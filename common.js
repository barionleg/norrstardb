(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{1004:function(e,t,i){var s=i(3),n=i(18),o=i(4),a=i(14),r=i(1003),l=i(1002),c=i(2756),h=i(2755),d=i(2754),u=["viewModel","configModel"];e.exports=o.extend({events:{"click .js-breadcrumb-dropdown":"_createBreadcrumbsDropdown","click .js-settings-dropdown":"_createSettingsDropdown"},initialize:function initialize(e){if(a(e,u,this),!this.options.el)throw new Error("el element is required");this.router=this.options.router,this._initBinds()},render:function render(){return this.clearSubViews(),this._renderBreadcrumbsDropdownLink(),this._renderNotifications(),this._renderLogoLink(),this},_initBinds:function _initBinds(){var e;s(e=this._viewModel).call(e,"change",this._renderBreadcrumbsDropdownLink,this),this.listenTo(this._viewModel,"change",this._renderBreadcrumbsDropdownLink),this.router&&this.listenTo(this.router.model,"change",this._onRouterChange),this.collection&&(this.listenTo(this.collection,"reset",this._stopLogoAnimation),this.listenTo(this.collection,"error",this._onCollectionError))},_onCollectionError:function _onCollectionError(e,t,i){(!t||t&&"abort"!==t.statusText)&&this._stopLogoAnimation()},_onRouterChange:function _onRouterChange(e,t){e.changed&&!e.changed.content_type&&this.collection.total_user_entries>0&&this._startLogoAnimation()},_startLogoAnimation:function _startLogoAnimation(){this.$(".Logo").addClass("is-loading")},_stopLogoAnimation:function _stopLogoAnimation(){this.$(".Logo").removeClass("is-loading")},_renderBreadcrumbsDropdownLink:function _renderBreadcrumbsDropdownLink(){this.$(".js-breadcrumb-dropdown").html(l({title:this._viewModel.breadcrumbTitle(),dropdownEnabled:this._viewModel.isBreadcrumbDropdownEnabled()}))},_renderNotifications:function _renderNotifications(){var e=new d({user:this.model,configModel:this._configModel,organizationNotifications:this.options.organizationNotifications});this.$(".js-user-notifications").html(e.render().el),this.addView(e)},_renderLogoLink:function _renderLogoLink(){this.$(".js-logo").html(r({homeUrl:this.model.viewUrl().dashboard(),googleEnabled:this.model.featureEnabled("google_maps")}))},_createSettingsDropdown:function _createSettingsDropdown(e){this.killEvent(e),this._setupDropdown(new c({target:n(e.target),model:this.model,configModel:this._configModel,horizontalOffset:15}))},_createBreadcrumbsDropdown:function _createBreadcrumbsDropdown(e){this._viewModel.isBreadcrumbDropdownEnabled()&&(this.killEvent(e),this._setupDropdown(new h({target:n(e.target),model:this.model,viewModel:this._viewModel,router:this.router,tick:"center",template:i(991),horizontalOffset:this.options.breadcrumbsDropdownOffset})))},_setupDropdown:function _setupDropdown(e){this._closeAnyOtherOpenDialogs(),this._previousDropDown=e,this.addView(e),e.on("onDropdownHidden",function(){e.clean()},this),e.render(),e.open()},_closeAnyOtherOpenDialogs:function _closeAnyOtherOpenDialogs(){this._previousDropDown&&this._previousDropDown.hide()}})},1006:function(e,t,i){var s=i(18),n=i(4),o=i(2822);e.exports=n.extend({events:{"click .js-dropdown-target":"_createDropdown"},_createDropdown:function _createDropdown(e){e&&e.preventDefault();var t=s(e.target),i=new o({target:t,verticalOffset:-10,horizontalOffset:t.width()-100,horizontalPosition:"left",tick:"center"});i.render(),i.on("onDropdownHidden",function(){i.clean()},this),i.open()}})},1009:function(e,t,i){var s=i(18),n=i(4),o=i(2824),a=i(1007);e.exports=n.extend({events:{"click .js-dropdown-target":"_createDropdown"},render:function render(){var e=this.model.viewUrl().dashboard(),t=e.datasets(),i=e.maps();return this.$el.html(a({avatarUrl:this.model.get("avatar_url"),mapsUrl:i,datasetsUrl:t})),this},_createDropdown:function _createDropdown(e){var t=new o({target:s(e.target),model:this.model,horizontalOffset:18});t.render(),t.on("onDropdownHidden",function(){t.clean()},this),t.open()}})},1033:function(e,t,i){var s=i(3),n=i(4),o=i(2880),a=i(2879),r=i(2877),l=i(1029),c=i(14),h="kuviz",d=["visDefinitionModel","userModel"];e.exports=n.extend({className:"Publish-modalShare u-inner",initialize:function initialize(e){c(e,d,this),this.hasOrganization=this._userModel.isInsideOrg(),this._mapcapsCollection=e.mapcapsCollection,this.isPublished=!!(this._visDefinitionModel.get("type")===h||this._mapcapsCollection&&this._mapcapsCollection.length>0);var t=o(this._visDefinitionModel);this._shareCollection=new a(t),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.html(l({isPublished:this.isPublished})),this._initViews(),this},_initViews:function _initViews(){var e,t=s(e=this._renderItemView).call(e,this);this._shareCollection.each(t)},_renderItemView:function _renderItemView(e){var t=new r({model:e,isPublished:this.isPublished,hasOrganization:this.hasOrganization});this.$(".js-list").append(t.render().el),this.addView(t)},_revampPrivacyOptions:function _revampPrivacyOptions(){var e=o(this._visDefinitionModel);this._shareCollection.reset(e)},_initBinds:function _initBinds(){this._visDefinitionModel.on("sync",this._revampPrivacyOptions,this),this.add_related_model(this._visDefinitionModel),this._shareCollection.on("reset",this.render,this),this.add_related_model(this._shareCollection),this._mapcapsCollection&&(this._mapcapsCollection.on("reset add",this.render,this),this.add_related_model(this._mapcapsCollection))}})},1038:function(e,t,i){var s=i(13),n=i(3),o=i(6),a=i(4),r=i(1),l=i(1266),c=i(1523),h=i(2888),d=i(1521),u=i(86),p=i(2887),g=i(2886),m=i(104),f=i(85),_=i(59);e.exports=a.extend({events:{"click .js-back":"_onBackFromError"},className:"Dialog-content Dialog-content--expanded",initialize:function initialize(e){if(!e.modalModel)throw new TypeError("modalModel is required");if(!e.visDefinitionModel)throw new TypeError("visDefinitionModel is required");this._modalModel=e.modalModel,this._visDefinitionModel=e.visDefinitionModel,this._visMetadataModel=new l({name:this._visDefinitionModel.get("name"),description:this._visDefinitionModel.get("description"),tags:this._visDefinitionModel.get("tags")}),this._stateModel=new o.Model({status:"show"}),this._initBinds()},render:function render(){return this.clearSubViews(),this._hasError()?this._renderError():this._isLoading()?this._renderLoading():(this.$el.html(c()),this._initViews()),this},_initViews:function _initViews(){var e,t,i=new p({visDefinitionModel:this._visDefinitionModel,visMetadataModel:this._visMetadataModel});this.$(".js-content").append(i.render().el),this.addView(i);var s=new h({visMetadataModel:this._visMetadataModel,onSaveAction:n(e=this._onSave).call(e,this),onCloseAction:n(t=this._onClose).call(t,this)});this.$(".js-footer").append(s.render().el),this.addView(s)},_renderError:function _renderError(){var e=this._stateModel.get("error");this.$el.html(d({error:_t("components.modals.maps-metadata.error.subtitle",{error:e})}))},_renderLoading:function _renderLoading(){this.$el.html(u({title:_t("components.modals.maps-metadata.loading")}))},_initBinds:function _initBinds(){this._stateModel.on("change:status",this.render,this),this.add_related_model(this._stateModel)},_hasError:function _hasError(){return"error"===this._stateModel.get("status")},_isLoading:function _isLoading(){return"loading"===this._stateModel.get("status")},_onSave:function _onSave(){var e,t;this._stateModel.set({status:"loading"}),g({onSuccess:n(e=this._onSuccessSave).call(e,this),onError:n(t=this._onErrorSave).call(t,this),visDefinitionModel:this._visDefinitionModel,name:this._getMetadataName(),description:this._getMetadataDescription(),tags:this._getMetadataTags()})},_onSuccessSave:function _onSuccessSave(){f.addNotification({status:"success",info:_t("components.modals.maps-metadata.success",{name:this._getMetadataName()}),closable:!0,delay:f.DEFAULT_DELAY}),this._modalModel.destroy()},_onClose:function _onClose(){this._modalModel.destroy()},_onErrorSave:function _onErrorSave(e){this._stateModel.set({status:"error",error:m(e)})},_onBackFromError:function _onBackFromError(){this._stateModel.set({status:"show"})},_getMetadataName:function _getMetadataName(){return _.sanitizeHtml(this._visMetadataModel.get("name"))},_getMetadataDescription:function _getMetadataDescription(){return _.sanitizeHtml(this._visMetadataModel.get("description"))},_getMetadataTags:function _getMetadataTags(){return s(r).call(r,this._visMetadataModel.get("tags"),function(e){return _.sanitizeHtml(e)})}})},104:function(e,t,i){i(37);var s=i(13),n=i(199),o=i(1);e.exports=function(e){if(!e)throw new Error("error is required");try{var t,i=e.responseText&&n(t=e.responseText).call(t)&&JSON.parse(e.responseText),a=e.statusText||"";if(i)a=o.compact(s(o).call(o,["errors","error"],function(e){return i[e]&&i[e].join(", ")})).join(", ");return a}catch(e){return""}}},1046:function(e,t,i){var s=i(6),n=i(1525);e.exports=s.Model.extend({defaults:{display_name:""},initialize:function initialize(e,t){this.parse(e||{},t)},parse:function parse(e,t){return this.users=new n(e.users,{group:this,configModel:t.configModel,organization:t.organization}),e}})},1047:function(e,t,i){var s=i(44),n=i(3),o=i(1),a=i(6),r=i(2914),l=i(743);e.exports=a.Model.extend({idAttribute:"item_queue_id",initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");this._configModel=t.configModel,this._initBinds(),this.poller=new r(this)},urlRoot:function urlRoot(){var e=this._configModel.urlVersion("import");return this._configModel.get("base_url")+"/api/"+e+"/imports"},_initBinds:function _initBinds(){var e;n(e=this).call(e,"change:item_queue_id",this._checkQueueId,this)},createImport:function createImport(e){var t=this._prepareData(e);this[0===t.interval?"_createRegularImport":"_createSyncImport"](t)},_checkQueueId:function _checkQueueId(){this.get("item_queue_id")&&this.pollCheck()},_prepareData:function _prepareData(e){var t={create_vis:e.create_vis,privacy:e.privacy},i=e.type;"remote"!==i&&o.extend(t,{type_guessing:e.type_guessing,content_guessing:e.content_guessing,interval:e.interval});var n=e.service_name;if("url"===i&&o.extend(t,{url:e.value}),"remote"===i&&o.extend(t,{type:"remote",interval:null,remote_visualization_id:e.remote_visualization_id,create_vis:!1,value:e.value}),"sql"===i&&o.extend(t,{table_name:e.table_name,sql:e.value}),"duplication"===i&&o.extend(t,{table_name:e.table_name,table_copy:e.value}),"service"===i){var a="twitter_search"===n?s(e.service_item_id):e.service_item_id;e.user_defined_limits&&(t.user_defined_limits=e.user_defined_limits),e.connector?o.extend(t,{value:e.value,connector:e.connector}):o.extend(t,{value:e.value,service_name:e.service_name,service_item_id:a})}return t},_createSyncImport:function _createSyncImport(e){var t=this;this._synchronizationModel=new l(e,{configModel:this._configModel}),this._synchronizationModel.save(null,{success:function success(e){t.set("item_queue_id",e.get("data_import").item_queue_id)},error:function error(e,i,s){t._setErrorState(i)}})},_createRegularImport:function _createRegularImport(e){var t=this;this.save(e,{error:function error(e,i,s){t._setErrorState(i)}})},_setErrorState:function _setErrorState(e){var t;try{t=e&&JSON.parse(e.responseText).errors.imports}catch(e){t=_t("data.import-model.error-starting-import")}this.set({state:"failure",get_error_text:{title:_t("data.import-model.error-title"),what_about:t}})},pollCheck:function pollCheck(){this.poller.start()},destroyCheck:function destroyCheck(){this.poller.stop()}})},1049:function(e,t,i){var s=i(68),n=i(44),o=i(7),a=i(18);e.exports={requestConnectorHubspot:function requestConnectorHubspot(e,t,i){var s,r=o(s="https://api.hsforms.com/submissions/v3/integration/submit/".concat("474999","/")).call(s,"1644a76c-4876-45ae-aa85-2420cd3fb3ff");return a.ajax({type:"POST",url:r,data:n(e),dataType:"json",contentType:"application/json",success:t,error:i})},getFormData:function getFormData(e,t,i){var n;return{fields:[{name:"email",value:e.get("email")},{name:"firstname",value:e.get("name")||"no_firstname"},{name:"lastname",value:e.get("last_name")||"no_last_name"},{name:"jobtitle",value:e.get("job_role")||"no_jobtitle"},{name:"company",value:e.get("company")||"no_company"},{name:"phone",value:e.get("phone")||"no_phone"},{name:"connector_request_type",value:i||"request"},{name:"connector_request_name",value:t}],context:{pageUri:window.location.href,pageName:s(n=window.location.href).call(n,"builder")?"Layer | CARTO":document.title}}}}},1050:function(e,t,i){i(269),i(268);var s=i(28),n=i(4),o=i(14),a=i(1531),r=i(1530),l=i(1049),c=["userModel","configModel","title","name"];e.exports=n.extend({step1:{selector:".js-step1",description:_t("components.modals.add-layer.imports.request.enable.desc"),buttonClass:"js-request",cta:_t("components.modals.add-layer.imports.request.enable.cta")},step3:{selector:".js-step3",titleClass:"title--success",title:_t("components.modals.add-layer.imports.request.success.title"),description:_t("components.modals.add-layer.imports.request.success.desc"),buttonClass:"js-ok success-icon",cta:_t("components.modals.add-layer.imports.request.ok")},step4:{selector:".js-step4",titleClass:"title--error",title:_t("components.modals.add-layer.imports.request.error.title"),description:_t("components.modals.add-layer.imports.request.error.desc"),buttonClass:"js-ok success-icon",cta:_t("components.modals.add-layer.imports.request.ok")},events:{"click .js-request":"_onRequest","click .js-ok":"_onReset"},initialize:function initialize(e){o(e,c,this)},render:function render(){return this.$el.html(a({name:this._name,title:this._title,isEnterprise:this._userModel.isEnterprise(),upgradeUrl:this._configModel.get("upgrade_url")})),this.$el.addClass("js-"+this._name+"Button"),this._renderSteps(),this},_renderSteps:function _renderSteps(){this.step1.title=this._title,this._renderStep(this.step1),this._renderStep(this.step3),this._renderStep(this.step4)},_renderStep:function _renderStep(e){var t;s(t=this.$el).call(t,e.selector).append(r({title:e.title,titleClass:e.titleClass,description:e.description,buttonClass:e.buttonClass,cta:e.cta}))},_goToStep:function _goToStep(e){this.$(".js-step").removeClass("is-active"),this.$(".js-step".concat(e)).addClass("is-active")},_onRequest:function _onRequest(){this.$el.addClass("is-active"),this._goToStep(2);var e=this,t=l.getFormData(this._userModel,this._title,this._getRequestType());l.requestConnectorHubspot(t,function(){e._goToStep(3)},function(){e._goToStep(4)})},_getRequestType:function _getRequestType(){return"enable"},_onReset:function _onReset(){this.$el.removeClass("is-active")}})},1051:function(e,t,i){"use strict";function enableButton(e){e.removeAttr("disabled"),e.removeClass("is-disabled")}function disableButton(e){e.attr("disabled","disabled"),e.addClass("is-disabled")}i.r(t),i.d(t,"enableButton",function(){return enableButton}),i.d(t,"disableButton",function(){return disableButton})},1052:function(e,t,i){(function(e){var t;(t=e).widget("ui.tagit",{options:{allowDuplicates:!1,caseSensitive:!0,fieldName:"tags",placeholderText:null,readOnly:!1,removeConfirmation:!1,tagLimit:null,availableTags:[],autocomplete:{},showAutocompleteOnFocus:!1,allowSpaces:!1,singleField:!1,singleFieldDelimiter:",",singleFieldNode:null,animate:!0,tabIndex:null,beforeTagAdded:null,afterTagAdded:null,beforeTagRemoved:null,afterTagRemoved:null,onTagClicked:null,onTagLimitExceeded:null,onTagAdded:null,onTagRemoved:null,tagSource:null,onSubmitTags:null,onFocus:null,onBlur:null},_create:function(){var e=this;this.element.is("input")?(this.tagList=t("<ul></ul>").insertAfter(this.element),this.options.singleField=!0,this.options.singleFieldNode=this.element,this.element.addClass("tagit-hidden-field")):this.tagList=this.element.find("ul, ol").andSelf().last(),this.tagInput=t('<input type="text" />').addClass("ui-widget-content"),this.options.readOnly&&this.tagInput.attr("disabled","disabled"),this.options.tabIndex&&this.tagInput.attr("tabindex",this.options.tabIndex),this.options.placeholderText&&this.tagInput.attr("placeholder",this.options.placeholderText),this.options.autocomplete.source||(this.options.autocomplete.source=function(e,i){var s=e.term.toLowerCase(),n=t.grep(this.options.availableTags,function(e){return 0===e.toLowerCase().indexOf(s)});this.options.allowDuplicates||(n=this._subtractArray(n,this.assignedTags())),i(n)}),this.options.showAutocompleteOnFocus&&(this.tagInput.focus(function(t,i){e._showAutocomplete()}),void 0===this.options.autocomplete.minLength&&(this.options.autocomplete.minLength=0)),t.isFunction(this.options.autocomplete.source)&&(this.options.autocomplete.source=t.proxy(this.options.autocomplete.source,this)),t.isFunction(this.options.tagSource)&&(this.options.tagSource=t.proxy(this.options.tagSource,this)),this.tagList.addClass("tagit").addClass("ui-widget ui-widget-content ui-corner-all").append(t('<li class="tagit-new"></li>').append(this.tagInput)).click(function(i){var s=t(i.target);if(s.hasClass("tagit-label")){var n=s.closest(".tagit-choice");n.hasClass("removed")||e._trigger("onTagClicked",i,{tag:n,tagLabel:e.tagLabel(n)})}else e.tagInput.focus()});var i=!1;if(this.options.singleField)if(this.options.singleFieldNode){var s=t(this.options.singleFieldNode),n=s.val().split(this.options.singleFieldDelimiter);s.val(""),t.each(n,function(t,s){e.createTag(s,null,!0),i=!0})}else this.options.singleFieldNode=t('<input type="hidden" style="display:none;" value="" name="'+this.options.fieldName+'" />'),this.tagList.after(this.options.singleFieldNode);if(i||this.tagList.children("li").each(function(){t(this).hasClass("tagit-new")||(e.createTag(t(this).text(),t(this).attr("class"),!0),t(this).remove())}),this.tagInput.keydown(function(i){if(i.which==t.ui.keyCode.BACKSPACE&&""===e.tagInput.val()){var s=e._lastTag();!e.options.removeConfirmation||s.hasClass("remove")?e.removeTag(s):e.options.removeConfirmation&&s.addClass("remove ui-state-highlight")}else e.options.removeConfirmation?e._lastTag().removeClass("remove ui-state-highlight"):i.which==t.ui.keyCode.ENTER&&""===e.tagInput.val()&&e._trigger("onSubmitTags",null,e.tagList);(i.which===t.ui.keyCode.COMMA&&!1===i.shiftKey||i.which===t.ui.keyCode.ENTER||i.which==t.ui.keyCode.TAB&&""!==e.tagInput.val()||i.which==t.ui.keyCode.SPACE&&!0!==e.options.allowSpaces&&('"'!=t.trim(e.tagInput.val()).replace(/^s*/,"").charAt(0)||'"'==t.trim(e.tagInput.val()).charAt(0)&&'"'==t.trim(e.tagInput.val()).charAt(t.trim(e.tagInput.val()).length-1)&&t.trim(e.tagInput.val()).length-1!=0))&&(i.which===t.ui.keyCode.ENTER&&""===e.tagInput.val()||i.preventDefault(),e.options.autocomplete.autoFocus&&e.tagInput.data("autocomplete-open")||(e.tagInput.autocomplete("close"),e.createTag(e._cleanedInput())))}).blur(function(t){e._trigger("onBlur",null,null),e.tagInput.data("autocomplete-open")||e.createTag(e._cleanedInput())}).focus(function(t){e._trigger("onFocus",null,null)}),this.options.availableTags||this.options.tagSource||this.options.autocomplete.source){var o={select:function(t,i){return e.createTag(i.item.value),!1}};t.extend(o,this.options.autocomplete),o.source=this.options.tagSource||o.source,this.tagInput.autocomplete(o).bind("autocompleteopen.tagit",function(t,i){e.tagInput.data("autocomplete-open",!0)}).bind("autocompleteclose.tagit",function(t,i){e.tagInput.data("autocomplete-open",!1)}),this.tagInput.autocomplete("widget").addClass("tagit-autocomplete")}},destroy:function(){return t.Widget.prototype.destroy.call(this),this.element.unbind(".tagit"),this.tagList.unbind(".tagit"),this.tagInput.removeData("autocomplete-open"),this.tagList.removeClass(["tagit","ui-widget","ui-widget-content","ui-corner-all","tagit-hidden-field"].join(" ")),this.element.is("input")?(this.element.removeClass("tagit-hidden-field"),this.tagList.remove()):(this.element.children("li").each(function(){t(this).hasClass("tagit-new")?t(this).remove():(t(this).removeClass(["tagit-choice","ui-widget-content","ui-state-default","ui-state-highlight","ui-corner-all","remove","tagit-choice-editable","tagit-choice-read-only"].join(" ")),t(this).text(t(this).children(".tagit-label").text()))}),this.singleFieldNode&&this.singleFieldNode.remove()),this},_cleanedInput:function(){return t.trim(this.tagInput.val().replace(/^"(.*)"$/,"$1"))},_lastTag:function(){return this.tagList.find(".tagit-choice:last:not(.removed)")},_tags:function(){return this.tagList.find(".tagit-choice:not(.removed)")},assignedTags:function(){var e=this,i=[];return this.options.singleField?""===(i=t(this.options.singleFieldNode).val().split(this.options.singleFieldDelimiter))[0]&&(i=[]):this._tags().each(function(){i.push(e.tagLabel(this))}),i},_updateSingleTagsField:function(e){t(this.options.singleFieldNode).val(e.join(this.options.singleFieldDelimiter)).trigger("change")},_subtractArray:function(e,i){for(var s=[],n=0;n<e.length;n++)-1==t.inArray(e[n],i)&&s.push(e[n]);return s},tagLabel:function(e){return this.options.singleField?t(e).find(".tagit-label:first").text():t(e).find("input:first").val()},_showAutocomplete:function(){this.tagInput.autocomplete("search","")},_findTagByLabel:function(e){var i=this,s=null;return this._tags().each(function(n){if(i._formatStr(e)==i._formatStr(i.tagLabel(this)))return s=t(this),!1}),s},_isNew:function(e){return!this._findTagByLabel(e)},_formatStr:function(e){return this.options.caseSensitive?e:t.trim(e.toLowerCase())},_effectExists:function(e){return Boolean(t.effects&&(t.effects[e]||t.effects.effect&&t.effects.effect[e]))},createTag:function(e,i,s){var n=this;if(e=t.trim(e),this.options.preprocessTag&&(e=this.options.preprocessTag(e)),""===e)return!1;if(!this.options.allowDuplicates&&!this._isNew(e)){var o=this._findTagByLabel(e);return!1!==this._trigger("onTagExists",null,{existingTag:o,duringInitialization:s})&&this._effectExists("highlight")&&o.effect("highlight"),!1}if(this.options.tagLimit&&this._tags().length>=this.options.tagLimit)return this._trigger("onTagLimitExceeded",null,{duringInitialization:s}),!1;var a=t(this.options.onTagClicked?'<a class="tagit-label"></a>':'<span class="tagit-label"></span>').text(e),r=t("<li></li>").addClass("tagit-choice ui-widget-content ui-state-default ui-corner-all").addClass(i).append(a);if(this.options.readOnly)r.addClass("tagit-choice-read-only");else{r.addClass("tagit-choice-editable");var l=t("<span></span>").addClass("ui-icon ui-icon-close"),c=t('<a><span class="text-icon">\xd7</span></a>').addClass("tagit-close").append(l).click(function(e){n.removeTag(r)});r.append(c)}if(!this.options.singleField){var h=a.html();r.append('<input type="hidden" value="'+h+'" name="'+this.options.fieldName+'" class="tagit-hidden-field" />')}if(!1!==this._trigger("beforeTagAdded",null,{tag:r,tagLabel:this.tagLabel(r),duringInitialization:s})){if(this.options.singleField){var d=this.assignedTags();d.push(e),this._updateSingleTagsField(d)}this._trigger("onTagAdded",null,r),this.tagInput.val(""),this.tagInput.parent().before(r),this._trigger("afterTagAdded",null,{tag:r,tagLabel:this.tagLabel(r),duringInitialization:s}),this.options.showAutocompleteOnFocus&&!s&&setTimeout(function(){n._showAutocomplete()},0)}},removeTag:function(e,i){if(i=void 0===i?this.options.animate:i,e=t(e),this._trigger("onTagRemoved",null,e),!1!==this._trigger("beforeTagRemoved",null,{tag:e,tagLabel:this.tagLabel(e)})){if(this.options.singleField){var s=this.assignedTags(),n=this.tagLabel(e);s=t.grep(s,function(e){return e!=n}),this._updateSingleTagsField(s)}if(i){e.addClass("removed");var o=this._effectExists("blind")?["blind",{direction:"horizontal"},"fast"]:["fast"],a=this;o.push(function(){e.remove(),a._trigger("afterTagRemoved",null,{tag:e,tagLabel:a.tagLabel(e)})}),e.fadeOut("fast").hide.apply(e,o).dequeue()}else e.remove(),this._trigger("afterTagRemoved",null,{tag:e,tagLabel:this.tagLabel(e)})}},removeTagByLabel:function(e,t){var i=this._findTagByLabel(e);if(!i)throw"No such tag exists with the name '"+e+"'";this.removeTag(i,t)},removeAll:function(){var e=this;this._tags().each(function(t,i){e.removeTag(i,!1)})}})}).call(this,i(18))},1053:function(e,t,i){var s=i(6),n=i(1054),o=i(14),a=["configModel","userModel"];e.exports=s.Collection.extend({model:n,url:function url(e){return this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("asset",e)+"/users/"+this._userModel.get("id")+"/assets"},initialize:function initialize(e,t){o(t,a,this)},parse:function parse(e,t){return e.assets},selectAll:function selectAll(){this.each(function(e){e.set("state","selected")})},deselectAll:function deselectAll(e){this.each(function(t){t!==e&&"selected"===t.get("state")&&t.set("state","")})}})},1054:function(e,t,i){i(35);var s=i(430),n=i(3),o=i(1),a=i(6),r=i(59);i(1059),e.exports=a.Model.extend({fileAttribute:"filename",defaults:{type:"",filename:"",interval:0,progress:0,state:"idle",option:""},_initBinds:function _initBinds(){var e,t,i;n(e=this).call(e,"progress",function(e){this.set({progress:100*e,state:"uploading"})},this),n(t=this).call(t,"change:filename change:url",function(){"error"===this.get("state")&&(this.set({state:"idle"}),this.unset("get_error_text",{silent:!0}))},this),n(i=this).call(i,"error invalid",function(e,t){this.set({state:"error",error_code:t&&t.error_code||"",get_error_text:{title:_t("componentes.data.asset-model.invalid-import"),what_about:t&&t.msg||""}},{silent:!0}),this.trigger("change")},this)},validate:function validate(e){if(e){if("filename"===e.type){if(e.filename&&e.filename.length)return{msg:_t("componentes.data.asset-model.one-file-per-upload")};var t=e.filename.name,i=t.substr(s(t).call(t,".")+1);if(i&&(i=i.toLowerCase()),!o.contains(["jpg","png","gif","svg"],i))return{msg:_t("componentes.data.asset-model.invalid-extension")}}return"url"!==e.type||r.isURL(e.url)?void 0:{msg:_t("componentes.data.asset-model.invalid-url")}}},isValid:function isValid(){return(this.get("filename")||this.get("url"))&&"error"!==this.get("state")},upload:function upload(){var e=this,t={kind:this.get("kind")};"file"===this.get("type")?t.filename=this.get("filename"):"url"===this.get("type")&&(t.filename=this.get("filename")),this.xhr=this.save(t,{success:function success(e){e.set("state","uploaded")},error:function error(t,i){var s=_t("componentes.data.asset-model.connection-error");i&&429===i.status?s=JSON.parse(i.responseText).error:i&&400===i.status&&(s=JSON.parse(i.responseText).error),e.set({state:"error",get_error_text:{title:_t("componentes.data.asset-model.error"),what_about:s}})},complete:function complete(){delete e.xhr}})},stopUpload:function stopUpload(){this.xhr&&this.xhr.abort()}})},1055:function(e,t,i){var s=i(13),n=i(3),o=i(28),a=i(4),r=i(786),l=i(3004),c=i(553),h=i(504),d=i(1558),u=i(1557),p=i(621),g=i(775),m=i(1560);e.exports=a.extend({events:{"click .js-show-collection":"_onClickShowCollection"},initialize:function initialize(e){if(!e.configModel)throw new Error("configModel is required");if(!e.userModel)throw new Error("userModel is required");if(!e.modals)throw new Error("modals is required");this._configModel=e.configModel,this._userModel=e.userModel,this._modals=e.modals,this._initCarouselCollection(),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.html(r()),this._renderAssets(),this},_initBinds:function _initBinds(){this.listenTo(this._carouselCollection,"change:selected",this._onSelectAsset),this.listenTo(this._carouselCollection,"reset",this.render)},_resetCarouselCollection:function _resetCarouselCollection(e){var t;this._icons.reset(m.icons);var i=o(t=this._carouselCollection).call(t,function(t){return t.get("url")===e});i&&i.set("selected",!0),this._icons.unshift(this._resetAsset),this._carouselCollection.reset(this._getIcons())},_initCarouselCollection:function _initCarouselCollection(){var e;this._icons=new d(m.icons),this.add_related_model(this._icons),this._resetAsset=new u({type:"none",selected:!this._getIconSelected(),name:_t("form-components.editors.fill.image.none"),action:n(e=function _context2(e){this._resetImage(e)}).call(e,this)}),this._icons.unshift(this._resetAsset),this._carouselCollection=new h(this._getIcons()),this.add_related_model(this._carouselCollection)},_getIcons:function _getIcons(){var e,t,i=n(e=function _context3(e){this._changeIcon(e)}).call(e,this);return s(t=this._icons).call(t,function(e){var t=e.get("type")?e.get("type"):"icon",s=e.get("action")?e.get("action"):i,n=this._getIconSelected();return{selected:e.get("selected")||e.getURLFor(e.get("icon"))===n,icon:e,type:t,name:e.get("name"),url:e.get("public_url"),action:s,template:function template(){return p({type:t,public_url:e.get("public_url")+"?req=markup",name:e.get("name")})}}},this)},_getIconSelected:function _getIconSelected(){if(this.model.get("ramp")){var e=this.model.get("index")||0;return this.model.get("ramp")[e].image||""}return this.model.get("image")||""},_renderAssets:function _renderAssets(){this.clearSubViews(),this.$el.html(r());var e=new c({collection:this._carouselCollection,template:g,listItemOptions:{className:"Carousel-item AssetListItem"},itemOptions:{className:"AssetItem-button"}});this.addView(e),this.$(".js-assets").append(e.render().el)},_onSelectAsset:function _onSelectAsset(e){e.get("action")(e)},_changeIcon:function _changeIcon(e){var t=e.get("icon");this.trigger("change",{url:t.get("public_url"),kind:t.get("kind")},this)},_resetImage:function _resetImage(){this.trigger("change",null,this)},_onClickShowCollection:function _onClickShowCollection(e){this.killEvent(e);var t=this;this._modals.create(function(e){var i;return t._assetsView=new l({model:t.model,modalModel:e,configModel:t._configModel,userModel:t._userModel}),n(i=t._assetsView).call(i,"change",t._resetAssetsView,t),t._assetsView},{breadcrumbsEnabled:!0})},_resetAssetsView:function _resetAssetsView(e){this._resetCarouselCollection(e.url),this.trigger("change",e,this)},_destroyDocumentBinds:function _destroyDocumentBinds(){this._assetsView&&this._assetsView.unbind("change",self._resetAssetsView,self)},clean:function clean(){this._destroyDocumentBinds(),this.trigger("onClean",this),a.prototype.clean.apply(this)}})},1056:function(e,t,i){var s=i(3),n=i(4),o=i(623);e.exports=n.extend({className:"Editor-boxModal Editor-FormDialog js-formDialog is-opening",initialize:function initialize(){this._initBinds()},render:function render(){return this.clearSubViews(),this._renderContentView(),this},_renderContentView:function _renderContentView(){var e,t=this.model.createContentView();this.addView(t),this.$el.append(t.render().$el),this.dropdownOverlay=new o({onClickAction:s(e=this.hide).call(e,this),visible:!0}),this.addView(this.dropdownOverlay)},_initBinds:function _initBinds(){this.listenTo(this.model,"change:show",this._onShowChange),this.listenTo(this.model,"destroy",this._onDestroy)},_onShowChange:function _onShowChange(e,t){t?(this.$el.show(),this.$el.removeClass("is-closing").addClass("is-opening")):(this.$el.removeClass("is-opening").addClass("is-closing"),this.$el.hide())},show:function show(){this.model.show()},hide:function hide(){this.model.hide()},_onDestroy:function _onDestroy(){this.hide(),this.dropdownOverlay&&this.dropdownOverlay.clean(),this.clean()}})},1057:function(e,t,i){var s=i(7),n=i(38),o=i(6),a=i(4);e.exports=o.Model.extend({defaults:{visible:!0,createContentView:function createContentView(){return new a}},createContentView:function createContentView(){return this.get("createContentView")(this)},show:function show(){this.set("visible",!0)},hide:function hide(){this.set("visible",!1)},isHidden:function isHidden(){return!this.get("visible")},destroy:function destroy(){var e,t=n(Array.prototype).call(arguments);this.trigger.apply(this,s(e=["destroy"]).call(e,t))}})},1060:function(e,t,i){i(31);var s=i(3);i(31);var n=i(4),o=i(345);e.exports=n.extend({initialize:function initialize(e){if(!e.userModel)throw new Error("userModel is required");if(!e.configModel)throw new Error("configModel is required");this._configModel=e.configModel,this._userModel=e.userModel,this.model=new o(null,{configModel:this._configModel,userModel:this._userModel}),this._initBinds()},_initBinds:function _initBinds(){var e;s(e=this.model).call(e,"change",this._triggerChange,this)},_triggerChange:function _triggerChange(){this.trigger("change",this.model.toJSON(),this)},getModelData:function getModelData(){return this.model?this.model.toJSON():{}}})},1063:function(e,t,i){var s=i(18);function isMacCmdKeyPressed(e){return e.metaKey}e.exports=function(e){this.killEvent(e);var t=s(e.target).closest("a").attr("href");if(!t)return!1;if(function isLinuxMiddleOrRightClick(e){return 2===e.which||3===e.which}(e)||isMacCmdKeyPressed(e))((function isCtrlKeyPressed(e){return e.ctrlKey})(e)||isMacCmdKeyPressed(e))&&window.open(t,"_blank");else{var i=this.routerModel||this.options.routerModel||this.options.router;if(!i)throw new Error("routerModel is required");i.navigate(t,{trigger:!0})}}},1209:function(e,t){e.exports={types:["POINT","LINESTRING","POLYGON","MULTIPOINT","MULTILINESTRING","MULTIPOLYGON"]}},1210:function(e,t,i){i(23),i(326);var s=i(199),n=i(235),o=i(1);e.exports={sortSchema:function sortSchema(e){var t,i={cartodb_id:1,the_geom:2,__default__:3,created_at:4,updated_at:5};function priority(e){return i[e]||i.__default__}return n(t=o.chain(e).clone()).call(t,function(e,t){var i=priority(e[0]),s=priority(t[0]);return i<s?-1:i>s?1:e[0]<t[0]?-1:1}).value()},alterTable:function alterTable(e){return-1!==(e=s(e).call(e)).search(/alter\s+[\w\."]+\s+/i)||-1!==e.search(/drop\s+[\w\.\"]+/i)||-1!==e.search(/^vacuum\s+[\w\.\"]+/i)||-1!==e.search(/^create\s+[\w\.\"]+/i)||-1!==e.search(/^reindex\s+[\w\.\"]+/i)||-1!==e.search(/^grant\s+[\w\.\"]+/i)||-1!==e.search(/^revoke\s+[\w\.\"]+/i)||-1!==e.search(/^cluster\s+[\w\.\"]+/i)||-1!==e.search(/^comment\s+on\s+[\w\.\"]+/i)||-1!==e.search(/^explain\s+[\w\.\"]+/i)},alterTableData:function alterTableData(e){return this.alterTable(e)||-1!==e.search(/^refresh\s+materialized\s+view\s+[\w\.\"]+/i)||-1!==e.search(/^truncate\s+[\w\.\"]+/i)||-1!==e.search(/insert\s+into/i)||-1!==e.search(/update\s+[\w\.\-"]+\s+.*set/i)||-1!==e.search(/delete\s+from/i)}}},1211:function(e,t,i){var s=i(32);e.exports=function(e){return void 0===e||-1===s(e).call(e,"-")||'"'===e[0]||'"'===e[e.length-1]?e:'"'+e+'"'}},1212:function(e,t,i){var s=i(6);e.exports=function(e,t,i){this._xhr&&this._xhr.abort();var n=this._xhr=s.Model.prototype.sync.apply(this,arguments);return n.always(function(){t._xhr=null}),n}},1213:function(e,t,i){var s=i(470).extend({edit:function edit(e){if(!e)throw new Error("User is needed to create the url");return this.urlToPath(e.get("username")+"/edit")},create:function create(){return this.urlToPath("new")},groups:function groups(){return this.urlToPath("groups")}});e.exports=s},1214:function(e,t,i){var s=i(470).extend({lockedItems:function lockedItems(){return this.urlToPath("locked")},sharedItems:function sharedItems(){return this.urlToPath("shared")},likedItems:function likedItems(){return this.urlToPath("liked")}});e.exports=s},1227:function(e,t,i){var s=i(6),n=i(667),o=i(14),a=["configModel"];e.exports=s.Collection.extend({model:function model(e,t){var i=t.collection;return new n(e,{collection:i,configModel:i._configModel})},url:function url(e){return"/api/"+this._configModel.urlVersion("organizationGroups",e)+"/organization/"+this.organization.id+"/groups"},initialize:function initialize(e,t){if(o(t,a,this),!t.organization)throw new Error("organization is required");this.organization=t.organization},parse:function parse(e){return this.total_entries=e.total_entries,e.groups},newGroupById:function newGroupById(e){var t=this.get(e);return t||(t=new n({id:e},{configModel:this._configModel,collection:this})),t},totalCount:function totalCount(){return this.total_entries}})},1228:function(e,t){(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function Dragster(e){this.el=e,this.dragleave=t(this.dragleave,this),this.dragenter=t(this.dragenter,this),this.first=!1,this.second=!1,this.el.addEventListener("dragenter",this.dragenter,!1),this.el.addEventListener("dragleave",this.dragleave,!1)}return Dragster.prototype.dragenter=function(e){return this.first?this.second=!0:(this.first=!0,this.customEvent=document.createEvent("CustomEvent"),this.customEvent.initCustomEvent("dragster:enter",!0,!0,{dataTransfer:e.dataTransfer,sourceEvent:e}),this.el.dispatchEvent(this.customEvent))},Dragster.prototype.dragleave=function(e){if(this.second?this.second=!1:this.first&&(this.first=!1),!this.first&&!this.second)return this.customEvent=document.createEvent("CustomEvent"),this.customEvent.initCustomEvent("dragster:leave",!0,!0,{dataTransfer:e.dataTransfer,sourceEvent:e}),this.el.dispatchEvent(this.customEvent)},Dragster.prototype.removeListeners=function(){return this.el.removeEventListener("dragenter",this.dragenter,!1),this.el.removeEventListener("dragleave",this.dragleave,!1)},Dragster.prototype.reset=function(){return this.first=!1,this.second=!1},Dragster}(),window.Dragster=e}).call(this)},1266:function(e,t,i){i(35);var s=i(6);e.exports=s.Model.extend({defaults:{name:""},validate:function validate(e){if(e)return e.name?void 0:_t("components.modals.maps-metadata.validation.error.name")}})},1273:function(e,t,i){var s=i(3),n=i(1),o=i(4),a=i(1044),r=i(2895),l=i(2894),c=i(2892),h=["configModel","currentUserId","organization","visDefinitionModel"];e.exports=o.extend({initialize:function initialize(e){n.each(h,function(t){if(!e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this),this._grantablesCollection=new r([],{currentUserId:this._currentUserId,organization:this._organization,configModel:this._configModel}),this._sharePermissionModel=this._visDefinitionModel.getPermissionModel().clone(),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.html(a({name:this._visDefinitionModel.get("name")})),this._initViews(),this},_initBinds:function _initBinds(){this._sharePermissionModel.acl.on("add remove reset change",this._onSave,this),this.add_related_model(this._sharePermissionModel.acl)},_initViews:function _initViews(){var e=this;this._searchPaginationView=new l({className:"u-inner",listCollection:this._grantablesCollection,createContentView:function createContentView(t){return new c(n.extend({},t,{collection:e._grantablesCollection,currentUserId:e._currentUserId,sharePermissionModel:e._sharePermissionModel,organization:e._organization,isVisualization:e._visDefinitionModel.isVisualization()}))}}),this.addView(this._searchPaginationView),this.$(".js-body").html(this._searchPaginationView.render().el)},_onCancel:function _onCancel(){this._modalModel.destroy()},_onBack:function _onBack(){this._modalModel.destroy(),this._onBack()},_onSave:function _onSave(){var e,t=this._visDefinitionModel.getPermissionModel();t.overwriteAcl(this._sharePermissionModel),t.save().fail(s(e=this._searchPaginationView.showError).call(e,this._searchPaginationView))}})},1274:function(e,t,i){var s=i(6);e.exports=s.Collection.extend({initialize:function initialize(e,t){if(!t.visDefinitionModel)throw new Error("visDefinitionModel is required");this.url=t.visDefinitionModel.mapcapsURL()}})},1276:function(e,t){var i={st_multipolygon:"polygon",st_polygon:"polygon",st_multilinestring:"line",st_linestring:"line",st_multipoint:"point",st_point:"point"};e.exports=function(e){return i[e.toLowerCase()]}},1277:function(e,t,i){var s=i(3),n=i(4),o=i(1),a=i(3079),r=i(3074),l=i(259),c=i(241),h=i(14),d=i(627),u=i(345),p=["createModel","userModel","configModel","privacyModel","guessingModel"];e.exports=n.extend({className:"CreateDialog-listing CreateDialog-listing--noPaddingTop",initialize:function initialize(e){h(e,p,this),this._initBinds(),this._onChangeListing()},render:function render(){return this.clearSubViews(),this._initViews(),this},_initBinds:function _initBinds(){this.listenTo(this._createModel,"change:listing",this._onChangeListing)},_initViews:function _initViews(){var e=this,t=[];t.push({name:"datasets",selected:!1,createContentView:function createContentView(){return new a({userModel:e._userModel,createModel:e._createModel})}}),this._userModel.canCreateDatasets()&&(t.push({name:"upload",selected:!1,createContentView:function createContentView(){return new d({userModel:e._userModel,configModel:e._configModel,createModel:e._createModel,privacyModel:e._privacyModel,guessingModel:e._guessingModel,type:"url",fileEnabled:!0,acceptSync:!0})}}),t.push({name:"import",selected:!1,createContentView:function createContentView(){var t=new r({userModel:e._userModel,configModel:e._configModel,createModel:e._createModel,privacyModel:e._privacyModel,guessingModel:e._guessingModel});return s(t).call(t,"toggleNavigation",e._toggleNavigation,e),t}})),this._tabPaneCollection=new c(t);var i=new l({collection:this._tabPaneCollection});this.addView(i),this.$el.append(i.render().el)},_onChangeListing:function _onChangeListing(){if(this._tabPaneCollection){var e=this._createModel.get("listing");o.first(this._tabPaneCollection.where({name:e})).set("selected",!0),this._resetUploadModel()}},_resetUploadModel:function _resetUploadModel(){this._setUploadModel(new u(null,{configModel:this._configModel,userModel:this._userModel}).attributes)},_setUploadModel:function _setUploadModel(e){this._createModel.getUploadModel().setFresh(e)},_toggleNavigation:function _toggleNavigation(){this._createModel.get("navigationVisible")?this._createModel.set("navigationVisible",!1):this._createModel.set("navigationVisible",!0)}})},1279:function(e,t,i){i(23),i(40),i(326);var s=i(199),n=i(84),o=i(6),a=i(4),r=i(18),l=i(1),c=i(14),h=i(1585),d=["configModel","createModel","userModel","routerModel","tablesCollection"];e.exports=a.extend({events:{"submit .js-search-form":"_submitSearch","keydown .js-search-form":"_onSearchKeyDown","click .js-search-form":"killEvent","click .js-search-link":"_onSearchClick","click .js-clean-search":"_onCleanSearchClick","click .js-shared":"_onSharedClick","click .js-library":"_onLibraryClick","click .js-connect":"_onConnectClick","click .js-upload":"_onUploadClick","click .js-datasets":"_onDatasetsClick","click .js-create-empty":"_onCreateEmptyClick"},initialize:function initialize(e){c(e,d,this),this.model=new o.Model,this._preRender(),this._initBinds()},_preRender:function _preRender(){var e=r("<div>").addClass("u-inner"),t=r("<div>").addClass("Filters-inner");this.$el.append(e.append(t))},render:function render(e,t){return this.clearSubViews(),this.$(".Filters-inner").html(h(l.extend({showDatasets:this._createModel.showDatasets(),createModelType:this._createModel.get("type"),canCreateDataset:this._userModel.canCreateDatasets(),listingType:this._createModel.get("listing"),isInsideOrg:this._userModel.isInsideOrg(),totalShared:this._tablesCollection.getTotalStat("total_shared"),selectedItemsCount:this._selectedItems().length,hasDataLibrary:this._configModel.dataLibraryEnabled()},this._routerModel.attributes))),this._animate(),this._routerModel.isSearching()&&this._focusSearchInput(),this},_initBinds:function _initBinds(){this.listenTo(this.model,"change:isSearchEnabled",this._onChangeIsSearchEnabled,this),this.listenTo(this._createModel,"change:listing",this.render,this),this.listenTo(this._routerModel,"change",this.render,this),this.listenTo(this._tablesCollection,"sync",this.render,this)},_onChangeIsSearchEnabled:function _onChangeIsSearchEnabled(e,t){this._enableSearchUI(t),this._routerModel.isSearching()?this._cleanSearch():t&&(this._$searchInput().val(""),this._focusSearchInput())},_$searchInput:function _$searchInput(){return this.$(".js-search-input")},_focusSearchInput:function _focusSearchInput(){this._$searchInput().select().focus()},_onSearchKeyDown:function _onSearchKeyDown(e){27===e.keyCode&&(this.killEvent(e),this._cleanSearch())},_selectedItems:function _selectedItems(){return this._tablesCollection.where({selected:!0})},_animate:function _animate(){this._enableSearchUI(!!this._routerModel.isSearching());var e=this._routerModel.get("library"),t="datasets"===this._createModel.get("listing"),i=this._tablesCollection.getTotalStat("total_user_entries")>0;this.$el.toggleClass("no-shadow",e&&!i&&t)},_enableSearchUI:function _enableSearchUI(e){this.$(".js-search-field").toggle(e),this.$(".js-links-list").toggleClass("is-hidden",e),this.$(".js-order-list").toggleClass("is-hidden",e)},_onDatasetsClick:function _onDatasetsClick(){this._routerModel.set({shared:"no",library:!1,page:1}),this._routerModel.trigger("change",this._routerModel),this._createModel.set("listing","datasets")},_onSharedClick:function _onSharedClick(){this._routerModel.set({shared:"only",library:!1,page:1}),this._routerModel.trigger("change",this._routerModel),this._createModel.set("listing","datasets")},_onLibraryClick:function _onLibraryClick(){this._routerModel.set({shared:"no",library:!0,page:1}),this._routerModel.trigger("change",this._routerModel),this._createModel.set("listing","datasets")},_onConnectClick:function _onConnectClick(){this._userModel.canCreateDatasets()&&this._createModel.set("listing","import")},_onUploadClick:function _onUploadClick(){this._userModel.canCreateDatasets()&&this._createModel.set("listing","upload")},_onCreateEmptyClick:function _onCreateEmptyClick(){this._userModel.canCreateDatasets()&&this._createModel.createFromScratch()},_onSearchClick:function _onSearchClick(e){this.killEvent(e),this.model.set("isSearchEnabled",!this.model.get("isSearchEnabled"))},_onCleanSearchClick:function _onCleanSearchClick(e){e&&e.preventDefault(),this._cleanSearch()},_cleanSearch:function _cleanSearch(){this._routerModel.set({q:"",tag:"",shared:"no",library:this._createModel.showLibrary()}),this.model.set("isSearchEnabled",!1)},_submitSearch:function _submitSearch(e){var t;this.killEvent(e);var i=n.core.sanitize.html(s(t=this.$(".js-search-input").val()).call(t)),o=0===i.search(":")?i.replace(":",""):"",a=0!==i.search(":")?i:"";this._routerModel.set({page:1,tag:o,q:a,shared:"yes"}),this._createModel.set("listing","datasets")}})},1280:function(e,t,i){var s=i(3),n=i(4),o=i(18),a=i(1647),r=i(58),l=i(14),c=["createModel","privacyModel","configModel","userModel"];e.exports=n.extend({events:{click:"_onClick"},initialize:function initialize(e){l(e,c,this),this._initBinds()},render:function render(){if(this.clearSubViews(),this.$el.empty(),this._createModel.showPrivacyToggler()){var e=this._userModel.canCreatePrivateDatasets(),t=this._privacyModel.get("privacy"),i="PUBLIC"===t,s=i?"PRIVATE":"PUBLIC",n=i?"unlock":"lock",o=this._configModel.get("upgrade_url")||window.upgrade_url,r=!this._configModel.get("cartodb_com_hosted")&&!e&&o;this.$el.html(a({privacy:t,isDisabled:!e,canUpgrade:r,nextPrivacy:s,upgradeUrl:o,icon:n})),this._initViews()}return this},_initBinds:function _initBinds(){var e;s(e=this._privacyModel).call(e,"change:privacy",this.render,this)},_initViews:function _initViews(){this.addView(new r({el:this.$(".js-toggler"),html:!0,title:function title(){return o(this).attr("data-title")}}))},_onClick:function _onClick(){if(this._userModel.canCreatePrivateDatasets()){var e=this._privacyModel.get("privacy");this._privacyModel.set("privacy","PUBLIC"===e?"PRIVATE":"PUBLIC")}}})},1281:function(e,t,i){var s=i(3),n=i(4),o=i(1648),a=i(14),r=["createModel","guessingModel","configModel","userModel"];e.exports=n.extend({events:{"click .js-toggle":"_toggle"},initialize:function initialize(e){a(e,r,this),this._initBinds()},render:function render(){var e="";if(this._createModel.showGuessingToggler()){var t=this._createModel.getUploadModel();e=o({isGuessingEnabled:this._guessingModel.get("guessing"),importState:this._createModel.getImportState(),isUploadValid:t.isValidToUpload(),customHosted:this._configModel.get("cartodb_com_hosted"),isTwitterDeprecatedForUser:!this._userModel.hasOwnTwitterCredentials()})}return this.$el.html(e),this},_initBinds:function _initBinds(){var e,t;s(e=this._createModel).call(e,"change",this.render,this),s(t=this._guessingModel).call(t,"change",this.render,this),this.add_related_model(this._createModel)},_toggle:function _toggle(){var e=!this._guessingModel.get("guessing");this._guessingModel.set("guessing",e)}})},1359:function(e,t){e.exports=[{keywords:"alter and as asc between by count create delete desc distinct drop from group having in insert into is join like not on or order select set table union update values where limit",type:"Sql"},{keywords:"ST_GeometryType ST_polygon ST_multipolygon ST_multilinestring ST_linestring ST_multipoint ST_point",type:"Postgis"}]},1362:function(e,t,i){var s=i(13),n=i(3),o=i(38),a=i(1),r=i(6),l=i(4),c=i(955),h=i(492),d=i(85),u=i(84),p=i(14),g=["configModel","editorModel","layerDefinitionModel","querySchemaModel"];e.exports=l.extend({initialize:function initialize(e){p(e,g,this),this._clearSQLModel=new r.Model({visible:!1}),this._sqlModel=this._layerDefinitionModel.sqlModel,this._SQL=new u.SQL({user:this._configModel.get("user_name"),sql_api_template:this._configModel.get("sql_api_template"),api_key:this._configModel.get("api_key")}),this._codemirrorModel=new r.Model({content:this._querySchemaModel.get("query"),readonly:!1}),this._applyButtonStatusModel=new r.Model({loading:!1}),c.track(this)},_internalParseSQL:function _internalParseSQL(e){var t=this._querySchemaModel.get("query"),i=this._codemirrorModel.get("content");i&&";"===o(i).call(i,-1)&&(i=o(i).call(i,0,i.length-1),this._codemirrorModel.set("content",i));var s,a,r,l=h.isSameQuery(i,t),u=h.altersData(i);if(""===i||l)return c.removeNotification(),!1;u?(c.showNotification({status:"loading",info:_t("notifications.sql.alter-loading"),closable:!1}),this._applyButtonStatusModel.set("loading",!0),this._sqlModel.set("content",i),this._SQL.execute(i,null,{success:n(s=function _context(){c.showNotification({status:"success",info:_t("notifications.sql.alter-success"),closable:!0,delay:d.DEFAULT_DELAY}),this._applyButtonStatusModel.set("loading",!1),this._applyDefaultSQLAfterAlteringData(),"function"==typeof e&&e.call(this)}).call(s,this),error:n(a=function _context2(e){var t=this._parseErrors(e.responseJSON&&e.responseJSON.error);this._applyButtonStatusModel.set("loading",!1),this._codemirrorModel.set("errors",t),c.showErrorNotification(t),this._checkClearButton()}).call(a,this)})):this._runQuery(i,n(r=this._saveSQL).call(r,this))},_checkClearButton:function _checkClearButton(){var e=this._codemirrorModel.get("content"),t=h.isSameQuery(e,this._defaultSQL());this._clearSQLModel.set({visible:!t})},_applyDefaultSQLAfterAlteringData:function _applyDefaultSQLAfterAlteringData(){var e=this._defaultSQL();this._codemirrorModel.set({content:e,errors:[]}),this._sqlModel.set("content",e),this._querySchemaModel.set("query_errors",[]),this._clearSQLModel.set({visible:!1}),this._querySchemaModel.resetDueToAlteredData(),this._clearSQL()},_clearSQL:function _clearSQL(){var e,t=this._defaultSQL();this._codemirrorModel.set({content:t,errors:[]}),this._runQuery(t,n(e=this._saveSQL).call(e,this))},_showErrors:function _showErrors(e){var t=this._querySchemaModel.get("query_errors");this._forceErrors(t),this._checkClearButton()},_forceErrors:function _forceErrors(e,t){var i=e&&e.length>0,s=i&&this._parseErrors(e),n=t&&!1===t.showEditorError?[]:s;this._codemirrorModel.set("errors",n),this._editorModel.set("disabled",i),i&&c.showErrorNotification(s)},_parseErrors:function _parseErrors(e){return e?(e=a.isArray(e)?e:[e],s(e).call(e,function(e){return{message:e}})):[]}})},1364:function(e,t,i){i(23),i(40);var s=i(3),n=i(89),o=i(44),a=i(4),r=i(1363),l=i(86),c=i(264),h=i(104);e.exports=a.extend({className:"Dialog-content",events:{"click .js-confirm":"_onConfirm","click .js-cancel":"_onCancel"},initialize:function initialize(e){if(!e.modalModel)throw new Error("modalModel is required");if(!e.syncModel)throw new Error("syncModel is required");if(!e.tableName)throw new Error("tableName is required");this._syncModel=e.syncModel,this._modalModel=e.modalModel,this._tableName=e.tableName},render:function render(){this.clearSubViews(),this.$el.html(r({interval:this._syncModel.get("interval"),service:this._syncModel.get("service_name")||"",isExternalSource:this._syncModel.get("from_external_source"),url:this._getServiceURL()}))},_renderErrorView:function _renderErrorView(e){var t=new c({title:_t("dataset.sync.error"),desc:e});this.$el.html(t.render().el),this.addView(t)},_renderLoadingView:function _renderLoadingView(){this.$el.html(l({title:_t("dataset.sync.loading",{tableName:this._tableName})}))},_getServiceURL:function _getServiceURL(){var e=this._syncModel.get("service_name"),t=this._syncModel.get("service_item_id");if(e||t){if("connector"===e){try{return o(JSON.parse(t),null,4)}catch(e){}return this._obfuscatePassword(t)}return t}return this._syncModel.get("url")},_onConfirm:function _onConfirm(){var e,t,i=n(this.$('[name="interval"]:checked').val(),10),o={wait:!0,success:s(e=function _context(){this._modalModel.destroy()}).call(e,this),error:s(t=function _context2(e,t){this._renderErrorView(h(t))}).call(t,this)};this._renderLoadingView(),this._syncModel.get("interval")!==i?i?this._syncModel.save({interval:i},o):this._syncModel.destroy(o):this._modalModel.destroy()},_onCancel:function _onCancel(){this._modalModel.destroy()},_obfuscatePassword:function _obfuscatePassword(e){return e.replace(/"password"\s*:\s*"[^"]*"/g,'"password":"******"')}})},1369:function(e,t,i){var s=i(732);e.exports=s.extend({tagName:"textarea",className:"Table-editorTextarea CDB-Textarea CDB-Text",_onKeyPressed:function _onKeyPressed(e){e.shiftKey||13!==e.which||(this._onValueChange(),this._editorModel.confirm())}})},1374:function(e,t,i){var s=i(85),n=i(104);e.exports=function(e){if(!e.rowsCollection)throw new Error("rowsCollection is required");var t=e.rowsCollection,i=e.onSuccess,o=e.onError,a=s.addNotification({status:"loading",info:_t("components.table.rows.create.loading"),closable:!1});t.addRow({success:function success(e,t){i&&i(e,t),a.set({status:"success",info:_t("components.table.rows.create.success"),closable:!0})},error:function error(e,t){o&&o(e,t),a.set({status:"error",info:_t("components.table.rows.create.error",{error:n(t)}),closable:!0})}})}},1380:function(e,t,i){i(35);var s=i(85),n=i(104);e.exports=function(e){if(!e.columnsCollection)throw new Error("columnsCollection is required");var t=e.columnsCollection,i=e.onSuccess,o=e.onError,a=s.addNotification({status:"loading",info:_t("components.table.columns.create.loading"),closable:!1});t.addColumn({success:function success(e,t){i&&i(e,t),a.set({status:"success",info:_t("components.table.columns.create.success",{columnName:t.name}),closable:!0})},error:function error(e,t){o&&o(e,t),a.set({status:"error",info:_t("components.table.columns.create.error",{error:n(t)}),closable:!0})}})}},1383:function(e,t,i){i(31),i(31);var s=i(2475),n=i(2453),o=i(395),a=i(14),r=["analysisDefinitionNodeModel","configModel","modals","userModel"];e.exports={create:function create(e){a(e,r,this);var t=this._analysisDefinitionNodeModel.get("table_name"),i=o.getUsername(t)||this._userModel.get("username");t=o.getQualifiedTableName(t,i,this._userModel.isInsideOrg());var l=this._analysisDefinitionNodeModel.querySchemaModel,c=new n(l.columnsCollection.toJSON(),{configModel:this._configModel,tableName:t,querySchemaModel:l});return new s({relativePositionated:e.relativePositionated,modals:this._modals,analysisDefinitionNodeModel:this._analysisDefinitionNodeModel,columnsCollection:c,tableName:t})},destroy:function destroy(e){if(!e)throw new Error("tableView object is needed");e.clean()}}},1384:function(e,t,i){var s=i(1),n={top:0,left:0};e.exports=function MagicPositioner(e){if(!e.parentView)throw new Error("parentView within params is required");if(!s.isNumber(e.posX))throw new Error("posX within params is required");if(!s.isNumber(e.posY))throw new Error("posY within params is required");var t=e.parentView,i=t.outerHeight(),o=t.outerWidth(),a=e.posX,r=e.posY,l=e.offsetX||0,c=e.offsetY||0,h=e.elementWidth||244,d=e.elementHeight||205,u=n;return a-h>10?(u.left="auto",u.right=o-a+l+"px"):a+h>h&&(u.right="auto",u.left=a+l+"px"),r+d<i?(u.bottom="auto",u.top=r+c+"px"):r+d>i&&(u.top="auto",u.bottom=i-r+c+"px"),u}},1385:function(e,t,i){var s=i(25),n=i(13),o=i(1),a=[{privacy:"PUBLIC",title:_t("components.modals.publish.privacy.public.title"),desc:_t("components.modals.publish.privacy.public.body"),alwaysEnabled:!0,cssClass:"green"},{privacy:"LINK",title:_t("components.modals.publish.privacy.link.title"),desc:_t("components.modals.publish.privacy.link.body"),cssClass:"orange"},{privacy:"PASSWORD",title:_t("components.modals.publish.privacy.password.title"),desc:_t("components.modals.publish.privacy.password.body"),cssClass:"orange-dark"},{privacy:"PRIVATE",title:_t("components.modals.publish.privacy.private.title"),desc:_t("components.modals.publish.privacy.private.body"),cssClass:"red"}];e.exports=function(e,t){var i,r,l=e.isVisualization(),c=t.get("actions")[l?"private_maps":"private_tables"],h=e.get("privacy"),d=e.privacyOptions(),u=l?t.hasPublicMapSharingDisabled():t.hasPublicDatasetSharingDisabled();return n(i=s(r=o.chain(a)).call(r,function(e){return o.contains(d,e.privacy)})).call(i,function(e){var i="PRIVATE"===e.privacy?function canChangeToPrivate(e,t,i){return"PRIVATE"!==t&&"PRIVATE"===i.privacy&&e.hasRemainingPrivateMaps()}(t,h,e):function canChangeToPublic(e,t,i){return"PRIVATE"!==t||"PRIVATE"===t&&"PRIVATE"!==i.privacy&&e.hasRemainingPublicMaps()}(t,h,e),s=!l||c&&i,n="PRIVATE"!==e.privacy&&u,a=(e.alwaysEnabled||s)&&!n||"PRIVATE"===e.privacy;return o.defaults({selected:e.privacy===h,disabled:!a},e)}).value()}},1386:function(e,t,i){i(37);var s=i(13),n=i(6),o=i(1);e.exports=n.Model.extend({defaults:{privacy:"PUBLIC",disabled:!1,selected:!1,password:void 0},validate:function validate(e){if(e.disabled&&e.selected)return"Option can not be disabled and selected at the same time"},classNames:function classNames(){var e;return s(e=o.chain(["disabled","selected"])).call(e,function(e){return void 0!==this.attributes[e]?"is-"+e:void 0},this).compact().value().join(" ")},canSave:function canSave(){return!this.get("disabled")},isPassword:function isPassword(){return!1},isSelected:function isSelected(){return!0===this.get("selected")},saveToVis:function saveToVis(e,t){return e.save(this._attrsToSave(),o.extend({wait:!0},t))},_attrsToSave:function _attrsToSave(){return o.pick(this.attributes,"privacy","password")}})},1387:function(e,t,i){var s=i(28),n=i(3),o=i(6),a=i(1386),r=i(2480);e.exports=o.Collection.extend({model:function model(e,t){return"PASSWORD"===e.privacy?new r(e,t):new a(e,t)},initialize:function initialize(){var e;n(e=this).call(e,"change:selected",this._deselectLastSelected,this)},searchByPrivacy:function searchByPrivacy(e){return this.findWhere({privacy:e})},selectedOption:function selectedOption(){var e;return s(e=this).call(e,function(e){return e.get("selected")})},passwordOption:function passwordOption(){var e;return s(e=this).call(e,function(e){return"PASSWORD"===e.get("privacy")})},_deselectLastSelected:function _deselectLastSelected(e,t){t&&this.each(function(t){t!==e&&t.set({selected:!1})})}})},1397:function(e,t,i){var s=i(13),n=i(18),o=i(1),a=i(1525);e.exports={track:function track(e){this.acl=e.acl,this.configModel=e.configModel,this.userModel=e.userModel,this.acl.on("reset",this.fetchUsers,this),this.fetchUsers()},fetchUsers:function fetchUsers(){var e,t=this;e=s(o).call(o,this.acl.where({type:"group"}),function(e){var i=e.get("entity"),s=new n.Deferred;return i.users&&0!==i.users.length?s.resolve():(i.users=new a([],{group:i,configModel:t.configModel,organization:t.userModel.getOrganization()}),i.users.fetch({success:function success(){s.resolve()}})),s.promise()},this),n.when.apply(n,e).done(function(){t.acl.trigger("fetch")})}}},1398:function(e,t,i){var s=i(6);e.exports=s.Model.extend({defaults:{edition:!1,disabled:!1},isEditing:function isEditing(){return!!this.get("edition")},isDisabled:function isDisabled(){return!!this.get("disabled")}})},14:function(e,t,i){var s=i(1);e.exports=function checkAndBuildRequiredOpts(e,t,i){if(void 0===t)throw new Error("Opts are required");s.each(t,function(t){if(void 0===e||void 0===e[t])throw new Error(t+" is required");i["_"+t]=e[t]},i)}},1411:function(e,t,i){i(35),i(185);var s=i(180),n=i(235),o=i(13),a=i(32),r=i(25),l=i(6),c=i(1),h=i(18);e.exports=l.Model.extend({SYSTEM_COLUMNS:["the_geom","the_geom_webmercator","created_at","updated_at","cartodb_id","cartodb_georef_status"],TEMPLATES:{},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");this._configModel=t.configModel},clearFields:function clearFields(){this.set({fields:[]})},saveFields:function saveFields(e){e=e||"old_fields",this.set(e,c.clone(this.get("fields")))},fieldCount:function fieldCount(){var e=this.get("fields");return e?e.length:0},restoreFields:function restoreFields(e,t){t=t||"old_fields";var i=this.get(t);e&&(i=r(i).call(i,function(t){return c.contains(e,t.name)})),i&&i.length&&this._setFields(i),this.unset(t)},containsField:function containsField(e){var t=this.get("fields")||[];return c.contains(c(t).pluck("name"),e)},getFieldProperty:function getFieldProperty(e,t){if(this.containsField(e)){var i=this.get("fields")||[];return i[a(c).call(c,c(i).pluck("name"),e)][t]}return null},setFieldProperty:function setFieldProperty(e,t,i){if(this.containsField(e)){var s=this._cloneFields()||[];s[a(c).call(c,c(s).pluck("name"),e)][t]=i,this._setFields(s)}return this},_cloneFields:function _cloneFields(){var e;return o(e=c(this.get("fields"))).call(e,function(e){return c.clone(e)})},_setFields:function _setFields(e){n(e).call(e,function(e,t){return e.position-t.position}),this.set({fields:e})},sortFields:function sortFields(){var e;n(e=this.get("fields")).call(e,function(e,t){return e.position-t.position})},_addField:function _addField(e,t){var i=h.Deferred();if(!this.containsField(e)){var s=this.get("fields");s?(t=void 0===t?s.length:t,s.push({name:e,title:!0,position:t})):(t=void 0===t?0:t,this.set("fields",[{name:e,title:!0,position:t}],{silent:!0}))}return i.resolve(),i.promise()},addField:function addField(e,t){var i=this;return h.when(this._addField(e,t)).then(function(){i.sortFields(),i.trigger("add:fields"),i.trigger("change:fields",i,i.get("fields")),i.trigger("change",i)}),this},removeField:function removeField(e){if(this.containsField(e)){var t=this._cloneFields()||[],i=a(c).call(c,c(t).pluck("name"),e);i>=0&&s(t).call(t,i,1),this._setFields(t),this.trigger("remove:fields")}return this},getAlternativeName:function getAlternativeName(e){return this.get("alternative_names")&&this.get("alternative_names")[e]},setAlternativeName:function setAlternativeName(e,t){var i=c.clone(this.get("alternative_names")||{});i[e]=t,this.set({alternative_names:i}),this.trigger("change:alternative_names")},getFieldPos:function getFieldPos(e){var t=this.getFieldProperty(e,"position");return void 0===t?Number.MAX_VALUE:t},unsetTemplate:function unsetTemplate(){this.setTemplate("")},setTemplate:function setTemplate(e){var t={template_name:e,template:void 0===this.TEMPLATES[e]?"":this.TEMPLATES[e],template_type:"mustache"};""===e&&(t.fields=[]),this.set(t)},getTemplate:function getTemplate(){var e=this.get("template_name");return""!==e?this.TEMPLATES["custom_"+e]:this.get("template")},hasTemplate:function hasTemplate(){return!!this.get("template_name")&&this.TEMPLATES[this.get("template_name")]},isCustomTemplate:function isCustomTemplate(){return""===this.get("template_name")&&""!==this.get("template")}})},1418:function(e,t,i){var s=i(1),n=i(548),o=i(962),a=i(59),r=i(344);e.exports=s.defaults({_getAggrAttrs:function _getAggrAttrs(e){return{aggregation:{size:10,value:{operator:"count",attribute:""}}}},_getStrokeAttrs:function _getStrokeAttrs(e){var t=o.stroke;return{stroke:a.cloneObject(t)}},_getFillAttrs:function _getFillAttrs(e){var t=r.ag_GrnYl[5];return{fill:{color:{attribute:"agg_value",bins:"5",quantification:"quantiles",range:a.cloneObject(t)}}}}},n)},1419:function(e,t){e.exports={generateAttributes:function generateAttributes(e){return{fill:null,stroke:null,blending:null,aggregation:{},labels:{}}}}},1421:function(e,t,i){i(92),i(35),i(34),i(67),i(236),i(257),i(31);var s=i(49),n=i(25),o=i(7),a=i(3);i(31);var r=i(6),l=i(1),c=i(394),h=i(2506),d=i(2500),u=i(2499),p=i(490),g=i(2498),m=i(2497),f=i(395),_=i(491),v=["id","order","infowindow","tooltip","error","from_layer_id","from_letter"];e.exports=r.Model.extend({sync:c,parse:function parse(e,t){e.options=e.options||{};var i=l.defaults(l.pick(e,v),l.omit(e.options,["query","tile_style"]));return i.type=i.type||p.getType(e.kind),e.options.tile_style&&(i.cartocss=e.options.tile_style),e.options.query&&(i.sql=e.options.query),e.infowindow&&(this.infowindowModel||(this.infowindowModel=new g(e.infowindow,{configModel:t.configModel||this._configModel}))),e.tooltip&&(this.tooltipModel||(this.tooltipModel=new m(e.tooltip,{configModel:t.configModel||this._configModel}))),e.options.table_name&&(i.autoStyle=i.autoStyle||!1,this.styleModel||(this.styleModel=new h(e.options.style_properties,{parse:!0}),this.cartocssModel=new d({content:i.cartocss},{history:e.options.cartocss_history||e.options.tile_style_history})),this.sqlModel||(this.sqlModel=new u({content:i.sql},{history:e.options.sql_history}))),i},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");var i;(this._configModel=t.configModel,this.on("change:source change:sql",this._onPosibleLayerSchemaChanged,this),this.styleModel)&&a(i=this.styleModel).call(i,"change:type change:animated",function(){(this.styleModel.isAggregatedType()||this.styleModel.isAnimation())&&(this.infowindowModel&&this.infowindowModel.unsetTemplate(),this.tooltipModel&&this.tooltipModel.unsetTemplate())},this)},save:function save(e,t){e=e||{};var i={autoStyle:!1};return(t=t||{})&&t.shouldPreserveAutoStyle?delete i.autoStyle:this.get("autoStyle")&&this.styleModel&&this.styleModel.resetPropertiesFromAutoStyle(),e=l.extend({},i,e),r.Model.prototype.save.call(this,e,t)},toJSON:function toJSON(){var e=l.omit(this.attributes,o(v).call(v,["cartocss","sql","autoStyle"])),t=this.get("cartocss");t&&(e.tile_style=t);var i=this.get("sql");i&&(e.query=i);var s={kind:p.getKind(this.get("type")),options:e},n=this.infowindowModel&&this.infowindowModel.toJSON();l.isEmpty(n)||(s.infowindow=this.infowindowModel.toJSON());var a=this.tooltipModel&&this.tooltipModel.toJSON();l.isEmpty(a)||(s.tooltip=this.tooltipModel.toJSON()),this.styleModel&&!this.styleModel.isAutogenerated()&&(s.options.style_properties=this.styleModel.toJSON()),this.cartocssModel&&(s.options.cartocss_history=this.cartocssModel.getHistory()),this.sqlModel&&(s.options.sql_history=this.sqlModel.getHistory());var r=l.omit(this.attributes,"infowindow","tooltip","options","error","autoStyle");return l.defaults(s,l.pick(r,v))},canBeDeletedByUser:function canBeDeletedByUser(){return this.collection.getNumberOfDataLayers()>1&&this.isDataLayer()&&(this._canBeFoldedUnderAnotherLayer()||!this._isAllDataLayersDependingOnAnyAnalysisOfThisLayer())},isOwnerOfAnalysisNode:function isOwnerOfAnalysisNode(e){return e&&e.letter()===this.get("letter")},ownedPrimaryAnalysisNodes:function ownedPrimaryAnalysisNodes(){var e=this.getAnalysisDefinitionNodeModel();return this.isOwnerOfAnalysisNode(e)?e.linkedListBySameLetter():[]},getName:function getName(){return this.get("name")||this.get("table_name_alias")||this.get("table_name")},getTableName:function getTableName(){return this.get("table_name")||""},getColor:function getColor(){return _.getColorForLetter(this.get("letter"))},containsNode:function containsNode(e){var t=this.getAnalysisDefinitionNodeModel();return t&&t.containsNode(e)},getAnalysisDefinitionNodeModel:function getAnalysisDefinitionNodeModel(){return this.findAnalysisDefinitionNodeModel(this.get("source"))},findAnalysisDefinitionNodeModel:function findAnalysisDefinitionNodeModel(e){return this.collection&&this.collection.findAnalysisDefinitionNodeModel(e)},_onPosibleLayerSchemaChanged:function _onPosibleLayerSchemaChanged(e,t,i){i&&i.ignoreSchemaChange||(this.infowindowModel&&this.infowindowModel.clearFields(),this.tooltipModel&&this.tooltipModel.clearFields(),this.styleModel&&this.styleModel.resetStyles())},toggleVisible:function toggleVisible(){this.set("visible",!this.get("visible"))},toggleCollapse:function toggleCollapse(){this.set("collapsed",!this.get("collapsed"))},hasAnalyses:function hasAnalyses(){return this.getNumberOfAnalyses()>0},hasAggregatedStyles:function hasAggregatedStyles(){return this.styleModel&&this.styleModel.isAggregatedType()},getNumberOfAnalyses:function getNumberOfAnalyses(){for(var e=this.getAnalysisDefinitionNodeModel(),t=0;e&&this.isOwnerOfAnalysisNode(e);)(e=e.getPrimarySource())&&(t+=1);return t},getQualifiedTableName:function getQualifiedTableName(){var e=this.get("user_name")||this.collection.userModel.get("username");return f.getQualifiedTableName(this.getTableName(),e,this.collection.userModel.isInsideOrg())},getColumnNamesFromSchema:function getColumnNamesFromSchema(){return this._getQuerySchemaModel().getColumnNames()},_getQuerySchemaModel:function _getQuerySchemaModel(){return this.getAnalysisDefinitionNodeModel().querySchemaModel},isDataLayer:function isDataLayer(){var e=this.get("type");return p.isCartoDBType(e)||p.isTorqueType(e)},isTorqueLayer:function isTorqueLayer(){return"torque"===this.get("type")},isAutoStyleApplied:function isAutoStyleApplied(){var e=this.get("autoStyle");return null!=e&&!1!==e},_canBeFoldedUnderAnotherLayer:function _canBeFoldedUnderAnotherLayer(){var e=this.getAnalysisDefinitionNodeModel();return this.collection.any(function(t){if(t!==this&&t.isDataLayer()){var i=t.getAnalysisDefinitionNodeModel();return i===e||l.last(i.linkedListBySameLetter()).getPrimarySource()===e}},this)},_isAllDataLayersDependingOnAnyAnalysisOfThisLayer:function _isAllDataLayersDependingOnAnyAnalysisOfThisLayer(){var e,t=this.getAnalysisDefinitionNodeModel();if(!t)return!1;if(!this.isOwnerOfAnalysisNode(t))return!1;var i=t.linkedListBySameLetter();return n(e=this.collection.chain()).call(e,function(e){return e!==this&&!!e.get("source")},this).all(function(e){return l.any(i,function(t){return e.containsNode(t)})},this).value()},getAllDependentLayers:function getAllDependentLayers(){for(var e=0,t=this.collection.models,i=0;i<t.length;i++){var s=t[i],n=!1;if(s!==this){for(var o=s.getAnalysisDefinitionNodeModel();o;)this.isOwnerOfAnalysisNode(o)&&(n=!0),o=o.getPrimarySource();n&&(e+=1)}}return e},matchesAttrs:function matchesAttrs(e){return this.get("type")===e.type&&(p.isTiledType(e.type)?this.get("name")===e.name&&this.get("urlTemplate")===e.urlTemplate:p.isGMapsBase(e.type)?this.get("name")===e.name&&this.get("baseType")===e.baseType&&this.get("style")===e.style:!!p.isPlainType(e.type)&&this.get("color")===e.color)},hasGeocodingAnalysisApplied:function hasGeocodingAnalysisApplied(){var e=this.getAnalysisDefinitionNodeModel();if(e&&"geocoding"===e.get("type"))return!0;for(;e&&this.isOwnerOfAnalysisNode(e);)if((e=e.getPrimarySource())&&"geocoding"===e.get("type"))return!0;return!1},_hasAnyAnalysisApplied:function _hasAnyAnalysisApplied(){return"source"!==this.getAnalysisDefinitionNodeModel().get("type")},isEmpty:function isEmpty(){throw new Error("LayerDefinitionModel.isEmpty() is an async operation. Use `.isEmptyAsync` instead.")},isEmptyAsync:function isEmptyAsync(){var e=this.getAnalysisDefinitionNodeModel(),t=this._hasAnyAnalysisApplied(),i=e.isCustomQueryApplied();return new s(function(s,n){e.queryRowsCollection.isEmptyAsync().then(function(e){s(!t&&!i&&e)})})},isDataFiltered:function isDataFiltered(){var e=this.getAnalysisDefinitionNodeModel(),t=this._hasAnyAnalysisApplied(),i=e.isCustomQueryApplied();return new s(function(s,n){e.queryRowsCollection.isEmptyAsync().then(function(e){s((t||i)&&e)})})},isDone:function isDone(){var e=this.getAnalysisDefinitionNodeModel();return e.queryRowsCollection.isDone()&&e.queryGeometryModel.isDone()&&e.querySchemaModel.isDone()},canBeGeoreferenced:function canBeGeoreferenced(){var e=this,t=this.getAnalysisDefinitionNodeModel(),i=e.isEmptyAsync(),n=t.queryGeometryModel.hasValueAsync();return s.all([i,n]).then(function(i){var s=i[0],n=i[1];return!(s||n||e.hasGeocodingAnalysisApplied()||e._hasAnyAnalysisApplied()||t.isCustomQueryApplied())})},fetchQueryRowsIfRequired:function fetchQueryRowsIfRequired(){var e=this,t=this.getAnalysisDefinitionNodeModel();t.queryGeometryModel.hasValueAsync().then(function(i){e.hasGeocodingAnalysisApplied()||i||t.isCustomQueryApplied()||!t.queryRowsCollection.isUnavailable()||t.queryRowsCollection.fetch()})}})},1422:function(e,t,i){var s=i(3),n=i(6),o=i(1);e.exports=n.Model.extend({idAttribute:"__id",url:function url(){if(this._tableName&&this._configModel){var url=this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("record")+"/tables/";if(this.hasWriteAccess(this._userModel)&&!this.isOwner(this._userModel))url+=this._permissionModel.getOwner().get("username")+"."+this._tableName+"/records";else url+=this._tableName+"/records";return this.isNew()||(url+="/"+this.get("cartodb_id")),url}return!1},initialize:function initialize(e,t){this.collection=this.collection||{},this._tableName=t.tableName||this.collection._tableName,this._configModel=t.configModel||this.collection._configModel,this._permissionModel=t.permissionModel||this.collection._permissionModel,this._userModel=t.userModel||this.collection._userModel,this._initBinds()},_initBinds:function _initBinds(){var e;s(e=this).call(e,"error",this._onError,this)},hasWriteAccess:function hasWriteAccess(e){return!(!e||!this._permissionModel)&&this._permissionModel.hasWriteAccess(e)},isOwner:function isOwner(e){return!(!e||!this._permissionModel)&&this._permissionModel.isOwner(e)},isNew:function isNew(){return!this.has("cartodb_id")},isGeomLoaded:function isGeomLoaded(){try{return JSON.parse(this.get("the_geom")),!0}catch(e){return!1}},fetchRowIfGeomIsNotLoaded:function fetchRowIfGeomIsNotLoaded(e){this.isGeomLoaded()?e():this.fetch({success:e})},_onError:function _onError(){this.set(this.previousAttributes())},sync:function sync(){this.trigger("loading",this),n.Model.prototype.sync.apply(this,arguments)},parse:function parse(e){return e.__id||(e.__id=o.uniqueId()),e},toJSON:function toJSON(){return o.omit(this.attributes,"__id","the_geom_webmercator")}})},1423:function(e,t,i){i(37),i(35),i(34),i(67),i(31);var s=i(13),n=i(3),o=i(49);i(31);var a=i(6),r=i(1422),l=i(394),c=i(1),h=i(493);e.exports=a.Collection.extend({defaults:{empty:!0},DEFAULT_FETCH_OPTIONS:{rows_per_page:40,sort_order:"asc",page:0},model:r,sync:l,url:function url(){return this._configModel.getSqlApiUrl()},initialize:function initialize(e,t){t=t||{},this._repeatedErrors=0,this._tableName=t.tableName,this._querySchemaModel=t.querySchemaModel,this._configModel=t.configModel,this.statusModel=new a.Model({status:h.initial}),this._initBinds()},_initBinds:function _initBinds(){this.listenTo(this._querySchemaModel,"change:query",this._onQuerySchemaQueryChange),this._querySchemaModel&&this._querySchemaModel.columnsCollection&&this.listenTo(this._querySchemaModel.columnsCollection,"reset",this._onColumnsCollectionReset),this.listenTo(this.statusModel,"change:status",this._onStatusChanged)},_onColumnsCollectionReset:function _onColumnsCollectionReset(){this._onQuerySchemaQueryChange(),this.shouldFetch()&&this.fetch()},getStatusValue:function getStatusValue(){return this.statusModel.get("status")},isInInitialStatus:function isInInitialStatus(){return this.getStatusValue()===h.initial},isFetched:function isFetched(){return this.getStatusValue()===h.fetched},isErrored:function isErrored(){return this.getStatusValue()===h.errored},isFetching:function isFetching(){return this.getStatusValue()===h.fetching},isDone:function isDone(){return this.isFetched()||this.isErrored()},isInFinalStatus:function isInFinalStatus(){var e=[h.unavailable,h.fetched,h.errored];return c.contains(e,this.getStatusValue())},isUnavailable:function isUnavailable(){return this.getStatusValue()===h.unavailable},canFetch:function canFetch(){var e=!!this._querySchemaModel.get("query"),t=this._querySchemaModel.get("ready"),i=this._querySchemaModel.isFetched(),s=this._querySchemaModel.isErrored();return e&&t&&i&&!s},shouldFetch:function shouldFetch(){return!this.isFetched()&&!this.isFetching()&&this.canFetch()&&!this.isErrored()},resetFetch:function resetFetch(){this.statusModel.set("status",h.unfetched)},isEmpty:function isEmpty(){throw new Error("QueryRowsCollection.isEmpty() is an async operation. Use `.isEmptyAsync` instead.")},isEmptyAsync:function isEmptyAsync(){return this.isInFinalStatus()?o.resolve(0===this.size()):new o(n(e=function _context(e){this.listenToOnce(this,"inFinalStatus",function(){e(0===this.size())})}).call(e,this));var e},_onStatusChanged:function _onStatusChanged(){this.isInFinalStatus()&&this.trigger("inFinalStatus")},_onQuerySchemaQueryChange:function _onQuerySchemaQueryChange(){this.statusModel.set("status","unfetched"),this.reset([],{silent:!0})},_geometryColumnSQL:function _geometryColumnSQL(e){return["CASE","WHEN GeometryType("+e+") = 'POINT' THEN","ST_AsGeoJSON("+e+",8)","WHEN ("+e+" IS NULL) THEN","NULL","ELSE","GeometryType("+e+")","END "+e].join(" ")},_getWrappedSQL:function _getWrappedSQL(e){var t,i=this,n=this._querySchemaModel.columnsCollection.toJSON(),o=s(t=c.chain(n).omit(function(t){return c.contains(e,t.name)})).call(t,function(e,t){return"geometry"===e.type?i._geometryColumnSQL(e.name):'"'+e.name+'"'}).value().join(",");return c.template("select <%= selectedColumns %> from (<%= sql %>) __wrapped")({selectedColumns:o,sql:this._querySchemaModel.get("query")})},_httpMethod:function _httpMethod(e){return e.length>1024?"POST":"GET"},_incrementRepeatedError:function _incrementRepeatedError(){this._repeatedErrors++},_resetRepeatedError:function _resetRepeatedError(){this._repeatedErrors=0},hasRepeatedErrors:function hasRepeatedErrors(){return this._repeatedErrors>=3},fetch:function fetch(e){var t,i;if(!this.isFetching()){e=e||{};var s=this.getStatusValue();this.statusModel.set("status",h.fetching);var o=e.data&&e.data.exclude||[],r=this._getWrappedSQL(o);(e=e||{}).data=c.extend({},this.DEFAULT_FETCH_OPTIONS,e.data&&c.omit(e.data,"exclude")||{},{api_key:this._configModel.get("api_key"),q:r}),e.method=this._httpMethod(r);var l=e.error;e.error=n(t=function _context3(e,t){s===h.unavailable&&this._incrementRepeatedError(),t&&t.error&&this._querySchemaModel.setError(t.error),this.trigger("fail",e,t),this.statusModel.set("status",this.hasRepeatedErrors()?h.errored:h.unavailable),l&&l(e,t)}).call(t,this);var d=e.success;return e.success=n(i=function _context4(t,i,s){if(i&&i.error)return e.error.apply(this,arguments);this._resetRepeatedError(),this.statusModel.set("status",h.fetched),d&&d(t,i)}).call(i,this),e.reset=!0,a.Collection.prototype.fetch.call(this,e)}},parse:function parse(e){return this._parseWithID(e.rows)},reset:function reset(e,t){var i=[];i=e&&e.rows?e.rows:e,a.Collection.prototype.reset.apply(this,[this._parseWithID(i)])},_parseWithID:function _parseWithID(e){return s(c).call(c,e,function(e){return e.__id=c.uniqueId(),e})},addRow:function addRow(e){e=e||{},this.create({__id:c.uniqueId()},c.extend(e,{wait:!0,parse:!0}))},setTableName:function setTableName(e){e&&this._tableName&&(this._tableName=e,this.each(function(t){t._tableName=e}))}})},1424:function(e,t,i){var s=i(3),n=i(1),o=i(6),a=i(394),r=i(493);e.exports=o.Model.extend({initialize:function initialize(e,t){this.repeatedErrors=0,this.listenTo(this,"change:status",this._onStatusChanged),this.listenTo(this,"change:ready",this._onReadyChanged)},sync:a,getStatusValue:function getStatusValue(){return this.get("status")},isInInitialStatus:function isInInitialStatus(){return this.get("status")===r.initial},isFetched:function isFetched(){return this.get("status")===r.fetched},isFetching:function isFetching(){return this.get("status")===r.fetching},isErrored:function isErrored(){return this.get("status")===r.errored},isUnavailable:function isUnavailable(){return this.get("status")===r.unavailable},isDone:function isDone(){return this.isFetched()||this.isErrored()},isInFinalStatus:function isInFinalStatus(){var e=[r.unavailable,r.fetched,r.errored];return n.contains(e,this.get("status"))},canFetch:function canFetch(){var e=this.hasQuery(),t=this.get("ready");return e&&t},hasQuery:function hasQuery(){return!!this.get("query")},shouldFetch:function shouldFetch(){return this.canFetch()&&!this.isFetched()&&!this.isFetching()&&!this.isErrored()},resetFetch:function resetFetch(){this.set("status",r.unfetched)},isNew:function isNew(){return!0},hasRepeatedErrors:function hasRepeatedErrors(){return this.repeatedErrors>=3},_onStatusChanged:function _onStatusChanged(){this.isInFinalStatus()&&this.trigger("inFinalStatus")},_addChangeListener:function _addChangeListener(){var e;s(e=this).call(e,"change",this._onChange,this)},_removeChangeListener:function _removeChangeListener(){this.unbind("change",this._onChange,this)},_httpMethod:function _httpMethod(){return this._getSqlApiQueryParam().length>1024?"POST":"GET"},_incrementRepeatedError:function _incrementRepeatedError(){this.repeatedErrors++},_resetRepeatedError:function _resetRepeatedError(){this.repeatedErrors=0},_onReadyChanged:function _onReadyChanged(){this.get("ready")&&this.shouldFetch()&&this.fetch()}})},1425:function(e,t,i){i(31);var s=i(56),n=i(13),o=i(28),a=i(7),r=i(44),l=i(32),c=i(41);i(31);var h=i(1),d=i(6),u=i(445),p=i(2508),g=i(2507),m=i(444),f=i(14),_=i(1423),v=i(963),y=i(491),w=["configModel"];e.exports=d.Model.extend({initialize:function initialize(e,t){if(!this.id)throw new Error("id is required");f(t,w,this);var i={configModel:this._configModel,userModel:t.userModel},s=this.get("simple_geom");this.querySchemaModel=new g(void 0,i),this.queryGeometryModel=new p({simple_geom:s,status:s?"fetched":"unfetched"},i),this.queryRowsCollection=new _([],{configModel:this._configModel,userModel:t.userModel,tableName:"",querySchemaModel:this.querySchemaModel}),this.listenTo(this.queryGeometryModel,"change:simple_geom",this._onGeometryTypeChanged)},fetchQueryObjects:function fetchQueryObjects(){"ready"!==this.get("status")||this.get("error")||v({queryGeometryModel:this.queryGeometryModel,querySchemaModel:this.querySchemaModel,queryRowsCollection:this.queryRowsCollection})},parse:function parse(e,t){var i=!e.type&&t.merge?[]:u.getSourceNamesForAnalysisType(e.type),s=c(h).call(h,e.params,function(e,s,n){return i[l(i).call(i,n)]?(this.collection.add(s,t),e[n]=s.id):e[n]=s,e},{},this),n=c(h).call(h,e.options,function(e,t,i){return e[i]=t,e},{},this);return h.defaults(h.omit(e,"params","options"),n,s)},toJSON:function toJSON(e){e=e||{};var t=[],i={},s=u.paramsForType(this.get("type"));for(var n in s){var o=s[n],l=this.get(n),c=!0;if("node"===o.type){var d=this.collection.get(l);if(d)l=d.toJSON(e);else{if(!o.optional)throw new Error('no node found for param "'+n+'" with id "'+l+'" in node '+r(this.attributes));c=!1}}c&&(i[n]=l,t.push(n))}var p={id:this.get("id"),type:this.get("type"),params:i},g=h.omit(this.attributes,a(t).call(t,"id","type","status","style_history"));return e.skipOptions||h.isEmpty(g)||(p.options=g),p},isNew:function isNew(){return!0},isReadOnly:function isReadOnly(){return!0},isCustomQueryApplied:function isCustomQueryApplied(){return!1},canBeDeletedByUser:function canBeDeletedByUser(){return this.hasPrimarySource()},hasFailed:function hasFailed(){return"failed"===this.get("status")},isDone:function isDone(){return"ready"===this.get("status")},destroy:function destroy(){return this.querySchemaModel&&(this.querySchemaModel.destroy(),this.querySchemaModel=null),d.Model.prototype.destroy.apply(this,arguments)},clone:function clone(e){if(!e)throw new Error("newId is required");if(!h.isString(e)||e.length<2)throw new Error("newId is required as a non-empty string");if(e===this.id)throw new Error("newId must be different from current id, "+this.id);var t=this.toJSON();return t.id=e,this.collection.add(t)},linkedListBySameLetter:function linkedListBySameLetter(){for(var e=[this],t=this,i=this.letter();;){var s=t.getPrimarySource();if(!s||s.letter()!==i)break;e.push(s),t=s}return e},isValidAsInputForType:function isValidAsInputForType(e){if("source"===e)return!1;var t=this.queryGeometryModel.get("simple_geom");return t?u.isValidInputGeometryForType(t,e):null},containsNode:function containsNode(e){return!!e&&(this.id===e.id||this._sourcesContains(e))},hasPrimarySource:function hasPrimarySource(){return!!this.getPrimarySource()},hasSecondarySource:function hasSecondarySource(){return!!this.getSecondarySource()},getPrimarySource:function getPrimarySource(){return this.collection.get(this._getPrimarySourceId())},getSecondarySource:function getSecondarySource(){var e=this._getPrimarySourceId(),t=o(h).call(h,this.sourceIds(),function(t){return t!==e});return this.collection.get(t)},getDefaultQuery:function getDefaultQuery(){return this.get("query")},sourceIds:function sourceIds(){return n(h).call(h,this._sourceNames(),function(e){return this.get(e)},this)},changeSourceIds:function changeSourceIds(e,t,i){var n;s(n=this._sourceNames()).call(n,function(s){this.get(s)===e&&this.set(s,t,{silent:i})},this)},isSourceType:function isSourceType(){return"source"===this.get("type")},letter:function letter(){return m.letter(this.id)},getColor:function getColor(){var e=m.letter(this.id);return y.getColorForLetter(e)},getStyleHistoryForLayer:function getStyleHistoryForLayer(e){var t=this.get("style_history");return t&&t[e]},_sourcesContains:function _sourcesContains(e){var t=this.getPrimarySource(),i=this.getSecondarySource();return!!(t&&t.containsNode(e)||i&&i.containsNode(e))},_getPrimarySourceId:function _getPrimarySourceId(){var e=this.get("primary_source_name")||this._sourceNames()[0];return this.get(e)},_sourceNames:function _sourceNames(){return u.getSourceNamesForAnalysisType(this.get("type"))},_onGeometryTypeChanged:function _onGeometryTypeChanged(e,t){this.set("simple_geom",t)}})},1426:function(e,t,i){var s=i(1425),n=i(550),o=i(492);e.exports=s.extend({defaults:{status:"ready"},initialize:function initialize(e,t){if(!t.userModel)throw new Error("userModel is required");this._userModel=t.userModel,s.prototype.initialize.apply(this,arguments);var i=this.get("query");this.querySchemaModel.set({query:i,ready:!0},{silent:!0}),this.queryGeometryModel.set({query:i,ready:!0},{silent:!0}),this.queryRowsCollection._tableName=this.get("table_name");var o=t.tableData||{name:this.get("table_name")};this.tableModel=new n(o,{configModel:t.configModel,parse:!0})},getDefaultQuery:function getDefaultQuery(){return o.getDefaultSQL(this.get("table_name"),this.tableModel.getOwnerName(),this._userModel.isInsideOrg())},isCustomQueryApplied:function isCustomQueryApplied(){return!o.isSameQuery(this.querySchemaModel.get("query"),this.getDefaultQuery())},isReadOnly:function isReadOnly(){var e=this.tableModel.isReadOnly(this._userModel),t=this.isCustomQueryApplied();return e||t},getTableModel:function getTableModel(){return this.tableModel},fetchTable:function fetchTable(){this.tableModel.get("id")||this.tableModel.fetch()},setTableName:function setTableName(e){if(!e)throw new Error("name is required");this.set("table_name",e),this.tableModel.set("name",e),this.queryRowsCollection.setTableName(e),this.querySchemaModel.set({status:"unfetched",query:this.getDefaultQuery()})}})},1427:function(e,t){e.exports={bubble:{legendType:"size"},category:{legendType:"color"},choropleth:{legendType:"color"},custom:{legendType:"color"},custom_choropleth:{legendType:"color"}}},1439:function(e,t,i){var s=i(1),n=i(565),o=i(2548),a=i(2547),r=["line-color","line-opacity"];function generateCSSTreeFromCartoCSS(e){return n().use(o).process(e,{syntax:a})}function isSelectorRule(e){return"rule"===e.type&&-1!==e.selector.search(/\[(.)+\]/g)}e.exports={changeStyle:s.memoize(function changeStyle(e,t,i){if(s.isUndefined(i))return e;var n=generateCSSTreeFromCartoCSS(e),o=n.result.root,a=!1;return o?(o.walkDecls(t,function(e){var n=e.parent;(function isOutlineRule(e){return"rule"===e.type&&-1!==e.selector.search("::outline")})(n)&&s.contains(r,t)||(isSelectorRule(n)||a?e.remove():(e.value=i,a=!0))}),n.css):e},function(e,t,i){return e+t+i}),isPropertyIncluded:function isPropertyIncluded(e,t){var i=generateCSSTreeFromCartoCSS(e).result.root,s=!1;return i&&i.walkDecls(t,function(e){var t=e.parent;isSelectorRule(t)&&!function isMapnikGeometrySelectorRule(e){return isSelectorRule(e)&&-1!==e.selector.search("mapnik::geometry_type")}(t)||(s=!0)}),s},replaceWrongSpaceChar:function replaceWrongSpaceChar(e){return e.replace(new RegExp(String.fromCharCode(160),"g")," ")}}},1440:function(e,t,i){var s=i(84),n=i(1439),o=i(2528),a=i(739),r=s.core.Model.extend({initialize:function(e,t,i){this.options=i||{},this.styles=i&&i.auto_style,this.dataviewModel=e,this.colors=new o(this.styles),this.layer=t},getStyle:function(){var e=this.layer.get("initialStyle");if(e)return r.FILL_SELECTORS.forEach(function(t){e=n.changeStyle(e,t,this._getFillColor(t))}.bind(this)),r.OPACITY_SELECTORS.forEach(function(t){e=n.changeStyle(e,t,this._getOpacity())}.bind(this)),n.replaceWrongSpaceChar(e)},_getColor:function(){return a(this.styles,"definition.color")},_getOpacity:function(){return a(this.styles,"definition.color.opacity")}});r.FILL_SELECTORS=["marker-fill","polygon-fill","line-color"],r.OPACITY_SELECTORS=["marker-fill-opacity","polygon-opacity","line-opacity"],e.exports=r},1452:function(e,t,i){var s=i(18),n=i(4),o=i(14),a=i(1451),r=i(970),l=["dataviewModel","widgetModel","paginatorModel"];e.exports=n.extend({options:{itemsPerPage:6,template:a,paginator:!1},className:"CDB-Widget-nav CDB-Widget-contentSpaced",events:{"click .js-searchToggle":"_onSearchClicked","click .js-next":"_onNextPage","click .js-prev":"_onPrevPage"},initialize:function(e){o(e,l,this),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initBinds:function(){this.listenTo(this._paginatorModel,"change:page",this.render),this.listenTo(this._dataviewModel,"change:categoriesCount",this.render),this.listenTo(this._dataviewModel,"change:data change:searchData",this._onDataChanged),this.listenTo(this._widgetModel,"change:search",this.toggle)},_initViews:function(){var e=this._dataviewModel.getCount();if(e>5){var t=this.options.template;this.$el.html(t({categoriesCount:e})),this.options.paginator&&this.$el.append(r({currentPage:this._paginatorModel.get("page"),pages:this._totalPages()}))}else this._paginatorModel.set("page",1)},_setPage:function(){var e=this._totalPages();(this._paginatorModel.get("page")>e||this._paginatorModel.get("page")<1)&&this._paginatorModel.set({page:1},{silent:!0})},_onSearchClicked:function(){this._widgetModel.setupSearch()},_onDataChanged:function(){this._setPage(),this.render()},_onPrevPage:function(){this._changePage(-1)},_onNextPage:function(){this._changePage(1)},_changePage:function(e){var t=this._totalPages(),i=this._paginatorModel.get("page")+e;i>t&&(i=1),i<1&&(i=t),this._paginatorModel.set("page",i)},_totalPages:function(){return Math.ceil(this._dataviewModel.getSize()/this.options.itemsPerPage)},toggle:function(){this[this._widgetModel.isSearchEnabled()?"hide":"show"]()},hide:function(){this.$el.addClass("is-hidden")},show:function(){this.$el.removeClass("is-hidden")},clean:function(){s(window).unbind("resize."+this.cid),n.prototype.clean.call(this)}})},1457:function(e,t,i){var s=i(1),n=i(4),o=i(14),a=i(2561),r=i(974),l=["dataviewModel","widgetModel","paginatorModel"];e.exports=n.extend({options:{paginator:!1,itemsPerPage:6},className:"CDB-Widget-list js-list",tagName:"ul",initialize:function(e){o(e,l,this),this._dataviewModel.get("sync_on_bbox_change")||this.$el.addClass("CDB-Widget-list--nodynamic"),this._initBinds()},render:function(){this.clearSubViews(),this.$el.empty();var e=this._dataviewModel.getData();return s.isEmpty(e)||0===s.size(e)?this._renderPlaceholder():this._renderList(),this},_initBinds:function(){this.listenTo(this._paginatorModel,"change:page",this.render),this.listenTo(this._widgetModel,"change:search",this.toggle),this.listenTo(this._widgetModel,"change:style change:autoStyle",this.render),this.listenTo(this._dataviewModel,"change:data",this.render),this.listenTo(this._dataviewModel,"change:sync_on_bbox_change",this.blockFiltering)},_renderPlaceholder:function(){this.$el.addClass("CDB-Widget-list--withBorders CDB-Widget-list--fake"),this.$el.append(r())},_renderList:function(){this._createList(),this.$el.removeClass("CDB-Widget-list--withBorders CDB-Widget-list--fake CDB-Widget-list--noresults"),this._renderItems()},_renderItems:function(){var e=this._paginatorModel.get("page")-1,t=this.pagesData[e];s.each(t,function(e){this._addItem(e)}.bind(this))},_createList:function(){this.pagesData={};var e=0;this._getData().each(function(t,i){i%this.options.itemsPerPage==0&&(0!==i&&(e+=1),this.pagesData[e]=[]),this.pagesData[e].push(t)},this)},_getData:function(){return this._dataviewModel.getData()},_addItem:function(e){var t=new a({model:e,widgetModel:this._widgetModel,dataviewModel:this._dataviewModel});t.bind("itemClicked",this._setFilters,this),this.addView(t),this.$el.append(t.render().el)},_setFilters:function(e){var t=e.get("selected"),i=this._dataviewModel.filter,s=e.get("name");t?0===i.rejectedCategories.size()&&0===i.acceptedCategories.size()?(this._dataviewModel.getData().each(function(e){e.get("name")!==s&&e.set("selected",!1)}),i.accept(e.get("name"))):(e.set("selected",!1),i.reject(s)):(e.set("selected",!0),i.accept(s));this._widgetModel.set("acceptedCategories",this._widgetModel._acceptedCategories().pluck("name"))},blockFiltering:function(e){e.changed.sync_on_bbox_change?this.$el.removeClass("CDB-Widget-list--nodynamic"):(this.$el.addClass("CDB-Widget-list--nodynamic"),this._dataviewModel.filter.acceptAll())},removeSelections:function(){this._dataviewModel.filter.acceptAll()},toggle:function(){this[this._widgetModel.isSearchEnabled()?"hide":"show"]()},show:function(){this.$el.removeClass("is-hidden")},hide:function(){this.$el.addClass("is-hidden")}})},1468:function(e,t,i){var s=i(84),n=i(4),o=i(454),a=i(1467),r=i(392),l=i(737),c=i(1466),h=i(58);e.exports=n.extend({className:"CDB-Widget-contentSpaced CDB-Widget-contentFull",events:{"click .js-clear":"_onClick"},options:{showClearButton:!0},initialize:function(e){if(!e.dataviewModel)throw new Error("dataviewModel is required");if(!e.layerModel)throw new Error("layerModel is required");if(!e.rangeFilter)throw new Error("rangeFilter is required");if(!e.timeSeriesModel)throw new Error("timeSeriesModel is required");if(void 0===e.selectedAmount)throw new Error("selectedAmount is required");this._timeSeriesModel=e.timeSeriesModel,this._dataviewModel=e.dataviewModel,this._rangeFilter=e.rangeFilter,this._selectedAmount=e.selectedAmount,this._layerModel=e.layerModel,this.model=new s.core.Model,this._createFormatter(),this._initBinds()},render:function(){var e=this._timeSeriesModel.get("title"),t=!this._rangeFilter.isEmpty();return this.$el.html(a({start:this.model.get("left_axis_tip")||this.formatter(this._rangeFilter.get("min")),end:this.model.get("right_axis_tip")||this.formatter(this._rangeFilter.get("max")),title:e,showClearButton:this.options.showClearButton&&t,showSelection:t})),this._animateValue(),this._initViews(),this},_initViews:function(){var e=new h({el:this.$el.find(".js-actions"),gravity:"auto"});this.addView(e)},_createFormatter:function(){this.formatter=r.formatNumber,"date"===this._dataviewModel.getColumnType()&&(this.formatter=r.timestampFactory(this._dataviewModel.get("aggregation"),this._dataviewModel.getCurrentOffset()))},_onLocalTimezoneChanged:function(){this._createFormatter(),this.render()},_animateValue:function(){var e=new l({el:this.$el}),t=this._rangeFilter.isEmpty()?"totalAmount":"filteredAmount",i=this._dataviewModel.get(t);e.animateFromValues.call(this,this._selectedAmount,i,".js-val",c,{formatter:r.formatNumber,templateData:{suffix:" Selected"}}),this._selectedAmount=i},_initBinds:function(){this.listenTo(this.model,"change:left_axis_tip change:right_axis_tip",this.render),this.listenTo(this._timeSeriesModel,"change:title",this.render),this.listenTo(this._timeSeriesModel,"change:local_timezone",this._onLocalTimezoneChanged),this.listenTo(this._dataviewModel,"change:totalAmount",this._animateValue),this.listenTo(this._dataviewModel,"on_update_axis_tip",this._onUpdateAxisTip),this.listenTo(this._rangeFilter,"change",this.render)},_onUpdateAxisTip:function(e){this.model.set(e.attr,e.text)},_setupScales:function(){var e=this._dataviewModel.get("data"),t=this._dataviewModel.getColumnType();this._scale="date"===t?o.time.scale().domain([1e3*e[0].start,1e3*e[e.length-1].end]).range([this._dataviewModel.get("start"),this._dataviewModel.get("end")]):o.scale.linear().domain([e[0].start,e[e.length-1].end]).range([this._dataviewModel.get("start"),this._dataviewModel.get("end")])},_onClick:function(){this.trigger("resetFilter",this)}})},1469:function(e,t,i){var s=i(18),n=i(1),o=i(454),a=i(339),r=i(2574),l=i(4),c=i(392),h=i(2573),d=i(971),u=function(e,t,i,s,n,o,a){var r=o+1*a;return"M "+e+" "+t+" L "+i+" "+s+" C "+(n+.1)+" "+r+" "+(n-.1)+" "+r+" "+e+" "+t+" z"};e.exports=l.extend({options:{showOnWidthChange:!0,chartBarColor:"#F2CC8F",labelsMargin:16,hasAxisTip:!1,minimumBarHeight:2,animationSpeed:750,handleWidth:8,handleRadius:3,divisionWidth:80,animationBarDelay:function(e,t){return Math.random()*(100+10*t)},transitionType:"elastic"},initialize:function(){if(this._originalData=this.options.originalData,!n.isNumber(this.options.height))throw new Error("height is required");if(!this.options.dataviewModel)throw new Error("dataviewModel is required");if(!this.options.layerModel)throw new Error("layerModel is required");if(!this.options.type)throw new Error("type is required");n.bindAll(this,"_selectBars","_adjustBrushHandles","_onBrushMove","_onBrushEnd","_onMouseMove","_onMouseOut"),this.forceResize=n.debounce(this._resizeToParentElement.bind(this),50),this.setElement(s('<svg class=""></svg>')[0]),this._widgetModel=this.options.widgetModel,this._dataviewModel=this.options.dataviewModel,this._layerModel=this.options.layerModel,this.canvas=o.select(this.el).style("overflow","visible").attr("width",0).attr("height",this.options.height),this.canvas.append("g").attr("class","CDB-WidgetCanvas"),this._setupModel(),this._setupBindings(),this._setupDimensions(),this._setupD3Bindings(),this._setupFillColor(),this.hide(),this._tooltipFormatter=c.formatNumber,this._createFormatter()},render:function(){return this._generateChart(),this._generateChartContent(),this},replaceData:function(e){this.model.set({data:e})},toggleLabels:function(e){this.model.set("showLabels",e)},chartWidth:function(){var e=this.model.get("margin");return Math.max(0,this.model.get("width")-e.left-e.right)},chartHeight:function(){var e=this.model.get("margin"),t=this.model.get("showLabels")?this.options.labelsMargin:0;return this.model.get("height")-e.top-e.bottom-t},getSelectionExtent:function(){if(this.brush&&this.brush.extent()){var e=this.brush.extent();return e[1]-e[0]}return 0},_resizeToParentElement:function(){if(this.$el.parent()){var e=this.isHidden();this.hide();var t=this.$el.parent(),i=t.parent&&t.parent()&&t.parent().length>0?t.parent():null,n=t.width()||0;this.model.get("animated")&&this.$el.siblings().each(function(){n-=s(this).width()}),i&&i.outerWidth&&this._isTabletViewport()&&(n-=i.outerWidth(!0)-i.width()),e?this.hide():this.show(),this.model.set("width",n)}},_onChangeLeftAxisTip:function(){this._updateAxisTip("left")},_onChangeRightAxisTip:function(){this._updateAxisTip("right")},_overlap:function(e,t){var i=e.node().getBoundingClientRect(),s=t.node().getBoundingClientRect();return!(i.right<s.left||i.left>s.right||i.bottom<s.top||i.top>s.bottom)},_updateTriangle:function(e,t,i,s,n){var a=!e||this._isTabletViewport()&&this._isTimeSeries()?1:-1,r=o.transform(t.attr("transform")),l=Math.min(14,n),c=s-l/2,h=e?Math.min(i+n-(c+l),0):Math.abs(Math.min(c-i,0)),d=[0,0],p=[l,0],g=[l/2-h,7*a];t.attr("d",u(d[0],d[1],p[0],p[1],g[0],g[1],a)),r.translate[0]=s-l/2+h,t.attr("transform",r.toString())},_updateAxisTip:function(e){var t=e+"_axis_tip",i="right"===e,s=!i,n="week"===this._dataviewModel.get("aggregation"),a=this.model.get(t);if(void 0!==a){var r=this.model.get("left_axis_tip"),l=this.model.get("right_axis_tip"),c=this.chart.select(".CDB-Chart-axisTipText.CDB-Chart-axisTip-"+e),h=this.chart.select(".CDB-Chart-axisTip.CDB-Chart-axisTip-"+e),d=this.chart.select(".CDB-Chart-axisTipRect.CDB-Chart-axisTip-"+e),u=this.chart.select(".CDB-Chart-handle.CDB-Chart-handle-"+e),p=u.select(".CDB-Chart-axisTipTriangle");if(c.data([a]).text(function(e){var i=this.formatter(e);return this._dataviewModel.trigger("on_update_axis_tip",{attr:t,text:i}),i}.bind(this)),c.node()){var g=c.node().getBBox(),m=g.width+6,f=this.options.handleWidth,_=this.barWidth,v=this.chartWidth();d.attr("width",m),c.attr("dx",3),c.attr("dy",g.height-Math.abs((g.height-17)/2));var y=+o.transform(u.attr("transform")).translate[0]+this.options.handleWidth/2,w=!i||this._isMobileViewport()&&this._isTimeSeries()?-26:this.chartHeight()+9.1-1;w=Math.floor(w);var b=m/2,C=(f+_)/2;C-=i?_:0,this._isDateTimeSeries()&&!n||(C=f/2);var M=C-b,k=y+M,S=M+b,x=k+m-(v+f);k<0&&(M-=k),x>0&&(M-=x);var T=s?r<=l:r<=l&&!(r===l&&this._isDateTimeSeries());this._showAxisTip(e,T),h.attr("transform","translate("+M+", "+w+")"),this._updateTriangle(i,p,M,S,m),this.model.get("dragging")&&this._isMobileViewport()&&this._isTimeSeries()&&this._showAxisTip(e,!0)}}},_onChangeData:function(){this.model.previous("data").length!==this.model.get("data").length?this.reset():this.refresh(),this._setupFillColor(),this._refreshBarsColor()},_onChangeRange:function(){var e=this.model.get("lo_index"),t=this.model.get("hi_index");0===e&&0===t||null===e&&null===t||(this.selectRange(e,t),this._adjustBrushHandles(),this._setAxisTipAccordingToBins(),this._selectBars(),this.trigger("on_brush_end",e,t))},_onChangeWidth:function(){var e=this.model.get("width");this.canvas.attr("width",e),this.chart.attr("width",e),this.options.showOnWidthChange&&e>0&&this.show(),this.reset();var t=this.model.get("lo_index"),i=this.model.get("hi_index");this.selectRange(t,i),this._updateAxisTip("left"),this._updateAxisTip("right")},_onChangeNormalized:function(){this.model.set("show_shadow_bars",!this.model.get("normalized")),this._generateShadowBars(),this.updateYScale(),this.refresh()},_onChangeHeight:function(){var e=this.model.get("height");this.$el.height(e),this.chart.attr("height",e),this.leftHandle.attr("height",e),this.rightHandle.attr("height",e),this.updateYScale(),this.reset()},_onChangeShowLabels:function(){this._axis.style("opacity",this.model.get("showLabels")?1:0)},_onChangePos:function(){var e=this.model.get("pos"),t=this.model.get("margin"),i=+e.x,s=+e.y;this.chart.transition().duration(150).attr("transform","translate("+(t.left+i)+", "+(t.top+s)+")")},_onChangeDragging:function(){this.chart.classed("is-dragging",this.model.get("dragging")),!this.model.get("dragging")&&this._isMobileViewport()&&this._isTimeSeries()&&(this._showAxisTip("right",!1),this._showAxisTip("left",!1))},_toggleAxisTip:function(e,t){var i=this.chart.select(".CDB-Chart-axisTipText.CDB-Chart-axisTip-"+e),s=this.chart.select(".CDB-Chart-axisTipRect.CDB-Chart-axisTip-"+e),n=this.chart.select(".CDB-Chart-handle.CDB-Chart-handle-"+e).select(".CDB-Chart-axisTipTriangle");i&&i.transition().duration(60).attr("opacity",t),s&&s.transition().duration(60).attr("opacity",t),n&&n.transition().duration(60).style("opacity",t)},_showAxisTip:function(e,t){this._toggleAxisTip(e,t?1:0)},_setAxisTipAccordingToBins:function(){var e=this._getValueFromBinIndex(this._getLoBarIndex()),t=this._getValueFromBinIndex(this._getHiBarIndex());this._isDateTimeSeries()&&(t=h.substractOneUnit(t,this._dataviewModel.get("aggregation"))),this._setAxisTip(e,t)},_setAxisTip:function(e,t){this.options.hasAxisTip&&this.model.set({left_axis_tip:e,right_axis_tip:t})},reset:function(){this._removeChartContent(),this._setupDimensions(),this._calcBarWidth(),this._generateChartContent(),this._generateShadowBars()},refresh:function(){this._createFormatter(),this._setupDimensions(),this._removeAxis(),this._generateAxis(),this._updateChart(),this._refreshBarsColor(),this.chart.select(".CDB-Chart-handles").moveToFront(),this.chart.select(".Brush").moveToFront()},resetIndexes:function(){this.model.set({lo_index:null,hi_index:null})},removeShadowBars:function(){this.model.set("show_shadow_bars",!1)},_removeShadowBars:function(){this.chart.selectAll(".CDB-Chart-shadowBars").remove()},_removeBars:function(){this.chart.selectAll(".CDB-Chart-bars").remove()},_removeBrush:function(){this.chart.selectAll(".Brush").remove(),this.chart.classed("is-selectable",!1),this._axis.classed("is-disabled",!1)},_removeLines:function(){this.chart.select(".CDB-Chart-lines").remove(),this.chart.select(".CDB-Chart-line--bottom").remove()},_removeChartContent:function(){this._removeBrush(),this._removeHandles(),this._removeBars(),this._removeAxis(),this._removeLines()},_generateChartContent:function(){this._generateAxis(),this._isTabletViewport()&&this._isTimeSeries()||this._generateLines(),this._generateBars(),this._isMobileViewport()&&this._isTimeSeries()||this._generateBottomLine(),this._generateHandles(),this._setupBrush()},_generateLines:function(){this._generateHorizontalLines(),this._generateVerticalLines()},_generateVerticalLines:function(){this.chart.select(".CDB-Chart-lines").append("g").selectAll(".CDB-Chart-line").data(this.verticalRange.slice(1,this.verticalRange.length-1)).enter().append("svg:line").attr("class","CDB-Chart-line").attr("y1",0).attr("x1",function(e){return e}).attr("y2",this.chartHeight()).attr("x2",function(e){return e})},_generateHorizontalLines:function(){this.chart.append("g").attr("class","CDB-Chart-lines").append("g").attr("class","y").selectAll(".CDB-Chart-line").data(this.horizontalRange.slice(0,this.horizontalRange.length-1)).enter().append("svg:line").attr("class","CDB-Chart-line").attr("x1",0).attr("y1",function(e){return e}).attr("x2",this.chartWidth()).attr("y2",function(e){return e})},_generateBottomLine:function(){this.chart.append("line").attr("class","CDB-Chart-line CDB-Chart-line--bottom").attr("x1",0).attr("y1",this.chartHeight()-1).attr("x2",this.chartWidth()-1).attr("y2",this.chartHeight()-1)},_setupD3Bindings:function(){o.selection.prototype.moveToBack=function(){return this.each(function(){var e=this.parentNode.firstChild;e&&this.parentNode.insertBefore(this,e)})},o.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})}},_setupModel:function(){this.model=new r({bounded:!1,showLabels:!0,data:this.options.data,height:this.options.height,display:!0,show_shadow_bars:this.options.displayShadowBars,margin:n.clone(this.options.margin),width:0,pos:{x:0,y:0},normalized:this.options.normalized,local_timezone:this.options.local_timezone})},_setupBindings:function(){this.listenTo(this.model,"change:data",this._onChangeData),this.listenTo(this.model,"change:display",this._onChangeDisplay),this.listenTo(this.model,"change:dragging",this._onChangeDragging),this.listenTo(this.model,"change:height",this._onChangeHeight),this.listenTo(this.model,"change:left_axis_tip",this._onChangeLeftAxisTip),this.listenTo(this.model,"change:lo_index change:hi_index",this._onChangeRange),this.listenTo(this.model,"change:pos",this._onChangePos),this.listenTo(this.model,"change:right_axis_tip",this._onChangeRightAxisTip),this.listenTo(this.model,"change:showLabels",this._onChangeShowLabels),this.listenTo(this.model,"change:show_shadow_bars",this._onChangeShowShadowBars),this.listenTo(this.model,"change:width",this._onChangeWidth),this.listenTo(this.model,"change:normalized",this._onChangeNormalized),this._widgetModel&&(this.listenTo(this._widgetModel,"change:autoStyle",this._refreshBarsColor),this.listenTo(this._widgetModel,"change:style",function(){this._setupFillColor(),this._refreshBarsColor()})),this._dataviewModel&&this.listenTo(this._dataviewModel,"change:offset change:localTimezone",function(){this.refresh()}),this.listenTo(this._layerModel,"change:cartocss",function(){this._areGradientsAlreadyGenerated()||this._setupFillColor()}),this._originalData&&this.listenTo(this._originalData,"change:data",function(){this.updateYScale(),this._removeShadowBars(),this._generateShadowBars()})},_setupDimensions:function(){this._setupScales(),this._setupRanges(),this.forceResize()},_getData:function(){return this._originalData&&this._originalData.getData()||this.model.get("data")},_getMaxData:function(e){return o.max(e,function(e){return n.isEmpty(e)?0:e.freq})},_getXScale:function(){return o.scale.linear().domain([0,100]).range([0,this.chartWidth()])},_getYScale:function(){var e=this.model.get("normalized")?this.model.get("data"):this._getData();return o.scale.linear().domain([0,this._getMaxData(e)]).range([this.chartHeight(),0])},updateXScale:function(){this.xScale=this._getXScale()},updateYScale:function(){this.yScale=this._getYScale()},resetYScale:function(){this.yScale=this._originalYScale},_getDataForScales:function(){return!this.model.get("bounded")&&this._originalData?this._originalData.getData():this.model.get("data")},_setupScales:function(){var e=this._getDataForScales();if(this.updateXScale(),this._originalYScale&&!this.model.get("normalized")||(this._originalYScale=this.yScale=this._getYScale()),e&&e.length){var t=e[0].start,i=e[e.length-1].end;this.xAxisScale=o.scale.linear().range([t,i]).domain([0,this.chartWidth()])}},_setupRanges:function(){this.verticalRange=this._calculateVerticalRangeDivisions(),this.horizontalRange=o.range(0,this.chartHeight()+this.chartHeight()/2,this.chartHeight()/2)},_calculateVerticalRangeDivisions:function(){return this._isDateTimeSeries()&&this.model.get("data").length>0?this._calculateTimelySpacedDivisions():this._calculateEvenlySpacedDivisions()},_calculateTimelySpacedDivisions:function(){this._calcBarWidth();for(var e=Math.round(this.chartWidth()/this.options.divisionWidth),t=Math.ceil(this.model.get("data").length/e),i=[0],s=0,o=0;o<e;o++)s=o<e-1?s+t:this.model.get("data").length,i.push(Math.ceil(this.xAxisScale.invert(this._getValueFromBinIndex(s))));if((i=n.uniq(i)).length>=3){var a=n.last(i,2);a[1]-a[0]<this.options.divisionWidth&&(i=n.without(i,a[0]))}return i},_calculateEvenlySpacedDivisions:function(){var e=Math.round(this.chartWidth()/this.options.divisionWidth),t=this.chartWidth()/e,i=this.chartWidth()+t;return o.range(0,i,t).slice(0,e+1)},_calcBarWidth:function(){this.barWidth=this.chartWidth()/this.model.get("data").length},_generateChart:function(){var e=this.model.get("margin");this.chart=o.select(this.el).selectAll(".CDB-WidgetCanvas").append("g").attr("class","CDB-Chart").attr("transform","translate("+e.left+", "+e.top+")"),this.chart.classed(this.options.className||"",!0)},_onChangeShowShadowBars:function(){this.model.get("show_shadow_bars")?this._generateShadowBars():this._removeShadowBars()},_onChangeDisplay:function(){this.model.get("display")?this._show():this._hide()},hide:function(){this.model.set("display",!1)},show:function(){this.model.set("display",!0)},_hide:function(){this.$el.hide()},_show:function(){this.$el.show()},isHidden:function(){return!this.model.get("display")},_selectBars:function(){this.chart.selectAll(".CDB-Chart-bar").classed({"is-selected":function(e,t){return this._isBarChartWithinFilter(t)}.bind(this),"is-filtered":function(e,t){return!this._isBarChartWithinFilter(t)}.bind(this)})},_isBarChartWithinFilter:function(e){var t=this.brush.extent(),i=t[0],s=t[1],n=Math.floor(e*this.barWidth),o=Math.floor(n+this.barWidth),a=Math.floor(this.xScale(i)),r=Math.floor(this.xScale(s));return n>a&&n<r||o>a&&o<r||n<=a&&o>=r},_isDragging:function(){return this.model.get("dragging")},setAnimated:function(){return this.model.set("animated",!0)},_isAnimated:function(){return this.model.get("animated")},_move:function(e){this.model.set({pos:e})},expand:function(e){this.canvas.attr("height",this.model.get("height")+e),this._move({x:0,y:e})},contract:function(e){this.canvas.attr("height",e),this._move({x:0,y:0})},resizeHeight:function(e){this.model.set("height",e)},setNormalized:function(e){return this.model.set("normalized",!!e),this},removeSelection:function(){this.resetIndexes(),this.chart.selectAll(".CDB-Chart-bar").classed({"is-selected":!1,"is-filtered":!1}),this._refreshBarsColor(),this._removeBrush(),this._setupBrush()},selectRange:function(e,t){if(e||t){var i=this._dataviewModel.get("data");if(!i[e]||!i[t-1])return this.trigger("on_reset_filter");var s=this._getBarPosition(e),n=this._getBarPosition(t);this.model.set({lo_index:e,hi_index:t}),this._selectRange(s,n)}},_selectRange:function(e,t){this.chart.select(".Brush").transition().duration(this.brush.empty()?0:150).call(this.brush.extent([e,t])).call(this.brush.event)},_getLoBarIndex:function(){var e=this.brush.extent();return Math.round(this.xScale(e[0])/this.barWidth)},_getHiBarIndex:function(){var e=this.brush.extent();return Math.round(this.xScale(e[1])/this.barWidth)},_getBarIndex:function(){var e=o.event.sourceEvent.layerX;return Math.floor(e/this.barWidth)},_getBarPosition:function(e){return e*(100/this.model.get("data").length)},_setupBrush:function(){var e=o.svg.brush().x(this.xScale).on("brush",this._onBrushMove).on("brushend",this._onBrushEnd),t=this.chart.append("g").attr("class","Brush").call(e),i=this._isTabletViewport()&&this._isTimeSeries()?2*this.chartHeight():this.chartHeight();t.selectAll("rect").attr("y",0).attr("height",i),t.selectAll("rect.background").on("mouseout",this._onMouseOut).on("mousemove",this._onMouseMove),t.selectAll("rect").classed("ps-prevent-touchmove",!0),t.selectAll("g").classed("ps-prevent-touchmove",!0),this.brush=e,this.chart.selectAll("g.resize rect").attr("width",this.options.handleWidth).attr("x",-this.options.handleWidth/2)},_onBrushMove:function(){this.brush.empty()||(this.chart.classed("is-selectable",!0),this._axis.classed("is-disabled",!0),this.model.set({dragging:!0}),this._selectBars(),this._setupFillColor(),this._refreshBarsColor(),this._adjustBrushHandles(),this._updateAxisTip("left"),this._updateAxisTip("right"))},_onBrushEnd:function(){var e,t,i=this.model.get("data"),s=this.brush,n=this._getLoBarIndex(),a=this._getHiBarIndex();if(this.model.set({dragging:!1}),s.empty()&&this._isAnimated())this.trigger("on_brush_click",s.extent()[0]/100);else if(e=this._getBarPosition(n),t=this._getBarPosition(a),o.event.sourceEvent){if(n===a&&(a>=i.length?(n=i.length-1,a=i.length):a+=1),this.model.set({lo_index:n,hi_index:a},{silent:!0}),this.model.trigger("change:lo_index"),o.event.sourceEvent&&void 0===e&&void 0===t){var r=this._getBarIndex();this.model.set({lo_index:r,hi_index:r+1})}this._setupFillColor(),this._refreshBarsColor()}},_onMouseOut:function(){this.chart.selectAll(".CDB-Chart-bar").classed("is-highlighted",!1).attr("fill",this._getFillColor.bind(this)),this.trigger("hover",{target:null})},_onMouseMove:function(){var e=o.event.offsetX-this.model.get("margin").left,t=Math.floor(e/this.barWidth),i=this.model.get("data");if(void 0!==i[t]&&null!==i[t]){var s=i[t].freq,n={},a=this.chart.select(".CDB-Chart-bar:nth-child("+(t+1)+")");if(a&&a.node()&&!a.classed("is-selected")){var r=t*this.barWidth+this.barWidth/2,l=this.yScale(s),c=this.chartHeight()-this.yScale(s);if(c<this.options.minimumBarHeight&&c>0&&(l=this.chartHeight()-this.options.minimumBarHeight),!this._isDragging()&&s>0){var h=this.formatter(s);n={target:a[0][0],top:l,left:r,data:h}}else n=null}else n=null;this.trigger("hover",n),this.chart.selectAll(".CDB-Chart-bar").classed("is-highlighted",!1).attr("fill",this._getFillColor.bind(this)),a&&a.node()&&(a.attr("fill",function(){return this._getHoverFillColor(i[t],t)}.bind(this)),a.classed("is-highlighted",!0))}},_adjustBrushHandles:function(){var e=this.brush.extent(),t=e[0],i=e[1];this._moveHandle(t,"left"),this._moveHandle(i,"right"),this._setAxisTipAccordingToBins()},_moveHandle:function(e,t){var i=this.chart.select(".CDB-Chart-handle-"+t),s=e.toFixed(5),n=this.xScale(s)-this.options.handleWidth/2,o=s>=0&&s<=100?"inline":"none";i.style("display",o).attr("transform","translate("+n+", 0)")},_generateAxisTip:function(e){var t=this.chart.select(".CDB-Chart-handle.CDB-Chart-handle-"+e),i="right"!==e||this._isMobileViewport()&&this._isTimeSeries()?-26:this.chartHeight()+9.1;i=Math.floor(i);var s="right"!==e||this._isMobileViewport()&&this._isTimeSeries()?-11:this.chartHeight()+9.1+2,n="right"===e?-1:1,o=7*n,a=t.selectAll("g").data([""]).enter().append("g").attr("class","CDB-Chart-axisTip CDB-Chart-axisTip-"+e).attr("transform","translate(0,"+i+")");t.append("path").attr("class","CDB-Chart-axisTipRect CDB-Chart-axisTipTriangle").attr("transform","translate("+(this.options.handleWidth/2-7)+", "+s+")").attr("d",u(0,0,14,0,7,o,n)).style("opacity","1"),a.append("rect").attr("class","CDB-Chart-axisTipRect CDB-Chart-axisTip-"+e).attr("rx","2").attr("ry","2").attr("opacity","1").attr("height",17),a.append("text").attr("class","CDB-Text CDB-Size-small CDB-Chart-axisTipText CDB-Chart-axisTip-"+e).attr("dy","11").attr("dx","0").attr("opacity","1").text(function(e){return e})},_isTabletViewport:function(){return d.isTabletViewport()},_generateHandle:function(e){var t=this._isTabletViewport()&&this._isTimeSeries()?2*this.chartHeight():this.chartHeight(),i={width:this.options.handleWidth,height:t,radius:this.options.handleRadius},s=this.chart.select(".CDB-Chart-handles").append("g").attr("class","CDB-Chart-handle CDB-Chart-handle-"+e);if(this.options.hasAxisTip&&this._generateAxisTip(e),this.options.hasHandles){s.append("rect").attr("class","CDB-Chart-handleRect").attr("width",i.width).attr("height",i.height).attr("rx",i.radius).attr("ry",i.radius);var n=this._isTabletViewport()&&this._isTimeSeries()?this.chartHeight():this.chartHeight()/2;n-=3;for(var o=(i.width-2)/2,a=0;a<3;a++)s.append("line").attr("class","CDB-Chart-handleGrip").attr("x1",o).attr("y1",n+3*a).attr("x2",o+2).attr("y2",n+3*a)}return s},_generateHandles:function(){this.chart.append("g").attr("class","CDB-Chart-handles"),this.leftHandle=this._generateHandle("left"),this.rightHandle=this._generateHandle("right")},_removeHandles:function(){this.chart.select(".CDB-Chart-handles").remove()},_removeAxis:function(){this.canvas.select(".CDB-Chart-axis").remove()},_generateAdjustAnchorMethod:function(e){return function(t,i){return 0===i?"start":i===e.length-1?"end":"middle"}},_generateAxis:function(){this._axis=this._generateNumericAxis(),this._onChangeShowLabels()},_generateNumericAxis:function(){var e=this,t=this._generateAdjustAnchorMethod(this.verticalRange),i=this.chart.append("g").attr("class","CDB-Chart-axis CDB-Text CDB-Size-small");return i.append("g").selectAll(".Label").data(this.verticalRange).enter().append("text").attr("x",function(e){return e}).attr("y",function(){return e.chartHeight()+15}).attr("text-anchor",t).text(function(t){var i=function verticalToValue(t){return e.xAxisScale?e.xAxisScale(t):null}(t);if(n.isFinite(i))return e.formatter(i)}),i},_getMinValueFromBinIndex:function(e){var t=this.model.get("data")[e];return t?null!=t.min?t.min:t.start:null},_getMaxValueFromBinIndex:function(e){var t=null,i=this.model.get("data")[e];return i&&(t=this._isDateTimeSeries()&&!n.isUndefined(i.next)?i.next:null!=i.min?i.max:i.end),t},_getValueFromBinIndex:function(e){if(!n.isNumber(e))return null;var t=null,i=!0,s=this.model.get("data");e>=s.length&&(e=s.length-1,i=!1);var o=s[e];return o&&(t=i?o.start:n.isFinite(o.next)?o.next:o.end),t},_getIndexFromValue:function(e){return n.findIndex(this.model.get("data"),function(t){return t.start<=e&&e<=t.end})},_getMaxFromData:function(){return this.model.get("data").length>0?n.last(this.model.get("data")).end:null},_calculateDataDomain:function(){var e,t,i,s,o=n.clone(this.model.get("data"));if(this._hasFilterApplied()){var a=this._getLoBarIndex(),r=this._getHiBarIndex()-1,l=o.slice(a,r);if(n.isNaN(a)||n.isNaN(r))return[0,0];if(i=this._getMinValueFromBinIndex(a),s=this._getMaxValueFromBinIndex(r),o[a]&&0===o[a].freq&&(e=n.find(l,function(e){return 0!==e.freq},this)),o[r]&&0===o[r].freq){var c=l.reverse();t=n.find(c,function(e){return 0!==e.freq},this)}}else i=this._getMinValueFromBinIndex(0),s=this._getMaxValueFromBinIndex(o.length-1),e=n.find(o,function(e){return 0!==e.freq}),t=n.find(o.reverse(),function(e){return 0!==e.freq});return[i=e?null!=e.min?e.min:e.start:i,s=t?null!=t.max?t.max:t.end:s]},_removeFillGradients:function(){o.select(this.el).select("defs").remove(),delete this._linearGradients},_areGradientsAlreadyGenerated:function(){return!!this._linearGradients},_generateFillGradients:function(){if(!this._widgetModel||!this._widgetModel.isAutoStyleEnabled())return!1;var e=this._widgetModel.getAutoStyle();if(n.isEmpty(e)||n.isEmpty(e.definition))return!1;var t=this,i=e.definition[Object.keys(e.definition)[0]],s=i&&i.color&&i.color.range,r=a.interpolateRgbBasis(s),l=n.map(s,function(e){return o.rgb(e).darker(.3).toString()}),c=a.interpolateRgbBasis(l),h=this.model.get("data"),d=this._calculateDataDomain(),u=o.scale.linear().domain(d).range([0,1]),p=o.select(this.el).append("defs");this._linearGradients=p.selectAll(".gradient").data(h).enter().append("linearGradient").attr("class","gradient").attr("id",function(e,i){return this.__scale__=o.scale.linear().range([t._getMinValueFromBinIndex(i),t._getMaxValueFromBinIndex(i)]).domain([0,1]),"bar-"+t.cid+"-"+i}).attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%"),this._linearGradientsHover=p.selectAll(".gradient-hover").data(h).enter().append("linearGradient").attr("class","gradient-hover").attr("id",function(e,i){return this.__scale__=o.scale.linear().range([t._getMinValueFromBinIndex(i),t._getMaxValueFromBinIndex(i)]).domain([0,1]),"bar-"+t.cid+"-"+i+"-hover"}).attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%"),this._linearGradients.selectAll("stop").data(o.range(5)).enter().append("stop").attr("offset",function(e,t){return(this.__offset__=Math.floor(t/4*100))+"%"}).attr("stop-color",function(){var e=this.parentNode.__scale__,t=u(e(this.__offset__/100));return r(t)}),this._linearGradientsHover.selectAll("stop").data(o.range(5)).enter().append("stop").attr("offset",function(e,t){return(this.__offset__=Math.floor(t/4*100))+"%"}).attr("stop-color",function(){var e=this.parentNode.__scale__,t=u(e(this.__offset__/100));return c(t)})},_setupFillColor:function(){this._removeFillGradients(),this._generateFillGradients()},_getFillColor:function(e,t){return this._widgetModel?this._widgetModel.isAutoStyle()?this._hasFilterApplied()&&!this._isBarChartWithinFilter(t)?"rgba(0, 0, 0, 0.06)":"url(#bar-"+this.cid+"-"+t+")":this._hasFilterApplied()?this._isBarChartWithinFilter(t)?"#2E3C43":"rgba(0, 0, 0, 0.06)":this._widgetModel.getWidgetColor()||this.options.chartBarColor:this.options.chartBarColor},_getHoverFillColor:function(e,t){var i=this._getFillColor(e,t);return this._widgetModel&&this._widgetModel.isAutoStyle()?"url(#bar-"+this.cid+"-"+t+"-hover)":o.rgb(i).darker(.3).toString()},_updateChart:function(){var e=this,t=this.model.get("data"),i=this.chart.selectAll(".CDB-Chart-bar").data(t);i.enter().append("rect").attr("class","CDB-Chart-bar").attr("fill",this._getFillColor.bind(this)).attr("x",function(t,i){return i*e.barWidth}).attr("y",e.chartHeight()).attr("height",0).attr("width",Math.max(0,this.barWidth-1)),i.attr("data-tooltip",function(t){return e._tooltipFormatter(t.freq)}).transition().duration(200).attr("height",function(t){if(n.isEmpty(t))return 0;if(e._isMobileViewport()&&e._isTimeSeries())return 3;var i=e.chartHeight()-e.yScale(t.freq);return i<e.options.minimumBarHeight&&i>0&&(i=e.options.minimumBarHeight),i}).attr("y",function(t){if(n.isEmpty(t))return e.chartHeight();if(e._isMobileViewport()&&e._isTimeSeries())return e.chartHeight()/2+3;var i=e.chartHeight()-e.yScale(t.freq);return i<e.options.minimumBarHeight&&i>0?e.chartHeight()-e.options.minimumBarHeight:e.yScale(t.freq)}),i.exit().transition().duration(200).attr("height",function(){return 0}).attr("y",function(){return e.chartHeight()})},_refreshBarsColor:function(){this.chart.selectAll(".CDB-Chart-bar").classed("is-highlighted",!1).attr("fill",this._getFillColor.bind(this))},_isMobileViewport:function(){return d.isMobileViewport()},_generateBars:function(){var e=this,t=this.model.get("data");this._calcBarWidth();var i=(2*t.length-1>this.chartWidth()||this._isMobileViewport())&&this._isDateTimeSeries()?0:1,s=this.chart.append("g").attr("transform","translate(0, 0)").attr("class","CDB-Chart-bars").selectAll(".CDB-Chart-bar").data(t);s.enter().append("rect").attr("class","CDB-Chart-bar").attr("fill",this._getFillColor.bind(e)).attr("x",function(t,i){return i*e.barWidth}).attr("y",e.chartHeight()).attr("height",0).attr("data-tooltip",function(t){return e._tooltipFormatter(t.freq)}).attr("width",Math.max(1,this.barWidth-i)),s.attr("data-tooltip",function(t){return e._tooltipFormatter(t.freq)}).transition().ease(this.options.transitionType).duration(this.options.animationSpeed).delay(this.options.animationBarDelay).transition().attr("height",function(t){if(n.isEmpty(t))return 0;if(e._isMobileViewport()&&e._isTimeSeries())return 3;var i=e.chartHeight()-e.yScale(t.freq);return i<e.options.minimumBarHeight&&i>0&&(i=e.options.minimumBarHeight),i}).attr("y",function(t){if(n.isEmpty(t))return e.chartHeight();if(e._isMobileViewport()&&e._isTimeSeries())return e.chartHeight()/2+3;var i=e.chartHeight()-e.yScale(t.freq);return i<e.options.minimumBarHeight&&i>0?e.chartHeight()-e.options.minimumBarHeight:e.yScale(t.freq)})},showShadowBars:function(){this.options.displayShadowBars&&this.model.set("show_shadow_bars",!0)},_generateShadowBars:function(){var e=this._getData();if(e&&e.length&&this.model.get("show_shadow_bars")&&!this.model.get("normalized")){this._removeShadowBars();var t=this,i=o.scale.linear().domain([0,this._getMaxData(e)]).range([this.chartHeight(),0]),s=this.chartWidth()/e.length;this.chart.append("g").attr("transform","translate(0, 0)").attr("class","CDB-Chart-shadowBars").selectAll(".CDB-Chart-shadowBar").data(e).enter().append("rect").attr("class","CDB-Chart-shadowBar").attr("x",function(e,t){return t*s}).attr("y",function(e){if(n.isEmpty(e))return t.chartHeight();var s=t.chartHeight()-i(e.freq);return s<t.options.minimumBarHeight&&s>0?t.chartHeight()-t.options.minimumBarHeight:i(e.freq)}).attr("width",Math.max(.5,s-1)).attr("height",function(e){if(n.isEmpty(e))return 0;var s=t.chartHeight()-i(e.freq);return s<t.options.minimumBarHeight&&s>0&&(s=t.options.minimumBarHeight),s}),this.chart.selectAll(".CDB-Chart-shadowBars").moveToBack(),this.chart.selectAll(".CDB-Chart-lines").moveToBack()}else this._removeShadowBars()},_hasFilterApplied:function(){return null!=this.model.get("lo_index")&&null!=this.model.get("hi_index")},_isTimeSeries:function(){return 0===this.options.type.indexOf("time")},_isDateTimeSeries:function(){return"time-date"===this.options.type},_calculateDivisionWithByAggregation:function(e){switch(e){case"year":return 50;case"quarter":case"month":return 80;case"week":case"day":return 120;default:return 140}},_createFormatter:function(){this.formatter=c.formatNumber,this._isDateTimeSeries()&&(this.formatter=c.timestampFactory(this._dataviewModel.get("aggregation"),this._dataviewModel.getCurrentOffset()),this.options.divisionWidth=this._calculateDivisionWithByAggregation(this._dataviewModel.get("aggregation")))},unsetBounds:function(){this.model.set("bounded",!1),this.updateYScale(),this.contract(this.options.height),this.resetIndexes(),this.removeSelection(),this._setupFillColor()},setBounds:function(){this.model.set("bounded",!0),this.updateYScale(),this.expand(4),this.removeShadowBars()}})},1470:function(e,t,i){var s=i(18),n=i(4),o=i(1469),a=i(971),r=i(58);e.exports=n.extend({className:"CDB-Chart--histogram",options:{tooltipDataAttribute:"data-tooltip"},defaults:{histogramChartHeight:72,histogramChartMobileHeight:16},initialize:function(){if(!this.options.dataviewModel)throw new Error("dataviewModel is required");if(!this.options.layerModel)throw new Error("layerModel is required");this._timeSeriesModel=this.options.timeSeriesModel,this._dataviewModel=this.options.dataviewModel,this._layerModel=this.options.layerModel,this._rangeFilter=this.options.rangeFilter,this._originalData=this._dataviewModel.getUnfilteredDataModel(),this._initBinds()},render:function(){return this.clearSubViews(),this._createHistogramView(),this},selectRange:function(e,t){this._chartView.selectRange(e,t)},resetFilter:function(){this._rangeFilter.unsetRange()},_initBinds:function(){this.listenTo(this._dataviewModel,"change:data",this._onChangeData,this),this.listenTo(this._dataviewModel,"change:column",this.resetFilter,this),this.listenTo(this._timeSeriesModel,"change:normalized",this._onNormalizedChanged),this.listenTo(this._timeSeriesModel,"change:local_timezone",this._onChangeLocalTimezone),this.listenTo(this._timeSeriesModel,"forceResize",this._onForceResize),this.listenTo(this._rangeFilter,"change",this._onFilterChanged)},_toggleTooltip:function(e){if(!e||!e.target)return this._clearTooltip();this._showTooltip(e)},_showTooltip:function(e){this.tooltip&&e&&this.tooltip.getElement()===e.target||(this._clearTooltip(),this.tooltip=new r({el:e.target,title:function(){return this._getTooltipTitle(e)}.bind(this),trigger:"manual"}),this.tooltip.showTipsy(),this.addView(this.tooltip))},_getTooltipTitle:function(e){return s(e.target).attr(this.options.tooltipDataAttribute)},_clearTooltip:function(){this.tooltip&&(this.tooltip.hideTipsy(),this.removeView(this.tooltip),this.tooltip=void 0)},_createHistogramView:function(){this._chartView=this._instantiateChartView(),this.addView(this._chartView),this.$el.append(this._chartView.render().el),this._chartView.show(),this.listenTo(this._chartView,"on_brush_end",this._onBrushEnd,this),this.listenTo(this._chartView,"on_reset_filter",this.resetFilter,this),this.listenTo(this._chartView,"hover",this._toggleTooltip,this),this.listenTo(this._chartView.model,"change:width",this._onChangeChartWidth,this)},_instantiateChartView:function(){return new o({type:this._getChartType(),chartBarColor:this._timeSeriesModel.getWidgetColor()||"#F2CC8F",animationSpeed:100,margin:{top:this._getMarginTop(),right:4,bottom:4,left:this._getMarginLeft()},hasHandles:!0,handleWidth:8,hasAxisTip:!0,animationBarDelay:function(e,t){return 3*t},height:this.defaults.histogramChartHeight,dataviewModel:this._dataviewModel,layerModel:this._layerModel,data:this._dataviewModel.getData(),originalData:this._originalData,displayShadowBars:!this._timeSeriesModel.get("normalized"),normalized:!!this._timeSeriesModel.get("normalized"),widgetModel:this._timeSeriesModel,local_timezone:!!this._timeSeriesModel.get("local_timezone")})},_getChartType:function(){return"time-"+this._dataviewModel.getColumnType()},_onChangeData:function(){this._chartView&&(this._chartView.replaceData(this._dataviewModel.getData()),this._chartView.updateXScale(),this._chartView.updateYScale())},_onBrushEnd:function(e,t){var i=this._dataviewModel.getData();this._rangeFilter.setRange(i[e].start,i[t-1].end),this._timeSeriesModel.set({lo_index:e,hi_index:t})},_onChangeChartWidth:function(){var e=a.isTabletViewport();this._chartView.toggleLabels(!e);var t=e?this.defaults.histogramChartMobileHeight:this.defaults.histogramChartHeight;this._chartView.model.set("height",t)},_onNormalizedChanged:function(){this._chartView&&this._chartView.setNormalized(this._timeSeriesModel.get("normalized"))},_onChangeLocalTimezone:function(){this._dataviewModel.set("localTimezone",this._timeSeriesModel.get("local_timezone"))},_onForceResize:function(){this._chartView.forceResize()},_resetFilterInDI:function(){this._timeSeriesModel.set({min:void 0,max:void 0,lo_index:void 0,hi_index:void 0}),this._chartView.removeSelection()},_onFilterChanged:function(){this._rangeFilter.has("min")||this._rangeFilter.has("max")||this._resetFilterInDI()},_getMarginLeft:function(){return 4},_getMarginTop:function(){return a.isTabletViewport()?0:4}})},1475:function(e,t,i){var s=i(1),n=i(2579),o=function(e){this.defs=[],s.each(e,function(e){this.addType(e)},this)};o.prototype.DEFAULT_CLASS_NAMES="CDB-Widget CDB-Widget--light",o.prototype.addType=function(e){if(!e.match){if(!e.type)throw new Error("def.type or def.match must be provided for createContentView to work");e.match=function(e){return e.get("type")===this.type}}if(!s.isFunction(e.createContentView))throw new Error("def.createContentView must be a function");this.defs.push(e)},o.prototype.createWidgetView=function(e){var t=s.find(this.defs,function(t){return t.match(e)});if(t){var i={className:this.DEFAULT_CLASS_NAMES,model:e,contentView:t.createContentView(e)};return new n(s.isFunction(t.customizeWidgetAttrs)?t.customizeWidgetAttrs(i):i)}},e.exports=o},1480:function(e,t,i){e.exports={VERSION:"",createDashboard:i(2584)}},1486:function(e,t,i){var s=i(1494),n=i(1485);e.exports=s.extend({options:{acceptedExtensions:["jpeg","jpg","png","gif"],imageKind:"orgavatar",imageURLAttribute:"avatar_url"},render:function render(){return this._destroyFileInput(),this.clearSubViews(),this.$el.html(n({state:this._model.get("state"),name:this._renderModel.get("name"),inputName:this._renderModel.get("inputName"),avatarURL:this._renderModel.get("avatar_url"),username:this._renderModel.get("username"),avatarAcceptedExtensions:this._formatAcceptedExtensions(this.options.acceptedExtensions)})),this._renderFileInput(),this}})},1487:function(e,t,i){i(23),i(326),i(64),e.exports={getAssetsVersion:function getAssetsVersion(e){for(var t=window.location.search.substring(1).split("&"),i=0;i<t.length;i++){var s=t[i].split("=");if("v"===s[0])return s[1]}return window.StaticConfig.assetVersion||window.CartoConfig&&window.CartoConfig.data&&window.CartoConfig.data.user_frontend_version||e},getAssetsBaseUrl:function getAssetsBaseUrl(){var e=window.CartoConfig.data,t=e&&e.asset_host?e.asset_host+"/assets":"";return(window.StaticConfig.assetsBaseUrl||t||e.config.app_assets_base_url)+"/"},getAssetsUrl:function getAssetsUrl(e){return this.getAssetsBaseUrl()+this.getAssetsVersion(e)}}},1489:function(e,t,i){var s=i(4),n=i(1488),o=i(14),a=["configModel","userModel","assetsVersion"];e.exports=s.extend({initialize:function initialize(e){o(e,a,this)},render:function render(){return this.$el.html(n({assetsVersion:this._assetsVersion,googleTagManagerId:this._configModel.get("google_tag_manager_id"),intercomAppId:this._configModel.get("intercom_app_id"),intercomEnabled:!!this._userModel.featureEnabled("intercom"),trackjsAppKey:this._configModel.get("trackjs_app_key"),trackjsCustomer:this._configModel.get("trackjs_customer"),trackjsEnabled:!!this._configModel.get("trackjs_enabled"),fullstoryEnabled:!!this._configModel.get("fullstory_enabled"),fullstoryOrg:this._configModel.get("fullstoryOrg"),userEmail:this._userModel.get("email"),userName:this._userModel.get("username"),userId:this._userModel.get("id"),userAccountType:this._userModel.get("account_type"),userCreatedAtInSeconds:Date.parse(this._userModel.get("created_at"))/1e3,userJobRole:this._userModel.get("job_role"),userInTrialPeriod:this._userModel.get("show_trial_reminder")})),this}})},1491:function(e,t,i){i(34),i(88);var s=i(4),n=i(1490),o=i(14),a=i(2708),r=["userModel","configModel"];e.exports=s.extend({initialize:function initialize(e){o(e,r,this)},render:function render(){var e=this._userModel.get("db_size_in_bytes"),t=this._userModel.get("quota_in_bytes"),i=Math.round(e/t*100),s="";return i>80&&i<90?s="caution":i>89&&(s="danger"),this.$el.html(n({isCartoDBHosted:this._configModel.get("cartodb_com_hosted"),usedDataStr:a(e).toString(2),usedDataPct:i,progressBarClass:s,availableDataStr:a(t).toString(2),profileUrl:this._userModel.viewUrl().accountProfile().pathname(),accountUrl:this._userModel.viewUrl().accountSettings().pathname(),apiKeysUrl:this._userModel.viewUrl().apiKeys().pathname(),connectedAppsUrl:this._userModel.viewUrl().connectedApps().pathname(),connectionsUrl:this._userModel.viewUrl().connections().pathname(),isInsideOrg:this._userModel.isInsideOrg(),hasDirectDBConnection:this._userModel.featureEnabled("dbdirect"),planUrl:this._userModel.get("plan_url"),isOrgAdmin:this._userModel.isOrgAdmin(),organizationUrl:this._userModel.viewUrl().organization().pathname(),isOrgOwner:this._userModel.isOrgOwner(),upgradeContactEmail:this._userModel.upgradeContactEmail(),path:this.getPath()})),this},getPath:function getPath(){return window.location.pathname}})},1493:function(e,t,i){var s=i(4),n=i(1492),o=i(14),a=["userModel","upgradeUrl","trialDays"];e.exports=s.extend({initialize:function initialize(e){o(e,a,this),this.userAccount=this._userModel.get("account_type")},render:function render(){return this.clearSubViews(),this.$el.html(n({upgradeUrl:this._upgradeUrl,trialDays:this._trialDays})),this}})},1494:function(e,t,i){i(37);var s=i(3),n=i(1),o=i(6),a=i(4),r=i(988),l=i(14);i(2719);var c=i(2718),h=["configModel","renderModel"];e.exports=a.extend({options:{acceptedExtensions:["jpeg","jpg","png","gif"],imageKind:"mobileAppIcon",imageURLAttribute:"icon_url"},initialize:function initialize(e){l(e,h,this),this._model=new o.Model({state:"idle"}),this._initBinds()},render:function render(){return this._destroyFileInput(),this.clearSubViews(),this.$el.html(r({state:this._model.get("state"),name:this._renderModel.get("name"),inputName:this._renderModel.get("inputName"),iconURL:this._renderModel.get("icon_url"),iconAcceptedExtensions:this._formatAcceptedExtensions(this.options.acceptedExtensions)})),this._renderFileInput(),this},_initBinds:function _initBinds(){n.bindAll(this,"_onInputChange","_onSuccess","_onError"),this.listenTo(this._model,"change",this.render)},_destroyFileInput:function _destroyFileInput(){var e=this.$(":file");e.unbind("change",this._onInputChange,this),e.filestyle("destroy")},_renderFileInput:function _renderFileInput(){var e=this.$(":file"),t={buttonText:"Choose image"};"loading"===this._model.get("state")&&(t.disabled=!0),e.filestyle(t),s(e).call(e,"change",this._onInputChange)},_onInputChange:function _onInputChange(){var e=this.$(":file").prop("files");new c(null,{userId:this._renderModel.get("id"),configModel:this._configModel}).save({kind:this.options.imageKind,filename:e},{success:this._onSuccess,error:this._onError}),this._model.set("state","loading")},_onSuccess:function _onSuccess(e,t){this._renderModel.set(this.options.imageURLAttribute,t.public_url),this._model.set("state","success")},_onError:function _onError(){this._model.set("state","error")},clean:function clean(){this._destroyFileInput(),a.prototype.clean.apply(this)},_formatAcceptedExtensions:function _formatAcceptedExtensions(e){for(var t=[],i=0;i<e.length;i++)t[i]="image/"+e[i];return t.join(",")}})},1499:function(e,t,i){var s=i(6);e.exports=s.Model.extend({defaults:{type:"",message:"",opened:!1}})},1500:function(e,t,i){var s=i(3),n=i(18),o=i(4),a=i(14),r=["el"];e.exports=o.extend({events:{"click .js-foo":"_fooHandler"},initialize:function initialize(e){var t;a(e,r,this),this._onWindowScroll=s(t=this._onWindowScroll).call(t,this),this._topBoundary=this.$el.offset().top,this._initBinds()},_initBinds:function _initBinds(){this._bindScroll()},_onWindowScroll:function _onWindowScroll(){this.$el.toggleClass("is-fixed",n(window).scrollTop()>this._topBoundary)},_unbindScroll:function _unbindScroll(){n(window).unbind("scroll",this._onWindowScroll)},_bindScroll:function _bindScroll(){var e;this._unbindScroll(),s(e=n(window)).call(e,"scroll",this._onWindowScroll)},clean:function clean(){this._unbindScroll()}})},1501:function(e,t,i){var s=i(84),n=i(1),o=i(4),a=i(2778);e.exports=o.extend({render:function render(){this.$el.removeClass("is-pre-loading").addClass("is-loading");var e=this;return(this.options.createVis?this._createVisMap(this.options.createVis):this._createFallbackMap()).done(function(){e.$el.removeClass("is-loading"),e.$(".js-spinner").remove()}),this},_createVisMap:function _createVisMap(e){return s.createVis(this.el,e.url||e.vizJson,n.defaults(e.opts,{authToken:"default_public",title:!1,header:!1,description:!1,searchControl:!1,layer_selector:!1,text:!1,image:!1,zoomControl:!1,logo:!1,scrollwheel:!1,mobile_layout:!0,legends:!1,loader:!1,fullscreen:!1,no_cdn:!1}))},_createFallbackMap:function _createFallbackMap(){return a({el:this.el,basemap:this.options.fallbackBaselayer}),{done:function done(e){e()}}}})},1506:function(e,t,i){"use strict";var s=i(12),n=i(79),o=i(353),a=i.n(o),r=i(193),l=i.n(r),c=i(483),h=i.n(c),d=i(1697),u=i.n(d),p=i(1696),g=i.n(p),m=i(201),f={install:function(e,t){e.mixin({beforeCreate:function beforeCreate(){this.$cartoModels=t}})}},_=Object(m.a)(),v=new a.a(Object(s.a)({},_.config,{base_url:_.user_data.base_url})),y=function configureUserModel(e){var t=new l.a(e);e.organization&&t.setOrganization(new h.a(e.organization,{configModel:v}));e.groups&&t.setGroups(new u.a(e.groups,{configModel:v}));return t}(_.user_data),w=new g.a({showGeocodingDatasetURLButton:!0,geocodingsPolling:!0,importsPolling:!0},{configModel:v,userModel:y});n.default.use(f,{config:v,user:y,backgroundPolling:w})},1507:function(e,t,i){var s=i(76),n=i(3),o=i(6),a=i(2843),r=i(14),l=["userModel","configModel"];e.exports=o.Model.extend({defaults:{showGeocodingDatasetURLButton:!1,showSuccessDetailsButton:!0,geocodingsPolling:!1,importsPolling:!1},initialize:function initialize(e,t){r(t,l,this),this.importsCollection=t.importsCollection||new a(null,{userModel:this._userModel,configModel:this._configModel}),this._initBinds(),this.startPollings()},_initBinds:function _initBinds(){var e,t,i;n(e=this.importsCollection).call(e,"change:state",function(e){this.trigger("change",e,this),this._onImportsStateChange(e)},this),n(t=this.importsCollection).call(t,"remove",function(e){this.trigger("importRemoved",e,this)},this),n(i=this.importsCollection).call(i,"add",function(e){this.trigger("importAdded",e,this)},this)},getTotalFailedItems:function getTotalFailedItems(){return this.importsCollection.failedItems().length},removeImportItem:function removeImportItem(e){if(!e)return!1;this.importsCollection.remove(e)},addImportItem:function addImportItem(e){if(!e)return!1;this.importsCollection.add(e)},canAddImport:function canAddImport(){return this.importsCollection.canImport()},getTotalImports:function getTotalImports(){return this.importsCollection.size()},getTotalPollings:function getTotalPollings(){return this.importsCollection.size()},stopPollings:function stopPollings(){this.get("importsPolling")&&this.importsCollection.destroyCheck()},startPollings:function startPollings(){var e=this;s(function(){e.get("importsPolling")&&e.importsCollection.pollCheck()},3e3)},_onImportsStateChange:function _onImportsStateChange(){},clean:function clean(){this.importsCollection.unbind(null,null,this),o.Model.prototype.clean.apply(this)}})},1508:function(e,t,i){i(23),i(101),i(31);var s=i(3);i(31);var n=i(1),o=i(6),a=i(1047),r=i(917),l=i(163),c=i(525);e.exports=o.Model.extend({defaults:{step:"upload",state:""},initialize:function initialize(e,t){if(!t.userModel)throw new Error("userModel is required");if(!t.configModel)throw new Error("configModel is required");this._userModel=t.userModel,this._configModel=t.configModel,this._uploadModel=new r(t.upload,{userModel:this._userModel,configModel:this._configModel}),n.isEmpty(t)&&(t={}),this._importModel=new a(t.import,{configModel:this._configModel}),this._initBinds(),this._checkStatus()},_initBinds:function _initBinds(){var e,t,i,n,o;s(e=this).call(e,"change:import",this._onImportChange,this),s(t=this).call(t,"change:upload",this._onUploadChange,this),s(i=this).call(i,"change:id",this._onIdChange,this),s(n=this._importModel).call(n,"change",function(){this.trigger("change:import",this),this.trigger("change",this)},this),s(o=this._uploadModel).call(o,"change",function(){this.trigger("change:upload",this),this.trigger("change",this)},this)},_destroyBinds:function _destroyBinds(){this._uploadModel.unbind(null,null,this),this._importModel.unbind(null,null,this)},_onIdChange:function _onIdChange(){var e=this.get("id");e&&this._importModel.set("item_queue_id",e),this.set("step","import")},_onUploadChange:function _onUploadChange(e,t){if("upload"===this.get("step")){var i=this._uploadModel.get("item_queue_id"),s=this._uploadModel.get("state");i&&this.set("id",i),s&&this.set("state",s)}},_onImportChange:function _onImportChange(){if("import"===this.get("step")){var e=this._importModel.get("state");e&&this.set("state",e)}},_checkStatus:function _checkStatus(){this.get("id")||this._uploadModel.isValid()?"file"===this._uploadModel.get("type")?this._uploadModel.upload():this.get("id")?(this.set("step","import"),this._importModel.set("item_queue_id",this.get("id"))):this._importModel.get("item_queue_id")||""===this._uploadModel.get("type")||(this.set("step","import"),this._importModel.createImport(this._uploadModel.toJSON())):this.trigger("change:upload")},getImportModel:function getImportModel(){return this._importModel},pause:function pause(){this.stopUpload(),this.stopImport()},hasFailed:function hasFailed(){var e=this.get("state"),t=this.get("step");return"import"===t&&"failure"===e||"upload"===t&&"error"===e},hasCompleted:function hasCompleted(){return"import"===this.get("step")&&this._importModel&&"complete"===this._importModel.get("state")},getWarnings:function getWarnings(){return"import"===this.get("step")?this._importModel.get("warnings"):""},getError:function getError(){if(this.hasFailed()){var e=this.get("step");return n.extend({errorCode:this["upload"===e?"_uploadModel":"_importModel"].get("error_code"),itemQueueId:"import"===e?this._importModel.get("id"):"",originalUrl:"import"===e?this._importModel.get("original_url"):"",dataType:"import"===e?this._importModel.get("data_type"):"",httpResponseCode:"import"===e?this._importModel.get("http_response_code"):"",httpResponseCodeMessage:"import"===e?this._importModel.get("http_response_code_message"):""},this["upload"===e?"_uploadModel":"_importModel"].get("get_error_text"))}return{title:"",what_about:"",error_code:""}},importedVis:function importedVis(){return this.get("import").derived_visualization_id?this._getMapVis():this._getDatasetVis()},getNumberOfTablesCreated:function getNumberOfTablesCreated(){return this._importModel.get("tables_created_count")},_getServiceName:function _getServiceName(){return this._importModel.get("service_name")},isTwitterImport:function isTwitterImport(){return"twitter_search"===this._getServiceName()},isCartoImport:function isCartoImport(){return this._getDisplayName()&&this._getDisplayName().match(/\.carto$/i)},_getDisplayName:function _getDisplayName(){return this._importModel.get("display_name")},_getMapVis:function _getMapVis(){var e=this._importModel.get("derived_visualization_id");return!!e&&this._createVis({type:"derived",id:e})},_getDatasetVis:function _getDatasetVis(){var e=this._importModel.get("table_name");return!!e&&this._createVis({type:"table",table:{name:e}})},_createVis:function _createVis(e){var t=new l(e,{configModel:this._configModel});return t.permission=new c({owner:this._userModel.attributes},{configModel:this._configModel,userModel:this._userModel}),t},setError:function setError(e){var t=this["upload"===this.get("step")?"_uploadModel":"_importModel"];this.stopUpload(),this.stopImport(),t.set(e),this.set("state","error")},stopUpload:function stopUpload(){this._uploadModel.stopUpload()},stopImport:function stopImport(){this._importModel.destroyCheck()},get:function get(e){return"upload"===e?this._uploadModel.toJSON():"import"===e?this._importModel.toJSON():o.Model.prototype.get.call(this,e)},getRedirectUrl:function getRedirectUrl(e){var t=this.importedVis();if(t)return encodeURI(t.viewUrl(e).edit())},toJSON:function toJSON(){return{step:this.get("step"),id:this.get("id"),state:this.get("state"),upload:this._uploadModel.toJSON(),import:this._importModel.toJSON()}}})},1510:function(e,t,i){var s=i(4),n=i(1509),o=i(85);e.exports=s.extend({initialize:function initialize(e){if(!e.userModel)throw new Error("userModel is required");if(!e.configModel)throw new Error("configModel is required");this._userModel=e.userModel,this._configModel=e.configModel,this._notification=o.addNotification({status:"error",closable:!0,button:!1,info:this._getInfo()}),this._initBinds()},_initBinds:function _initBinds(){this._notification.on("notification:close",this._closeHandler,this),this.add_related_model(this._notification)},_closeHandler:function _closeHandler(){this.clean()},_getInfo:function _getInfo(){var e=this._userModel.getMaxConcurrentImports(),t=!this._configModel.get("cartodb_com_hosted")&&1===e;return n({upgradeUrl:window.upgrade_url,isUpgradeable:t,importQuota:e})}})},1512:function(e,t,i){var s=i(4),n=i(59),o=i(1511),a=i(14),r=["userModel","modalModel"];e.exports=s.extend({className:"TwitterImportDetails",events:{"click .js-close":"_onCloseClick"},initialize:function initialize(e){a(e,r,this)},render:function render(){var e=this.model.get("import"),t=this._userModel.get("twitter"),i=t.quota-t.monthly_use;return this.$el.html(o({datasetTotalRows:e.tweets_georeferenced,datasetTotalRowsFormatted:n.formatNumber(e.tweets_georeferenced),tweetsCost:e.tweets_cost,tweetsCostFormatted:n.formatNumber(e.tweets_cost),availableTweets:i,availableTweetsFormatted:n.formatNumber(i),tweetsOverquota:e.tweets_overquota,tweetsOverquotaFormatted:n.formatNumber(e.tweets_overquota),blockSizeFormatted:n.formatNumber(t.block_size),blockPriceFormatted:n.formatNumber(t.block_price)})),this},_onCloseClick:function _onCloseClick(){this._modalModel.destroy()}})},1516:function(e,t,i){var s=i(4),n=i(1515),o=i(1514),a=i(1513);e.exports=s.extend({initialize:function initialize(e){if(!e.userModel)throw new Error("userModel is required");if(!e.warnings)throw new Error("warnings is required");this._userModel=this.options.userModel,this._warnings=this.options.warnings},render:function render(){var e=this._warnings,t=this._getTemplate(e);return this.$el.html(t({userMaxLayers:e.user_max_layers,maxTablesPerImport:e.max_tables_per_import,maxRowsPerConnectorImport:e.max_rows_per_connection})),this},_getTemplate:function _getTemplate(e){return e.user_max_layers&&e.max_tables_per_import?e.user_max_layers<e.max_tables_per_import?n:o:e.user_max_layers?n:e.max_tables_per_import?o:e.max_rows_per_connection?a:void 0}})},1517:function(e,t,i){"use strict";i(79).default.directive("clickOutside",{bind:function bind(e,t,i){e.clickOutsideEvent=function(s){e.contains(s.target)||i.context[t.expression](s)},e.addClickEvent=function(t){document.body.addEventListener("click",e.clickOutsideEvent,{passive:!0})},e.addEventListener("click",e.addClickEvent,{passive:!0})},unbind:function unbind(e){document.body.removeEventListener("click",e.clickOutsideEvent,{passive:!0}),e.removeEventListener("click",e.addClickEvent,{passive:!0})}})},1519:function(e,t,i){i(23),i(101);var s=i(180);e.exports=function(){var e,t=navigator.userAgent,i=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(i[1])?{name:"IE ",version:(e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""}:"Chrome"===i[1]&&null!=(e=t.match(/\bOPR\/(\d+)/))?{name:"Opera",version:e[1]}:(i=i[2]?[i[1],i[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&s(i).call(i,1,1,e[1]),{name:i[0],version:i[1]})}},1524:function(e,t,i){var s=i(618);e.exports=function(e){return s({icon:e.icon||"CDB-IconFont-cockroach",title:e.title||"",desc:e.desc})}},1525:function(e,t,i){var s=i(6),n=i(394);e.exports=s.Collection.extend({sync:n,initialize:function initialize(e,t){if(!t.group)throw new Error("group is required");this.group=t.group,this.configModel=t.configModel,this.organization=t.organization},url:function url(e){return this.configModel.get("base_url")+"/api/"+this.configModel.urlVersion("organizationGroups",e)+"/organization/"+this.organization.id+"/groups/"+this.group.id+"/users"},parse:function parse(e){return this.total_entries=e.total_entries,this.total_user_entries=e.total_user_entries,e.users},totalCount:function totalCount(){return this.total_user_entries}})},1526:function(e,t,i){var s=i(28),n=i(6),o=i(1);e.exports=n.Model.extend({url:function url(){return this._configModel.get("base_url")+"/api/v1/org"},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");this._configModel=t.configModel,o.isEmpty(this.get("owner"))||(this._ownerModel=new n.Model(o.omit(this.get("owner"),"organization")))},getOwnerId:function getOwnerId(){return this._ownerModel&&this._ownerModel.get("id")},getOwnerEmail:function getOwnerEmail(){return this._ownerModel&&this._ownerModel.get("email")},isOrgAdmin:function isOrgAdmin(e){return this.getOwnerId()===e.get("id")||!!s(o).call(o,this.get("admins"),function(t){return t.id===e.get("id")})}})},1543:function(e,t,i){var s=i(6),n=i(14),o=["configModel"];e.exports=s.Model.extend({initialize:function initialize(e){n(e,o,this)},isUserAuthentication:function isUserAuthentication(){return!!this._configModel.get("oauth_bigquery")},isServiceAuthentication:function isServiceAuthentication(){return this._configModel.get("bigquery_uses_service_auth")},hasAnyAuthMethod:function hasAnyAuthMethod(){return this.isUserAuthentication()||this.isServiceAuthentication()}})},1547:function(e,t,i){var s=i(3),n=i(6),o=i(1);e.exports=n.Model.extend({_MAX_COUNTER:1014,_CHAR_MAP:{" ":2,"-":2,_:2,".":2},defaults:{terms:[],category:"",counter:1014},initialize:function initialize(){this._initBinds()},_initBinds:function _initBinds(){var e;s(e=this).call(e,"change:terms",this._setCounter,this)},_setCounter:function _setCounter(){var e=this._MAX_COUNTER,t=this;this.get("terms").length>1&&(e-=4*(this.get("terms").length-1)),o.each(this.get("terms"),function(i){o.each(i,function(i){void 0!==t._CHAR_MAP[i]?e-=t._CHAR_MAP[i]:e--})}),this.set("counter",Math.max(0,e))}})},1550:function(e,t,i){(function(e){var t,i,s,n,o,a,r,l,c,h,d,u,p;i={years:"datepickerViewYears",moths:"datepickerViewMonths",days:"datepickerViewDays"},s={wrapper:'<div class="datepicker"><div class="datepickerBorderT" /><div class="datepickerBorderB" /><div class="datepickerBorderL" /><div class="datepickerBorderR" /><div class="datepickerBorderTL" /><div class="datepickerBorderTR" /><div class="datepickerBorderBL" /><div class="datepickerBorderBR" /><div class="datepickerContainer"><table cellspacing="0" cellpadding="0"><tbody><tr></tr></tbody></table></div></div>',head:["<td>",'<table cellspacing="0" cellpadding="0">',"<thead>","<tr>",'<th class="datepickerGoPrev"><a href="#"><span><%=prev%></span></a></th>','<th colspan="5" class="datepickerMonth"><a href="#"><span></span></a></th>','<th class="datepickerGoNext"><a href="#"><span><%=next%></span></a></th>',"</tr>",'<tr class="datepickerDoW">',"<th><span><%=week%></span></th>","<th><span><%=day1%></span></th>","<th><span><%=day2%></span></th>","<th><span><%=day3%></span></th>","<th><span><%=day4%></span></th>","<th><span><%=day5%></span></th>","<th><span><%=day6%></span></th>","<th><span><%=day7%></span></th>","</tr>","</thead>","</table></td>"],space:'<td class="datepickerSpace"><div></div></td>',days:['<tbody class="datepickerDays">',"<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[0].week%></span></a></th>','<td class="<%=weeks[0].days[0].classname%>"><a href="#"><span><%=weeks[0].days[0].text%></span></a></td>','<td class="<%=weeks[0].days[1].classname%>"><a href="#"><span><%=weeks[0].days[1].text%></span></a></td>','<td class="<%=weeks[0].days[2].classname%>"><a href="#"><span><%=weeks[0].days[2].text%></span></a></td>','<td class="<%=weeks[0].days[3].classname%>"><a href="#"><span><%=weeks[0].days[3].text%></span></a></td>','<td class="<%=weeks[0].days[4].classname%>"><a href="#"><span><%=weeks[0].days[4].text%></span></a></td>','<td class="<%=weeks[0].days[5].classname%>"><a href="#"><span><%=weeks[0].days[5].text%></span></a></td>','<td class="<%=weeks[0].days[6].classname%>"><a href="#"><span><%=weeks[0].days[6].text%></span></a></td>',"</tr>","<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[1].week%></span></a></th>','<td class="<%=weeks[1].days[0].classname%>"><a href="#"><span><%=weeks[1].days[0].text%></span></a></td>','<td class="<%=weeks[1].days[1].classname%>"><a href="#"><span><%=weeks[1].days[1].text%></span></a></td>','<td class="<%=weeks[1].days[2].classname%>"><a href="#"><span><%=weeks[1].days[2].text%></span></a></td>','<td class="<%=weeks[1].days[3].classname%>"><a href="#"><span><%=weeks[1].days[3].text%></span></a></td>','<td class="<%=weeks[1].days[4].classname%>"><a href="#"><span><%=weeks[1].days[4].text%></span></a></td>','<td class="<%=weeks[1].days[5].classname%>"><a href="#"><span><%=weeks[1].days[5].text%></span></a></td>','<td class="<%=weeks[1].days[6].classname%>"><a href="#"><span><%=weeks[1].days[6].text%></span></a></td>',"</tr>","<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[2].week%></span></a></th>','<td class="<%=weeks[2].days[0].classname%>"><a href="#"><span><%=weeks[2].days[0].text%></span></a></td>','<td class="<%=weeks[2].days[1].classname%>"><a href="#"><span><%=weeks[2].days[1].text%></span></a></td>','<td class="<%=weeks[2].days[2].classname%>"><a href="#"><span><%=weeks[2].days[2].text%></span></a></td>','<td class="<%=weeks[2].days[3].classname%>"><a href="#"><span><%=weeks[2].days[3].text%></span></a></td>','<td class="<%=weeks[2].days[4].classname%>"><a href="#"><span><%=weeks[2].days[4].text%></span></a></td>','<td class="<%=weeks[2].days[5].classname%>"><a href="#"><span><%=weeks[2].days[5].text%></span></a></td>','<td class="<%=weeks[2].days[6].classname%>"><a href="#"><span><%=weeks[2].days[6].text%></span></a></td>',"</tr>","<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[3].week%></span></a></th>','<td class="<%=weeks[3].days[0].classname%>"><a href="#"><span><%=weeks[3].days[0].text%></span></a></td>','<td class="<%=weeks[3].days[1].classname%>"><a href="#"><span><%=weeks[3].days[1].text%></span></a></td>','<td class="<%=weeks[3].days[2].classname%>"><a href="#"><span><%=weeks[3].days[2].text%></span></a></td>','<td class="<%=weeks[3].days[3].classname%>"><a href="#"><span><%=weeks[3].days[3].text%></span></a></td>','<td class="<%=weeks[3].days[4].classname%>"><a href="#"><span><%=weeks[3].days[4].text%></span></a></td>','<td class="<%=weeks[3].days[5].classname%>"><a href="#"><span><%=weeks[3].days[5].text%></span></a></td>','<td class="<%=weeks[3].days[6].classname%>"><a href="#"><span><%=weeks[3].days[6].text%></span></a></td>',"</tr>","<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[4].week%></span></a></th>','<td class="<%=weeks[4].days[0].classname%>"><a href="#"><span><%=weeks[4].days[0].text%></span></a></td>','<td class="<%=weeks[4].days[1].classname%>"><a href="#"><span><%=weeks[4].days[1].text%></span></a></td>','<td class="<%=weeks[4].days[2].classname%>"><a href="#"><span><%=weeks[4].days[2].text%></span></a></td>','<td class="<%=weeks[4].days[3].classname%>"><a href="#"><span><%=weeks[4].days[3].text%></span></a></td>','<td class="<%=weeks[4].days[4].classname%>"><a href="#"><span><%=weeks[4].days[4].text%></span></a></td>','<td class="<%=weeks[4].days[5].classname%>"><a href="#"><span><%=weeks[4].days[5].text%></span></a></td>','<td class="<%=weeks[4].days[6].classname%>"><a href="#"><span><%=weeks[4].days[6].text%></span></a></td>',"</tr>","<tr>",'<th class="datepickerWeek"><a href="#"><span><%=weeks[5].week%></span></a></th>','<td class="<%=weeks[5].days[0].classname%>"><a href="#"><span><%=weeks[5].days[0].text%></span></a></td>','<td class="<%=weeks[5].days[1].classname%>"><a href="#"><span><%=weeks[5].days[1].text%></span></a></td>','<td class="<%=weeks[5].days[2].classname%>"><a href="#"><span><%=weeks[5].days[2].text%></span></a></td>','<td class="<%=weeks[5].days[3].classname%>"><a href="#"><span><%=weeks[5].days[3].text%></span></a></td>','<td class="<%=weeks[5].days[4].classname%>"><a href="#"><span><%=weeks[5].days[4].text%></span></a></td>','<td class="<%=weeks[5].days[5].classname%>"><a href="#"><span><%=weeks[5].days[5].text%></span></a></td>','<td class="<%=weeks[5].days[6].classname%>"><a href="#"><span><%=weeks[5].days[6].text%></span></a></td>',"</tr>","</tbody>"],months:['<tbody class="<%=className%>">',"<tr>",'<td colspan="2"><a href="#"><span><%=data[0]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[1]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[2]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[3]%></span></a></td>',"</tr>","<tr>",'<td colspan="2"><a href="#"><span><%=data[4]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[5]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[6]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[7]%></span></a></td>',"</tr>","<tr>",'<td colspan="2"><a href="#"><span><%=data[8]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[9]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[10]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[11]%></span></a></td>',"</tr>","</tbody>"]},n={flat:!1,starts:1,prev:"&#9664;",next:"&#9654;",lastSel:!1,mode:"single",view:"days",calendars:1,format:"Y-m-d",position:"bottom",eventName:"click",onRender:function(){return{}},onChange:function(){return!0},onShow:function(){return!0},onBeforeShow:function(){return!0},onHide:function(){return!0},locale:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekMin:"wk"}},o=function(e){var i,n,o,a,l,c,h,d,u=t(e).data("datepicker"),p=t(e),g=Math.floor(u.calendars/2),m=0;p.find("td>table tbody").remove();for(var f=0;f<u.calendars;f++){switch((i=new Date(u.current)).addMonths(-g+f),(d=p.find("table").eq(f+1))[0].className){case"datepickerViewDays":v=r(i,"B, Y");break;case"datepickerViewMonths":v=i.getFullYear();break;case"datepickerViewYears":v=i.getFullYear()-6+" - "+(i.getFullYear()+5)}d.find("thead tr:first th:eq(1) span").text(v),v=i.getFullYear()-6,n={data:[],className:"datepickerYears"};for(var _=0;_<12;_++)n.data.push(v+_);h=tmpl(s.months.join(""),n),i.setDate(1),n={weeks:[],test:10},o=i.getMonth();var v=(i.getDay()-u.starts)%7;for(i.addDays(-(v+(v<0?7:0))),a=-1,m=0;m<42;){l=parseInt(m/7,10),c=m%7,n.weeks[l]||(a=i.getWeekNumber(),n.weeks[l]={week:a,days:[]}),n.weeks[l].days[c]={text:i.getDate(),classname:[]},o!=i.getMonth()&&n.weeks[l].days[c].classname.push("datepickerNotInMonth"),0==i.getDay()&&n.weeks[l].days[c].classname.push("datepickerSunday"),6==i.getDay()&&n.weeks[l].days[c].classname.push("datepickerSaturday");var y=u.onRender(i),w=i.valueOf();w===u.date[0]&&n.weeks[l].days[c].classname.push("datepickerSelectedFirst"),w+86399e3===u.date[1]&&n.weeks[l].days[c].classname.push("datepickerSelectedLast"),(y.selected||u.date==w||t.inArray(w,u.date)>-1||"range"==u.mode&&w>=u.date[0]&&w<=u.date[1])&&n.weeks[l].days[c].classname.push("datepickerSelected"),y.disabled&&n.weeks[l].days[c].classname.push("datepickerDisabled"),y.className&&n.weeks[l].days[c].classname.push(y.className),n.weeks[l].days[c].classname=n.weeks[l].days[c].classname.join(" "),m++,i.addDays(1)}h=tmpl(s.days.join(""),n)+h,n={data:u.locale.monthsShort,className:"datepickerMonths"},h=tmpl(s.months.join(""),n)+h,d.append(h)}},a=function(e,t){if(e.constructor==Date)return new Date(e);for(var i,s,n,o,a,r=e.split(/\W+/),l=t.split(/\W+/),c=new Date,h=0;h<r.length;h++)switch(l[h]){case"d":case"e":i=parseInt(r[h],10);break;case"m":s=parseInt(r[h],10)-1;break;case"Y":case"y":n=parseInt(r[h],10),n+=n>100?0:n<29?2e3:1900;break;case"H":case"I":case"k":case"l":o=parseInt(r[h],10);break;case"P":case"p":/pm/i.test(r[h])&&o<12?o+=12:/am/i.test(r[h])&&o>=12&&(o-=12);break;case"M":a=parseInt(r[h],10)}return new Date(void 0===n?c.getFullYear():n,void 0===s?c.getMonth():s,void 0===i?c.getDate():i,void 0===o?c.getHours():o,void 0===a?c.getMinutes():a,0)},r=function(e,t){var i=e.getMonth(),s=e.getDate(),n=e.getFullYear(),o=(e.getWeekNumber(),e.getDay()),a=e.getHours(),r=a>=12,l=r?a-12:a,c=e.getDayOfYear();0==l&&(l=12);for(var h,d=e.getMinutes(),u=e.getSeconds(),p=t.split(""),g=0;g<p.length;g++){switch(h=p[g],p[g]){case"a":h=e.getDayName();break;case"A":h=e.getDayName(!0);break;case"b":h=e.getMonthName();break;case"B":h=e.getMonthName(!0);break;case"C":h=1+Math.floor(n/100);break;case"d":h=s<10?"0"+s:s;break;case"e":h=s;break;case"H":h=a<10?"0"+a:a;break;case"I":h=l<10?"0"+l:l;break;case"j":h=c<100?c<10?"00"+c:"0"+c:c;break;case"k":h=a;break;case"l":h=l;break;case"m":h=i<9?"0"+(1+i):1+i;break;case"M":h=d<10?"0"+d:d;break;case"p":case"P":h=r?"PM":"AM";break;case"s":h=Math.floor(e.getTime()/1e3);break;case"S":h=u<10?"0"+u:u;break;case"u":h=o+1;break;case"w":h=o;break;case"y":h=(""+n).substr(2,2);break;case"Y":h=n}p[g]=h}return p.join("")},l=function(e){var i=t(e).data("datepicker"),s=t("#"+i.id);if(!i.extraHeight){var n=t(e).find("div");i.extraHeight=n.get(0).offsetHeight+n.get(1).offsetHeight,i.extraWidth=n.get(2).offsetWidth+n.get(3).offsetWidth}var o=s.find("table:first").get(0),a=o.offsetWidth,r=o.offsetHeight;s.css({width:a+i.extraWidth+"px",height:r+i.extraHeight+"px"}).find("div.datepickerContainer").css({width:a+"px",height:r+"px"})},c=function(e){t(e.target).is("span")&&(e.target=e.target.parentNode);var i=t(e.target);if(i.is("a")){if(e.target.blur(),i.hasClass("datepickerDisabled"))return!1;var s=t(this).data("datepicker"),n=i.parent(),a=n.parent().parent().parent(),r=t("table",this).index(a.get(0))-1,l=new Date(s.current),c=!1,d=!1;if(n.is("th"))if(n.hasClass("datepickerWeek")&&"range"==s.mode&&!n.next().hasClass("datepickerDisabled")){var u=parseInt(n.next().text(),10);l.addMonths(r-Math.floor(s.calendars/2)),n.next().hasClass("datepickerNotInMonth")&&l.addMonths(u>15?-1:1),l.setDate(u),s.date[0]=l.setHours(0,0,0,0).valueOf(),l.setHours(23,59,59,0),l.addDays(6),s.date[1]=l.valueOf(),d=!0,c=!0,s.lastSel=!1}else{if(n.hasClass("datepickerMonth"))return!1;if(n.parent().parent().is("thead")){switch(a.get(0).className){case"datepickerViewDays":s.current.addMonths(n.hasClass("datepickerGoPrev")?-1:1);break;case"datepickerViewMonths":s.current.addYears(n.hasClass("datepickerGoPrev")?-1:1);break;case"datepickerViewYears":s.current.addYears(n.hasClass("datepickerGoPrev")?-12:12)}d=!0}}else if(n.is("td")&&!n.hasClass("datepickerDisabled")){switch(a.get(0).className){case"datepickerViewMonths":s.current.setMonth(a.find("tbody.datepickerMonths td").index(n)),s.current.setFullYear(parseInt(a.find("thead th.datepickerMonth span").text(),10)),s.current.addMonths(Math.floor(s.calendars/2)-r),a.get(0).className="datepickerViewDays";break;case"datepickerViewYears":s.current.setFullYear(parseInt(i.text(),10)),a.get(0).className="datepickerViewMonths";break;default:u=parseInt(i.text(),10);switch(l.addMonths(r-Math.floor(s.calendars/2)),n.hasClass("datepickerNotInMonth")&&l.addMonths(u>15?-1:1),l.setDate(u),s.mode){case"multiple":u=l.setHours(0,0,0,0).valueOf(),t.inArray(u,s.date)>-1?t.each(s.date,function(e,t){if(t==u)return s.date.splice(e,1),!1}):s.date.push(u);break;case"range":s.lastSel||(s.date[0]=l.setHours(0,0,0,0).valueOf()),(u=l.setHours(23,59,59,0).valueOf())<s.date[0]?(s.date[1]=s.date[0]+86399e3,s.date[0]=u-86399e3):s.date[1]=u,s.lastSel=!s.lastSel;break;default:s.date=l.valueOf()}}d=!0,c=!0}d&&o(this),c&&s.onChange.apply(this,h(s))}return!1},h=function(e){var i;return"single"==e.mode?(i=new Date(e.date),[r(i,e.format),i,e.el]):(i=[[],[],e.el],t.each(e.date,function(t,s){var n=new Date(s);i[0].push(r(n,e.format)),i[1].push(n)}),i)},d=function(e){var i,s=t("#"+t(this).data("datepickerId"));if(!s.is(":visible")){var n=s.get(0);o(n);var a=s.data("datepicker");a.onBeforeShow.apply(this,[s.get(0)]);var r=t(this).offset(),c=(i="CSS1Compat"==document.compatMode,{l:window.pageXOffset||(i?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(i?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(i?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(i?document.documentElement.clientHeight:document.body.clientHeight)}),h=r.top,d=r.left;t.curCSS(n,"display");switch(s.css({visibility:"hidden",display:"block"}),l(n),a.position){case"top":h-=n.offsetHeight;break;case"left":d-=n.offsetWidth;break;case"right":d+=this.offsetWidth;break;case"bottom":h+=this.offsetHeight}h+n.offsetHeight>c.t+c.h&&(h=r.top-n.offsetHeight),h<c.t&&(h=r.top+this.offsetHeight+n.offsetHeight),d+n.offsetWidth>c.l+c.w&&(d=r.left-n.offsetWidth),d<c.l&&(d=r.left+this.offsetWidth),s.css({visibility:"visible",display:"block",top:h+"px",left:d+"px"}),0!=a.onShow.apply(this,[s.get(0)])&&s.show(),t(document).bind("mousedown",{cal:s,trigger:this},u)}return!1},u=function(e){e.target==e.data.trigger||function(e,t,i){if(e==t)return!0;if(e.contains)return e.contains(t);if(e.compareDocumentPosition)return!!(16&e.compareDocumentPosition(t));for(var s=t.parentNode;s&&s!=i;){if(s==e)return!0;s=s.parentNode}return!1}(e.data.cal.get(0),e.target,e.data.cal.get(0))||(0!=e.data.cal.data("datepicker").onHide.apply(this,[e.data.cal.get(0)])&&e.data.cal.hide(),t(document).unbind("mousedown",u))},p={init:function(e){return function(e){Date.prototype.tempDate||(Date.prototype.tempDate=null,Date.prototype.months=e.months,Date.prototype.monthsShort=e.monthsShort,Date.prototype.days=e.days,Date.prototype.daysShort=e.daysShort,Date.prototype.getMonthName=function(e){return this[e?"months":"monthsShort"][this.getMonth()]},Date.prototype.getDayName=function(e){return this[e?"days":"daysShort"][this.getDay()]},Date.prototype.addDays=function(e){this.setDate(this.getDate()+e),this.tempDate=this.getDate()},Date.prototype.addMonths=function(e){null==this.tempDate&&(this.tempDate=this.getDate()),this.setDate(1),this.setMonth(this.getMonth()+e),this.setDate(Math.min(this.tempDate,this.getMaxDays()))},Date.prototype.addYears=function(e){null==this.tempDate&&(this.tempDate=this.getDate()),this.setDate(1),this.setFullYear(this.getFullYear()+e),this.setDate(Math.min(this.tempDate,this.getMaxDays()))},Date.prototype.getMaxDays=function(){var e,t=new Date(Date.parse(this)),i=28;for(e=t.getMonth(),i=28;t.getMonth()==e;)i++,t.setDate(i);return i-1},Date.prototype.getFirstDay=function(){var e=new Date(Date.parse(this));return e.setDate(1),e.getDay()},Date.prototype.getWeekNumber=function(){var e=new Date(this);e.setDate(e.getDate()-(e.getDay()+6)%7+3);var t=e.valueOf();return e.setMonth(0),e.setDate(4),Math.round((t-e.valueOf())/6048e5)+1},Date.prototype.getDayOfYear=function(){var e=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0)-new Date(this.getFullYear(),0,0,0,0,0);return Math.floor(e/24*60*60*1e3)})}((e=t.extend({},n,e||{})).locale),e.calendars=Math.max(1,parseInt(e.calendars,10)||1),e.mode=/single|multiple|range/.test(e.mode)?e.mode:"single",this.each(function(){if(!t(this).data("datepicker")){if(e.el=this,e.date.constructor==String&&(e.date=a(e.date,e.format),e.date.setHours(0,0,0,0)),"single"!=e.mode)if(e.date.constructor!=Array)e.date=[e.date.valueOf()],"range"==e.mode&&e.date.push(new Date(e.date[0]).setHours(23,59,59,0).valueOf());else{for(var n=0;n<e.date.length;n++)e.date[n]=a(e.date[n],e.format).setHours(0,0,0,0).valueOf();"range"==e.mode&&(e.date[1]=new Date(e.date[1]).setHours(23,59,59,0).valueOf())}else e.date=e.date.valueOf();e.current?e.current=a(e.current,e.format):e.current=new Date,e.current.setDate(1),e.current.setHours(0,0,0,0);var r,h="datepicker_"+parseInt(1e3*Math.random());e.id=h,t(this).data("datepickerId",e.id);var u=t(s.wrapper).attr("id",h).bind("click",c).data("datepicker",e);e.className&&u.addClass(e.className);var p="";for(n=0;n<e.calendars;n++)r=e.starts,n>0&&(p+=s.space),p+=tmpl(s.head.join(""),{week:e.locale.weekMin,prev:e.prev,next:e.next,day1:e.locale.daysMin[r++%7],day2:e.locale.daysMin[r++%7],day3:e.locale.daysMin[r++%7],day4:e.locale.daysMin[r++%7],day5:e.locale.daysMin[r++%7],day6:e.locale.daysMin[r++%7],day7:e.locale.daysMin[r++%7]});u.find("tr:first").append(p).find("table").addClass(i[e.view]),o(u.get(0)),e.flat?(u.appendTo(this).show().css("position","relative"),l(u.get(0))):(u.appendTo(document.body),t(this).bind(e.eventName,d))}})},showPicker:function(){return this.each(function(){t(this).data("datepickerId")&&d.apply(this)})},hidePicker:function(){return this.each(function(){t(this).data("datepickerId")&&t("#"+t(this).data("datepickerId")).hide()})},setDate:function(e,i){return this.each(function(){if(t(this).data("datepickerId")){var s=t("#"+t(this).data("datepickerId")),n=s.data("datepicker");if(n.date=e,n.date.constructor==String&&(n.date=a(n.date,n.format),n.date.setHours(0,0,0,0)),"single"!=n.mode)if(n.date.constructor!=Array)n.date=[n.date.valueOf()],"range"==n.mode&&n.date.push(new Date(n.date[0]).setHours(23,59,59,0).valueOf());else{for(var r=0;r<n.date.length;r++)n.date[r]=a(n.date[r],n.format).setHours(0,0,0,0).valueOf();"range"==n.mode&&(n.date[1]=new Date(n.date[1]).setHours(23,59,59,0).valueOf())}else n.date=n.date.valueOf();i&&(n.current=new Date("single"!=n.mode?n.date[0]:n.date)),o(s.get(0))}})},getDate:function(e){if(this.size()>0)return h(t("#"+t(this).data("datepickerId")).data("datepicker"))[e?0:1]},clear:function(){return this.each(function(){if(t(this).data("datepickerId")){var e=t("#"+t(this).data("datepickerId")),i=e.data("datepicker");"single"!=i.mode&&(i.date=[],o(e.get(0)))}})},fixLayout:function(){return this.each(function(){if(t(this).data("datepickerId")){var e=t("#"+t(this).data("datepickerId"));e.data("datepicker").flat&&l(e.get(0))}})}},(t=e).fn.extend({DatePicker:p.init,DatePickerHide:p.hidePicker,DatePickerShow:p.showPicker,DatePickerSetDate:p.setDate,DatePickerGetDate:p.getDate,DatePickerClear:p.clear,DatePickerLayout:p.fixLayout}),function(){var e={};this.tmpl=function tmpl(t,i){var s=/\W/.test(t)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+t.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):e[t]=e[t]||tmpl(document.getElementById(t).innerHTML);return i?s(i):s}}()}).call(this,i(18))},1551:function(e,t){e.exports=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","grey","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"]},1552:function(e,t,i){i(35);var s=i(56),n=i(13),o=i(1),a=i(4),r=i(259),l=i(241),c=i(2968);e.exports=function(e,t){var i=(t=t||{}).tabPaneItemLabelOptions,h=n(e).call(e,function(e){var t;return s(t=["label","createContentView"]).call(t,function(t){if(!e[t])throw new Error(t+" should be provided")}),{name:e.name,selected:e.selected,disabled:e.disabled,tooltip:e.tooltip,tooltipGravity:e.tooltipGravity,label:e.label,selectedChild:e.selectedChild,createButtonView:function createButtonView(){return new c(o.extend({model:this},i))},createContentView:function createContentView(){return e.createContentView&&e.createContentView()||new a}}}),d=new l(h),u=t.tabPaneOptions;return new r(o.extend({collection:d},u))}},1553:function(e,t,i){var s=i(3),n=i(4),o=i(451),a=i(620),r=i(1057),l=i(1056),c=i(2973),h=i(14),d=["columns","query","configModel","userModel","editorAttrs","modals","dialogMode","popupConfig"];e.exports=n.extend({className:"Form-InputFill CDB-OptionInput CDB-Text js-input",events:{focus:function focus(){this.trigger("focus",this)},blur:function blur(){this.trigger("blur",this)}},focus:function focus(){this.hasFocus||this.$(".js-fillInput").focus()},blur:function blur(){this.hasFocus&&this.$(".js-fillInput").blur()},initialize:function initialize(e){h(e,d,this),this._initViews()},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},clean:function clean(){this.removeDialog(),this._popupManager&&this._popupManager.destroy(),n.prototype.clean.call(this)},removeDialog:function removeDialog(){this._dialogView&&(this._popupManager.untrack(),this._inputCollection.unselect(),this._dialogView.clean())},_initViews:function _initViews(){this.$el.append(a()),this.options.editorAttrs&&this.options.editorAttrs.disabled&&this.$el.addClass("is-disabled"),this._initFillDialog(),this._initInputFields(),this._popupManager=new o(this._popupConfig.cid,this._popupConfig.$el,this._dialogView.$el)},_initInputFields:function _initInputFields(){var e;this._inputCollection=new c,s(e=this._inputCollection).call(e,"onInputChanged",this._onInputChanged,this)},_onInputChanged:function _onInputChanged(){this.trigger("onInputChanged",this)},_initFillDialog:function _initFillDialog(){var e=new r;this.listenToOnce(e,"destroy",function(){this._dialogView=null,this.stopListening(e)}),this._dialogView=new l({model:e})},_onInputClick:function _onInputClick(e){e.get("selected")?this.removeDialog():(e.set("selected",!0),this._dialogView.model.set("createContentView",e.get("createContentView")),this._dialogView.render(),this._dialogView.show(),this._popupManager.append(this._dialogMode),this._popupManager.track())}})},1554:function(e,t,i){i(37),i(34),i(23),i(88),i(40);var s=i(32),n=i(25),o=i(13),a=i(38),r=i(28),l=i(3),c=i(1),h=i(84),d=i(6),u=i(4),p=i(769),g=i(368),m=i(2986),f=i(2984),_=i(2981),v=i(1555),y=i(174),w=i(344),b=c.clone(w.Prism[11]),C=c.template("SELECT <%= column %>, count(<%= column %>) FROM (<%= sql %>) _table_sql GROUP BY <%= column %> ORDER BY count DESC, <%= column %> ASC LIMIT <%= max_values %>"),M=i(14),k=["columns","configModel","modals","query","userModel"],S=0,x=1,T=2,D=3;function _quote(e){return e&&!0!==e?'"'+e.toString().replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"':e}e.exports=u.extend({module:"components:form-components:editors:fill:input-color:input-qualitative-ramps:main-view",events:{"click .js-back":"_onClickBack","click .js-quantification":"_onClickQuantification"},initialize:function initialize(e){M(e,k,this),this._imageEnabled=e.imageEnabled,this._hideTabs=e.hideTabs,this._query=e.query,this._viewModel=new d.Model({step:0,status:"idle"}),this.listenTo(this.model,"change:attribute",this._fetchColumns),this.listenTo(this._viewModel,"change:status",this.render),this.model.hasChanged("quantification")&&this._fetchColumns()},render:function render(){this.clearSubViews(),this.$el.empty();var e=this._getColumn(),t=e&&e.type,i=!(!this._hideTabs||!c.contains(this._hideTabs,y.Tabs.QUANTIFICATION));return this.$el.append(p({status:this._viewModel.get("status"),columnType:t,attribute:this.model.get("attribute"),quantification:this.model.get("quantification")||"category",hideQuantification:i})),this._generateStackLayoutView(),this},_generateStackLayoutView:function _generateStackLayoutView(){var e,t,i,s,n,o=this._viewModel.get("step"),a=new d.Collection([{selected:o===S,createStackView:l(e=this._createCategoriesRampsListView).call(e,this)},{selected:o===x,createStackView:l(t=this._createRangeListView).call(t,this)},{selected:o===T,createStackView:l(i=this._createColorPickerView).call(i,this)}]);this._iconStylingEnabled()&&a.add({selected:o===D,createStackView:l(n=this._createImagePickerView).call(n,this)});this._stackLayoutView=new g({collection:a}),l(s=this._stackLayoutView).call(s,"positionChanged",this._onStackLayoutPositionChange,this),this.$(".js-content").append(this._stackLayoutView.render().$el),this.addView(this._stackLayoutView)},_computeRequiredNumberOfColors:function _computeRequiredNumberOfColors(){return this.model.get("domain")?Math.min(this.model.get("domain").length,11):11},_onStackLayoutPositionChange:function _onStackLayoutPositionChange(){this.$(".js-prevStep").toggle(0===this._stackLayoutView.getCurrentPosition())},_iconStylingEnabled:function _iconStylingEnabled(){return this._imageEnabled},_getColumn:function _getColumn(){return r(c).call(c,this._columns,function(e){return e.label===this.model.get("attribute")},this)},_fetchColumns:function _fetchColumns(){var e,t;this.model.get("attribute")&&(this._query?(this._setViewStatus("loading"),new h.SQL({user:this._configModel.get("user_name"),sql_api_template:this._configModel.get("sql_api_template"),api_key:this._configModel.get("api_key")}).execute(C({sql:this._query,column:this.model.get("attribute"),max_values:11}),null,{success:l(e=this._onQueryDone).call(e,this),error:l(t=function _context7(){this._setViewStatus("error")}).call(t,this)})):this._onQueryDone())},_onQueryDone:function _onQueryDone(e){e=e||{},this._updateRangeAndDomain(e.rows),this._setViewStatus("idle")},_updateRangeAndDomain:function _updateRangeAndDomain(e){var t;e=e||[];var i,r=c.pluck(e,this.model.get("attribute")),l=a(t=o(c).call(c,r,function(e,t){return e})).call(t,0,10);"number"!==this.model.get("attribute_type")&&(l=o(i=n(l).call(l,function(e,t,i){return s(i).call(i,e)===t})).call(i,_quote));var h=o(c).call(c,r,function(e,t){return t<10?b[t]:b[11]});if(this._iconStylingEnabled()){var d=o(c).call(c,r,function(){return""});this.model.attributes.images=d}this.model.set({range:h,domain:l})},_setViewStatus:function _setViewStatus(e){var t={status:e};"loading"===e&&(t.step=0),this._viewModel.set(t)},_getRange:function _getRange(){return o(c).call(c,this.model.get("range"),function(e,t){var i={val:e,color:e,title:this.model.get("domain")[t]};return this._iconStylingEnabled()&&(i.image=this.model.get("images")[t]),i},this)},_updateRange:function _updateRange(e){var t=c.clone(this.model.get("range"));t[this._index]=e[this._index].color,this.model.set("range",t)},_createColorPickerView:function _createColorPickerView(e,t){var i=this._getRange(),s=void 0!==this.model.get("opacity")?this.model.get("opacity"):1,n=this.options.imageEnabled&&this._index<10,o=new v({index:this._index,ramp:i,opacity:s,imageEnabled:n});return l(o).call(o,"back",function(t){e.prevStep()},this),l(o).call(o,"goToAssetPicker",function(){e.nextStep()},this),l(o).call(o,"change",this._updateRange,this),l(o).call(o,"changeIndex",function(e){this._index=e,this.model.set("index",e)},this),l(o).call(o,"change:opacity",function(e){this.model.set("opacity",e)},this),o},_createRangeListView:function _createRangeListView(e,t){var i=new _({model:this.model,maxValues:10,imageEnabled:this._iconStylingEnabled(),requiredNumberOfColors:this._computeRequiredNumberOfColors()});return l(i).call(i,"back",function(t){e.prevStep()},this),l(i).call(i,"selectItem",function(t){this._index=t.index,"asset"===t.target?e.goToStep(D):e.goToStep(T)},this),i},_createCategoriesRampsListView:function _createCategoriesRampsListView(e,t){var i=new f({model:this.model,maxValues:10,requiredNumberOfColors:this._computeRequiredNumberOfColors()}),s=[f.EVENTS.RAMP_SELECTED,f.EVENTS.CUSTOMIZE,f.EVENTS.CUSTOM_COLOR].join(" ");return i.on(s,function(){e.goToStep(x)},this),i},_createImagePickerView:function _createImagePickerView(e,t){var i=this._getRange(),s=new m({userModel:this._userModel,configModel:this._configModel,index:this._index,ramp:i,modals:this._modals,imageEnabled:this._iconStylingEnabled()});return l(s).call(s,"back",function(t){e.goToStep(x)},this),l(s).call(s,"goToColorPicker",function(){e.prevStep()},this),l(s).call(s,"changeIndex",function(e){this._index=e},this),this._iconStylingEnabled()&&l(s).call(s,"change:image",this._onImageChanged,this),s},_onImageChanged:function _onImageChanged(e){var t=c.clone(this.model.get("images"));t[this._index]=e.url,this.model.set("images",t)},_onClickQuantification:function _onClickQuantification(e){this.killEvent(e),this.trigger("selectQuantification",this)},_onClickBack:function _onClickBack(e){this.killEvent(e),this.trigger("back",this)}},{MAX_VALUES:10})},1555:function(e,t,i){var s=i(3),n=i(1),o=i(6),a=i(4),r=i(789),l=i(771),c=i(2987),h=i(14),d=["ramp","opacity"];e.exports=a.extend({events:{"click .js-back":"_onClickBack"},initialize:function initialize(e){h(e,d,this),this.model=new o.Model({index:this.options.index,ramp:e.ramp,opacity:e.opacity}),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.html(l()),this._initViews(),this},_initBinds:function _initBinds(){this.listenTo(this.model,"change:index",this._onChangeIndex),this.listenTo(this.model,"change:opacity",this._onOpacityChanged)},_initViews:function _initViews(){var e,t;this._headerView=new c({model:this.model,imageEnabled:this.options.imageEnabled}),this.addView(this._headerView),s(e=this._headerView).call(e,"goToAssetPicker",this._onGoToAssetPicker,this),this.$(".js-header").append(this._headerView.render().$el),this._colorPicker=new r({value:this._getColor(),opacity:1,disableOpacity:!0}),this.addView(this._colorPicker),s(t=this._colorPicker).call(t,"change",this._onChangeValue,this),this.$(".js-content").append(this._colorPicker.render().$el)},_setColor:function _setColor(e){var t=n.clone(this.model.get("ramp"));t[this.model.get("index")].color=e,this.model.set("ramp",t),this.model.trigger("change",t),this.trigger("change",t)},_getColor:function _getColor(){return this.model.get("ramp")[this.model.get("index")||0].color},_onChangeIndex:function _onChangeIndex(){this._colorPicker.setColor(this._getColor()),this.trigger("changeIndex",this.model.get("index"),this)},_onChangeValue:function _onChangeValue(e){this._setColor(e.hex)},_onClickBack:function _onClickBack(e){this.killEvent(e),this.trigger("back",this)},_onOpacityChanged:function _onOpacityChanged(){var e=this.model.get("opacity");this.trigger("change:opacity",e)},_onGoToAssetPicker:function _onGoToAssetPicker(){this.trigger("goToAssetPicker")}})},1556:function(e,t,i){var s=i(28),n=i(180),o=i(32),a=i(3),r=i(1),l=i(6),c=i(4),h=i(368),d=i(795),u=i(505),p=i(2992),g=i(1554),m=i(174),f=i(14),_=i(263),v=i(262),y=0,w=1,b=2,C=["the_geom","the_geom_webmercator"],M=["columns","configModel","modals","query","userModel"];e.exports=c.extend({module:"components:form-components:editors:fill:input-color:input-color-value-content-view",initialize:function initialize(e){f(e,M,this),this._settings=r.clone(m.Settings.COLOR),this.options.removeByValueCategory&&this._removeCategoryFrom(this._settings.quantifications.items),this._categorizeColumns=e.categorizeColumns,this._imageEnabled=e.imageEnabled,this._hideTabs=e.hideTabs,this._column=this._getColumn(),this._columnType=this._column&&this._column.type,this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initBinds:function _initBinds(){this.listenTo(this.model,"change:quantification",function(){"category"===this.model.previous("quantification")&&delete this.model.attributes.range,"category"!==this.model.get("quantification")&&this.model.unset("domain")})},_initViews:function _initViews(){var e,t,i,s,n=new l.Collection([{createStackView:a(e=this._createColumnListView).call(e,this)},{createStackView:a(t=this._createInputQuantitativeRamps).call(t,this)},{createStackView:a(i=this._createInputQualitativeRamps).call(i,this)}]);this._hideTabs&&r.contains(this._hideTabs,m.Tabs.QUANTIFICATION)||n.push({createStackView:a(s=this._createQuantificationListView).call(s,this)});if(this._stackLayoutView=new h({collection:n}),this.model.get("attribute")){var o=this.model.get("domain")&&this.model.get("domain").length,c=this.model.get("range")&&this.model.get("range").length;"string"===this._columnType||o&&c?this._stackLayoutView.model.set("position",b):this._stackLayoutView.model.set("position",w)}this.$el.append(this._stackLayoutView.render().$el),this.addView(this._stackLayoutView)},_createInputQualitativeRamps:function _createInputQualitativeRamps(e,t){var i=new g({model:this.model,query:this._query,columns:this._columns,configModel:this._configModel,userModel:this._userModel,modals:this._modals,hideTabs:this._hideTabs,imageEnabled:this._imageEnabled});return a(i).call(i,"back",function(t){e.goToStep(y)},this),i},_createQuantificationListView:function _createQuantificationListView(e,t){var i=new d({headerTitle:_t("form-components.editors.fill.quantification.title"),stackLayoutModel:e,itemTemplate:u,columns:this._settings.quantifications.items,showSearch:!1});return a(i).call(i,"selectItem",function(t){this.model.set("quantification",t.get("val")),e.goToStep(w)},this),a(i).call(i,"back",function(t){e.goToStep(y)},this),i},_removeCategoryFrom:function _removeCategoryFrom(e){var t=o(e).call(e,"category");-1!==t&&n(e).call(e,t,1)},_createInputQuantitativeRamps:function _createInputQuantitativeRamps(e,t){var i=r.clone(m.Settings.COLOR_RAMPS);this.options.removeByValueCategory&&this._removeCategoryFrom(i.quantifications.items);var s=new p({hideTabs:this.options.hideTabs,model:this.model,settings:i});return a(s).call(s,"switch",function(){e.goToStep(b)},this),a(s).call(s,"back",function(t){e.prevStep()},this),s},_getColumn:function _getColumn(e){return s(r).call(r,this._columns,function(t){return t.label===(e||this.model.get("attribute"))},this)},_createColumnListView:function _createColumnListView(e,t){var i=new d({stackLayoutModel:e,columns:this._filteredColumns(),showSearch:!0,typeLabel:"column"});return a(i).call(i,"selectItem",function(t){this._onChangeAttribute(t.get("val"),e)},this),i},_filteredColumns:function _filteredColumns(){var e=r.reject(this._columns,function(e){return"geometry"===e.type||"date"===e.type||r.contains(C,e.label)},this);return this.options.hideNumericColumns&&(e=r.reject(e,function(e){return"number"===e.type})),e},_onChangeAttribute:function _onChangeAttribute(e,t){var i="category"===this.model.get("quantification");this._column=this._getColumn(e),this._columnType=this._column&&this._column.type,r.each(["image","fixed","quantification","opacity"],function(e){this.model.unset(e,{silent:!0})},this),r.contains(["string","boolean"],this._columnType)||this._categorizeColumns?(this.model.unset("bins",{silent:!0}),t.goToStep(b)):"number"===this._columnType&&(this.model.unset("images",{silent:!0}),this.model.unset("domain",{silent:!0}),i&&this.model.unset("range",{silent:!0}),t.goToStep(w));var s={attribute:e,attribute_type:this._columnType};this.model.set(s),_.track(v.STYLED_BY_VALUE,s)}})},1557:function(e,t,i){var s=i(1),n=i(1054);e.exports=n.extend({defaults:{ext:"svg",folder:"maki-icons",host:"https://s3.amazonaws.com",bucket:"com.cartodb.users-assets.production",kind:"marker",name:"",public_url:"",size:"18",state:"idle"},getURLFor:function getURLFor(e){return this.get("host")+"/"+this.get("bucket")+"/"+this.get("folder")+"/"+e+(this.get("size")?"-"+this.get("size"):"")+"."+this.get("ext")},toJSON:function toJSON(){var e=s.clone(this.attributes);return e.public_url=this.getURLFor(e.icon),e},get:function get(e){var t=this.attributes[e];return"public_url"===e&&(t=this.getURLFor(this.attributes.icon)),t}})},1558:function(e,t,i){var s=i(1557),n=i(1053);e.exports=n.extend({model:s,url:function url(){return""},initialize:function initialize(e,t){},parse:function parse(e,t){return[]}})},1559:function(e,t,i){var s=i(4),n=i(785);e.exports=s.extend({tagName:"li",className:"AssetsList-item AssetsList-item--medium",events:{"click .js-asset":"_onClick"},initialize:function initialize(e){this.listenTo(this.model,"change:state",this._changeState)},render:function render(){this.clearSubViews(),this.$el.attr("id",this.model.get("id"));var e=this.model.get("type")||"icon";return this.$el.append(n({type:e,height:this.options.assetHeight||24,name:this.model.get("name"),public_url:this.model.get("public_url")})),this.$el.addClass("AssetsList-item--"+e),this},_onClick:function _onClick(e){this.killEvent(e),this.trigger("selected",this.model)},_changeState:function _changeState(){this.$el.toggleClass("is-selected","selected"===this.model.get("state"))}})},1560:function(e,t){e.exports={disclaimer:_t("assets.maki-icons.disclaimer"),icons:[{name:"Square stroked",icon:"square-stroked"},{name:"Square solid",icon:"square"},{name:"Triangle stroked",icon:"triangle-stroked"},{name:"Triangle solid",icon:"triangle"},{name:"Star stroked",icon:"star-stroked"},{name:"Star solid",icon:"star"},{name:"Cross",icon:"cross"},{name:"Marker Stroke",icon:"marker-stroked"},{name:"Marker Solid",icon:"marker"},{name:"Religious Jewish",icon:"religious-jewish"},{name:"Religious Christian",icon:"religious-christian"},{name:"Religious Muslim",icon:"religious-muslim"},{name:"Cemetery",icon:"cemetery"},{name:"Rocket",icon:"rocket"},{name:"Airport",icon:"airport"},{name:"Heliport",icon:"heliport"},{name:"Rail",icon:"rail"},{name:"Rail Metro",icon:"rail-metro"},{name:"Rail Light",icon:"rail-light"},{name:"Bus",icon:"bus"},{name:"Fuel",icon:"fuel"},{name:"Parking",tags:["parking","transportation"],icon:"parking"},{name:"Parking Garage",tags:["parking","transportation","garage"],icon:"parking-garage"},{name:"Airfield",tags:["airfield","airport","plane","landing strip"],icon:"airfield"},{name:"Roadblock",tags:["roadblock","stop","warning","dead end"],icon:"roadblock"},{name:"Ferry",tags:["ship","boat","water","ferry","transportation"],icon:"ferry"},{name:"Harbor",tags:["marine","dock","water","wharf"],icon:"harbor"},{name:"Bicycle",tags:["cycling","cycle","transportation"],icon:"bicycle"},{name:"Park",tags:["recreation","park","forest","tree","green","woods","nature"],icon:"park"},{name:"Park 2",tags:["recreation","park","forest","tree","green","woods","nature"],icon:"park2"},{name:"Museum",tags:["recreation","museum","tourism"],icon:"museum"},{name:"Lodging",tags:["lodging","hotel","recreation","motel","tourism"],icon:"lodging"},{name:"Monument",tags:["recreation","statue","monument","tourism"],icon:"monument"},{name:"Zoo",tags:["recreation","zoo","animal","giraffe"],icon:"zoo"},{name:"Garden",tags:["recreation","garden","park","flower","nature"],icon:"garden"},{name:"Campsite",tags:["recreation","campsite","camp","camping","tent","nature"],icon:"campsite"},{name:"Theatre",tags:["recreation","theatre","theater","entertainment","play","performance"],icon:"theatre"},{name:"Art gallery",tags:["art","center","museum","gallery","creative","recreation","entertainment","studio"],icon:"art-gallery"},{name:"Pitch",tags:["pitch","track","athletic","sports","field"],icon:"pitch"},{name:"Soccer",tags:["soccer","sports"],icon:"soccer"},{name:"American Football",tags:["football","sports"],icon:"america-football"},{name:"Tennis",tags:["tennis","court","ball","sports"],icon:"tennis"},{name:"Basketball",tags:["basketball","ball","sports"],icon:"basketball"},{name:"Baseball",tags:["baseball","softball","ball","sports"],icon:"baseball"},{name:"Golf",tags:["golf","sports","course"],icon:"golf"},{name:"Swimming",tags:["swimming","water","swim","sports"],icon:"swimming"},{name:"Cricket",tags:["cricket","sports"],icon:"cricket"},{name:"Skiing",tags:["winter","skiing","ski","sports"],icon:"skiing"},{name:"School",tags:["school","highschool","elementary","children","amenity","middle"],icon:"school"},{name:"College",tags:["college","school","amenity","university"],icon:"college"},{name:"Library",tags:["library","books","amenity"],icon:"library"},{name:"Post",tags:["post","office","amenity","mail","letter"],icon:"post"},{name:"Fire station",tags:["fire","station","amenity"],icon:"fire-station"},{name:"Town hall",tags:["townhall","mayor","building","amenity","government"],icon:"town-hall"},{name:"Police",tags:["police","jail","arrest","amenity","station"],icon:"police"},{name:"Prison",tags:["prison","jail","amenity"],icon:"prison"},{name:"Embassy",tags:["embassy","diplomacy","consulate","amenity","flag"],icon:"embassy"},{name:"Beer",tags:["bar","beer","drink","commercial","biergarten","pub"],icon:"beer"},{name:"Restaurant",tags:["restaurant","commercial"],icon:"restaurant"},{name:"Cafe",tags:["cafe","coffee","commercial","tea"],icon:"cafe"},{name:"Shop",tags:["shop","mall","commercial","store"],icon:"shop"},{name:"Fast Food",tags:["food","fast","commercial","burger","drive-through"],icon:"fast-food"},{name:"Bar",tags:["bar","drink","commercial","club","martini","lounge"],icon:"bar"},{name:"Bank",tags:["bank","atm","commercial","money"],icon:"bank"},{name:"Grocery",tags:["food","grocery","commercial","store","market"],icon:"grocery"},{name:"Cinema",tags:["cinema","theatre","film","movie","commercial","theater","entertainment"],icon:"cinema"},{name:"Pharmacy",tags:["pharmacy","drugs","medication","social","medicine","prescription"],icon:"pharmacy"},{name:"Hospital",tags:["hospital","health","medication","social","medicine","medical","clinic"],icon:"hospital"},{name:"Danger",tags:["minefield","landmine","disaster","dangerous","hazard"],icon:"danger"},{name:"Industrial",tags:["industrial","factory","property","building"],icon:"industrial"},{name:"Warehouse",tags:["warehouse","property","storage","building"],icon:"warehouse"},{name:"Commercial",tags:["commercial","property","business","building"],icon:"commercial"},{name:"Building",tags:["building","property","structure","business","building"],icon:"building"},{name:"Place of worship",tags:["religion","ceremony","religious","nondenominational","church","temple"],icon:"place-of-worship"},{name:"Alcohol shop",tags:["alcohol","liquor","store","shop","beer","wine","vodka"],icon:"alcohol-shop"},{name:"Logging",tags:["logger","chainsaw","woods","industry"],icon:"logging"},{name:"Oil well",tags:["oil","natural","environment","industry","resources"],icon:"oil-well"},{name:"Slaughterhouse",tags:["cows","cattle","food","meat","industry","resources"],icon:"slaughterhouse"},{name:"Dam",tags:["water","natural","hydro","hydroelectric","energy","environment","industry","resources"],icon:"dam"},{name:"Water",tags:["water","natural","hydro","lake","river","ocean","resources"],icon:"water"},{name:"Wetland",tags:["water","swamp","natural"],icon:"wetland"},{name:"Disability",tags:["handicap","wheelchair","access"],icon:"disability"},{name:"Telephone",tags:["payphone","call"],icon:"telephone"},{name:"Emergency Telephone",tags:["payphone","danger","safety","call"],icon:"emergency-telephone"},{name:"Toilets",tags:["bathroom","men","women","sink","washroom","lavatory"],icon:"toilets"},{name:"Waste Basket",tags:["trash","rubbish","bin","garbage"],icon:"waste-basket"},{name:"Music",tags:["stage","performance","band","concert","venue"],icon:"music"},{name:"Land Use",tags:["zoning","usage","area"],icon:"land-use"},{name:"City",tags:["area","point","place","urban"],icon:"city"},{name:"Town",tags:["area","point","place","small"],icon:"town"},{name:"Village",tags:["area","point","place","small","rural"],icon:"village"},{name:"Farm",tags:["building","farming","crops","plants","agriculture","rural"],icon:"farm"},{name:"Bakery",tags:["bakery","pastry","croissant","food","shop","bread"],icon:"bakery"},{name:"Dog Park",tags:["dog","pet"],icon:"dog-park"},{name:"Lighthouse",tags:["building","navigation","nautical","ocean","logistics"],icon:"lighthouse"},{name:"Clothing Store",tags:["clothing","store","shop"],icon:"clothing-store"},{name:"Polling Place",icon:"polling-place"},{name:"Playground",icon:"playground"},{name:"Entrance",icon:"entrance"},{name:"Heart",icon:"heart"},{name:"London Underground",icon:"london-underground"},{name:"Minefield",icon:"minefield"},{name:"Rail Underground",icon:"rail-underground"},{name:"Rail Above",icon:"rail-above"},{name:"Camera",icon:"camera"},{name:"Laundry",icon:"laundry"},{name:"Car",icon:"car"},{name:"Suitcase",icon:"suitcase"},{name:"Hairdresser",icon:"hairdresser"},{name:"Chemist",icon:"chemist"},{name:"Mobile phone",icon:"mobilephone"},{name:"Scooter",icon:"scooter"}]}},1561:function(e,t,i){var s=i(4),n=i(796);e.exports=s.extend({className:"Label",initialize:function initialize(){if(!this.model)throw new Error("A model should be provided");this.model.on("change:label",this.render,this)},render:function render(){return this.$el.html(n({label:this.model.get("label"),selectedChild:this.model.get("selectedChild")||""})),this}})},1562:function(e,t,i){i(37);var s=i(3),n=i(4),o=i(1),a=i(58);e.exports=n.extend({module:"components:tab-pane:tab-pane-item-view",tagName:"button",className:function className(){var e=[this.options.klassName];return this.model.get("selected")&&e.push("is-selected"),this.model.get("disabled")&&e.push("is-disabled"),e.join(" ")},events:{click:"_onButtonClicked"},initialize:function initialize(){var e;if(!this.model)throw new Error("A model should be provided");s(e=this.model).call(e,"change:selected",this._onChangeSelected,this)},render:function render(){return this.clearSubViews(),this._initViews(),this},_initViews:function _initViews(){this._initButton(),this._initTooltip()},_initButton:function _initButton(){var e=this.model.get("createButtonView").call(this.model);this.addView(e),this.$el.append(e.render().$el)},_initTooltip:function _initTooltip(){var e=this.model.get("tooltip");if(e){var t=new a({el:this.$el,title:function title(){return _t(e)},gravity:this.model.get("tooltipGravity")||"w"});this._buttonTooltip=t,this.addView(t)}},_onChangeSelected:function _onChangeSelected(){var e=!!this.model.get("selected");e||this._buttonTooltip&&this._buttonTooltip.hideTipsy(),this.$el.toggleClass("is-selected",e)},_onButtonClicked:function _onButtonClicked(e){e.preventDefault(),this.model.get("disabled")||(this.model.set("selected",!0),o.isFunction(this.model.get("onClick"))&&this.model.get("onClick")())},clean:function clean(){this._buttonTooltip&&this._buttonTooltip.clean()}})},1563:function(e,t,i){var s=i(6);e.exports=s.Model.extend({defaults:{selected:!1},getName:function getName(){return null==this.get("label")?this.getValue():this.get("label")},getValue:function getValue(){return this.get("val")}})},1567:function(e,t,i){var s=i(6);e.exports=s.Model.extend({_DATASOURCE_NAME:"dropbox",url:function url(e){var t=this._configModel.urlVersion("imports_service");return this._configModel.get("base_url")+"/api/"+t+"/imports/service/"+this._DATASOURCE_NAME+"/auth_url"},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");if(!t.datasourceName)throw new Error("datasource_name is required");this._configModel=t.configModel,this._DATASOURCE_NAME=t.datasourceName}})},1568:function(e,t,i){var s=i(6);e.exports=s.Model.extend({_DATASOURCE_NAME:"dropbox",url:function url(e){var t=this._configModel.urlVersion("imports_service");return this._configModel.get("base_url")+"/api/"+t+"/imports/service/"+this._DATASOURCE_NAME+"/token_valid"},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");if(!t.datasourceName)throw new Error("datasource_name is required");this._configModel=t.configModel,this._DATASOURCE_NAME=t.datasourceName}})},1572:function(e,t,i){var s=i(3),n=i(4),o=i(1571);e.exports=n.extend({events:{"click .js-connect":"_checkToken"},initialize:function initialize(e){if(!e.serviceTokenModel)throw new Error("serviceTokenModel provider is required");if(!e.serviceOauthModel)throw new Error("serviceOauthModel is required");this._serviceTokenModel=e.serviceTokenModel,this._serviceOauthModel=e.serviceOauthModel,this._initBinds(),this._checkVisibility()},render:function render(){return this.$el.html(o({state:this.model.get("state")})),this},_initBinds:function _initBinds(){var e;s(e=this.model).call(e,"change:state",function(){this.render(),this._checkVisibility()},this)},_checkToken:function _checkToken(){var e=this;this.model.set("state","token"),this._serviceTokenModel.fetch({success:function success(t){t.get("oauth_valid")||e._getOauthURL()},error:function error(t){e._getOauthURL()}})},_checkVisibility:function _checkVisibility(){var e=this.model.get("state");"list"!==e&&"selected"!==e?this.show():this.hide()},_getOauthURL:function _getOauthURL(){var e=this;this.model.set("state","oauth"),this._serviceOauthModel.set({url:""},{silent:!0}),this._serviceOauthModel.fetch({error:function error(){e.model.set("state","error")}})}})},1582:function(e,t,i){!function(e){var t=e.Markdown=function(e){switch(typeof e){case"undefined":this.dialect=t.dialects.Gruber;break;case"object":this.dialect=e;break;default:if(!(e in t.dialects))throw new Error("Unknown Markdown dialect '"+String(e)+"'");this.dialect=t.dialects[e]}this.em_state=[],this.strong_state=[],this.debug_indent=""};function mk_block_toSource(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function mk_block_inspect(){var e=i(507);return"Markdown.mk_block( "+e.inspect(this.toString())+", "+e.inspect(this.trailing)+", "+e.inspect(this.lineNumber)+" )"}e.parse=function(e,i){return new t(i).toTree(e)},e.toHTML=function toHTML(t,i,s){var n=e.toHTMLTree(t,i,s);return e.renderJsonML(n)},e.toHTMLTree=function toHTMLTree(e,t,i){"string"==typeof e&&(e=this.parse(e,t));var s=extract_attr(e),n={};s&&s.references&&(n=s.references);var o=function convert_tree_to_html(e,t,i){var s;i=i||{};var n=e.slice(0);"function"==typeof i.preprocessTreeNode&&(n=i.preprocessTreeNode(n,t));var o=extract_attr(n);if(o){for(s in n[1]={},o)n[1][s]=o[s];o=n[1]}if("string"==typeof n)return n;switch(n[0]){case"header":n[0]="h"+n[1].level,delete n[1].level;break;case"bulletlist":n[0]="ul";break;case"numberlist":n[0]="ol";break;case"listitem":n[0]="li";break;case"para":n[0]="p";break;case"markdown":n[0]="html",o&&delete o.references;break;case"code_block":n[0]="pre",s=o?2:1;var a=["code"];a.push.apply(a,n.splice(s,n.length-s)),n[s]=a;break;case"inlinecode":n[0]="code";break;case"img":n[1].src=n[1].href,delete n[1].href;break;case"linebreak":n[0]="br";break;case"link":n[0]="a";break;case"link_ref":n[0]="a";var r=t[o.ref];if(!r)return o.original;delete o.ref,o.href=r.href,r.title&&(o.title=r.title),delete o.original;break;case"img_ref":n[0]="img";var r=t[o.ref];if(!r)return o.original;delete o.ref,o.src=r.href,r.title&&(o.title=r.title),delete o.original}s=1;if(o){for(var l in n[1]){s=2;break}1===s&&n.splice(s,1)}for(;s<n.length;++s)n[s]=convert_tree_to_html(n[s],t,i);return n}(e,n,i);return function merge_text_nodes(e){var t=extract_attr(e)?2:1;for(;t<e.length;)"string"==typeof e[t]?t+1<e.length&&"string"==typeof e[t+1]?e[t]+=e.splice(t+1,1)[0]:++t:(merge_text_nodes(e[t]),++t)}(o),o};var s=t.mk_block=function(e,t,i){1==arguments.length&&(t="\n\n");var s=new String(e);return s.trailing=t,s.inspect=mk_block_inspect,s.toSource=mk_block_toSource,void 0!=i&&(s.lineNumber=i),s};function count_lines(e){for(var t=0,i=-1;-1!==(i=e.indexOf("\n",i+1));)t++;return t}function strong_em(e,t){var i=e+"_state",s="strong"==e?"em_state":"strong_state";function CloseTag(e){this.len_after=e,this.name="close_"+t}return function(n,o){if(this[i][0]==t)return this[i].shift(),[n.length,new CloseTag(n.length-t.length)];var a=this[s].slice(),r=this[i].slice();this[i].unshift(t);var l=this.processInline(n.substr(t.length)),c=l[l.length-1];this[i].shift();return c instanceof CloseTag?(l.pop(),[n.length-c.len_after,[e].concat(l)]):(this[s]=a,this[i]=r,[t.length,t])}}t.prototype.split_blocks=function splitBlocks(e,t){e=e.replace(/(\r\n|\n|\r)/g,"\n");var i,n=/([\s\S]+?)($|\n#|\n(?:\s*\n|$)+)/g,o=[],a=1;for(null!=(i=/^(\s*\n)/.exec(e))&&(a+=count_lines(i[0]),n.lastIndex=i[0].length);null!==(i=n.exec(e));)"\n#"==i[2]&&(i[2]="\n",n.lastIndex--),o.push(s(i[1],i[2],a)),a+=count_lines(i[0]);return o},t.prototype.processBlock=function processBlock(e,t){var i=this.dialect.block,s=i.__order__;if("__call__"in i)return i.__call__.call(this,e,t);for(var n=0;n<s.length;n++){var a=i[s[n]].call(this,e,t);if(a)return(!o(a)||a.length>0&&!o(a[0]))&&this.debug(s[n],"didn't return a proper array"),a}return[]},t.prototype.processInline=function processInline(e){return this.dialect.inline.__call__.call(this,String(e))},t.prototype.toTree=function toTree(e,t){var i=e instanceof Array?e:this.split_blocks(e),s=this.tree;try{for(this.tree=t||this.tree||["markdown"];i.length;){var n=this.processBlock(i.shift(),i);n.length&&this.tree.push.apply(this.tree,n)}return this.tree}finally{t&&(this.tree=s)}},t.prototype.debug=function(){var e=Array.prototype.slice.call(arguments);e.unshift(this.debug_indent),"undefined"!=typeof print&&print.apply(print,e),"undefined"!=typeof console&&void 0!==console.log&&console.log.apply(null,e)},t.prototype.loop_re_over_block=function(e,t,i){for(var s,n=t.valueOf();n.length&&null!=(s=e.exec(n));)n=n.substr(s[0].length),i.call(this,s);return n},t.dialects={},t.dialects.Gruber={block:{atxHeader:function atxHeader(e,t){var i=e.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(i){var n=["header",{level:i[1].length}];return Array.prototype.push.apply(n,this.processInline(i[2])),i[0].length<e.length&&t.unshift(s(e.substr(i[0].length),e.trailing,e.lineNumber+2)),[n]}},setextHeader:function setextHeader(e,t){var i=e.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(i){var n=["header",{level:"="===i[2]?1:2},i[1]];return i[0].length<e.length&&t.unshift(s(e.substr(i[0].length),e.trailing,e.lineNumber+2)),[n]}},code:function code(e,t){var i=[],n=/^(?: {0,3}\t| {4})(.*)\n?/;if(e.match(n)){e:for(;;){var o=this.loop_re_over_block(n,e.valueOf(),function(e){i.push(e[1])});if(o.length){t.unshift(s(o,e.trailing));break e}if(!t.length)break e;if(!t[0].match(n))break e;i.push(e.trailing.replace(/[^\n]/g,"").substring(2)),e=t.shift()}return[["code_block",i.join("\n")]]}},horizRule:function horizRule(e,t){var i=e.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(i){var n=[["hr"]];return i[1]&&n.unshift.apply(n,this.processBlock(i[1],[])),i[3]&&t.unshift(s(i[3])),n}},lists:function(){var e="[*+-]|\\d+\\.",t=/[*+-]/,i=new RegExp("^( {0,3})("+e+")[ \t]+"),o="(?: {0,3}\\t| {4})";function add(e,t,i,s){if(t)e.push(["para"].concat(i));else{var n=e[e.length-1]instanceof Array&&"para"==e[e.length-1][0]?e[e.length-1]:e;s&&e.length>1&&i.unshift(s);for(var o=0;o<i.length;o++){var a=i[o];"string"==typeof a&&n.length>1&&"string"==typeof n[n.length-1]?n[n.length-1]+=a:n.push(a)}}}function get_contained_blocks(e,t){for(var i=new RegExp("^("+o+"{"+e+"}.*?\\n?)*$"),n=new RegExp("^"+o+"{"+e+"}","gm"),a=[];t.length>0&&i.exec(t[0]);){var r=t.shift(),l=r.replace(n,"");a.push(s(l,r.trailing,r.lineNumber))}return a}function paragraphify(e,t,i){var s=e.list,n=s[s.length-1];if(!(n[1]instanceof Array&&"para"==n[1][0]))if(t+1==i.length)n.push(["para"].concat(n.splice(1,n.length-1)));else{var o=n.pop();n.push(["para"].concat(n.splice(1,n.length-1)),o)}}return function(s,a){var r=s.match(i);if(r){for(var l,c,h,d=[],u=make_list(r),p=!1,g=[d[0].list];;){for(var m=s.split(/(?=\n)/),f="",_=0;_<m.length;_++){var v="",y=m[_].replace(/^\n/,function(e){return v=e,""}),w=(h=d.length,new RegExp("(?:^("+o+"{0,"+h+"} {0,3})("+e+")\\s+)|(^"+o+"{0,"+(h-1)+"}[ ]{0,4})"));if(void 0!==(r=y.match(w))[1]){f.length&&(add(l,p,this.processInline(f),v),p=!1,f=""),r[1]=r[1].replace(/ {0,3}\t/g,"    ");var b=Math.floor(r[1].length/4)+1;if(b>d.length)u=make_list(r),l.push(u),l=u[1]=["listitem"];else{var C=!1;for(c=0;c<d.length;c++)if(d[c].indent==r[1]){u=d[c].list,d.splice(c+1,d.length-(c+1)),C=!0;break}C||(++b<=d.length?(d.splice(b,d.length-b),u=d[b-1].list):(u=make_list(r),l.push(u))),l=["listitem"],u.push(l)}v=""}y.length>r[0].length&&(f+=v+y.substr(r[0].length))}f.length&&(add(l,p,this.processInline(f),v),p=!1,f="");var M=get_contained_blocks(d.length,a);M.length>0&&(n(d,paragraphify,this),l.push.apply(l,this.toTree(M,[])));var k=a[0]&&a[0].valueOf()||"";if(!k.match(i)&&!k.match(/^ /))break;s=a.shift();var S=this.dialect.block.horizRule(s,a);if(S){g.push.apply(g,S);break}n(d,paragraphify,this),p=!0}return g}function make_list(e){var i=t.exec(e[2])?["bulletlist"]:["numberlist"];return d.push({list:i,indent:e[1]}),i}}}(),blockquote:function blockquote(e,t){if(e.match(/^>/m)){var i=[];if(">"!=e[0]){for(var n=e.split(/\n/),o=[],a=e.lineNumber;n.length&&">"!=n[0][0];)o.push(n.shift()),a++;var l=s(o.join("\n"),"\n",e.lineNumber);i.push.apply(i,this.processBlock(l,[])),e=s(n.join("\n"),e.trailing,a)}for(;t.length&&">"==t[0][0];){var c=t.shift();e=s(e+e.trailing+c,c.trailing,e.lineNumber)}var h=e.replace(/^> ?/gm,""),d=(this.tree,this.toTree(h,["blockquote"])),u=extract_attr(d);return u&&u.references&&(delete u.references,r(u)&&d.splice(1,1)),i.push(d),i}},referenceDefn:function referenceDefn(e,t){var i=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(e.match(i)){extract_attr(this.tree)||this.tree.splice(1,0,{});var n=extract_attr(this.tree);void 0===n.references&&(n.references={});var o=this.loop_re_over_block(i,e,function(e){e[2]&&"<"==e[2][0]&&">"==e[2][e[2].length-1]&&(e[2]=e[2].substring(1,e[2].length-1));var t=n.references[e[1].toLowerCase()]={href:e[2]};void 0!==e[4]?t.title=e[4]:void 0!==e[5]&&(t.title=e[5])});return o.length&&t.unshift(s(o,e.trailing)),[]}},para:function para(e,t){return[["para"].concat(this.processInline(e))]}}},t.dialects.Gruber.inline={__oneElement__:function oneElement(e,t,i){var s,n;return t=t||this.dialect.inline.__patterns__,(s=new RegExp("([\\s\\S]*?)("+(t.source||t)+")").exec(e))?s[1]?[s[1].length,s[1]]:(s[2]in this.dialect.inline&&(n=this.dialect.inline[s[2]].call(this,e.substr(s.index),s,i||[])),n=n||[s[2].length,s[2]]):[e.length,e]},__call__:function inline(e,t){var i,s=[];function add(e){"string"==typeof e&&"string"==typeof s[s.length-1]?s[s.length-1]+=e:s.push(e)}for(;e.length>0;)i=this.dialect.inline.__oneElement__.call(this,e,t,s),e=e.substr(i.shift()),n(i,add);return s},"]":function(){},"}":function(){},__escape__:/^\\[\\`\*_{}\[\]()#\+.!\-]/,"\\":function escaped(e){return this.dialect.inline.__escape__.exec(e)?[2,e.charAt(1)]:[1,"\\"]},"![":function image(e){var t=e.match(/^!\[(.*?)\][ \t]*\([ \t]*([^")]*?)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(t){t[2]&&"<"==t[2][0]&&">"==t[2][t[2].length-1]&&(t[2]=t[2].substring(1,t[2].length-1)),t[2]=this.dialect.inline.__call__.call(this,t[2],/\\/)[0];var i={alt:t[1],href:t[2]||""};return void 0!==t[4]&&(i.title=t[4]),[t[0].length,["img",i]]}return(t=e.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/))?[t[0].length,["img_ref",{alt:t[1],ref:t[2].toLowerCase(),original:t[0]}]]:[2,"!["]},"[":function link(e){var i=String(e),s=t.DialectHelpers.inline_until_char.call(this,e.substr(1),"]");if(!s)return[1,"["];var link,n,o=1+s[0],a=s[1],r=(e=e.substr(o)).match(/^\s*\([ \t]*([^"']*)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(r){var l=r[1];if(o+=r[0].length,l&&"<"==l[0]&&">"==l[l.length-1]&&(l=l.substring(1,l.length-1)),!r[3])for(var c=1,h=0;h<l.length;h++)switch(l[h]){case"(":c++;break;case")":0==--c&&(o-=l.length-h,l=l.substring(0,h))}return n={href:(l=this.dialect.inline.__call__.call(this,l,/\\/)[0])||""},void 0!==r[3]&&(n.title=r[3]),link=["link",n].concat(a),[o,link]}return(r=e.match(/^\s*\[(.*?)\]/))?(o+=r[0].length,link=["link_ref",n={ref:(r[1]||String(a)).toLowerCase(),original:i.substr(0,o)}].concat(a),[o,link]):1==a.length&&"string"==typeof a[0]?(link=["link_ref",n={ref:a[0].toLowerCase(),original:i.substr(0,o)},a[0]],[o,link]):[1,"["]},"<":function autoLink(e){var t;return null!=(t=e.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))?t[3]?[t[0].length,["link",{href:"mailto:"+t[3]},t[3]]]:"mailto"==t[2]?[t[0].length,["link",{href:t[1]},t[1].substr("mailto:".length)]]:[t[0].length,["link",{href:t[1]},t[1]]]:[1,"<"]},"`":function inlineCode(e){var t=e.match(/(`+)(([\s\S]*?)\1)/);return t&&t[2]?[t[1].length+t[2].length,["inlinecode",t[3]]]:[1,"`"]},"  \n":function lineBreak(e){return[3,["linebreak"]]}},t.dialects.Gruber.inline["**"]=strong_em("strong","**"),t.dialects.Gruber.inline.__=strong_em("strong","__"),t.dialects.Gruber.inline["*"]=strong_em("em","*"),t.dialects.Gruber.inline._=strong_em("em","_"),t.buildBlockOrder=function(e){var t=[];for(var i in e)"__order__"!=i&&"__call__"!=i&&t.push(i);e.__order__=t},t.buildInlinePatterns=function(e){var t=[];for(var i in e)if(!i.match(/^__.*__$/)){var s=i.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");t.push(1==i.length?s:"(?:"+s+")")}t=t.join("|"),e.__patterns__=t;var n=e.__call__;e.__call__=function(e,i){return void 0!=i?n.call(this,e,i):n.call(this,e,t)}},t.DialectHelpers={},t.DialectHelpers.inline_until_char=function(e,t){for(var i=0,s=[];;){if(e.charAt(i)==t)return[++i,s];if(i>=e.length)return null;var n=this.dialect.inline.__oneElement__.call(this,e.substr(i));i+=n[0],s.push.apply(s,n.slice(1))}},t.subclassDialect=function(e){function Block(){}function Inline(){}return Block.prototype=e.block,Inline.prototype=e.inline,{block:new Block,inline:new Inline}},t.buildBlockOrder(t.dialects.Gruber.block),t.buildInlinePatterns(t.dialects.Gruber.inline),t.dialects.Maruku=t.subclassDialect(t.dialects.Gruber),t.dialects.Maruku.processMetaHash=function processMetaHash(e){for(var t=function split_meta_hash(e){var t=e.split(""),i=[""],s=!1;for(;t.length;){var n=t.shift();switch(n){case" ":s?i[i.length-1]+=n:i.push("");break;case"'":case'"':s=!s;break;case"\\":n=t.shift();default:i[i.length-1]+=n}}return i}(e),i={},s=0;s<t.length;++s)if(/^#/.test(t[s]))i.id=t[s].substring(1);else if(/^\./.test(t[s]))i.class?i.class=i.class+t[s].replace(/./," "):i.class=t[s].substring(1);else if(/\=/.test(t[s])){var n=t[s].split(/\=/);i[n[0]]=n[1]}return i},t.dialects.Maruku.block.document_meta=function document_meta(e,t){if(!(e.lineNumber>1)&&e.match(/^(?:\w+:.*\n)*\w+:.*$/)){extract_attr(this.tree)||this.tree.splice(1,0,{});var i=e.split(/\n/);for(p in i){var s=i[p].match(/(\w+):\s*(.*)$/),n=s[1].toLowerCase(),o=s[2];this.tree[1][n]=o}return[]}},t.dialects.Maruku.block.block_meta=function block_meta(e,t){var i=e.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(i){var s,n=this.dialect.processMetaHash(i[2]);if(""===i[1]){var o=this.tree[this.tree.length-1];if(s=extract_attr(o),"string"==typeof o)return;for(a in s||(s={},o.splice(1,0,s)),n)s[a]=n[a];return[]}var r=e.replace(/\n.*$/,""),l=this.processBlock(r,[]);for(a in(s=extract_attr(l[0]))||(s={},l[0].splice(1,0,s)),n)s[a]=n[a];return l}},t.dialects.Maruku.block.definition_list=function definition_list(e,t){var i,s=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,n=["dl"];if(r=e.match(s)){for(var o=[e];t.length&&s.exec(t[0]);)o.push(t.shift());for(var a=0;a<o.length;++a){var r,l=(r=o[a].match(s))[1].replace(/\n$/,"").split(/\n/),c=r[2].split(/\n:\s+/);for(i=0;i<l.length;++i)n.push(["dt",l[i]]);for(i=0;i<c.length;++i)n.push(["dd"].concat(this.processInline(c[i].replace(/(\n)\s+/,"$1"))))}return[n]}},t.dialects.Maruku.block.table=function table(e,t){var i,s,o=function(e,t){(t=t||"\\s").match(/^[\\|\[\]{}?*.+^$]$/)&&(t="\\"+t);for(var i,s=[],n=new RegExp("^((?:\\\\.|[^\\\\"+t+"])*)"+t+"(.*)");i=e.match(n);)s.push(i[1]),e=i[2];return s.push(e),s};if(s=e.match(/^ {0,3}\|(.+)\n {0,3}\|\s*([\-:]+[\-| :]*)\n((?:\s*\|.*(?:\n|$))*)(?=\n|$)/))s[3]=s[3].replace(/^\s*\|/gm,"");else if(!(s=e.match(/^ {0,3}(\S(?:\\.|[^\\|])*\|.*)\n {0,3}([\-:]+\s*\|[\-| :]*)\n((?:(?:\\.|[^\\|])*\|.*(?:\n|$))*)(?=\n|$)/)))return;var table=["table",["thead",["tr"]],["tbody"]];s[2]=s[2].replace(/\|\s*$/,"").split("|");var a=[];for(n(s[2],function(e){e.match(/^\s*-+:\s*$/)?a.push({align:"right"}):e.match(/^\s*:-+\s*$/)?a.push({align:"left"}):e.match(/^\s*:-+:\s*$/)?a.push({align:"center"}):a.push({})}),s[1]=o(s[1].replace(/\|\s*$/,""),"|"),i=0;i<s[1].length;i++)table[1][1].push(["th",a[i]||{}].concat(this.processInline(s[1][i].trim())));return n(s[3].replace(/\|\s*$/gm,"").split("\n"),function(e){var t=["tr"];for(e=o(e,"|"),i=0;i<e.length;i++)t.push(["td",a[i]||{}].concat(this.processInline(e[i].trim())));table[2].push(t)},this),[table]},t.dialects.Maruku.inline["{:"]=function inline_meta(e,t,i){if(!i.length)return[2,"{:"];var s=i[i.length-1];if("string"==typeof s)return[2,"{:"];var n=e.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!n)return[2,"{:"];var o=this.dialect.processMetaHash(n[1]),a=extract_attr(s);for(var r in a||(a={},s.splice(1,0,a)),o)a[r]=o[r];return[n[0].length,""]},t.dialects.Maruku.inline.__escape__=/^\\[\\`\*_{}\[\]()#\+.!\-|:]/,t.buildBlockOrder(t.dialects.Maruku.block),t.buildInlinePatterns(t.dialects.Maruku.inline);var n,o=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)};n=Array.prototype.forEach?function(e,t,i){return e.forEach(t,i)}:function(e,t,i){for(var s=0;s<e.length;s++)t.call(i||e,e[s],s,e)};var r=function(e){for(var t in e)if(hasOwnProperty.call(e,t))return!1;return!0};function extract_attr(e){return o(e)&&e.length>1&&"object"==typeof e[1]&&!o(e[1])?e[1]:void 0}function escapeHTML(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function render_tree(e){if("string"==typeof e)return escapeHTML(e);var t=e.shift(),i={},s=[];for(!e.length||"object"!=typeof e[0]||e[0]instanceof Array||(i=e.shift());e.length;)s.push(render_tree(e.shift()));var n="";for(var o in i)n+=" "+o+'="'+escapeHTML(i[o])+'"';return"img"==t||"br"==t||"hr"==t?"<"+t+n+"/>":"<"+t+n+">"+s.join("")+"</"+t+">"}e.renderJsonML=function(e,t){(t=t||{}).root=t.root||!1;var i=[];if(t.root)i.push(render_tree(e));else for(e.shift(),!e.length||"object"!=typeof e[0]||e[0]instanceof Array||e.shift();e.length;)i.push(render_tree(e.shift()));return i.join("\n\n")}}(t)},1584:function(e,t,i){var s=i(84),n=i(4),o=i(18),a=i(1),r=i(74),l=i(59),c=i(58),h=i(1583);e.exports=n.extend({tagName:"li",className:"ModalBlockList-item ModalBlockList-item--full",events:{"click .js-tag-link":"_onTagClick",click:"_toggleSelected"},initialize:function initialize(e){if(!e.createModel)throw new Error("createModel is required");if(!e.userModel)throw new Error("userModel is required");this._createModel=e.createModel,this._userModel=e.userModel,this._routerModel=this._createModel.getVisualizationFetchModel(),this.model.on("change",this.render,this)},render:function render(){var e=this.model.getTableModel(),t=this.model.getPermissionModel(),i=this.model.getSynchronizationModel(),n=this.model.get("tags")||[],o=s.core.sanitize.html(this.model.get("description")),c=(e.getGeometryType?e.getGeometryType():e.geomColumnTypes())||[],d=this.model.get("sample"),u=this.model.get("subscription"),p={isRaster:this.model.isRaster(),geometryType:c.length>0?c[0]:"",title:this.model.get("name"),isOwner:t.isOwner(this._userModel),owner:t.getOwner().renderData(this._userModel),showPermissionIndicator:!t.hasWriteAccess(this._userModel),description:o,entityTag:d&&!!d.entity_id?"SAMPLE":u&&!!u.entity_id&&"SUBSCRIPTION",privacy:this.model.get("privacy").toLowerCase(),timeDiff:r(this.model.get("updated_at")).fromNow(),tags:n,tagsCount:n.length,maxTagsToShow:3,rowCount:void 0,datasetSize:void 0,syncStatus:void 0,syncRanAt:void 0},g=e.get("row_count");g>=0&&(p.rowCount=g,p.rowCountFormatted=g<1e4?l.formatNumber(g):l.readizableNumber(g));var m=e.get("size");return m>=0&&(p.datasetSize=l.readablizeBytes(m,!0)),a.isEmpty(i)||(p.syncRanAt=r(i.get("ran_at")||new Date).fromNow(),p.syncStatus=i.get("state")),this.$el.html(h(p)),this._renderTooltips(),this.$el.toggleClass("is-selected",!!this.model.get("selected")),this},_renderTooltips:function _renderTooltips(){a.isEmpty(this.model.get("synchronization"))||this.addView(new c({el:this.$(".DatasetsList-itemStatus"),title:function title(e){return o(this).attr("data-title")}}))},_onTagClick:function _onTagClick(e){var t=o(e.target).val();t&&this._routerModel.set("tag",t)},_toggleSelected:function _toggleSelected(e){"A"!==e.target.tagName&&(this.killEvent(e),this._createModel.canSelect(this.model)&&this.model.set("selected",!this.model.get("selected")))}})},163:function(e,t,i){i(341),i(528),i(31);var s=i(25),n=i(195),o=i(32),a=i(13),r=i(3);i(31);var l=i(6),c=i(1),h=i(1875),d=i(193),u=i(525),p=i(1874),g=i(1871),m=i(1870),f=i(1869),_=i(1868),v=i(470),y=i(666),w=i(14),b=["configModel"],C={default:{public:"PUBLIC",link:"LINK",private:"PRIVATE",password:"PASSWORD"},kuviz:{public:"PUBLIC",password:"PASSWORD"}},M=["derived","kuviz","slide"],k=l.Model.extend({defaults:{bindMap:!0},INHERIT_TABLE_ATTRIBUTES:["name","description","privacy"],initialize:function initialize(e,t){w(t,b,this),this.type=this.get("type"),"kuviz"!==this.type&&(this.map=new p({configModel:this._configModel}),this.get("bindMap")&&this._bindMap()),this._privacyOptions="kuviz"===this.type?C[this.type]:C.default,this.permission=new u(this.get("permission"),{configModel:this._configModel}),this.order=new g({visualization:this}),this.transition=new m(this.get("transition_options"),{parse:!0}),this.like=h.newByVisData({vis_id:this.id,liked:this.get("liked"),likes:this.get("likes"),config:this._configModel}),this._initBinds()},_initBinds:function _initBinds(){var e,t;r(e=this.permission.acl).call(e,"reset",function(){this.set("permission",this.permission.attributes,{silent:!0}),this.trigger("change:permission",this)},this),r(t=this).call(t,"change:permission",function(){this.permission.set(this.get("permission"))},this)},_bindMap:function _bindMap(){var e;this.on("change:map_id",this._fetchMap,this),r(e=a(this)).call(e,"change:id",function(){this.set("map_id",a(this).id)},this),a(this).set("id",this.get("map_id"))},url:function url(e){var t="/api/"+this._configModel.urlVersion("visualization",e)+"/viz";return this.isNew()?t:t+"/"+this.id},parse:function parse(e){return this.transition&&e.transition_options&&this.transition.set(this.transition.parse(e.transition_options)),this.like&&this.like.set({vis_id:this.id,likes:this.get("likes"),liked:this.get("liked")}),this.owner&&(this.owner=new d(this.owner)),e},toJSON:function toJSON(){var e=c.clone(this.attributes);return delete e.bindMap,delete e.stats,delete e.related_tables,delete e.children,e.transition_options=this.transition.toJSON(),e},getLikesModel:function getLikesModel(){return this.like},copy:function copy(e,t){e=e||{},t=t||{};var i=new k(c.extend({source_visualization_id:this.id},e),{configModel:this._configModel});return i.save(null,t),i},_fetchMap:function _fetchMap(){a(this).set("id",this.get("map_id")).fetch()},viewUrl:function viewUrl(e){var t=this.permission.owner,i=this.permission.owner.viewUrl();if(this.isVisualization()||c.isUndefined(this.get("type"))){var s=this.get("id");return"kuviz"===this.get("type")?new v({base_url:i.urlToPath("kuviz",s)}):(e&&e.id!==t.id&&this.permission.hasAccess(e)&&(i=e.viewUrl(),s=t.get("username")+"."+s),new f({base_url:i.urlToPath("viz",s)}))}return e&&this.permission.hasAccess(e)&&(i=e.viewUrl()),new _({base_url:i.urlToPath("tables",this.tableMetadata().getUnquotedName())})},sharedWithEntities:function sharedWithEntities(){return a(c).call(c,this.permission.acl.toArray()||[],function(e){return e.get("entity")})},isVisualization:function isVisualization(){var e=this.get("type");return o(M).call(M,e)>-1},tableMetadata:function tableMetadata(){return this._metadata||(this._metadata=new y(this.get("table"),{configModel:this._configModel})),this._metadata},getTableModel:function getTableModel(){return this._metadata||(this._metadata=new y(this.get("table"),{configModel:this._configModel})),this._metadata},privacyOptions:function privacyOptions(){var e=n(c).call(c,this._privacyOptions);return this.isVisualization()?e:s(c).call(c,e,function(e){return"PASSWORD"!==e})},isRaster:function isRaster(){return"raster"===this.get("kind")},getPermissionModel:function getPermissionModel(){return this.permission},getSynchronizationModel:function getSynchronizationModel(){return this._synchronizationModel},mapcapsURL:function mapcapsURL(){return this._configModel.get("base_url")+"/api/v3/viz/"+this.id+"/mapcaps"}},{isPubliclyAvailable:function isPubliclyAvailable(e){return e===C.default.password||e===C.default.link||e===C.default.public}});e.exports=k},166:function(e,t,i){"use strict";(function(e){i.d(t,"j",function(){return initFilter}),i.d(t,"e",function(){return fetchDatasetsList}),i.d(t,"d",function(){return fetchDataset}),i.d(t,"f",function(){return fetchKeyVariables}),i.d(t,"i",function(){return fetchVariables}),i.d(t,"w",function(){return setSearchText}),i.d(t,"v",function(){return setPage}),i.d(t,"a",function(){return clearTagFilters}),i.d(t,"r",function(){return requestExtendedLicense}),i.d(t,"o",function(){return requestAccess}),i.d(t,"p",function(){return requestAccessHubspot}),i.d(t,"h",function(){return fetchSubscriptionsList}),i.d(t,"g",function(){return fetchSubscriptionsDetailsList}),i.d(t,"k",function(){return performSubscribe}),i.d(t,"n",function(){return performUnsubscribe}),i.d(t,"l",function(){return performSubscriptionSync}),i.d(t,"m",function(){return performSubscriptionUnsync}),i.d(t,"b",function(){return connectSubscriptionSample}),i.d(t,"c",function(){return downloadNotebook}),i.d(t,"q",function(){return requestDataset}),i.d(t,"s",function(){return sendAccessAttemptMetrics}),i.d(t,"u",function(){return sendRequestExtendedMetrics}),i.d(t,"t",function(){return sendRequestAccessMetrics});i(598),i(92),i(37),i(35),i(34),i(67),i(23),i(236),i(326),i(64),i(257);var s=i(1701),n=i.n(s),o=i(28),a=i.n(o),r=i(12),l=i(15),c=i.n(l),h=i(25),d=i.n(h),u=(i(77),i(38)),p=i.n(u),g=i(53),m=i(44),f=i.n(m),_=i(49),v=i.n(_),y=i(7),w=i.n(y),b=i(29),C=i(89),M=i.n(C),k=i(13),S=i.n(k),x=i(56),T=i.n(x),D=(i(569),i(469)),E=i(253),V="data/observatory/metadata/entities",A="data/observatory/metadata/datasets",I="data/observatory/metadata/geographies",B="data/observatory/templates/notebooks/explore",z="do/subscriptions";function initFilter(t,i){var s={searchText:"",limit:e.env.VUE_APP_PAGE_SIZE||10,page:0,categories:{}},n=["country","category","license","provider","placetype"];T()(n).call(n,function(e){var t;e in i&&(s.categories[e]=S()(t=i[e].split(",")).call(t,function(e){return{id:e}}))}),"search"in i&&(s.searchText=i.search),"page"in i&&(s.page=M()(i.page)-1),t.state.filter=s}function fetchDatasetsList(e){return _fetchDatasetsList.apply(this,arguments)}function _fetchDatasetsList(){return(_fetchDatasetsList=Object(b.a)(c.a.mark(function _callee(e){var t,i,s,n,o,a,r;return c.a.wrap(function _callee$(l){for(;;)switch(l.prev=l.next){case 0:return Object(D.a)(e.state),e.commit("resetDatasetsList"),e.commit("setFetchingState"),s=Object(E.a)(e.rootState),n=w()(t=w()(i="".concat(s,"/")).call(i,V,"?")).call(t,filtersToPayload(d()(e.state))),l.prev=5,l.next=8,fetch(n);case 8:return o=l.sent,l.next=11,o.json();case 11:for(r in a=l.sent,e.commit("setDatasetsList",a.results),e.commit("setDatasetsListCount",a.total_results),a.filters)e.commit("setAvailableFilters",{id:r,options:a.filters[r]});l.next=20;break;case 17:l.prev=17,l.t0=l.catch(5),console.error("ERROR: ".concat(l.t0));case 20:case"end":return l.stop()}},_callee,null,[[5,17]])}))).apply(this,arguments)}function fetchDataset(e,t){return _fetchDataset.apply(this,arguments)}function _fetchDataset(){return(_fetchDataset=Object(b.a)(c.a.mark(function _callee2(e,t){var i,s,n,o,a,l,h,d,u;return c.a.wrap(function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return n=t.id,o=t.type,e.commit("resetDataset"),e.commit("setFetchingState"),a=Object(E.a)(e.rootState),l="dataset"===o?A:I,h=w()(i=w()(s="".concat(a,"/")).call(s,l,"/")).call(i,n,"?geom_in_summary=false&only_products=true"),c.prev=6,c.next=9,fetch(h);case 9:return d=c.sent,c.next=12,d.json();case 12:u=c.sent,e.commit("setDataset",Object(r.a)({},u)),c.next=19;break;case 16:c.prev=16,c.t0=c.catch(6),console.error("ERROR: ".concat(c.t0));case 19:case"end":return c.stop()}},_callee2,null,[[6,16]])}))).apply(this,arguments)}function fetchKeyVariables(e,t){return _fetchKeyVariables.apply(this,arguments)}function _fetchKeyVariables(){return(_fetchKeyVariables=Object(b.a)(c.a.mark(function _callee3(e,t){var i,s,n,o,a,r,l,h,d;return c.a.wrap(function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return n=t.id,o=t.type,a=Object(E.a)(e.rootState),r="dataset"===o?A:I,l=w()(i=w()(s="".concat(a,"/")).call(s,r,"/")).call(i,n,"/key_variables"),c.prev=4,c.next=7,fetch(l);case 7:return h=c.sent,c.next=10,h.json();case 10:d=c.sent,e.commit("setKeyVariables",d),c.next=17;break;case 14:c.prev=14,c.t0=c.catch(4),console.error("ERROR: ".concat(c.t0));case 17:case"end":return c.stop()}},_callee3,null,[[4,14]])}))).apply(this,arguments)}function fetchVariables(e,t){return _fetchVariables.apply(this,arguments)}function _fetchVariables(){return(_fetchVariables=Object(b.a)(c.a.mark(function _callee4(e,t){var i,s,n,o,a,r,l,h,d;return c.a.wrap(function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return n=t.id,o=t.type,a=Object(E.a)(e.rootState),r="dataset"===o?A:I,l=w()(i=w()(s="".concat(a,"/")).call(s,r,"/")).call(i,n,"/variables?minimal=true"),c.prev=4,c.next=7,fetch(l);case 7:return h=c.sent,c.next=10,h.json();case 10:d=c.sent,e.commit("setVariables",d),c.next=17;break;case 14:c.prev=14,c.t0=c.catch(4),console.error("ERROR: ".concat(c.t0));case 17:case"end":return c.stop()}},_callee4,null,[[4,14]])}))).apply(this,arguments)}function setSearchText(e,t){e.commit("setSearchText",t)}function setPage(e,t){e.commit("setPage",t)}function clearTagFilters(e){e.commit("resetTagFilters")}function requestExtendedLicense(e,t){return _requestExtendedLicense.apply(this,arguments)}function _requestExtendedLicense(){return(_requestExtendedLicense=Object(b.a)(c.a.mark(function _callee5(e,t){return c.a.wrap(function _callee5$(i){for(;;)switch(i.prev=i.next){case 0:requestAccess(e,{subscriptionId:t,requestedPlatformProperty:"full_access_status_bq"});case 1:case"end":return i.stop()}},_callee5)}))).apply(this,arguments)}function requestAccess(e,t){return _requestAccess.apply(this,arguments)}function _requestAccess(){return(_requestAccess=Object(b.a)(c.a.mark(function _callee6(e,t){var i,s,n,o,a,r,l,h,d,u,p,g;return c.a.wrap(function _callee6$(c){for(;;)switch(c.prev=c.next){case 0:if(i=t.subscriptionId,s=t.requestedPlatformProperty,e.rootState.user){c.next=3;break}return c.abrupt("return");case 3:return c.prev=3,l=Object(E.a)(e.rootState),h=e.rootState.user.api_key,d="".concat(s,"=requested"),u=w()(n=w()(o=w()(a=w()(r="".concat(l,"/")).call(r,z,"/")).call(a,i,"?api_key=")).call(o,h,"&")).call(n,d),c.next=10,fetch(u,{method:"PUT",headers:{Accept:"application/json","content-type":"application/json"}});case 10:return p=c.sent,c.next=13,p.json();case 13:g=c.sent,e.state.currentSubscription=g,c.next=20;break;case 17:c.prev=17,c.t0=c.catch(3),e.state.requestError=c.t0.message;case 20:case"end":return c.stop()}},_callee6,null,[[3,17]])}))).apply(this,arguments)}function requestAccessHubspot(e,t){var i,s=t.dataset,n=t.platform,o=t.type,a=[w()(i="submissions/v3/integration/submit/".concat("474999","/")).call(i,"507ead6f-06d9-434a-95e1-a9616c576796")],r={data:function prepareAccessDataToHubspot(e,t,i,s){var n;return f()({fields:w()(n=[]).call(n,Object(g.a)(prepareUserToHubspotFields(e)),Object(g.a)(prepareDatasetToHubspot(t)),[{name:"data_request_type",value:s},{name:"data_cloud_access",value:i}]),context:{pageUri:"www.carto.com/dashboard/datasets/subscriptions",pageName:"Subscriptions page in Dashboard"}})}(e.rootState.user,s,n,o),baseUrl:"https://api.hsforms.com"};return new v.a(function(t,i){e.rootState.client.post([a],r,function(e){t(!e)})})}function fetchSubscriptionsList(e){return _fetchSubscriptionsList.apply(this,arguments)}function _fetchSubscriptionsList(){return(_fetchSubscriptionsList=Object(b.a)(c.a.mark(function _callee7(e){var t,i,s,n,o,l,h,d,u,p,g=arguments;return c.a.wrap(function _callee7$(c){for(;;)switch(c.prev=c.next){case 0:if(s=g.length>1&&void 0!==g[1]&&g[1],e.rootState.user){c.next=3;break}return c.abrupt("return");case 3:return n=Object(E.a)(e.rootState),o=e.rootState.user.api_key,l=w()(t=w()(i="".concat(n,"/")).call(i,z,"?api_key=")).call(t,o),c.prev=6,c.next=9,fetch(l);case 9:return h=c.sent,c.next=12,h.json();case 12:d=c.sent,s?(p=S()(u=e.state.subscriptionsList).call(u,function(e){var t;return Object(r.a)({},e,{},a()(t=d.subscriptions).call(t,function(t){return t.id===e.id}))}),e.commit("setSubscriptionsList",p||[])):e.commit("setSubscriptionsList",d.subscriptions||[]),c.next=19;break;case 16:c.prev=16,c.t0=c.catch(6),console.error("ERROR: ".concat(c.t0));case 19:case"end":return c.stop()}},_callee7,null,[[6,16]])}))).apply(this,arguments)}function fetchSubscriptionsDetailsList(e,t){return _fetchSubscriptionsDetailsList.apply(this,arguments)}function _fetchSubscriptionsDetailsList(){return(_fetchSubscriptionsDetailsList=Object(b.a)(c.a.mark(function _callee8(e,t){var i,s,o,l,h,d,u,p,g,m;return c.a.wrap(function _callee8$(c){for(;;)switch(c.prev=c.next){case 0:return s=Object(E.a)(e.rootState),o=S()(i=chunkArray(t,100)).call(i,function(e){return S()(e).call(e,function(e){return"id=".concat(e)}).join("&")}),l=S()(o).call(o,function(e){var t,i;return w()(t=w()(i="".concat(s,"/")).call(i,V,"?filter_catalog=false&")).call(t,e)}),c.prev=3,c.next=6,v.a.all(S()(l).call(l,function(e){return fetch(e)}));case 6:return u=c.sent,c.next=9,v.a.all(S()(u).call(u,function(e){return e.json()}));case 9:p=c.sent,g=n()(h=S()(p).call(p,function(e){return e.results})).call(h,1),m=S()(d=e.state.subscriptionsList).call(d,function(e){return Object(r.a)({},e,{},a()(g).call(g,function(t){return t.id===e.id}))}),e.commit("setSubscriptionsList",m),c.next=18;break;case 15:c.prev=15,c.t0=c.catch(3),console.error("ERROR: ".concat(c.t0));case 18:case"end":return c.stop()}},_callee8,null,[[3,15]])}))).apply(this,arguments)}function performSubscribe(e,t){return _performSubscribe.apply(this,arguments)}function _performSubscribe(){return(_performSubscribe=Object(b.a)(c.a.mark(function _callee9(e,t){var i,s,n,o,a,r,l,h,d,u;return c.a.wrap(function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:if(a=t.id,r=t.type,e.rootState.user){c.next=3;break}return c.abrupt("return");case 3:return l=Object(E.a)(e.rootState),h=e.rootState.user.api_key,d=w()(i=w()(s=w()(n=w()(o="".concat(l,"/")).call(o,z,"?id=")).call(n,a,"&type=")).call(s,r,"&api_key=")).call(i,h),c.prev=6,c.next=9,fetch(d,{method:"POST"});case 9:return u=c.sent,c.abrupt("return",200===u.status||204===u.status);case 13:return c.prev=13,c.t0=c.catch(6),c.abrupt("return",!1);case 16:case"end":return c.stop()}},_callee9,null,[[6,13]])}))).apply(this,arguments)}function performUnsubscribe(e,t){return _performUnsubscribe.apply(this,arguments)}function _performUnsubscribe(){return(_performUnsubscribe=Object(b.a)(c.a.mark(function _callee10(e,t){var i,s,n,o,a,r,l,h,d,u;return c.a.wrap(function _callee10$(c){for(;;)switch(c.prev=c.next){case 0:if(a=t.id,r=t.type,e.rootState.user){c.next=3;break}return c.abrupt("return");case 3:return l=Object(E.a)(e.rootState),h=e.rootState.user.api_key,d=w()(i=w()(s=w()(n=w()(o="".concat(l,"/")).call(o,z,"?id=")).call(n,a,"&type=")).call(s,r,"&api_key=")).call(i,h),c.prev=6,c.next=9,fetch(d,{method:"DELETE"});case 9:return u=c.sent,c.abrupt("return",200===u.status||204===u.status);case 13:return c.prev=13,c.t0=c.catch(6),c.abrupt("return",!1);case 16:case"end":return c.stop()}},_callee10,null,[[6,13]])}))).apply(this,arguments)}function performSubscriptionSync(e,t){return _performSubscriptionSync.apply(this,arguments)}function _performSubscriptionSync(){return(_performSubscriptionSync=Object(b.a)(c.a.mark(function _callee11(e,t){var i,s,n,o,a,r,l;return c.a.wrap(function _callee11$(c){for(;;)switch(c.prev=c.next){case 0:if(e.rootState.user){c.next=2;break}return c.abrupt("return");case 2:return o=Object(E.a)(e.rootState),a=e.rootState.user.api_key,r=w()(i=w()(s=w()(n="".concat(o,"/")).call(n,z,"/")).call(s,t,"/sync/?api_key=")).call(i,a),c.prev=5,c.next=8,fetch(r,{method:"POST"});case 8:return l=c.sent,c.abrupt("return",200===l.status||204===l.status);case 12:return c.prev=12,c.t0=c.catch(5),c.abrupt("return",!1);case 15:case"end":return c.stop()}},_callee11,null,[[5,12]])}))).apply(this,arguments)}function performSubscriptionUnsync(e,t){return _performSubscriptionUnsync.apply(this,arguments)}function _performSubscriptionUnsync(){return(_performSubscriptionUnsync=Object(b.a)(c.a.mark(function _callee12(e,t){var i,s,n,o,a,r,l;return c.a.wrap(function _callee12$(c){for(;;)switch(c.prev=c.next){case 0:if(e.rootState.user){c.next=2;break}return c.abrupt("return");case 2:return o=Object(E.a)(e.rootState),a=e.rootState.user.api_key,r=w()(i=w()(s=w()(n="".concat(o,"/")).call(n,z,"/")).call(s,t,"/sync/?api_key=")).call(i,a),c.prev=5,c.next=8,fetch(r,{method:"DELETE"});case 8:return l=c.sent,c.abrupt("return",200===l.status||204===l.status);case 12:return c.prev=12,c.t0=c.catch(5),c.abrupt("return",!1);case 15:case"end":return c.stop()}},_callee12,null,[[5,12]])}))).apply(this,arguments)}function connectSubscriptionSample(e,t){return _connectSubscriptionSample.apply(this,arguments)}function _connectSubscriptionSample(){return(_connectSubscriptionSample=Object(b.a)(c.a.mark(function _callee13(e,t){var i,s,n,o,a,r,l;return c.a.wrap(function _callee13$(c){for(;;)switch(c.prev=c.next){case 0:if(e.rootState.user){c.next=2;break}return c.abrupt("return");case 2:return o=Object(E.a)(e.rootState),a=e.rootState.user.api_key,r=w()(i=w()(s=w()(n="".concat(o,"/")).call(n,z,"/")).call(s,t,"/sample/?api_key=")).call(i,a),c.prev=5,c.next=8,fetch(r,{method:"POST"});case 8:return l=c.sent,c.abrupt("return",200===l.status||204===l.status);case 12:return c.prev=12,c.t0=c.catch(5),c.abrupt("return",!1);case 15:case"end":return c.stop()}},_callee13,null,[[5,12]])}))).apply(this,arguments)}function downloadNotebook(e,t){return _downloadNotebook.apply(this,arguments)}function _downloadNotebook(){return(_downloadNotebook=Object(b.a)(c.a.mark(function _callee14(e,t){var i,s,n,o,a,r,l,h;return c.a.wrap(function _callee14$(c){for(;;)switch(c.prev=c.next){case 0:if(n=t.id,o=t.type,e.rootState.user){c.next=3;break}return c.abrupt("return");case 3:a=["id=".concat(n),"type=".concat(o),"api_key=".concat(e.rootState.user.api_key),"username=".concat(e.rootState.user.username)],r=Object(E.a)(e.rootState),l=w()(i=w()(s="".concat(r,"/")).call(s,B,"?")).call(i,a.join("&")),(h=document.createElement("a")).href=l,h.click();case 9:case"end":return c.stop()}},_callee14)}))).apply(this,arguments)}function requestDataset(e,t){var i,s=t.user,n=t.dataset,o=t.requestStatus,a=[w()(i="submissions/v3/integration/submit/".concat("474999","/")).call(i,"507ead6f-06d9-434a-95e1-a9616c576796")],r={data:function getFormData(e,t,i){var s;return f()({fields:w()(s=[]).call(s,Object(g.a)(prepareUserToHubspotFields(e)),Object(g.a)(prepareDatasetToHubspot(t)),[{name:"datastream_request_status",value:i||"active"}]),skipValidation:!0,context:{pageUri:"www.carto.com/dashboard/spatial-data-catalog",pageName:"Spatial Data Catalog page in Dashboard"}})}(s,n,o),baseUrl:"https://api.hsforms.com"};return new v.a(function(t,i){e.rootState.client.post([a],r,function(e){t(!e)})})}function sendMetrics(e,t){return _sendMetrics.apply(this,arguments)}function _sendMetrics(){return(_sendMetrics=Object(b.a)(c.a.mark(function _callee15(e,t){var i,s,n,o,a,r,l,h,d;return c.a.wrap(function _callee15$(c){for(;;)switch(c.prev=c.next){case 0:return s=t.name,n=t.datasetId,o=t.platform,a=t.licenseType,r=Object(E.b)(e.rootState),l=e.rootState.user.api_key,h=w()(i="".concat(r,"?api_key=")).call(i,l),d={name:s,properties:{user_id:e.rootState.user.id,dataset_id:n,db_type:o,license_type:a}},c.prev=5,c.next=8,fetch(h,{method:"POST",headers:{"content-type":"application/json"},body:f()(d)});case 8:c.next=13;break;case 10:c.prev=10,c.t0=c.catch(5),console.error(c.t0);case 13:case"end":return c.stop()}},_callee15,null,[[5,10]])}))).apply(this,arguments)}function sendAccessAttemptMetrics(e,t){return _sendAccessAttemptMetrics.apply(this,arguments)}function _sendAccessAttemptMetrics(){return(_sendAccessAttemptMetrics=Object(b.a)(c.a.mark(function _callee16(e,t){var i,s,n;return c.a.wrap(function _callee16$(o){for(;;)switch(o.prev=o.next){case 0:i=t.datasetId,s=t.platform,n=t.licenseType,sendMetrics(e,{name:"do_full_access_attempt",datasetId:i,platform:s,licenseType:n});case 2:case"end":return o.stop()}},_callee16)}))).apply(this,arguments)}function sendRequestExtendedMetrics(e,t){return _sendRequestExtendedMetrics.apply(this,arguments)}function _sendRequestExtendedMetrics(){return(_sendRequestExtendedMetrics=Object(b.a)(c.a.mark(function _callee17(e,t){var i,s;return c.a.wrap(function _callee17$(n){for(;;)switch(n.prev=n.next){case 0:i=t.datasetId,s=t.licenseType,sendMetrics(e,{name:"do_full_access_request",datasetId:i,platform:"bq",licenseType:s});case 2:case"end":return n.stop()}},_callee17)}))).apply(this,arguments)}function sendRequestAccessMetrics(e,t){return _sendRequestAccessMetrics.apply(this,arguments)}function _sendRequestAccessMetrics(){return(_sendRequestAccessMetrics=Object(b.a)(c.a.mark(function _callee18(e,t){var i,s,n;return c.a.wrap(function _callee18$(o){for(;;)switch(o.prev=o.next){case 0:i=t.datasetId,s=t.platform,n=t.licenseType,sendMetrics(e,{name:"do_full_access_request",datasetId:i,platform:s,licenseType:n});case 2:case"end":return o.stop()}},_callee18)}))).apply(this,arguments)}function filtersToPayload(e){var t=[],i=e.searchText,s=e.limit,n=e.page,o=e.categories,a=n*s,r=function _loop(e){var i;o[e].length&&(t=w()(t).call(t,S()(i=o[e]).call(i,function(t){var i;return w()(i="".concat(e,"=")).call(i,t.id)})))};for(var l in o)r(l);return i&&t.push("searchtext=".concat(encodeURIComponent(i))),t.push("limit=".concat(s)),t.push("offset=".concat(a)),t.push("filter_catalog=true"),t.join("&")}function prepareUserToHubspotFields(e){return[{name:"email",value:e.email},{name:"lastname",value:e.last_name||"no_last_name"},{name:"firstname",value:e.name||"no_firstname"},{name:"jobtitle",value:e.job_role||"no_jobtitle"},{name:"company",value:e.company||(e.organization?e.organization.display_name||e.organization.name:"no_company")},{name:"phone",value:e.phone||"no_phone"}]}function prepareDatasetToHubspot(e){return[{name:"country_data",value:e.country_name||""},{name:"data_category",value:e.category_name||"Geography"},{name:"datastream_name",value:e.data_source_name||""},{name:"provider",value:e.provider_name||""},{name:"datastream_license",value:e.license_name||""},{name:"data_purpose",value:"no_data_purpose"}]}function chunkArray(e,t){for(var i=[],s=0;s<e.length;s+=t){var n=p()(e).call(e,s,s+t);i.push(n)}return i}}).call(this,i(162))},1676:function(e,t,i){i(37),i(34),i(23),i(88),i(101);var s=i(44),n=i(61),o=i(13),a=i(1091).default,r=i(7),l=i(636).default,c=i(635).default,h=i(18);window.StaticConfig=window.StaticConfig||{};var d=function(){"use strict";function PublicClient(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";l(this,PublicClient),this.apiURI=e}return c(PublicClient,[{key:"get",value:function get(){for(var e,t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return this.request.apply(this,r(e=["get"]).call(e,i))}},{key:"put",value:function put(){for(var e,t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return this.request.apply(this,r(e=["put"]).call(e,i))}},{key:"post",value:function post(){for(var e,t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return this.request.apply(this,r(e=["post"]).call(e,i))}},{key:"delete",value:function _delete(){for(var e,t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return this.request.apply(this,r(e=["delete"]).call(e,i))}},{key:"addHeaders",value:function addHeaders(e,t){return a({},e.headers,t)}},{key:"paramsToURI",value:function paramsToURI(e){var t;return this.checkParams(e)?"?".concat(o(t=n(e)).call(t,function(t){var i;return r(i="".concat(encodeURIComponent(t),"=")).call(i,encodeURIComponent(e[t]))}).join("&")):""}},{key:"checkParams",value:function checkParams(e){return e&&"[object Object]"===Object.prototype.toString.call(e)&&n(e).length}},{key:"makeRelativeURI",value:function makeRelativeURI(e){return"/".concat(e.join("/"))}},{key:"makeAbsoluteURI",value:function makeAbsoluteURI(e){var t;return r(t="".concat(this.apiURI)).call(t,e)}},{key:"successCallback",value:function successCallback(e){return function(t,i,n){try{t=JSON.parse(s(t))}catch(e){t=null}e(null,i,t)}}},{key:"errorCallback",value:function errorCallback(e){return function(t,i,s){var n=s||new Error("Failed to fetch");e(n,i,t)}}},{key:"getAssetsBaseUrl",value:function getAssetsBaseUrl(){var e,t,i=window.location,s=i.host,n=i.protocol,o=window.location.href.match(/(\/(u|user)\/[a-z0-9\-]+)\//),a=o&&o[1]||"";return window.StaticConfig.baseUrl||r(e=r(t="".concat(n,"//")).call(t,s)).call(e,a)}},{key:"request",value:function request(e,t){var i,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;n||"function"!=typeof s||(n=s,s={});var o=!s.doNoSetDefaultContentType&&"application/json; charset=utf-8";a(s,{contentType:o,method:e.toUpperCase()}),this.addHeaders(s);var l=s.baseUrl||this.getAssetsBaseUrl(),c=0!==t.length?this.makeAbsoluteURI(this.makeRelativeURI(t)):"",d=a({},s,{success:this.successCallback(n),error:this.errorCallback(n)});h.ajax(r(i="".concat(l)).call(i,c),d)}}]),PublicClient}();e.exports=d},1696:function(e,t,i){var s=i(1507);e.exports=s.extend({_onImportsStateChange:function _onImportsStateChange(e){this._shouldRedirect(e)?this._redirectTo(e.getRedirectUrl(this._userModel)):e.hasCompleted()&&this.trigger("importCompleted",e,this)},_shouldRedirect:function _shouldRedirect(e){return e.hasCompleted()&&this.importsCollection.allImportsCompletedOrFailed()&&1===this.importsCollection.getCompletedItemsCount()&&!e.isTwitterImport()&&e.getRedirectUrl(this._userModel)&&(1===e.getNumberOfTablesCreated()||e.isCartoImport())},_redirectTo:function _redirectTo(e){window.location=e}})},1697:function(e,t,i){var s=i(6),n=i(667),o=i(14),a=["configModel"];e.exports=s.Collection.extend({model:function model(e,t){var i=t.collection;return new n(e,{collection:i,configModel:i._configModel})},initialize:function initialize(e,t){o(t,a,this),this.organization=t.organization}})},170:function(e,t,i){var s=i(56),n=i(1),o=i(4);e.exports={createByHTML:function createByHTML(e,t){var i=new o(t);return i.render=function(){return this.$el.html(e),this},i},createByTemplate:function createByTemplate(e,t,i){var s=new o(i);return s.render=function(){return this.$el.html(e(t)),this},s},createListView:function createListView(e,t){if(!e||!s(e))throw new Error("createViewFns is required as an iterable list");if(!n.all(e,n.isFunction))throw new Error("createViewFns must only contain functions");var i=new o(t);return i.render=function(){return this.clearSubViews(),s(e).call(e,function(e){var t=e();this.addView(t),this.$el.append(t.render().el)},this),this},i}}},1703:function(e,t){e.exports={uploadStates:["enqueued","pending","importing","uploading","guessing","unpacking","getting","creating","complete"],fileExtensions:["csv","xls","xlsx","zip","kml","geojson","json","ods","kmz","tsv","gpx","tar","gz","tgz","osm","bz2","tif","tiff","txt","sql","rar","carto","gpkg"],fileTimesBigger:3}},174:function(e,t){e.exports={Size:{MARKER_MIN:7,IMAGE_MIN:20,DEFAULT:{min:1,max:45,step:.5},DefaultInput100:{MIN:0,MAX:100,STEP:1},DEFAULT_RANGE:[5,20]},Panes:{FIXED:"fixed",BY_VALUE:"value",FILE:"file"},Tabs:{BINS:"bins",QUANTIFICATION:"quantification"},Quantification:{REFERENCE:{Jenks:"jenks","Equal Interval":"equal","Heads/Tails":"headtails",Quantile:"quantiles"}},Settings:{COLOR:{quantifications:{items:["jenks","equal","headtails","quantiles","category"],defaultIndex:0}},COLOR_RAMPS:{quantifications:{items:["quantiles","jenks","equal","headtails","category"],defaultIndex:0},bins:{items:["2","3","4","5","6","7"],defaultIndex:3}},NUMBER:{quantifications:{items:["quantiles","jenks","equal","headtails"],defaultIndex:0},bins:{items:["2","3","4","5","6","7"],defaultIndex:3}}}}},176:function(e,t,i){"use strict";i.d(t,"h",function(){return setCurrentAccessPlatform}),i.d(t,"i",function(){return setCurrentSubscription}),i.d(t,"m",function(){return setFetchingState}),i.d(t,"k",function(){return setDatasetsList}),i.d(t,"j",function(){return setDataset}),i.d(t,"o",function(){return setKeyVariables}),i.d(t,"u",function(){return setVariables}),i.d(t,"g",function(){return setAvailableFilters}),i.d(t,"n",function(){return setFilter}),i.d(t,"b",function(){return removeFilter}),i.d(t,"r",function(){return setSearchText}),i.d(t,"p",function(){return setPage}),i.d(t,"l",function(){return setDatasetsListCount}),i.d(t,"f",function(){return resetTagFilters}),i.d(t,"d",function(){return resetDatasetsList}),i.d(t,"c",function(){return resetDataset}),i.d(t,"t",function(){return setSubscriptionsList}),i.d(t,"s",function(){return setSubscriptionInfo}),i.d(t,"q",function(){return setRequestError}),i.d(t,"e",function(){return resetSubscriptionsList}),i.d(t,"a",function(){return addInterestedSubscriptions});var s=i(52),n=i(25),o=i.n(n),a=i(91),r=i(12),l=i(190),c=i.n(l),h=i(41),d=i.n(h),u=i(469);function setCurrentAccessPlatform(e,t){e.currentAccessPlatform=t}function setCurrentSubscription(e,t){e.currentSubscription=t}function setFetchingState(e){e.isFetching=!0,e.hasError=!1}function setDatasetsList(e,t){e.datasetsList=t,e.isFetching=!1,e.hasError=!1}function setDataset(e,t){e.dataset=t,e.isFetching=!1,e.hasError=!1}function setKeyVariables(e,t){e.keyVariables=t,e.hasError=!1}function setVariables(e,t){e.variables=t,e.hasError=!1}function setAvailableFilters(e,t){var i=t.id,s=t.options,n={glo:!0},l=d()(s).call(s,function(e,t){return t.highlighted=n[t.id]||!1,e.set(t.id,t),e},new c.a);e.filtersAvailable=Object(r.a)({},e.filtersAvailable,Object(a.a)({},i,l)),o()(e).categories[i]||(o()(e).categories[i]=[])}function setFilter(e,t){var i=Object(s.a)(Object(r.a)({},o()(e).categories),t);o()(e).categories=i,t.page||(o()(e).page=0),Object(u.a)(e)}function removeFilter(e,t){var i;o()(e).categories[t.id]=o()(i=o()(e).categories[t.id]).call(i,function(e){return e.id!==t.value.id}),o()(e).page=0,Object(u.a)(e)}function setSearchText(e,t){o()(e).searchText=t,Object(u.a)(e)}function setPage(e,t){o()(e).page=t,Object(u.a)(e)}function setDatasetsListCount(e,t){e.datasetsListCount=t}function resetTagFilters(e){for(var t in o()(e).categories)o()(e).categories[t]=[];o()(e).page=0,Object(u.a)(e)}function resetDatasetsList(e){e.datasetsList=[],e.datasetsListCount=0}function resetDataset(e){e.dataset={},e.keyVariables={},e.variables={}}function setSubscriptionsList(e,t){e.subscriptionsList=t}function setSubscriptionInfo(e,t){e.subscriptionInfo=t}function setRequestError(e,t){e.requestError=t}function resetSubscriptionsList(e){e.subscriptionsList=[]}function addInterestedSubscriptions(e,t){e.interestedSubscriptions.push(t),localStorage.setItem("interestedSubscriptions",e.interestedSubscriptions)}},179:function(e,t,i){var s=i(38),n=i(7),o=i(1),a=i(6),r=i(2897),l=i(2896);e.exports=a.Model.extend({create:function create(e,t){if(!o.isFunction(e))throw new Error("createContentView is required");return this._modalView||(this.trigger("willCreateModal"),this._modalView=this._newModalView(t),this.trigger("didCreateModal",this._modalView),document.body.appendChild(this._modalView.el)),this._modalView.model.set("createContentView",e),this._modalView.render(),this._modalView},onDestroyOnce:function onDestroyOnce(e,t){this.once("destroyedModal",e,t)},destroy:function destroy(){this._modalView&&this._modalView.model.destroy()},keepOpenOnRouteChange:function keepOpenOnRouteChange(){return this._modalView&&this._modalView.keepOpenOnRouteChange()},_newModalView:function _newModalView(e){var t=new l({keepOpenOnRouteChange:e&&e.keepOpenOnRouteChange});this._handleBodyClass(t);var i=e&&e.escapeOptionsDisabled,o=e&&e.breadcrumbsEnabled;return i||this._destroyOnEsc(t),this.listenToOnce(t,"destroy",function(){var e;this._modalView=null,this.trigger.apply(this,n(e=["destroyedModal"]).call(e,s(Array.prototype).call(arguments))),this.stopListening(t)}),new r({model:t,escapeOptionsDisabled:i,breadcrumbsEnabled:o})},_destroyOnEsc:function _destroyOnEsc(e){var t=function destroyOnEsc(t){27===t.keyCode&&(t.stopPropagation(),e.destroy())};document.addEventListener("keydown",t),this.listenToOnce(e,"destroy",function(){document.removeEventListener("keydown",t)})},_handleBodyClass:function _handleBodyClass(e){document.body.classList.add("is-inDialog"),this.set("open",!0),this.listenTo(e,"change:show",function(e,t){document.body.classList[t?"add":"remove"]("is-inDialog"),this.set("open",t)}),this.listenToOnce(e,"destroy",function(){document.body.classList.remove("is-inDialog"),this.set("open",!1)})},isOpen:function isOpen(){return!0===this.get("open")}})},1844:function(e,t,i){i(269),i(268),i(35);var s=i(924);e.exports=function(e){if(!e.visDefinitionModel)throw new Error("visDefinitionModel is required");if(!e.name)throw new Error("name is required");var t=e.visDefinitionModel,i=e.onSuccess,n=e.onError,o=e.name,a=e.description,r=e.tags,l=e.source,c=e.license,h=e.attributions,d=t.get("name");t.save({name:o,description:a,tags:r,source:l,license:c,attributions:h},{wait:!0,success:function success(e,t){document.title=o+s,i&&i()},error:function error(e,t){document.title=d+s,n&&n(t)}})}},1845:function(e,t,i){i(35);var s=i(7),n=i(13),o=i(1),a=i(6),r=i(4),l=i(1222);i(242);var c=i(58),h=i(59),d=["visDefinitionModel","visMetadataModel","configModel"];e.exports=r.extend({className:"Metadata-form",initialize:function initialize(e){if(o.each(d,function(t){if(!e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this),void 0===e.isLocked)throw new TypeError("isLocked is required");this._isLocked=e.isLocked},render:function render(){return this.clearSubViews(),this.$el.html(l()),this._initViews(),this},_initViews:function _initViews(){this._addNameView(),this._addDescriptionView(),this._addSourceView(),this._addAttributionView(),this._addLicenseView(),this._addTagsView(),this._addTooltip()},_addInputView:function _addInputView(e,t,i,s,n){var o="_"+t,r=new a.Form.editors.Text({key:e,model:this._visMetadataModel,schema:{options:this._visDefinitionModel.get(e),editorAttrs:{placeholder:i,disabled:n||!1}}});r.on("change",this._commitView,this),this[o]=r,s.append(r.render().$el)},_addNameView:function _addNameView(){this._addInputView("name","nameInput",_t("components.modals.dataset-metadata.form.name-placeholder"),this.$(".js-name-field"),this._isLocked)},_addSourceView:function _addSourceView(){this._addInputView("source","sourceInput",_t("components.modals.dataset-metadata.form.source-placeholder"),this.$(".js-source-field"))},_addAttributionView:function _addAttributionView(){this._addInputView("attributions","attributionInput",_t("components.modals.dataset-metadata.form.attributions-placeholder"),this.$(".js-attributions-field"))},_buildLicenseOptions:function _buildLicenseOptions(){var e,t=this._configModel.get("licenses"),i=[{id:"",name:"-"}];return n(e=o.chain(s(i).call(i,t)).compact()).call(e,function(e){return{val:e.id,label:e.name}}).value()},_addLicenseView:function _addLicenseView(){var e=this._buildLicenseOptions();this._selectView=new a.Form.editors.Select({className:"u-flex u-alignCenter",key:"license",schema:{options:e},model:this._visMetadataModel,showSearch:!1}),this._selectView.on("change",this._commitView,this),this._selectView.setValue(this._visMetadataModel.get("license")||0),this.$(".js-license-field").append(this._selectView.render().$el)},_addDescriptionView:function _addDescriptionView(){this._descriptionView=new a.Form.editors.TextArea({className:"CDB-Textarea Metadata-textarea",key:"description",model:this._visMetadataModel,schema:{options:this._visDefinitionModel.get("description"),editorAttrs:{placeholder:_t("components.modals.dataset-metadata.form.description-placeholder")}}}),this._descriptionView.on("change",this._commitView,this),this.$(".js-description-field").append(this._descriptionView.render().$el)},_addTagsView:function _addTagsView(){this._taglistView=new a.Form.editors.Taglist({key:"tags",model:this._visMetadataModel,schema:{options:{tags:this._visDefinitionModel.get("tags")||[]}}}),this._taglistView.on("change",this._commitView,this),this.$(".js-tags-field").append(this._taglistView.render().$el),this.addView(this._taglistView)},_addTooltip:function _addTooltip(){var e=this.$(".js-markdown").data("tooltip");this._removeTooltip(),this._tooltip=new c({el:this.$(".js-markdown"),html:!0,title:function title(){return e}})},_commitView:function _commitView(e){e.commit(),e.model.changed.hasOwnProperty("name")&&this._sanitizeName(e.model.get("name"))},_sanitizeName:function _sanitizeName(e){this._visMetadataModel.set("name",h.sanitizeHtml(e))},_removeTooltip:function _removeTooltip(){this._tooltip&&this._tooltip.clean()},_removeBinds:function _removeBinds(){this._nameView&&this._nameView.off("change",this._commitView,this),this._descriptionView&&this._descriptionView.off("change",this._commitView,this),this._taglistView&&this._taglistView.off("change",this._commitView,this),this._sourceInput&&this._sourceInput.off("change",this._commitView,this),this._attributionView&&this._attributionView.off("change",this._commitView,this),this._selectView&&this._selectView.off("change",this._commitView,this)},clean:function clean(){this._removeBinds(),r.prototype.clean.call(this)}})},1846:function(e,t,i){var s=i(4),n=i(1224);e.exports=s.extend({tagName:"ul",className:"Modal-listActions u-flex u-alignCenter ",events:{"click .js-save":"_save","click .js-close":"_close"},initialize:function initialize(e){if(!e.visMetadataModel)throw new Error("visMetadataModel is required");if(!e.onSaveAction)throw new Error("onSaveAction is required");this._visMetadataModel=e.visMetadataModel,this._onSaveAction=e.onSaveAction,this._onCloseAction=e.onCloseAction,this._initBinds()},_initBinds:function _initBinds(){this._visMetadataModel.on("change",this.render,this)},render:function render(){return this.$el.html(n({canFinish:this._visMetadataModel.isValid()})),this},_save:function _save(){this._visMetadataModel.isValid()&&this._onSaveAction()},_close:function _close(){this._onCloseAction&&this._onCloseAction()}})},186:function(e,t,i){var s=i(7),n=i(1);e.exports={setOptions:function setOptions(e,t){var i=[];if(t.schema&&t.schema.validators&&(i=s(i).call(i,t.schema.validators)),e.options&&e.options.validators&&(i=s(i).call(i,e.options.validators)),e.validators=i,e.options=this._getEditorOptions(e,t,i),e.options.className&&e.$el.addClass(e.options.className),e.options.trackingClass){var n=e.options.trackingClass+" track-"+e.options.key+e.options.editorType;e.$el.addClass(n)}},_editorAttrsFromBackboneFormSchema:function _editorAttrsFromBackboneFormSchema(e){return e.schema&&e.schema.editorAttrs||{}},_getEditorOptions:function _getEditorOptions(e,t,i){var s=n.omit(e.options,"validators")||{},o=t.schema,a=this._editorAttrsFromBackboneFormSchema(t),r=t.editorAttrs,l={keyAttr:t.key},c={validators:i},h=n.omit(t,"validators");return n.extend({},s,o,a,r,l,c,h)}}},1863:function(e,t,i){var s=i(3);e.exports=function(e,t,i){var n=this;i||(i=e),s(t)&&s(t).call(t,e,function(){n.trigger(i)},this)}},1864:function(e,t,i){i(34),i(67);var s=i(360),n=i(3),o=i(1),a=i(18),r=i(6),l=i(14),c=["configModel"];e.exports=r.Model.extend({_X:1.2,_INTERVAL:1500,_STATES:["created","failure","success","syncing","queued"],defaults:{name:"",url:"",state:"",run_at:0,ran_at:0,retried_times:0,interval:0,error_code:0,error_message:"",service_name:"",service_item_id:"",content_guessing:!0,type_guessing:!0},url:function url(e){var t="/api/"+this._configModel.urlVersion("synchronization",e)+"/synchronizations/";return this.isNew()?t:t+this.id},initialize:function initialize(e){var t;l(e,c,this),n(t=this).call(t,"destroy",function(){this.unset("id")})},toJSON:function toJSON(){var e=o.clone(this.attributes),t={url:e.url,interval:e.interval,content_guessing:e.content_guessing,type_guessing:e.type_guessing,create_vis:e.create_vis};return"remote"===e.type&&o.extend(t,{remote_visualization_id:e.remote_visualization_id,create_vis:!1,value:e.value}),void 0!==e.id&&(t.id=e.id),e.service_name&&(t.service_name=e.service_name,t.service_item_id=e.service_item_id),t},syncNow:function syncNow(e){a.ajax({url:this._configModel.prefixUrl()+this.url()+"/sync_now",type:"PUT"}).always(e)},pollCheck:function pollCheck(e){var t=this,i=this._INTERVAL;this.pollTimer=s(function request(){t.destroyCheck();t.fetch({error:function error(e,i){t.set({error_message:i.statusText||"",state:"failure"})}});i*=t._X;t.pollTimer=s(request,i)},i)},destroyCheck:function destroyCheck(){clearInterval(this.pollTimer)},isSync:function isSync(){return!this.isNew()},linkToTable:function linkToTable(e){var t=this;e.has("synchronization")&&this.set(e.get("synchronization")),n(e).call(e,"change:synchronization",function(){t.set(e.get("synchronization"))},e),n(e).call(e,"destroy",function destroy(){t.unbind(null,null,e),t.destroy()},e)}})},1865:function(e,t,i){i(34),i(67);var s=i(360),n=i(3),o=i(6);e.exports=o.Model.extend({idAttribute:"item_queue_id",urlRoot:"/api/v1/imports",initialize:function initialize(){var e;n(e=this).call(e,"change",this._checkFinish,this)},setUrlRoot:function setUrlRoot(e){this.urlRoot=e},pollCheck:function pollCheck(e){var t=this;this.pollTimer=s(function(){t.fetch({error:function error(e){t.trigger("change")}})},e||1500)},destroyCheck:function destroyCheck(){clearInterval(this.pollTimer)},_checkFinish:function _checkFinish(){!0===this.get("success")?(clearInterval(this.pollTimer),this.trigger("importComplete",this)):!1===this.get("success")?(clearInterval(this.pollTimer),this.trigger("importError",this)):this.trigger("importChange",this)}})},1866:function(e,t,i){i(35);var s=i(1),n=i(6),o=i(14),a=["configModel"];e.exports=n.Model.extend({idAttribute:"name",url:function url(e){var t=this._configModel.urlVersion("column",e),i=this.table||this.collection.table;i||console.error("column has no table assigned");var s="/api/"+t+"/tables/"+i.get("name")+"/columns/";return this.isNew()?s:s+this.id},initialize:function initialize(e){if(o(e,a,this),this.table=this.get("table"),!this.table)throw"you should specify a table model";this.unset("table",{silent:!0})},toJSON:function toJSON(){var e=s.clone(this.attributes);return e._name&&(e.name=e._name,delete e._name),e}})},1867:function(e,t,i){var s=i(3),n=i(6);e.exports=n.Collection.extend({fetched:!1,initialize:function initialize(){var e,t=this;s(e=this).call(e,"sync",function(){t.fetched=!0})},getCell:function getCell(e,t){var i=this.at(e);return i?i.get(t):null},isEmpty:function isEmpty(){return 0===this.length}})},1868:function(e,t,i){var s=i(470).extend({edit:function edit(){return this.urlToPath()},public:function _public(){return this.urlToPath("public")}});e.exports=s},1869:function(e,t,i){var s=i(470).extend({edit:function edit(){return this.urlToPath("map")},public:function _public(){return this.urlToPath("public_map")},deepInsights:function deepInsights(){return this.urlToPath("deep-insights")}});e.exports=s},1870:function(e,t,i){var s=i(6).Model.extend({defaults:{time:0}});e.exports=s},1871:function(e,t,i){var s=i(6);e.exports=s.Model.extend({url:function url(e){return this.visualization.url(e)+"/next_id"},initialize:function initialize(){this.visualization=this.get("visualization"),this.set("id",this.visualization.id),this.unset("visualization")}})},1872:function(e,t,i){var s=i(6).Model.extend({defaults:{visible:!0,type:"Tiled"}});e.exports=s},1873:function(e,t,i){var s=i(13),n=i(7),o=i(3),a=i(89),r=i(6),l=i(1872),c=i(14),h=["configModel"],d=r.Collection.extend({model:l,initialize:function initialize(e,t){var i,s;c(t,h,this),this.comparator=function(e){return a(e.get("order"),10)},o(i=this).call(i,"add",this._assignIndexes),o(s=this).call(s,"remove",this._assignIndexes)},url:function url(e){var t,i=this._configModel.urlVersion("layer",e);return n(t="/api/".concat(i,"/maps/")).call(t,s(this).id,"/layers")},parse:function parse(e){return e.layers},_assignIndexes:function _assignIndexes(e,t,i){if(this.size()>0&&(this.at(0).set({order:0}),this.size()>1)){for(var s={},n=1;n<this.size();++n){var o=this.at(n),a=o.get("type");s[a]=s[a]||[],s[a].push(o)}for(var r=0,l=["CartoDB","torque","Tiled"],c=0;c<l.length;++c)for(var h=s[l[c]]||[],d=0;d<h.length;++d){h[d].set({order:++r})}}}});e.exports=d},1874:function(e,t,i){i(341);var s=i(3),n=i(6),o=i(1873),a=i(14),r=["configModel"],l=n.Model.extend({urlRoot:"/api/v1/maps",initialize:function initialize(e){var t;a(e,r,this),s(t=this).call(t,"change:id",this._fetchLayers,this),this.layers=new o(null,{configModel:this._configModel}),this.layers.map=this},_fetchLayers:function _fetchLayers(){this.layers.fetch()}});e.exports=l},1875:function(e,t,i){var s=i(7),n=i(6),o=i(1),a=i(14),r=["config"],l=n.Model.extend({defaults:{likeable:!0},url:function url(e){var t,i,n=this._config.urlVersion("like",e);return s(t=s(i="".concat(this._config.get("base_url"),"/api/")).call(i,n,"/viz/")).call(t,this.get("vis_id"),"/like")},initialize:function initialize(e,t){a(t,r,this),o.bindAll(this,"_onSaveError"),this.on("destroy",function(){this.set({liked:!1,likes:this.get("likes")-1})},this)},_onSaveError:function _onSaveError(e,t){this.trigger("error",{status:t.status,statusText:t.statusText})},toggleLiked:function toggleLiked(){this.get("liked")?this.destroy():(this.set({id:null},{silent:!0}),this.save({},{error:this._onSaveError}))}},{newByVisData:function newByVisData(e){var t=o.defaults({id:e.liked?e.vis_id:null},o.omit(e,"url","config")),i=new l(t,{config:e.config});return e.url&&(i.url=e.url),i}});e.exports=l},1876:function(e,t,i){i(34),i(67);var s=i(3),n=i(1),o=i(18),a=i(6),r=i(193),l=i(14),c=["configModel"];e.exports=a.Collection.extend({model:r,initialize:function initialize(e,t){if(l(t,c,this),!t.group)throw new Error("group is required");this.group=t.group},url:function url(){return this.group.url.apply(this.group,arguments)+"/users"},parse:function parse(e){return this.total_entries=e.total_entries,this.total_user_entries=e.total_user_entries,e.users},addInBatch:function addInBatch(e,t){return this._batchAsyncProcessUsers("POST",e,t)},removeInBatch:function removeInBatch(e,t){var i=this;return this._batchAsyncProcessUsers("DELETE",e,t).done(function(){var t;n.each(e,s(t=i.remove).call(t,i))})},_batchAsyncProcessUsers:function _batchAsyncProcessUsers(e,t,i){var s=this,n=o.Deferred();return o.ajax({type:e,url:this._configModel.get("base_url")+this.url(),data:{users:t,password_confirmation:i},success:function success(){var e=arguments;s.fetch({success:function success(){n.resolve.apply(n,e)},error:function error(){n.resolve.apply(n,e)}})},error:function error(){n.reject.apply(n,arguments)}}),n},totalCount:function totalCount(){return this.total_user_entries}})},1877:function(e,t,i){var s=i(41),n=i(6),o=i(1),a=i(14),r=i(193),l=i(667),c=["configModel"];e.exports=n.Collection.extend({model:function model(e,t){var model,i=t.collection,s=i._configModel,n=i.organization;return model="user"===e.type?new r(e,{configModel:s,collection:i}):new l(e,{configModel:s,collection:i}),model.organization=n,model.entity=model,model},url:function url(e){return"/api/"+this._configModel.urlVersion("organizationGrantables",e)+"/organization/"+this.organization.id+"/grantables"},initialize:function initialize(e,t){if(a(t,c,this),!t.organization)throw new Error("organization is required");this.organization=t.organization,this.currentUserId=t.currentUserId,this.sync=i(1212)},parse:function parse(e){return this.total_entries=e.total_entries,s(o).call(o,e.grantables,function(e,t){return t.id===this.currentUserId?this.total_entries--:e.push(t),e},[],this)},totalCount:function totalCount(){return this.total_entries}})},1878:function(e,t,i){var s=i(41),n=i(1),o=i(6),a=i(193),r=i(14),l=["organization","configModel"];e.exports=o.Collection.extend({model:a,_DEFAULT_EXCLUDE_CURRENT_USER:!0,url:function url(){return"/api/v1/organization/"+this.organization.id+"/users"},initialize:function initialize(e,t){r(t,l,this),this.organization=this._organization,this.currentUserId=t.currentUserId,this._excludeCurrentUser=this._DEFAULT_EXCLUDE_CURRENT_USER},comparator:function comparator(e){return e.get("username")},excludeCurrentUser:function excludeCurrentUser(e){e=!!e,this._excludeCurrentUser=e,e&&!this.currentUserId&&console.error("set excludeCurrentUser to true, but there is no current user id set to exclude!")},restoreExcludeCurrentUser:function restoreExcludeCurrentUser(){this.excludeCurrentUser(this._DEFAULT_EXCLUDE_CURRENT_USER)},parse:function parse(e){return this.total_entries=e.total_entries,this.total_user_entries=e.total_user_entries,s(n).call(n,e.users,function(e,t){return this._excludeCurrentUser&&t.id===this.currentUserId?(this.total_user_entries--,this.total_entries--):e.push(t),e},[],this)},totalCount:function totalCount(){return this.total_user_entries}})},1879:function(e,t,i){var s=i(1214).extend({dataLibrary:function dataLibrary(){return this.urlToPath("library")}});e.exports=s},1880:function(e,t,i){var s=i(470),n=i(1214),o=i(1879),a=s.extend({datasets:function datasets(){return new o({base_url:this.urlToPath("datasets")})},maps:function maps(){return new n({base_url:this.urlToPath("maps")})},deepInsights:function deepInsights(){return new n({base_url:this.urlToPath("deep-insights")})}});e.exports=a},1881:function(e,t,i){var s=i(1),n=i(470),o=i(1880),a=i(1213),r=n.extend({initialize:function initialize(e){if(n.prototype.initialize.apply(this,arguments),s.isUndefined(e.is_org_admin))throw new Error("is_org_admin is required")},organization:function organization(){return this.get("is_org_admin")?new a({base_url:this.urlToPath("organization")}):this.urlToPath("account")},accountProfile:function accountProfile(){return this.urlToPath("profile")},accountSettings:function accountSettings(){return this.urlToPath("account")},publicProfile:function publicProfile(){return this.urlToPath("me")},apiKeys:function apiKeys(){return this.urlToPath("your_apps")},logout:function logout(){return this.urlToPath("logout")},dashboard:function dashboard(){return new o({base_url:this.urlToPath("dashboard")})},connectedApps:function connectedApps(){return new o({base_url:this.urlToPath("dashboard/app_permissions")})},connections:function connections(){return new o({base_url:this.urlToPath("dashboard/connections")})}});e.exports=r},193:function(e,t,i){i(255);var s=i(7),n=i(32),o=i(1),a=i(6),r=i(1881),l=a.Model.extend({urlRoot:"/api/v1/users",defaults:{avatar_url:"http://cartodb.s3.amazonaws.com/static/public_dashboard_default_avatar.png",username:""},initialize:function initialize(e,t){e=e||{},t=t||{},this.tables=[],null===this.get("avatar_url")&&this.set("avatar_url",this.defaults.avatar_url),this.email=void 0!==e.email?e.email:"",t.groups&&this.setGroups(t.groups),t.organization&&this.setOrganization(t.organization)},setGroups:function setGroups(e){this.groups=e},setOrganization:function setOrganization(e){this.organization=e,this.groups&&(this.groups.organization=e)},isInsideOrg:function isInsideOrg(){return!!this.organization&&(!1!==this.organization.id||this.isOrgOwner())},isAuthUsernamePasswordEnabled:function isAuthUsernamePasswordEnabled(){return!!this.organization&&this.organization.get("auth_username_password_enabled")},isOrgOwner:function isOrgOwner(){return!!this.organization&&this.organization.owner.get("id")===this.get("id")},isOrgAdmin:function isOrgAdmin(){return!!this.organization&&this.organization.isOrgAdmin(this)},isViewer:function isViewer(){return!0===this.get("viewer")},isBuilder:function isBuilder(){return!this.isViewer()},role:function role(){return this.get("role_display")},isDOEnabled:function isDOEnabled(){return this.get("do_enabled")},isEnterprise:function isEnterprise(){return this.get("is_enterprise")},isIndividualUser:function isIndividualUser(){var e=["Individual","Annual Individual"];return n(e).call(e,this.get("account_type"))>-1},isFree2020User:function isFree2020User(){var e;return-1!==n(e=this.get("account_type").toLowerCase()).call(e,"free 2020")},nameOrUsername:function nameOrUsername(){return this.fullName()||this.get("username")},fullName:function fullName(){var e=this.get("name")||"",t=this.get("last_name")||"";return e||t?e+(e&&t?" ":"")+t:""},renderData:function renderData(e){var t=this.get("username");return e&&e.id===this.id&&(t=_t("You")),{username:t,avatar_url:this.get("avatar_url")}},hasCreateDatasetsFeature:function hasCreateDatasetsFeature(){return this.isBuilder()},canCreateDatasets:function canCreateDatasets(){return!(!this.get("remaining_byte_quota")||this.get("remaining_byte_quota")<=0)&&this.hasCreateDatasetsFeature()},hasCreateMapsFeature:function hasCreateMapsFeature(){return this.isBuilder()},canAddLayerTo:function canAddLayerTo(e){if(!e||!e.layers||!e.layers.getDataLayers)throw new Error("Map model is not defined or wrong");return e.layers.getDataLayers().length<this.getMaxLayers()},getMaxLayers:function getMaxLayers(){return this.get("limits")&&this.get("limits").max_layers||5},hasPublicMapsLimits:function hasPublicMapsLimits(){return(this.isIndividualUser()||this.isFree2020User())&&!this.hasUnlimitedPublicMaps()},hasRemainingPublicMaps:function hasRemainingPublicMaps(){return!this.hasPublicMapsLimits()||this.get("public_map_quota")>this.getTotalPublicMapsCount()},hasUnlimitedPublicMaps:function hasUnlimitedPublicMaps(){return null===this.get("public_map_quota")},getTotalPublicMapsCount:function getTotalPublicMapsCount(){return(this.get("public_privacy_map_count")||0)+(this.get("password_privacy_map_count")||0)+(this.get("link_privacy_map_count")||0)},hasPrivateMapsLimits:function hasPrivateMapsLimits(){return this.isFree2020User()&&!this.hasUnlimitedPrivateMaps()},hasRemainingPrivateMaps:function hasRemainingPrivateMaps(){return!this.hasPrivateMapsLimits()||this.get("private_map_quota")>this.getTotalPrivateMapsCount()},hasUnlimitedPrivateMaps:function hasUnlimitedPrivateMaps(){return null===this.get("private_map_quota")},getTotalPrivateMapsCount:function getTotalPrivateMapsCount(){return this.get("private_privacy_map_count")},getMaxConcurrentImports:function getMaxConcurrentImports(){return this.get("limits")&&this.get("limits").concurrent_imports||1},featureEnabled:function featureEnabled(e){var t=this.get("feature_flags");return!(!t||0===t.length||!e)&&o.contains(t,e)},isCloseToLimits:function isCloseToLimits(){var e=this.get("quota_in_bytes");return 100*this.get("remaining_byte_quota")/e<20},getOrganizationName:function getOrganizationName(){return this.isInsideOrg()?this.organization.get("name"):""},getOrgName:function getOrgName(){return this.isInsideOrg()?this.organization.get("name"):""},getMaxLayersPerMap:function getMaxLayersPerMap(){return this.get("max_layers")||4},canStartTrial:function canStartTrial(){return!this.isInsideOrg()&&"FREE"===this.get("account_type")&&this.get("table_count")>0},canCreatePrivateDatasets:function canCreatePrivateDatasets(){var e=this.get("actions");return e&&e.private_tables},canCreateTwitterDataset:function canCreateTwitterDataset(){return this.hasOwnTwitterCredentials()},canSelectPremiumOptions:function canSelectPremiumOptions(e){return this.get("actions")[e.isVisualization()?"private_maps":"private_tables"]},hasOwnTwitterCredentials:function hasOwnTwitterCredentials(){var e=this.get("twitter");return e&&e.customized_config||!1},equals:function equals(e){if(e.get)return this.get("id")===e.get("id")},viewUrl:function viewUrl(){return new r({base_url:this.get("base_url"),is_org_admin:this.isOrgAdmin()})},upgradeContactEmail:function upgradeContactEmail(){return this.isInsideOrg()?this.isOrgOwner()?"enterprise-support@carto.com":this.organization.owner.get("email"):"support@carto.com"},needsPasswordConfirmation:function needsPasswordConfirmation(){return this.get("needs_password_confirmation")},usedQuotaPercentage:function usedQuotaPercentage(){return 100*this.get("db_size_in_bytes")/this.organization.get("available_quota_for_user")},assignedQuotaInRoundedMb:function assignedQuotaInRoundedMb(){return Math.floor(this.get("quota_in_bytes")/1024/1024).toFixed(0)},assignedQuotaPercentage:function assignedQuotaPercentage(){return 100*this.get("quota_in_bytes")/this.organization.get("available_quota_for_user")},getGoogleApiKey:function getGoogleApiKey(){return this.get("google_maps_private_key")},hasGoogleMaps:function hasGoogleMaps(){return!!this.getGoogleApiKey()},showGoogleApiKeys:function showGoogleApiKeys(){return this.hasGoogleMaps()&&(!this.isInsideOrg()||this.isOrgOwner())},getSchema:function getSchema(){return this.isInsideOrg()?this.get("username"):"public"},getAuthToken:function getAuthToken(){var e;return btoa(s(e="".concat(this.get("username"),":")).call(e,this.get("api_key")))},getModelType:function getModelType(){return"user"},isActionEnabled:function isActionEnabled(e){return this.get("actions")&&this.get("actions")[e]},hasAccountType:function hasAccountType(e){return this.get("account_type")===e},hasPublicMapSharingDisabled:function hasPublicMapSharingDisabled(){return 0===this.get("public_map_quota")},hasPublicDatasetSharingDisabled:function hasPublicDatasetSharingDisabled(){return 0===this.get("public_dataset_quota")}});e.exports=l},198:function(e,t,i){i(34),i(88);var s=i(28),n=i(32),o=i(25),a=i(3),r=i(235),l=i(6),c=i(1563),h=i(1);e.exports=l.Collection.extend({sort_key:"id",initialize:function initialize(e,t){this.options=h.extend({silent:!0},t),this._initBinds()},comparator:function comparator(e){var t=e.get(this.sort_key);return this._nameToLowerCase(t)},model:function model(e,t){var i={};return"string"==typeof e?i.val=e:i=e,new c(i,t)},sortByKey:function sortByKey(e){var t;this.sort_key=e,r(t=this).call(t)},_initBinds:function _initBinds(){var e;a(e=this).call(e,"change:selected",this._onSelectedChange,this)},_nameToLowerCase:function _nameToLowerCase(e){return h.isUndefined(e)||h.isNull(e)?e:h.isString(e)?e.toLowerCase():e.toString().toLowerCase()},search:function search(e){var t;return e?(e=e.toLowerCase(),h(o(t=this).call(t,function(t){var i=t.getName(),s=this._nameToLowerCase(i);return s?~n(s).call(s,e):-1},this))):this},_onSelectedChange:function _onSelectedChange(e,t){t&&this.each(function(t){t.cid!==e.cid&&t.set({selected:!1},{silent:this.options.silent})},this)},getSelectedItem:function getSelectedItem(){return this.findWhere({selected:!0})},containsValue:function containsValue(e){var t;return s(t=this).call(t,function(t){return t.getValue()===e})},setSelected:function setSelected(e){var t,i={silent:this.options.silent};return this.each(function(s){s.getValue()===e?(s.set({selected:!0},i),t=s):s.set({selected:!1},i)}),t},removeSelected:function removeSelected(){this.each(function(e){e.set({selected:!1})})},isAsync:function isAsync(){return!1}})},200:function(e,t,i){"use strict";i.d(t,"c",function(){return isSharedWithMe}),i.d(t,"b",function(){return getURL}),i.d(t,"a",function(){return getThumbnailUrl});i(37),i(35),i(23),i(40);var s=i(32),n=i.n(s),o=i(13),a=i.n(o),r=i(52),l=i(7),c=i.n(l),h=i(525),d=i.n(h),u={derived:"derived",kuviz:"kuviz",slide:"slide",keplergl:"keplergl"};function isSharedWithMe(e,t){return t.user.get("id")!==e.permission.owner.id}function getURL(e,t){var i=e.type===u.kuviz,s=e.type===u.keplergl;if(i||s)return e.url;var n=t.user,o=n.id||n.get("id"),a=new d.a(e.permission,{configModel:t.config}),r=e.id,l=a.owner.viewUrl();if(e.type===u.derived||void 0===e.type){var h;if(n&&o!==a.owner.get("id")&&a.hasAccess(n))l=n.viewUrl(),r=c()(h="".concat(a.owner.get("username"),".")).call(h,r);return l.urlToPath("viz",r).get("base_url")}return n&&a.hasAccess(n)&&(l=n.viewUrl()),l.urlToPath("tables",_(e.table.name)).get("base_url")}function getThumbnailUrl(e,t,i){if(e.type===u.keplergl)return e.thumbnailDataUrl;var s=f()?"https":"http",n=t.config.get("cdn_url"),o=e.permission.owner.username||t.user.get("username"),a={protocol:s,username:o,mapsApiResource:t.config.getMapsResourceName(o),tpl:m(e.id),width:i.width,height:i.height,authTokens:g(e.auth_tokens)};return n&&Object(r.a)(a,{cdn:n[s]}),p(n?"cdn":"regular",a)}var p=function interpolateTemplateUrl(e,t){var i,s,n,o,a,r,l,h,d,u,p;return"regular"===e?c()(i=c()(s=c()(n=c()(o=c()(a="".concat(t.protocol,"://")).call(a,t.mapsApiResource,"/api/v1/map/static/named/")).call(o,t.tpl,"/")).call(n,t.width,"/")).call(s,t.height,".png")).call(i,t.authTokens):"cdn"===e?c()(r=c()(l=c()(h=c()(d=c()(u=c()(p="".concat(t.protocol,"://")).call(p,t.cdn,"/")).call(u,t.username,"/api/v1/map/static/named/")).call(d,t.tpl,"/")).call(h,t.width,"/")).call(l,t.height,".png")).call(r,t.authTokens):void 0},g=function _generateAuthTokensParams(e){return e&&e.length>0?"?"+a()(e).call(e,function(e){return"auth_token=".concat(e)}).join("&"):""},m=function _generateImageTemplate(e){return"tpl_".concat(e.replace(/-/g,"_"))},f=function isHTTPS(){var e;return 0===n()(e=location.protocol).call(e,"https")},_=function getUnquotedName(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").replace(/"/g,"")}},201:function(e,t,i){"use strict";function getCARTOData(){return window.CartoConfig?window.CartoConfig.data:{user_data:window.user_data||window.userData,notification:(window.user_data||window.userData).notification,organization_notifications:window.organization_notifications||[]}}i.d(t,"a",function(){return getCARTOData})},202:function(e,t,i){"use strict";i.d(t,"f",function(){return d}),i.d(t,"e",function(){return u}),i.d(t,"d",function(){return p}),i.d(t,"g",function(){return g}),i.d(t,"a",function(){return m}),i.d(t,"c",function(){return f}),i.d(t,"b",function(){return _});var s,n,o,a,r,l,c=i(7),h=i.n(c),d=["Individual","Annual Individual"],u=["Free 2020"],p=["FREE"],g=["CARTO for the Classroom - Annual","CARTO for students - Annual"],m=(h()(s=[]).call(s,d,u),h()(n=[]).call(n,d,u),h()(o=[]).call(o,d,u),h()(a=[]).call(a,u,p,g)),f=h()(r=[]).call(r,u,p,g),_=h()(l=[]).call(l,u,p,g)},241:function(e,t,i){var s=i(28),n=i(3),o=i(6),a=i(1);e.exports=o.Collection.extend({constructor:function constructor(e,t){t=a.extend(t||{},{silent:!1}),o.Collection.prototype.constructor.call(this,e,t)},initialize:function initialize(e,t){this._disabledTabs=t.disabledTabs,this._initBinds(),this._setSelected()},_initBinds:function _initBinds(){var e,t;n(e=this).call(e,"reset",this._setSelected,this),n(t=this).call(t,"change:selected",this._onSelectedChange,this)},getSelected:function getSelected(){var e;return s(e=this).call(e,function(e){return e.get("selected")})},getDefault:function getDefault(){var e;return s(e=this).call(e,function(e){return e.get("name")===this.getDefaultName()},this)},getDisabledTabs:function getDisabledTabs(){return this._disabledTabs||[]},getDefaultName:function getDefaultName(){return this._defaultTab},isDisabledTab:function isDisabledTab(e){var t;return!!s(t=this).call(t,function(t){return t.get("disabled")&&t.get("name")===e})},_setSelected:function _setSelected(){!this.getSelected()&&this.size()>0&&this.at(0).set("selected",!0)},_onSelectedChange:function _onSelectedChange(e,t){t&&this.each(function(t){t!==e&&t.set("selected",!1)},this)},select:function select(e,t){var i,n=s(i=this).call(i,function(i){return i.get(e)===t},this);n&&n.set("selected",!0)}})},242:function(e,t,i){var s=i(18),n=i(1),o=i(6);i(3061),i(3060),o.$=s,n.extend(o.Form.validators,{columnType:i(3059),interval:i(3058),requiredBoolean:i(3057)}),o.Form.Original=o.Form,i(3056),i(3055),i(3054),i(3046),i(3045),i(3044),i(3043),i(3042),i(3038),i(3037),i(3034),i(3033),i(3032),i(3031),i(3030),i(3028),i(3024),i(3023),i(3022),i(3021),i(3020),i(3019),i(2975),i(2967),i(2963),i(2960),i(2955),i(2954),i(2942)},245:function(e,t,i){"use strict";function createModalModel(e){return{create:e.create,destroy:e.destroy}}i.d(t,"a",function(){return createModalModel})},2451:function(e,t,i){var s=i(4),n=i(1365),o=i(14),a=["format","isDisabled","isChecked"];e.exports=s.extend({tagName:"li",className:"Modal-listFormItem",initialize:function initialize(e){o(e,a,this)},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initViews:function _initViews(){this.$el.html(n({format:this._format,isDisabled:this._isDisabled,isChecked:this._isChecked})),this.$el.toggleClass("is-disabled",this._isDisabled)}})},2453:function(e,t,i){i(31);var s=i(3);i(31);var n=i(6),o=i(1),a=i(958);e.exports=n.Collection.extend({model:function model(e,t){var i=t.collection;return new a(e,{configModel:i._configModel,tableName:i._tableName})},url:function url(){return!!this._tableName&&this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("column")+"/tables/"+this._tableName+"/columns"},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");if(!t.querySchemaModel)throw new Error("querySchemaModel is required");this._tableName=t.tableName,this._querySchemaModel=t.querySchemaModel,this._configModel=t.configModel,this._initBinds()},_initBinds:function _initBinds(){var e,t;s(e=this).call(e,"add remove change:type change:name",function(){this.reset(),this._querySchemaModel.set("status","unfetched"),this._querySchemaModel.fetch()},this),s(t=this._querySchemaModel).call(t,"change:status",function(e,t){"fetched"===t&&this.reset(this._querySchemaModel.columnsCollection.toJSON())},this)},setTableName:function setTableName(e){e&&this._tableName&&(this._tableName=e,this.each(function(t){t._tableName=e}))},addColumn:function addColumn(e){e=e||{},this.create({name:"column_"+(new Date).getTime(),type:"string",isNew:!0},o.extend(e,{wait:!0,parse:!1}))}})},2454:function(e,t,i){i(31),i(31);var s=i(6),n=i(74),o=i(59),a=[{val:0,label:_t("months.january")},{val:1,label:_t("months.february")},{val:2,label:_t("months.march")},{val:3,label:_t("months.april")},{val:4,label:_t("months.may")},{val:5,label:_t("months.june")},{val:6,label:_t("months.july")},{val:7,label:_t("months.august")},{val:8,label:_t("months.september")},{val:9,label:_t("months.october")},{val:10,label:_t("months.november")},{val:11,label:_t("months.december")}];e.exports=s.Model.extend({parse:function parse(e){var t;return{day:(t=e.date?n(e.date).utc():n().utc()).date(),month:t.month(),year:t.year(),time:t.format("HH:mm:ss"),utcOffset:t.utcOffset()}},initialize:function initialize(){this.schema={day:{title:"",type:"Text",validators:["required",/^([12]?\d{0,1}|3[01]{0,2})$/,function(e,t){if(!n(o.formatDate(t)).isValid())return{type:"date",message:_t("components.datepicker.invalid-date")}}]},month:{type:"Select",title:"",options:a},year:{title:"",type:"Text",validators:["required",/^([0-9]{0,4})$/]},time:{title:"",type:"Text",validators:["required",/^([01]{1}[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$/]}}},getFormattedDate:function getFormattedDate(){return o.formatDate(this.toJSON())}})},2455:function(e,t,i){var s=i(3),n=i(6),o=i(732),a=i(2454);i(242),e.exports=o.extend({tagName:"div",className:"Table-editorDate",initialize:function initialize(e){var t;o.prototype.initialize.apply(this,arguments),this._formModel=new a({date:this.model.get("value")},{parse:!0}),this._setValue(),s(t=this._formModel).call(t,"change",this._setValue,this),this.add_related_model(this._formModel)},render:function render(){var e;return this._formView=new n.Form({model:this._formModel}),s(e=this._formView).call(e,"change",function(){this.commit()}),this.$el.html(this._formView.render().el),this},_setValue:function _setValue(){this.model.set("value",this._formModel.getFormattedDate())},clean:function clean(){this._formView.remove(),o.prototype.clean.apply(this)}})},2456:function(e,t,i){i(34),i(88);var s=i(732),n=i(18),o=i(1368);e.exports=s.extend({tagName:"div",className:"u-flex",events:{"change input:radio":"_onRadioChanged"},render:function render(){var e=this.model.get("value");return this.$el.html(o({value:null!==e?e.toString():"null"})),this},_onRadioChanged:function _onRadioChanged(e){var t=n(e.target).val();switch(t){case"true":t=!0;break;case"false":t=!1;break;default:t=null}this.model.set("value",t),this._editorModel.confirm()}})},2457:function(e,t,i){var s=i(6),n=i(1);e.exports=s.Model.extend({validate:function validate(e,t){return"number"===e.type&&isNaN(e.value)?"Number not valid":"boolean"!==e.type||n.isBoolean(e.value)||null===e.value?void 0:"Boolean not valid"}})},2458:function(e,t,i){var s=i(7),n=i(38),o=i(6),a=i(4);e.exports=o.Model.extend({defaults:{show:!0,createContentView:function createContentView(){return new a}},createContentView:function createContentView(){return this.get("createContentView")(this)},show:function show(){this.set("show",!0)},hide:function hide(){this.set("show",!1)},isHidden:function isHidden(){return!this.get("show")},confirm:function confirm(){var e,t=n(Array.prototype).call(arguments);this.trigger.apply(this,s(e=["confirm"]).call(e,t))},destroy:function destroy(){var e,t=n(Array.prototype).call(arguments);this.trigger.apply(this,s(e=["destroy"]).call(e,t))}})},2459:function(e,t,i){var s=i(4);e.exports=s.extend({className:"CDB-Box-modal Table-editor",initialize:function initialize(){this.listenTo(this.model,"change:show",this._onShowChange),this.listenTo(this.model,"destroy",this._onDestroy)},render:function render(){this.clearSubViews();var e=this.model.createContentView();return this.addView(e),e.render(),this.$el.append(e.el),this.$el.css(this.options.position),this},show:function show(){this.model.show()},hide:function hide(){this.model.hide()},destroy:function destroy(){this.model.destroy()},_onShowChange:function _onShowChange(e,t){this.$el[t?"show":"hide"]()},_onClose:function _onClose(){this.destroy()},_onDestroy:function _onDestroy(){this.hide(),this.clean()}})},246:function(e,t,i){var s=i(3),n=i(4),o=i(457),a=i(554),r=window.MutationObserver;e.exports=n.extend({tagName:"div",className:"ScrollView",initialize:function initialize(e){var t;if(!e.createContentView)throw new Error("A factory createContentView function is required");this.options=e||{},this._type=e.type||"vertical",this._maxScroll=0,this._bindedCheckShadows=s(t=this._checkShadows).call(t,this)},render:function render(){this.clearSubViews(),this._html();var e=this.options.createContentView.call(this);return this._contentContainer().append(e.render().el),this.addView(e),this._applyScroll(),this._updateScrollWhenExist(),this},_html:function _html(){this.$el.html(a({type:this._type})),"horizontal"===this._type&&this.$el.addClass("ScrollView--horizontal")},_contentContainer:function _contentContainer(){return this.$(".js-content")},_wrapperContainer:function _wrapperContainer(){return this.$(".js-wrapper")},_updateScrollWhenExist:function _updateScrollWhenExist(){if(r){var e=document.body,t=this._wrapperContainer().get(0),i=function onMutationObserver(){e.contains(t)&&(o.update(t),s.disconnect())},s=new r(i);i();s.observe(e,{subtree:!0,childList:!0})}},_applyScroll:function _applyScroll(){o.initialize(this._wrapperContainer().get(0),{wheelSpeed:2,wheelPropagation:!0,stopPropagationOnClick:!1,minScrollbarLength:20,suppressScrollX:"vertical"===this._type,suppressScrollY:"horizontal"===this._type}),this._bindScroll()},_bindScroll:function _bindScroll(){this._wrapperContainer().on("ps-dom-change",this._bindedCheckShadows).on("ps-x-reach-start",this._bindedCheckShadows).on("ps-x-reach-end",this._bindedCheckShadows).on("ps-y-reach-start",this._bindedCheckShadows).on("ps-y-reach-end",this._bindedCheckShadows).on("ps-scroll-x",this._bindedCheckShadows).on("ps-scroll-y",this._bindedCheckShadows)},_unbindScroll:function _unbindScroll(){this._wrapperContainer().off("ps-dom-change",this._bindedCheckShadows).off("ps-x-reach-start",this._bindedCheckShadows).off("ps-x-reach-end",this._bindedCheckShadows).off("ps-y-reach-start",this._bindedCheckShadows).off("ps-y-reach-end",this._bindedCheckShadows).off("ps-scroll-x",this._bindedCheckShadows).off("ps-scroll-y",this._bindedCheckShadows)},_checkShadows:function _checkShadows(){var e,t;"horizontal"===this._type?(e=this._wrapperContainer().scrollLeft(),t=this._wrapperContainer().get(0).scrollWidth-this._wrapperContainer().outerWidth(),this.$("> .js-leftShadow").toggleClass("is-visible",e>0),this.$("> .js-rightShadow").toggleClass("is-visible",e<t)):(e=this._wrapperContainer().scrollTop(),t=this._wrapperContainer().get(0).scrollHeight-this._wrapperContainer().outerHeight(),this.$("> .js-topShadow").toggleClass("is-visible",e>0),this.$("> .js-bottomShadow").toggleClass("is-visible",e<t))},destroyScroll:function destroyScroll(){this._wrapperContainer().length&&(this._unbindScroll(),o.destroy(this._wrapperContainer().get(0)))},clean:function clean(){this.destroyScroll(),n.prototype.clean.apply(this,arguments)}})},2460:function(e,t,i){var s=i(38),n=i(7),o=i(1),a=i(18),r=i(6),l=i(2459),c=i(2458);e.exports=r.Model.extend({create:function create(e,t){if(!o.isFunction(e))throw new Error("createContentView is required");return t=t||{left:"50%",top:"50%"},this._editorView||(this._editorView=this._newEditorView(t),document.body.appendChild(this._editorView.el)),this._editorView.model.set("createContentView",e),this._editorView.render(),this._editorView},confirm:function confirm(){this._editorView&&this._editorView.model.confirm()},destroy:function destroy(){this._editorView&&this._editorView.model.destroy()},_newEditorView:function _newEditorView(e){var t=new c;this._destroyOnEsc(t),this.listenToOnce(t,"destroy",function(){var e;this._editorView=null,this.trigger.apply(this,n(e=["destroyedEditor"]).call(e,s(Array.prototype).call(arguments))),this.stopListening(t)}),this.listenToOnce(t,"confirm",function(){var e;this.trigger.apply(this,n(e=["confirmedEditor"]).call(e,s(Array.prototype).call(arguments))),this.destroy()});var i=new l({model:t,position:e});return this._destroyOnClickOutside(i),i},_destroyOnClickOutside:function _destroyOnClickOutside(e){var t=function destroyOnClickOutside(t){0===a(t.target).closest(e.el).length&&e.model.confirm()};document.addEventListener("click",t),this.listenToOnce(e.model,"destroy",function(){document.removeEventListener("click",t)})},_destroyOnEsc:function _destroyOnEsc(e){var t=function destroyOnEsc(t){27===t.which&&e.destroy()};document.addEventListener("keydown",t),this.listenToOnce(e,"destroy",function(){document.removeEventListener("keydown",t)})}})},2461:function(e,t,i){var s=i(1),n=i(6);e.exports=n.Collection.extend({url:function url(){return this._configModel.getSqlApiUrl()},initialize:function initialize(e){e=e||{},this._subquery=e.subquery,this._configModel=e.configModel},fetchCount:function fetchCount(e){var t={},i=-1;return t.data={api_key:this._configModel.get("api_key"),q:this._getCountSQL()},t.method=this._httpMethod(),t.error=function(t,s){e&&e(i)},t.success=function(t,s,n){s.rows&&s.rows.length&&(i=s.rows[0].count),e&&e(i)},n.Collection.prototype.fetch.call(this,t)},_getCountSQL:function _getCountSQL(e){return s.template("select count(*) from (<%= subquery %>) st")({subquery:this._subquery})},_httpMethod:function _httpMethod(){return"GET"}})},2462:function(e,t,i){var s=i(76),n=i(3),o=i(1),a=i(4),r=i(1373),l=i(1372),c=i(85),h=i(104),d=i(2461);e.exports=a.extend({tagName:"div",className:"Table-paginator js-tablePaginator",events:{"click .js-prev":"_onPrevPage","click .js-next":"_onNextPage"},initialize:function initialize(e){var t,i,s,o,a;if(!e.rowsCollection)throw new Error("rowsCollection is required");if(!e.tableViewModel)throw new Error("tableViewModel is required");this._tableViewModel=e.tableViewModel,this._rowsCollection=e.rowsCollection,this._scrollToBottom=e.scrollToBottom,this._numRows=-1,this._queryUtilsModel=e.queryUtilsModel||new d({subquery:this._rowsCollection._querySchemaModel.get("query"),configModel:this._rowsCollection._configModel}),this._queryUtilsModel.fetchCount(n(t=function _context(e){this._numRows=e,this.render()}).call(t,this)),n(i=this._rowsCollection).call(i,"loading",function(e){e.models&&(this._isLoading=!0)},this),n(s=this._rowsCollection).call(s,"add",this._onRowAdded,this),n(o=this._rowsCollection).call(o,"remove",this._onRowRemoved,this),n(a=this._tableViewModel).call(a,"change:page",this._onTablePageChange,this),this.add_related_model(this._tableViewModel),this.add_related_model(this._rowsCollection)},render:function render(){var e=this._rowsCollection.size(),t=this._tableViewModel.get("page"),i=this._rowsCollection.DEFAULT_FETCH_OPTIONS.rows_per_page;return this.$el.html(r({page:this._tableViewModel.get("page"),size:e,isNextAvailable:this._numRows>(t+1)*i,isPrevAvailable:t>0})),this.$el.toggleClass("Table-paginator--relative",!!this._tableViewModel.get("relativePositionated")),this},_onRowAdded:function _onRowAdded(){var e;this._queryUtilsModel.fetchCount(n(e=function _context6(e){if(e>-1){var t=this._rowsCollection.DEFAULT_FETCH_OPTIONS.rows_per_page,i=Math.ceil(e/t)-1;i!==this._tableViewModel.get("page")?this._tableViewModel.set("page",i):this.render(),s(this._scrollToBottom,200)}}).call(e,this))},_onRowRemoved:function _onRowRemoved(){this._rowsCollection.fetch({data:this._getData()})},_onTablePageChange:function _onTablePageChange(){var e;this._rowsCollection.fetch({data:this._getData(),error:n(e=function _context7(e,t){this._isLoading=!1,this.render(),c.addNotification({status:"error",info:_t("components.table.rows.paginator.error",{error:h(t)}),closable:!0})}).call(e,this)})},_getData:function _getData(){return o.extend(this._tableViewModel.pick("page","order_by","sort_order"),{exclude:this._tableViewModel.isCustomQueryApplied()?[]:["the_geom_webmercator"]})},_onPrevPage:function _onPrevPage(e){this._isLoading||(this.$(".js-prev").html(l()),this._tableViewModel.set("page",this._tableViewModel.get("page")-1))},_onNextPage:function _onNextPage(e){this._isLoading||(this.$(".js-next").html(l()),this._tableViewModel.set("page",this._tableViewModel.get("page")+1))}})},2463:function(e,t,i){var s=i(85),n=i(104);e.exports=function(e){if(!e.rowModel)throw new Error("rowModel is required");if(void 0===e.newValue)throw new Error("newValue is required");if(!e.attribute)throw new Error("attribute is required");var t=e.rowModel,i=e.newValue,o=e.attribute,a=t.get("cartodb_id"),r=e.onSuccess,l=e.onError,c=s.addNotification({status:"loading",info:_t("components.table.rows.edit.loading",{attribute:o,cartodbId:a}),closable:!1});t.set(o,i),t.save(null,{success:function success(e,t){r&&r(e,t),c.set({status:"success",info:_t("components.table.rows.edit.success",{attribute:o,cartodbId:a}),closable:!0})},error:function error(e,t){l&&l(e,t),c.set({status:"error",info:_t("components.table.rows.edit.error",{attribute:o,cartodbId:a,error:n(t)}),closable:!0})}})}},2464:function(e,t,i){var s=i(85),n=i(104);e.exports=function(e){if(!e.rowModel)throw new Error("rowModel is required");var t=e.rowModel,i=e.onSuccess,o=e.onError,a=t.get("cartodb_id"),r=s.addNotification({status:"loading",info:_t("components.table.rows.destroy.loading",{cartodb_id:a}),closable:!1});t.destroy({wait:!0,success:function success(e,t){i&&i(e,t),r.set({status:"success",info:_t("components.table.rows.destroy.success",{cartodb_id:a}),closable:!0})},error:function error(e,t){o&&o(e,t),r.set({status:"error",info:_t("components.table.rows.destroy.error",{cartodb_id:a,error:n(t)}),closable:!0})}})}},2465:function(e,t,i){i(37),e.exports=function(e){try{return JSON.parse(e).coordinates.join(", ")}catch(e){return!1}}},2466:function(e,t,i){i(37);var s=i(38),n=i(3),o=i(4),a=i(1),r=i(1375),l=i(2465),c=i(14),h={geometry:l},d=["columnsCollection","tableViewModel","canHideColumns"];e.exports=o.extend({className:"Table-row",tagName:"tr",options:{simpleGeometry:""},initialize:function initialize(e){c(e,d,this),this.el.setAttribute("data-model",this.model.cid),this._initBinds()},render:function render(){return this.$el.empty(),this._generateRowsHTML(),this},_initBinds:function _initBinds(){var e,t;n(e=this.model).call(e,"change",this.render,this),n(t=this.model).call(t,"destroy",this.remove,this)},_generateRowsHTML:function _generateRowsHTML(){for(var e=[],t=0,i=this._columnsCollection.size();t<i;t++){var s=this._columnsCollection.at(t),n=s.get("name");(this._tableViewModel.isCustomQueryApplied()||"the_geom_webmercator"!==n)&&(this._canHideColumns&&"center"===n&&s.isGeometryColumn()||(e[t]=this._generateCellHTML(n)))}this.el.innerHTML=e.join("")},_generateCellHTML:function _generateCellHTML(e){var t=this.options.simpleGeometry,i=a.first(this._columnsCollection.where({name:e})).get("type"),n=this.model.get(e),o=n;return"geometry"===i?o="point"===t?h[i](n):t&&t.charAt(0).toUpperCase()+s(t).call(t,1):h[i]&&(o=h[i](n)),r({value:n,formattedValue:o,type:i,columnName:e,geometry:t})}})},2467:function(e,t,i){var s=i(28),n=i(7),o=i(3),a=i(4),r=i(18),l=i(1),c=i(1058),h=i(2466),d=i(489),u=i(198),p=i(1374),g=i(2464),m=i(2463),f=i(367),_=i(2462),v=i(1371),y=i(86),w=i(264),b=i(1370),C=i(2460),M=i(2457),k=i(104),S=i(1384),x=i(14),T={string:i(1369),number:i(732),boolean:i(2456),date:i(2455),default:i(1369)},D=["columnsCollection","modals","queryGeometryModel","querySchemaModel","rowsCollection","canHideColumns","tableViewModel"];e.exports=a.extend({className:"Table-body",tagName:"div",events:{click:"_onClick",dblclick:"_onDblClick"},initialize:function initialize(e){var t,i;x(e,D,this),this._editors=new C,this._closeEditor=o(t=this._closeEditor).call(t,this),this._hideContextMenu=o(i=this._hideContextMenu).call(i,this),this._initBinds()},render:function render(){return this.clearSubViews(),this._destroyScrollBinding(),this.$el.empty(),!this._querySchemaModel.isFetched()||this._queryGeometryModel.isFetching()||this._rowsCollection.isFetching()?this._renderQueryState():this._rowsCollection.size()?(this.$el.html(v()),this._rowsCollection.each(this._renderBodyRow,this),this._initPaginator()):this._renderNoRows(),this.$el.toggleClass("Table-body--relative",!!this._tableViewModel.get("relativePositionated")),this},_initBinds:function _initBinds(){var e,t,i,s,n,a,r;o(e=this._queryGeometryModel).call(e,"change:status",this.render,this),o(t=this._querySchemaModel).call(t,"change:status",this.render,this),o(i=this._rowsCollection).call(i,"reset",l.debounce(o(s=this.render).call(s,this),20),this),o(n=this._rowsCollection).call(n,"add",function(e){1===this._rowsCollection.size()?this.render():this._renderBodyRow(e)},this),o(a=this._rowsCollection).call(a,"remove",this._onRemoveRow,this),o(r=this._rowsCollection).call(r,"fail",function(e,t){(!t||t&&"abort"!==t.statusText)&&this._renderError(k(t))},this),this.add_related_model(this._queryGeometryModel),this.add_related_model(this._querySchemaModel),this.add_related_model(this._rowsCollection)},_renderQueryState:function _renderQueryState(){var e=this._querySchemaModel.get("status"),t=this._querySchemaModel.get("ready"),i=this._queryGeometryModel.get("status"),s=this._rowsCollection.getStatusValue();t&&("unavailable"===e&&"unavailable"===i||"unavailable"===s)?this._renderError(this._querySchemaModel.get("query_errors")):this._renderLoading()},_renderLoading:function _renderLoading(){this.$el.html(y({title:_t("components.table.rows.loading.title")}))},_renderError:function _renderError(e){var t=new w({title:_t("components.table.rows.error.title"),desc:e||_t("components.table.rows.error.desc")});this.addView(t),this.$el.html(t.render().el)},_renderNoRows:function _renderNoRows(){this.$el.html(b({page:this._tableViewModel.get("page"),customQuery:this._tableViewModel.isCustomQueryApplied()}))},_initPaginator:function _initPaginator(){var e,t=new _({rowsCollection:this._rowsCollection,tableViewModel:this._tableViewModel,scrollToBottom:o(e=this._scrollToBottom).call(e,this)}),i=r("body");this._tableViewModel.get("relativePositionated")&&(i=this.$el.closest(".Table").parent()),i.append(t.render().el),this.addView(t)},_initScrollBinding:function _initScrollBinding(){r(".Table").scroll(this._hideContextMenu),this.$(".js-tbody").scroll(this._hideContextMenu)},_destroyScrollBinding:function _destroyScrollBinding(){r(".Table").off("scroll",this._hideContextMenu),this.$(".js-tbody").off("scroll",this._hideContextMenu)},_renderBodyRow:function _renderBodyRow(e){var t=new h({model:e,columnsCollection:this._columnsCollection,simpleGeometry:this._queryGeometryModel.get("simple_geom"),canHideColumns:this._canHideColumns,tableViewModel:this._tableViewModel});this.addView(t),this.$(".js-tbody").append(t.render().el)},_onRemoveRow:function _onRemoveRow(){if(!this._rowsCollection.size()){this._rowsCollection.resetFetch(),this._queryGeometryModel.resetFetch();var e=this._tableViewModel.get("page");e>0?this._tableViewModel.set("page",e-1):this.render()}},_hasContextMenu:function _hasContextMenu(){return this._menuView},_hideContextMenu:function _hideContextMenu(){this._unhighlightCell(),this._destroyScrollBinding(),this._menuView.collection.unbind(null,null,this),this.removeView(this._menuView),this._menuView.clean(),delete this._menuView},_highlightCell:function _highlightCell(e,t){e.addClass("is-highlighted"),t.addClass("is-highlighted")},_unhighlightCell:function _unhighlightCell(){this.$(".Table-cellItem.is-highlighted, .Table-row.is-highlighted").removeClass("is-highlighted")},_showContextMenu:function _showContextMenu(e){var t,i,s=this,a={x:e.clientX,y:e.clientY},l=r(e.target).closest(".Table-row"),c=r(e.target).closest(".Table-cellItem"),h=l.data("model"),p=c.data("attribute"),g=s._rowsCollection.get({cid:h}),m=[];(m.push({label:_t("components.table.rows.options.copy"),val:"copy",action:function action(){s._copyValue(c)}}),this._tableViewModel.isDisabled())||(m=n(i=[{label:_t("components.table.rows.options.edit"),val:"edit",action:function action(){s._editCell(g,p)}},{label:_t("components.table.rows.options.create"),val:"create",action:function action(){s._addRow()}}]).call(i,m)).push({label:_t("components.table.rows.options.delete"),val:"delete",destructive:!0,action:function action(){s._removeRow(g)}});if(!m.length)return!1;var f=new u(m);this._menuView=new d({className:"Table-rowMenu "+d.prototype.className,collection:f,triggerElementID:h,position:a}),this._menuView.$el.css(S({parentView:r("body"),posX:a.x,posY:a.y})),o(f).call(f,"change:selected",function(e){var t=e.get("action");t&&t()},this),o(t=this._menuView.model).call(t,"change:visible",function(e,t){this._hasContextMenu()&&!t&&this._hideContextMenu()},this),this._menuView.show(),this.addView(this._menuView),this._highlightCell(c,l),this._initScrollBinding()},_onClick:function _onClick(e){r(e.target).hasClass("js-cellOptions")&&(this._hasContextMenu()?this._hideContextMenu():this._showContextMenu(e))},_onDblClick:function _onDblClick(e){var t=r(e.target).closest(".Table-cellItem"),i=r(e.target).hasClass("js-cellOptions");if(t&&!i){var s=t.closest(".Table-row").data("model"),n=t.data("attribute"),o=this._rowsCollection.get({cid:s});!this._tableViewModel.isDisabled()&&o&&n&&"cartodb_id"!==n&&this._editCell(o,n)}},_copyValue:function _copyValue(e){this._clipboard=new c(e.get(0)),e.click(),this._clipboard.destroy()},_addRow:function _addRow(){p({rowsCollection:this._rowsCollection})},_initEditorScrollBinding:function _initEditorScrollBinding(){r(".Table").scroll(this._closeEditor),this.$(".js-tbody").scroll(this._closeEditor)},_destroyEditorScrollBinding:function _destroyEditorScrollBinding(){r(".Table").unbind("scroll",this._closeEditor),this.$(".js-tbody").unbind("scroll",this._closeEditor)},_closeEditor:function _closeEditor(){this._unhighlightCell(),this._destroyEditorScrollBinding(),this._editors.unbind(null,null,this),this._editors.destroy()},_saveValue:function _saveValue(e,t,i){e.get(t)!==i&&m({rowModel:e,attribute:t,newValue:i})},_doCellEdition:function _doCellEdition(e,t){var i,n,a=this.$('[data-model="'+e.cid+'"]'),r=s(a).call(a,'[data-attribute="'+t+'"]'),c=s(r).call(r,".js-cellOptions"),h=l.first(this._columnsCollection.where({name:t})).get("type");this._highlightCell(r,a),this._initEditorScrollBinding();var d=new M({type:h,value:e.get(t)});o(i=this._editors).call(i,"destroyedEditor",this._closeEditor,this),o(n=this._editors).call(n,"confirmedEditor",function(){d.isValid()&&this._saveValue(e,t,d.get("value"))},this);var u=c.offset();r.index()>1&&(u.right=window.innerWidth-u.left,delete u.left),this._rowsCollection.size()>4&&a.index()+2>=this._rowsCollection.size()-1?(u.bottom=window.innerHeight-u.top,delete u.top):u.top=u.top+20;var p=T[h];p||(p=T.default),this._editors.create(function(e){return new p({editorModel:e,model:d})},u)},_editCell:function _editCell(e,t){var i,s=o(i=this._doCellEdition).call(i,this,e,t);e.fetchRowIfGeomIsNotLoaded(s)},_removeRow:function _removeRow(e){var t=this;this._modals.create(function(s){return new f({modalModel:s,template:i(1367),renderOpts:{cartodb_id:e.get("cartodb_id")},loadingTitle:_t("components.table.rows.destroy.loading",{cartodb_id:e.get("cartodb_id")}),runAction:function runAction(){g({tableViewModel:t._tableViewModel,rowModel:e,onSuccess:function onSuccess(){s.destroy()},onError:function onError(e){s.destroy()}})}})})},_scrollToBottom:function _scrollToBottom(){var e=this.$(".js-tbody").get(0).scrollHeight;this.$(".js-tbody").animate({scrollTop:e},"slow")},clean:function clean(){this._destroyScrollBinding(),a.prototype.clean.apply(this)}})},2468:function(e,t,i){var s=i(85),n=i(104);e.exports=function(e){if(!e.columnModel)throw new Error("columnModel is required");var t=e.columnModel,i=e.onSuccess,o=e.onError,a=s.addNotification({status:"loading",info:_t("components.table.columns.destroy.loading",{columnName:t.get("name")}),closable:!1});t.destroy({wait:!0,success:function success(e,s){i&&i(e,s),a.set({status:"success",info:_t("components.table.columns.destroy.success",{columnName:t.get("name")}),closable:!0})},error:function error(e,i){o&&o(e,i),a.set({status:"error",info:_t("components.table.columns.destroy.error",{columnName:t.get("name"),error:n(i)}),closable:!0})}})}},2469:function(e,t,i){var s=i(85),n=i(104);e.exports=function(e){if(!e.columnModel)throw new Error("columnModel is required");if(!e.newType)throw new Error("newType is required");var t=e.columnModel,i=e.newType,o=e.onSuccess,a=e.onError,r=s.addNotification({status:"loading",info:_t("components.table.columns.change-type.loading",{columnName:t.get("name")}),closable:!1});t.save({type:i},{wait:!0,success:function success(e,s){o&&o(e,s),r.set({status:"success",info:_t("components.table.columns.change-type.success",{columnName:t.get("name"),newType:i}),closable:!0})},error:function error(e,s){a&&a(e,s),r.set({status:"error",info:_t("components.table.columns.change-type.error",{columnName:t.get("name"),newType:i,error:n(s)}),closable:!0})}})}},2470:function(e,t,i){var s=i(85),n=i(104);e.exports=function(e){if(!e.columnModel)throw new Error("columnModel is required");if(!e.newName)throw new Error("newName is required");var t=e.columnModel,i=t.get("name"),o=e.newName,a=e.onSuccess,r=e.onError,l=s.addNotification({status:"loading",info:_t("components.table.columns.rename.loading",{oldName:i,newName:o}),closable:!1});t.save({new_name:o,old_name:t.get("name")},{wait:!0,success:function success(e,t){a&&a(e,t),l.set({status:"success",info:_t("components.table.columns.rename.success",{columnName:i,newName:o}),closable:!0})},error:function error(e,t){r&&r(e,t),l.set({status:"error",info:_t("components.table.columns.rename.error",{columnName:i,newName:o,error:n(t)}),closable:!0})}})}},2471:function(e,t,i){var s=i(3),n=i(1),o=i(453),a=i(396),r=i(958);e.exports=o.extend({events:n.extend(o.prototype.events,{"click .js-desc":"_onDescClick","click .js-asc":"_onAscClick","click .js-order":"killEvent"}),render:function render(){return this.$el.empty(),this.clearSubViews(),this.$el.append(this.options.template({typeLabel:this.options.typeLabel,isSelected:this.model.get("selected"),isDisabled:this.model.get("disabled"),isDestructive:this.model.get("destructive"),isOrderBy:this.model.get("isOrderBy"),sortBy:this.model.get("sortBy"),name:this.model.getName(),val:this.model.getValue()})),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")),this},_onClick:function _onClick(e){this.killEvent(e),"change"===this.model.getValue()?this._openSubContextMenu(e):this.model.set("selected",!0)},_hideSubContextMenu:function _hideSubContextMenu(){this._subContextMenu&&(this._subContextMenu.clean(),this.removeView(this._subContextMenu),delete this.collection,delete this._subContextMenu)},_openSubContextMenu:function _openSubContextMenu(e){var t;this._subContextMenu&&this._hideSubContextMenu();var i="Table-columnTypeMenu ";this.model.get("isLastColumns")&&(i+=" Table-columnTypeMenu--toLeft "),this._subContextMenu=new a({className:i+a.prototype.className,options:[{label:_t("components.table.columns.types.number"),disabled:!r.isTypeChangeAllowed(this.model.get("type"),"number"),val:"number"},{label:_t("components.table.columns.types.string"),disabled:!r.isTypeChangeAllowed(this.model.get("type"),"string"),val:"string"},{label:_t("components.table.columns.types.date"),disabled:!r.isTypeChangeAllowed(this.model.get("type"),"date"),val:"date"},{label:_t("components.table.columns.types.boolean"),disabled:!r.isTypeChangeAllowed(this.model.get("type"),"boolean"),val:"boolean"}],showSearch:!1,typeLabel:""}),s(t=this._subContextMenu.collection).call(t,"change:selected",function(e){e.get("disabled")||this.model.set({type:e.getValue(),selected:!0})},this),this.$el.closest(".Table-columnMenu").append(this._subContextMenu.render().el),this._subContextMenu.show(),this.addView(this._subContextMenu)},_onAscClick:function _onAscClick(e){this.killEvent(e),this.model.set({sort:"asc",selected:!0})},_onDescClick:function _onDescClick(e){this.killEvent(e),this.model.set({sort:"desc",selected:!0})}})},2472:function(e,t,i){var s=i(7),n=i(3),o=i(18),a=i(4),r=i(1382),l=i(489),c=i(198),h=i(2471),d=i(1381),u=i(367),p=i(958),g=i(1380),m=i(2470),f=i(2469),_=i(2468);e.exports=a.extend({className:"Table-headItem",tagName:"th",events:{"dblclick .js-attribute":"_onAttributeDblClicked","focusout .js-attribute":"_saveNewName","click .js-columnOptions":"_showContextMenu"},initialize:function initialize(e){var t,i;if(!e.tableViewModel)throw new Error("tableViewModel is required");if(!e.columnsCollection)throw new Error("columnsCollection is required");if(!e.modals)throw new Error("modals is required");this._tableViewModel=e.tableViewModel,this._columnsCollection=e.columnsCollection,this._modals=e.modals,this._hideContextMenu=n(t=this._hideContextMenu).call(t,this),this._onKeyDown=n(i=this._onKeyDown).call(i,this)},render:function render(){this.clearSubViews();var e=this.model.get("name");return this.$el.html(r({name:e,type:this.model.get("type"),isOrderBy:this._tableViewModel.get("order_by")===e,sortBy:this._tableViewModel.get("sort_order"),geometry:this.options.simpleGeometry})),this},_hasContextMenu:function _hasContextMenu(){return this._menuView},_hideContextMenu:function _hideContextMenu(){this._unhighlightHead(),this._destroyScrollBinding(),this._menuView.collection.unbind(null,null,this),this.removeView(this._menuView),this._menuView.clean(),delete this._menuView},_highlightHead:function _highlightHead(){this.$el.addClass("is-highlighted")},_unhighlightHead:function _unhighlightHead(){this.$el.removeClass("is-highlighted")},_initScrollBinding:function _initScrollBinding(){o(".Table").scroll(this._hideContextMenu)},_destroyScrollBinding:function _destroyScrollBinding(){o(".Table").off("scroll",this._hideContextMenu)},_showContextMenu:function _showContextMenu(e){var t,i=this,o={x:e.clientX,y:e.clientY},a=this.$el.index(),r=this.model.cid,u=this.model.get("name");this._highlightHead();var p=[{label:_t("components.table.columns.options.order"),val:"order",isOrderBy:this._tableViewModel.get("order_by")===u,sortBy:this._tableViewModel.get("sort_order"),action:function action(e){i._tableViewModel.set({sort_order:e.get("sort"),order_by:u})}}];this._tableViewModel.isDisabled()||(this.model.isCartoDBIDColumn()||this.model.isGeometryColumn()||(p=s(p).call(p,[{label:_t("components.table.columns.options.rename"),val:"rename",action:function action(){i._startEditing()}},{label:_t("components.table.columns.options.change"),type:this.model.get("type"),isLastColumns:this._columnsCollection.size()-a<3,val:"change",action:function action(e){i._changeColumnType(e.get("type"))}}])),p.push({label:_t("components.table.columns.options.create"),val:"create",action:function action(){i._addColumn()}}),this.model.isCartoDBIDColumn()||this.model.isGeometryColumn()||p.push({label:_t("components.table.columns.options.delete"),val:"delete",destructive:!0,action:function action(){i._removeColumn()}}));var g=new c(p);this._menuView=new l({className:l.prototype.className+" Table-columnMenu",collection:g,itemTemplate:d,itemView:h,triggerElementID:r,position:o}),n(g).call(g,"change:selected",function(e){var t=e.get("action");t&&t(e)},this),n(t=this._menuView.model).call(t,"change:visible",function(e,t){this._hasContextMenu()&&!t&&this._hideContextMenu()},this),this._menuView.show(),this.addView(this._menuView),this._initScrollBinding()},_addColumn:function _addColumn(){g({columnsCollection:this._columnsCollection})},_changeColumnType:function _changeColumnType(e){var t=this,s=this.model.get("type");p.isTypeChangeDestructive(s,e)?this._modals.create(function(s){return new u({modalModel:s,template:i(1379),renderOpts:{columnName:t.model.get("name"),newType:e},loadingTitle:_t("components.table.columns.change-type.loading",{columnName:t.model.get("name")}),runAction:function runAction(){f({columnModel:t.model,newType:e,onSuccess:function onSuccess(){s.destroy()},onError:function onError(e){s.destroy()}})}})}):f({columnModel:this.model,newType:e})},_removeColumn:function _removeColumn(){var e=this;this._modals.create(function(t){return new u({modalModel:t,template:i(1378),renderOpts:{name:e.model.get("name")},loadingTitle:_t("components.table.columns.destroy.loading",{columnName:e.model.get("name")}),runAction:function runAction(){_({columnModel:e.model,onSuccess:function onSuccess(){t.destroy()},onError:function onError(e){t.destroy()}})}})})},_onAttributeDblClicked:function _onAttributeDblClicked(){this.model.isEditable()&&!this._tableViewModel.isDisabled()&&this._startEditing()},_initRenameBinds:function _initRenameBinds(){var e;n(e=o(document)).call(e,"keydown",this._onKeyDown)},_destroyRenameBinds:function _destroyRenameBinds(){o(document).unbind("keydown",this._onKeyDown)},_onKeyDown:function _onKeyDown(e){var t=e.which;13===t?this._saveNewName():27===t&&this._finishEditing()},_startEditing:function _startEditing(){this.$(".js-attribute").addClass("is-active").removeAttr("readonly"),this._initRenameBinds()},_finishEditing:function _finishEditing(){this.$(".js-attribute").val(this.model.get("name")).removeClass("is-active").attr("readonly",""),this._destroyRenameBinds()},_saveNewName:function _saveNewName(){if(this.model.isEditable()){var e=this.$(".js-attribute").val(),t=this.model,s=t.get("name");s!==e&&""!==e&&this._modals.create(function(n){return new u({modalModel:n,template:i(1377),renderOpts:{columnName:s,newName:e},loadingTitle:_t("components.table.columns.rename.loading",{columnName:s,newName:e}),runAction:function runAction(){m({columnModel:t,newName:e,onSuccess:function onSuccess(){n.destroy()},onError:function onError(e){n.destroy()}})}})})}this._finishEditing()},focusInput:function focusInput(){this._startEditing(),this.$(".js-attribute").select()},clean:function clean(){this._destroyRenameBinds(),this._destroyScrollBinding(),a.prototype.clean.apply(this)}})},2473:function(e,t,i){var s=i(76),n=i(3),o=i(18),a=i(4),r=i(2472),l=i(1376),c=i(14),h=["columnsCollection","tableViewModel","queryGeometryModel","canHideColumns","modals"];e.exports=a.extend({className:"Table-head",tagName:"table",initialize:function initialize(e){c(e,h,this),this._lastHeadItemView=null,this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this.$el.append(l()),this._columnsCollection.each(this._renderColumnHead,this),this},_initBinds:function _initBinds(){var e,t,i,o;n(e=this._queryGeometryModel).call(e,"change:simple_geom",this.render,this),this.add_related_model(this._queryGeometryModel),n(t=this._tableViewModel).call(t,"change:sort_order change:order_by",this.render,this),this.add_related_model(this._tableViewModel),n(i=this._columnsCollection).call(i,"reset",function(){if(this.render(),this._newColumn){var e,t=this.$el.get(0).scrollWidth;s(n(e=function _context4(){this._scrollToLeft({pos:t}),this._focusLastHeadItem()}).call(e,this),500),delete this._newColumn}},this),n(o=this._columnsCollection).call(o,"add",function(e){this._newColumn=e},this),this.add_related_model(this._columnsCollection)},_renderColumnHead:function _renderColumnHead(e){var t=e.get("name");if((this._tableViewModel.isCustomQueryApplied()||"the_geom_webmercator"!==t)&&(!this._canHideColumns||"center"!==t||!e.isGeometryColumn())){var i=new r({model:e,modals:this._modals,columnsCollection:this._columnsCollection,tableViewModel:this._tableViewModel,simpleGeometry:this._queryGeometryModel.get("simple_geom")});this.$(".js-headRow").append(i.render().el),this.addView(i),this._lastHeadItemView=i}},_scrollToLeft:function _scrollToLeft(e){e=e||{},o(".Table").animate({scrollLeft:e.pos||0},e.speed||"slow")},_focusLastHeadItem:function _focusLastHeadItem(){this._lastHeadItemView&&this._lastHeadItemView.focusInput()}})},2474:function(e,t,i){var s=i(6);e.exports=s.Model.extend({defaults:{page:0,order_by:"",sort_order:"",readonly:!1,tableName:""},initialize:function initialize(e,t){if(!t.analysisDefinitionNodeModel)throw new Error("analysisDefinitionNodeModel is required");if(!t.columnsCollection)throw new Error("columnsCollection is required");this._analysisDefinitionNodeModel=t.analysisDefinitionNodeModel,this._columnsCollection=t.columnsCollection,this._setOrderAndSort(),this.listenTo(this._columnsCollection,"reset",this._setOrderAndSort)},_setOrderAndSort:function _setOrderAndSort(){this._columnsCollection.where({name:"cartodb_id"}).length&&!this.isCustomQueryApplied()&&this.set({order_by:"cartodb_id",sort_order:"asc"},{silent:!0})},resetFetchDefaults:function resetFetchDefaults(){this.set({page:this.defaults.page,order_by:"",sort_order:""},{silent:!0})},isDisabled:function isDisabled(){return this._analysisDefinitionNodeModel.isReadOnly()},isCustomQueryApplied:function isCustomQueryApplied(){return this._analysisDefinitionNodeModel.isCustomQueryApplied()}})},2475:function(e,t,i){var s=i(171),n=i(3),o=i(4),a=i(1),r=i(18),l=i(2474),c=i(2473),h=i(2467),d=i(1374),u=i(1380),p=i(492),g=i(14),m=i(957),f=m.nodeHasTradeArea,_=m.nodeHasSQLFunction,v=["analysisDefinitionNodeModel","columnsCollection","modals"];e.exports=o.extend({className:"Table-wrapper",tagName:"div",initialize:function initialize(e){g(e,v,this),this._rowsCollection=this._analysisDefinitionNodeModel.queryRowsCollection,this._queryGeometryModel=this._analysisDefinitionNodeModel.queryGeometryModel,this._querySchemaModel=this._analysisDefinitionNodeModel.querySchemaModel,this._tableModel=this._analysisDefinitionNodeModel.isSourceType()&&this._analysisDefinitionNodeModel.getTableModel(),this._tableViewModel=new l({relativePositionated:e.relativePositionated,tableName:e.tableName},{analysisDefinitionNodeModel:this._analysisDefinitionNodeModel,columnsCollection:this._columnsCollection}),this._initBinds(),this._querySchemaModel.shouldFetch()?this._querySchemaModel.fetch():this._rowsCollection.shouldFetch()&&this._fetchRowsData()},render:function render(){this.clearSubViews(),this.$el.empty();var e=r("<div>").addClass("Table js-table");return this.$el.append(e),this._initViews(),this.$(".js-table").toggleClass("Table--relative",!!this._tableViewModel.get("relativePositionated")),this._setDisableState(),this},_initBinds:function _initBinds(){var e;if(this._onChangeQueryOrStatus=n(e=this._onChangeQueryOrStatus).call(e,this),this.listenTo(this._querySchemaModel,"change:query change:status",a.debounce(this._onChangeQueryOrStatus,100)),this.listenTo(this._querySchemaModel,"change:status",this._setDisableState),this.listenTo(this._querySchemaModel,"change:query",this._onQueryChanged),this._fetchRowsData=a.debounce(this._fetchRowsData,100),this.listenTo(this._querySchemaModel,"change:status",this._fetchRowsData),this.listenTo(this._tableViewModel,"change:sort_order change:order_by",this._fetchRowsData),this._tableModel&&this._tableModel.isSync()){var t=this._tableModel.getSyncModel();this.listenTo(t,"destroy",this.render)}},_setDisableState:function _setDisableState(){this.$(".js-table").toggleClass("is-disabled",!!this._tableViewModel.isDisabled())},_fetchRowsData:function _fetchRowsData(e){var t=e&&s(a).call(a,e.changed),i=p.altersData(this._querySchemaModel.get("query")),n=this._tableViewModel.isCustomQueryApplied(),o=!1;t&&(a.contains(t,"sort_order")||a.contains(t,"order_by"))&&(o=!0),this._querySchemaModel.isFetched()&&!i&&this._rowsCollection.fetch({data:{page:this._tableViewModel.get("page"),order_by:!n||o?this._tableViewModel.get("order_by"):"",sort_order:!n||o?this._tableViewModel.get("sort_order"):"",exclude:!n||o?["the_geom_webmercator"]:[]}})},_initViews:function _initViews(){var e=f(this._analysisDefinitionNodeModel)&&!_(this._analysisDefinitionNodeModel),t=new c({modals:this._modals,queryGeometryModel:this._queryGeometryModel,columnsCollection:this._columnsCollection,tableViewModel:this._tableViewModel,canHideColumns:e});this.addView(t),this.$(".js-table").append(t.render().el);var i=new h({modals:this._modals,columnsCollection:this._columnsCollection,rowsCollection:this._rowsCollection,queryGeometryModel:this._queryGeometryModel,querySchemaModel:this._querySchemaModel,canHideColumns:e,tableViewModel:this._tableViewModel});this.addView(i),this.$(".js-table").append(i.render().el)},_onChangeQueryOrStatus:function _onChangeQueryOrStatus(){var e=this._querySchemaModel.get("status"),t=this._queryGeometryModel.get("status");"unfetched"===e&&this._querySchemaModel.canFetch()&&this._querySchemaModel.fetch(),"unfetched"===t&&this._queryGeometryModel.canFetch()&&this._queryGeometryModel.fetch()},addRow:function addRow(){d({rowsCollection:this._rowsCollection})},addColumn:function addColumn(){u({columnsCollection:this._columnsCollection})},getColumnsCollection:function getColumnsCollection(){return this._columnsCollection},_onQueryChanged:function _onQueryChanged(){this._tableViewModel.resetFetchDefaults()},remove:function remove(){r(".Table-paginator").remove(),o.prototype.remove.apply(this)}})},2480:function(e,t,i){var s=i(1),n=i(1386);e.exports=n.extend({initialize:function initialize(){n.prototype.initialize.apply(this,arguments),this.set("password","!@#!@#")},_attrsToSave:function _attrsToSave(){var e=n.prototype._attrsToSave.call(this);return"!@#!@#"===e.password&&delete e.password,e},canSave:function canSave(){return!this.get("disabled")&&!s.isEmpty(this.get("password"))},isPassword:function isPassword(){return!0}})},2481:function(e,t,i){var s=i(1),n=i(4),o=i(1388),a=s.template("<a href='mailto:<%- mail %>'><%- contact %></a>")({contact:_t("components.modals.publish.privacy.upgrade.contact"),mail:_t("components.modals.publish.privacy.upgrade.mail")});e.exports=n.extend({render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initViews:function _initViews(){var e=o({title:_t("components.modals.publish.privacy.upgrade.title"),desc:_t("components.modals.publish.privacy.upgrade.desc",{contact:a})});this.$el.html(e)}})},2482:function(e,t,i){var s=i(18),n=i(74),o=i(6),a=i(4),r=i(1),l=i(925),c=i(179),h=i(332),d=i(1390),u=["visDefinitionModel","mapcapsCollection","configModel","userModel"];e.exports=a.extend({events:{"click .js-button":"_onUpdate"},initialize:function initialize(e){r.each(u,function(t){if(void 0===e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this),this._modals=new c,this.model=new o.Model({status:"idle"}),this._initBinds()},render:function render(){var e=this._mapcapsCollection.length>0?_t("components.modals.publish.share.last-published",{date:"updated"===this.model.get("status")?n(this._mapcapsCollection.first().get("created_at")).fromNow():n(this._mapcapsCollection.first().get("created_at")).format("Do MMMM YYYY, HH:mm")}):_t("components.modals.publish.share.unpublished");return this.clearSubViews(),this.$el.html(d({isPublished:this._isPublished(),isLoading:this._isLoading(),isDisabled:this._isDisabled(),publishedOn:e})),this},_initBinds:function _initBinds(){this._mapcapsCollection.on("reset",this.render,this),this.add_related_model(this._mapcapsCollection),this.model.on("change:status",this.render,this)},_isPublished:function _isPublished(){return this._mapcapsCollection.length>0},_isLoading:function _isLoading(){return"loading"===this.model.get("status")},_isDisabled:function _isDisabled(){return"updated"===this.model.get("status")},_onUpdate:function _onUpdate(){var e=this,t=this._visDefinitionModel.mapcapsURL(),i={api_key:this._configModel.get("api_key")};if(this._isDisabled())return!1;this._shouldShowPrivacyWarning()?this._checkPrivacyChange(this._visDefinitionModel.get("privacy"),function(){e._createMapCap(t,i)}):this._createMapCap(t,i)},_checkPrivacyChange:function _checkPrivacyChange(e,t,i){this._modals.create(function(s){return new l({modalModel:s,privacyType:e,onConfirm:t,onDismiss:i})})},_createMapCap:function _createMapCap(e,t){var i=this;this.model.set({status:"loading"}),s.post(e,t).done(function(e){i._visDefinitionModel.set("visChanges",0),i._mapcapsCollection.add(e,{at:0}),i.model.set({status:"updated"})}).fail(function(){i.model.set({status:"error"})})},_shouldShowPrivacyWarning:function _shouldShowPrivacyWarning(){return this._userModel.canSelectPremiumOptions(this._visDefinitionModel)&&!this._isPublished()&&h.isPubliclyAvailable(this._visDefinitionModel.get("privacy"))},clean:function clean(){this._modals.destroy(),a.prototype.clean.apply(this,arguments)}})},2483:function(e,t,i){var s=i(4),n=i(1393),o=i(1),a=["onBack","onEdit"];e.exports=s.extend({className:"Editor-boxModal Editor-PrivacyDialog",events:{"click .js-back":"_onClickBack","keyup .js-input":"_onKeyUpInput"},initialize:function initialize(e){o.each(a,function(t){if(void 0===e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this)},render:function render(){return this.$el.empty(),this.$el.html(n()),this},_onKeyUpInput:function _onKeyUpInput(e){27===e.which&&this._onBack(),13===e.which&&this._onEdit&&this._onEdit(this.getValue())},_onClickBack:function _onClickBack(){this._onBack()},getValue:function getValue(){return this.$(".js-input").val()}})},2484:function(e,t,i){var s=i(4),n=i(816),o=i(453),a=i(1394),r=i(1),l=["model","collection","userModel","configModel","visModel"];e.exports=s.extend({className:"Editor-boxModal Privacy-dialog",initialize:function initialize(e){r.each(l,function(t){if(void 0===e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this)},render:function render(){return this.$el.empty(),this.clearSubViews(),this._renderList(),this},_renderList:function _renderList(){var e=this._collection.where({disabled:!0}),t=this._configModel.get("cartodb_com_hosted"),i=this._configModel.get("upgrade_url"),s=new n({model:this._model,collection:this._collection,itemView:o});this.$el.append(s.render().el),this.addView(s);var r=this._visModel.isVisualization()?this._userModel.hasPublicMapSharingDisabled():this._userModel.hasPublicDatasetSharingDisabled();e.length>0&&!t&&i&&!r&&this.$el.append(a({upgradeURL:i,showTrial:this._userModel.canStartTrial()}))}})},2497:function(e,t,i){var s=i(1411);e.exports=s.extend({defaults:{vertical_offset:0,horizontal_offset:0,position:"top|center",template_name:"",template:""},TEMPLATES:{tooltip_dark:i(1402),tooltip_light:i(1401),custom_tooltip_dark:i(1400),custom_tooltip_light:i(1399)},setDefault:function setDefault(){this.setTemplate(this.defaults.template_name)}})},2498:function(e,t,i){i(23),i(40),i(247);var s=i(1411);e.exports=s.extend({defaults:{template_name:"",latlng:[0,0],offset:[28,0],maxHeight:180,autoPan:!0,template:"",content:"",visibility:!1,alternative_names:{},fields:null,width:226,headerColor:{color:{fixed:"#35AAE5",opacity:1}}},TEMPLATES:{infowindow_light:i(1410),infowindow_dark:i(1409),infowindow_color:i(1408),infowindow_header_with_image:i(1407),custom_infowindow_light:i(1406),custom_infowindow_dark:i(1405),custom_infowindow_color:i(1404),custom_infowindow_header_with_image:i(1403)},_transformTemplate:function _transformTemplate(e){var t=this.get("headerColor").color.fixed;return e.replace("background: #35AAE5","background: "+t)},setTemplate:function setTemplate(e){var t=void 0===this.TEMPLATES[e]?"":this.TEMPLATES[e];"infowindow_color"===e&&(t=this._transformTemplate(t));var i={template_name:e,template:t,template_type:"mustache"};""===e&&(i.fields=[]),this.set(i)},isEmptyTemplate:function isEmptyTemplate(){var e=0===this.fieldCount();return this.hasTemplate()&&e},setDefault:function setDefault(){this.setTemplate(this.defaults.template_name)}})},2499:function(e,t,i){var s=i(41),n=i(6),o=i(1),a=i(733);e.exports=n.Model.extend({defaults:{content:""},initialize:function initialize(e,t){this._history=this._generateHistory(t&&t.history),a.init(this,{track:!0,history:this._history})},_generateHistory:function _generateHistory(e){return!(!e||!e.length)&&s(o).call(o,e,function(e,t){return e.push({content:t}),e},[],this)},getHistory:function getHistory(){return o.pluck(this.getUndoHistory(),"content")}})},2500:function(e,t,i){var s=i(41),n=i(6),o=i(733),a=i(1);e.exports=n.Model.extend({defaults:{content:""},initialize:function initialize(e,t){this._history=this._generateHistory(t&&t.history),o.init(this,{track:!0,history:this._history})},_generateHistory:function _generateHistory(e){return!(!e||!e.length)&&s(a).call(a,e,function(e,t){return e.push({content:t}),e},[],this)},getHistory:function getHistory(){return a.pluck(this.getUndoHistory(),"content")}})},2502:function(e,t,i){var s=i(1),n=i(548),o=i(344);e.exports=s.defaults({_getAggrAttrs:function _getAggrAttrs(e){return{aggregation:{dataset:"countries",change:"manual",value:{operator:"count",attribute:""}}}},_getFillAttrs:function _getFillAttrs(e){return{fill:{color:{attribute:"agg_value_density",bins:"5",quantification:"quantiles",range:s.clone(o.Emrld[5])}}}}},n)},2503:function(e,t,i){var s=i(1),n=i(1418);e.exports=s.defaults({_getAggrAttrs:function _getAggrAttrs(e){return{aggregation:{size:12,value:{operator:"count",attribute:""}}}}},n)},2504:function(e,t,i){var s=i(1),n=i(548);e.exports=s.defaults({generateAttributes:function generateAttributes(e){return s.extend(this._getStyleTypeAttrs(),this._getFillAttrs(e),this._getStrokeAttrs(e),{blending:"lighter"},this._getAggrAttrs(e),this._getAnimatedAttrs(e))},_getStyleTypeAttrs:function _getStyleTypeAttrs(){return{style:"simple"}},_getAnimatedAttrs:function _getAnimatedAttrs(e){return{animated:{attribute:null,overlap:!1,duration:30,steps:256,trails:2,resolution:4}}},_getAggrAttrs:function _getAggrAttrs(e){return{aggregation:{}}}},n)},2505:function(e,t,i){var s=i(1),n=i(548),o=i(344);e.exports=s.defaults({generateAttributes:function generateAttributes(e){return s.extend(this._getFillAttrs(e),this._getAggrAttrs(),this._getAnimatedAttrs(),this._getLabelsAttrs())},_getFillAttrs:function _getFillAttrs(e){return{fill:{size:{fixed:45},color:{attribute:"cartodb_id",range:o.ag_Sunset[7],bins:6}}}},_getAggrAttrs:function _getAggrAttrs(){return{aggregation:{}}},_getAnimatedAttrs:function _getAnimatedAttrs(e){return{animated:{attribute:"cartodb_id",overlap:!1,duration:30,steps:1,trails:0,resolution:4}}},_getLabelsAttrs:function _getLabelsAttrs(){return{labels:{}}}},n)},2506:function(e,t,i){i(1420),i(34),i(23),i(88),i(40);var s=i(7),n=i(244),o=i(13),a=i(3),r=i(44),l=i(6),c=i(1),h=i(734),d=i(293),u=i(733);e.exports=l.Model.extend({parse:function parse(e){return e=e||{},c.extend({type:e.type,autogenerated:e&&e.autogenerated},e.properties)},initialize:function initialize(e,t){this.get("type")||this.setDefaultPropertiesByType(d.Type.SIMPLE,"point"),u.init(this,{track:!0})},resetPropertiesFromAutoStyle:function resetPropertiesFromAutoStyle(){this._stylesPreAutoStyle&&(delete this.attributes.autoStyle,this.set(this._stylesPreAutoStyle),this.removeStylesPreAutoStyle())},removeStylesPreAutoStyle:function removeStylesPreAutoStyle(){delete this._stylesPreAutoStyle},setPropertiesFromAutoStyle:function setPropertiesFromAutoStyle(e){var t;if(!e.definition)throw new Error("definition is required");if(!e.geometryType)throw new Error("geometryType is required");if(!e.widgetId)throw new Error("widgetId is required");this._stylesPreAutoStyle||(this._stylesPreAutoStyle=JSON.parse(r(this.attributes))),delete this.attributes.autoStyle;var i=a(t=function _context(e,t){var i=this.get(e);if(t.color&&t.color.domain){var s=c.compact(o(c).call(c,t.color.domain,function(e){return e&&!0!==e?'"'+e.toString().replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"':e}));t.color.static=!0,t.color.domain=s,t.color.quantification="category",t.color.attribute_type="string"}else t.color.bins=t.color.range.length,t.color.quantification="quantiles",t.color.attribute_type="number";return i=c.extend(i,t)}).call(t,this),s=JSON.parse(r(this.attributes)),n=e.geometryType,l=e.definition[n];l&&("line"===n?s.stroke=i("stroke",l):s.fill=i("fill",l)),this.set(c.extend({type:d.Type.SIMPLE,autoStyle:e.widgetId},s))},setDefaultPropertiesByType:function setDefaultPropertiesByType(e,t,i){this.set(c.extend({type:e},h.getDefaultStyleAttrsByType(e,t)),{silently:!!i}),i&&this.trigger("style:update")},setFill:function setFill(e){var t=h.getDefaultStyleAttrsByType(e,"point");this.set("fill",n(t))},applyLastState:function applyLastState(){this._undoManager.stopTracking(),this.trigger("change"),this._undoManager.startTracking()},resetStyles:function resetStyles(){this.setDefaultPropertiesByType(d.Type.NONE,"")},isAutogenerated:function isAutogenerated(){return this.get("autogenerated")},isAggregatedType:function isAggregatedType(){return c.contains(h.getAggregationTypes(),this.get("type"))},isAnimation:function isAnimation(){return this.get("type")===d.Type.ANIMATION},isHeatmap:function isHeatmap(){return this.get("type")===d.Type.HEATMAP},hasNoneStyles:function hasNoneStyles(){return this.get("type")===d.Type.NONE},canApplyAutoStyle:function canApplyAutoStyle(){return this.get("type")===d.Type.SIMPLE},getColumnsUsedForStyle:function getColumnsUsedForStyle(){var e,t=this._getFillColumns(),i=this._getStrokeColumns(),n=this._getLabelColumns(),o=this._getAggregationColumns();return s(e=[]).call(e,t,i,n,o)},toJSON:function toJSON(){return{type:this.get("type"),properties:c.omit(this.attributes,"type","autogenerated")}},_getFillColumns:function _getFillColumns(){var e=[],t=this.get("fill");return t&&t.color&&t.color.attribute&&e.push({name:t.color.attribute,type:t.color.attribute_type||"string"}),t&&t.size&&t.size.attribute&&e.push({name:t.size.attribute,type:"number"}),e},_getStrokeColumns:function _getStrokeColumns(){var e=[],t=this.get("stroke");return t&&t.color&&t.color.attribute&&e.push({name:t.color.attribute,type:t.color.attribute_type||"string"}),t&&t.size&&t.size.attribute&&e.push({name:t.size.attribute,type:"number"}),e},_getLabelColumns:function _getLabelColumns(){var e=[],t=this.get("labels");return t&&t.attribute&&t.enabled&&e.push({name:t.attribute}),e},_getAggregationColumns:function _getAggregationColumns(){var e=[],t=this.get("aggregation");return t&&t.value&&t.value.attribute&&e.push({name:t.value.attribute,type:t.value.attribute_type||"string"}),e}})},2507:function(e,t,i){i(35);var s=i(250),n=i(13),o=i(3),a=i(1),r=i(6),l=i(1424),c=i(1423),h=i(492),d=i(493),u=a.template("SELECT * FROM <%= tableName %>"),p=a.template("SELECT * FROM (<%= sql %>) __wrapped");e.exports=l.extend({defaults:{query:"",sort_order:"asc",rows_per_page:0,page:0,status:d.initial,ready:!1},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");l.prototype.initialize.call(this,e,t),this._configModel=t.configModel,this.columnsCollection=new r.Collection([]),this.rowsCollection=new c([]),this.get("status")===d.initial&&this._setStatusPerQueryValue(),this._addChangeListener()},url:function url(){return this._configModel.getSqlApiUrl()},fetch:function fetch(e){var t,i;if(this.canFetch()){this.set("status",d.fetching),(e=e||{}).errorCallback=e&&(e.originalError||e.error);var s=e&&(e.success||e.complete);return e.data=a.extend(e.data||{},{sort_order:this.get("sort_order"),rows_per_page:this.get("rows_per_page"),page:this.get("page"),api_key:this._configModel.get("api_key"),q:this._getSqlApiQueryParam()}),e.method=this._httpMethod(),e.success=o(t=function _context(e,t){this._resetRepeatedError(),s&&s(t)}).call(t,this),e.error=o(i=function _context2(t,i){if(i&&"abort"!==i.statusText){var s=i.responseText?JSON.parse(i.responseText).error:[];this._incrementRepeatedError(),this.set({query_errors:s,status:this.hasRepeatedErrors()?d.errored:d.unavailable}),e.errorCallback&&e.errorCallback({status:i.status||"Unknown",error:s})}}).call(i,this),r.Model.prototype.fetch.call(this,e)}},parse:function parse(e){return this.rowsCollection.reset(e.rows),this.columnsCollection.reset(n(a).call(a,e.fields,function(e,t){return{name:t,type:e.type}})),{status:d.fetched}},hasDefaultQueryFor:function hasDefaultQueryFor(e){if(!this.hasQuery())return!1;var t=u({tableName:e});return h.isSameQuery(this.get("query"),t)},getColumnNames:function getColumnNames(){return this.columnsCollection.pluck("name")},getColumnType:function getColumnType(e){return this.isFetched()?this.columnsCollection.findWhere({name:e}).get("type"):void 0},_onChange:function _onChange(){this._removeChangeListener(),this.hasChanged("status")||this.get("status")!==d.fetching?this.hasChanged("query")&&(this.columnsCollection.reset(),this._setStatusPerQueryValue()):this.fetch(),this._addChangeListener()},_setStatusPerQueryValue:function _setStatusPerQueryValue(){this.set("status",this.get("query")?d.unfetched:d.unavailable,{silent:!0})},setError:function setError(e){var t=this.get("query_errors");t&&t.length||(this._incrementRepeatedError(),this.set({query_errors:e,status:this.hasRepeatedErrors()?d.errored:d.unavailable}))},hasDifferentSchemaThan:function hasDifferentSchemaThan(e){return!s(a).call(a,e,function(e){var t=this.columnsCollection.findWhere({name:e.name});return t&&(t.get("type")===e.type||null==e.type)},this)},resetDueToAlteredData:function resetDueToAlteredData(){this.set("status",d.unfetched),this.trigger("resetDueToAlteredData"),this.fetch()},_getSqlApiQueryParam:function _getSqlApiQueryParam(){return p({sql:this.get("query")})}})},2508:function(e,t,i){i(34),i(67);var s=i(49),n=i(65),o=i(3),a=i(1),r=i(6),l=i(1424),c=i(493),h=a.template("SELECT CASE LOWER(ST_GeometryType(<%= geom_column %>))      WHEN 'st_polygon' THEN 'polygon'      WHEN 'st_multipolygon' THEN 'polygon'      WHEN 'st_multilinestring' THEN 'line'      WHEN 'st_linestring' THEN 'line'      WHEN 'st_multipoint' THEN 'point'      WHEN 'st_point' THEN 'point'      ELSE ''   END AS the_geom FROM (<%= sql %>) __wrapped WHERE <%= geom_column %> IS NOT NULL"),d={sort_order:"asc",rows_per_page:40,page:0},u="polygon";e.exports=l.extend({defaults:{query:"",status:c.initial,simple_geom:"",ready:!1},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");l.prototype.initialize.call(this,e,t),this._configModel=t.configModel,this._addChangeListener()},url:function url(){return this._configModel.getSqlApiUrl()},fetch:function fetch(e){var t,i;if(this.canFetch()){this.set("status",c.fetching),(e=e||{}).errorCallback=e&&(e.originalError||e.error);var s=e&&(e.success||e.complete);return e.data=a.extend(e.data||{},{api_key:this._configModel.get("api_key"),q:this._getSqlApiQueryParam(e.geomColumnName)},d),e.method=this._httpMethod(),e.success=o(t=function _context(e,t){this._resetRepeatedError(),s&&s(t)}).call(t,this),e.error=o(i=function _context2(t,i){if(i&&"abort"!==i.statusText){var s=i.responseText?JSON.parse(i.responseText).error:[];1===s.length&&'column "the_geom" does not exist'===s[0]?this.fetch(a.extend({},a.omit(e,"success"),{originalError:e.errorCallback,geomColumnName:"the_geom_webmercator"})):(this._incrementRepeatedError(),this.set({simple_geom:"",query_errors:s,status:this.hasRepeatedErrors()?c.errored:c.unavailable}),e.errorCallback&&e.errorCallback({status:i.status||"Unknown",error:s}))}}).call(i,this),r.Model.prototype.fetch.call(this,e)}},parse:function parse(e){var t;return n(a).call(a,e.rows,function(e){return!!(t=e.the_geom)}),{status:c.fetched,simple_geom:t||""}},hasValue:function hasValue(){throw new Error("QueryGeometryModel.hasValue() is an async operation. Use `.hasValueAsync` instead.")},hasValueAsync:function hasValueAsync(){var e=this;return this.isFetched()?s.resolve(!!this.get("simple_geom")):new s(function(t){e.listenToOnce(e,"inFinalStatus",function(){t(!!e.get("simple_geom"))})})},_onChange:function _onChange(){this._removeChangeListener(),this.hasChanged("status")||this.get("status")!==c.fetching?(this.hasChanged("query")||this.hasChanged("ready"))&&this.set("status",this.get("query")?c.unfetched:c.unavailable,{silent:!0}):this.hasChanged("query")&&this.fetch(),this._addChangeListener()},_getSqlApiQueryParam:function _getSqlApiQueryParam(e){return h({geom_column:e||"the_geom",sql:this.get("query")})},isPolygon:function isPolygon(){return this.get("simple_geom")===u}})},2523:function(e,t,i){var s=i(736),n=i(1);e.exports=s.extend({defaults:{normalized:!0,animated:!1},defaultState:n.extend({normalized:!1},s.prototype.defaultState),getState:function(){var e,t,i=s.prototype.getState.call(this),o=this.dataviewModel.get("start"),a=this.dataviewModel.get("end"),r=this.dataviewModel.get("data"),l=this.get("lo_index"),c=this.get("hi_index"),h=function(e,t){return!!(n.isNumber(e)&&n.isNumber(t)&&e!==t&&Math.abs(e-t)>.01*Math.abs(o-a))};return n.isNumber(l)&&n.isNumber(c)&&l<r.length&&c-1<r.length?(e=r[l].start,t=r[c-1].end):(e=o,t=a),h(o,e)&&(i.min=e),h(a,t)&&(i.max=t),i}})},2524:function(e,t,i){var s=i(1),n=i(736);e.exports=n.extend({defaults:{normalized:!0},defaultState:s.extend({autoStyle:!1,normalized:!1},n.prototype.defaultState),initialize:function(e,t){n.prototype.initialize.apply(this,arguments),this.on("change:collapsed",this._onCollapsedChange,this),this.on("change:style",this._updateAutoStyle,this),this.dataviewModel.once("change",function(){this.get("autoStyle")&&this.autoStyle()},this)},_onCollapsedChange:function(e,t){this.dataviewModel.set("enabled",!t)},getState:function(){var e=n.prototype.getState.call(this),t=this.dataviewModel.get("start"),i=this.dataviewModel.get("end"),o=this.get("min"),a=this.get("max"),r=function(e,n){return!!(s.isNumber(e)&&s.isNumber(n)&&e!==n&&Math.abs(e-n)>.01*Math.abs(t-i))};return r(t,o)?e.min=o:delete e.min,r(i,a)?e.max=a:delete e.max,!0===this.get("zoomed")&&(e.zoomed=!0),e}})},2525:function(e,t,i){var s=i(1),n=i(6);e.exports=n.Collection.extend({addItem:function(e){this.isItemLocked(e.get("name"))||this.add(e)},addItems:function(e){s.each(e,function(e){this.isItemLocked(e.name)||this.add(e)},this)},resetItems:function(e){this.reset(e)},removeItem:function(e){var t=this.isItemLocked(e.get("name"));t&&this.remove(t)},removeItems:function(){this.reset([])},isItemLocked:function(e){return this.find(function(t){return t.get("name")===e})},getItemsName:function(){return this.pluck("name")}})},2526:function(e,t,i){var s=i(1),n=i(736),o=i(2525);e.exports=n.extend({defaults:s.extend({type:"category",search:!1,locked:!1},n.prototype.defaults),defaultState:s.extend({acceptedCategories:[],locked:!1,autoStyle:!1},n.prototype.defaultState),initialize:function(){n.prototype.initialize.apply(this,arguments),this.lockedCategories=new o,this.listenTo(this.dataviewModel,"change:allCategoryNames",this._onDataviewAllCategoryNamesChange),this.on("change:locked",this._onLockedChange,this),this.on("change:collapsed",this._onCollapsedChange,this),this.isAutoStyleEnabled()&&this.on("change:style",this._updateAutoStyle,this),this.dataviewModel.filter.on("change",function(){this.set("acceptedCategories",this._acceptedCategories().pluck("name"))},this),this.dataviewModel.once("change:allCategoryNames",function(){this.get("autoStyle")&&this.autoStyle()},this)},setupSearch:function(){this.dataviewModel.setupSearch(),this.lockedCategories.addItems(this._acceptedCategories().toJSON()),this.toggleSearch()},toggleSearch:function(){this.set("search",!this.get("search"))},enableSearch:function(){this.set("search",!0)},disableSearch:function(){this.set("search",!1)},isSearchEnabled:function(){return this.get("search")},cleanSearch:function(){this.dataviewModel.cleanSearch(),this.lockedCategories.reset([])},autoStyle:function(){this.autoStyler.colors.updateData(this.dataviewModel.get("allCategoryNames")),n.prototype.autoStyle.call(this)},isLocked:function(){return this.get("locked")},canBeLocked:function(){return this.isLocked()||this._acceptedCategories().size()>0},canApplyLocked:function(){return this._acceptedCategories().size()!==this.lockedCategories.size()||this._acceptedCategories().any(function(e){return!this.lockedCategories.isItemLocked(e.get("name"))},this)},applyLocked:function(){var e=this.lockedCategories.getItemsName();if(!e.length)return this.unlockCategories(),!1;this.set("locked",!0);var t=this.dataviewModel.filter;t.cleanFilter(!1),t.accept(e),t.applyFilter(),this.cleanSearch()},lockCategories:function(){this.set("locked",!0),this.dataviewModel.fetch()},unlockCategories:function(){this.set("locked",!1),this.dataviewModel.filter.acceptAll()},_onDataviewAllCategoryNamesChange:function(e,t){this.isAutoStyleEnabled()&&(this.isAutoStyle()||this.autoStyler.colors.updateData(t))},_onLockedChange:function(e,t){t?this.dataviewModel.enableFilter():this.dataviewModel.disableFilter()},_acceptedCategories:function(){return this.dataviewModel.filter.acceptedCategories},_onCollapsedChange:function(e,t){this.dataviewModel.set("enabled",!t)}})},2527:function(e,t,i){var s=i(1),n=i(344),o=i(1440),a=i(1439),r=o.extend({updateStyle:function(e){this.styles=e.auto_style},_getFillColor:function(e){var t=this._getColor(),i=t||{};if(!t){var s=this.dataviewModel.getDistributionType(this.dataviewModel.getUnfilteredDataModel().get("data"));i=r.SCALES_MAP[e][s]}return"ramp(["+this.dataviewModel.get("column")+"], "+(t?"('"+i.range.join("', '")+"'), ":"cartocolor("+i.palette+", "+this.dataviewModel.get("bins")+"), ")+(i.quantification+")")},getDef:function(e){var t={},i=this.dataviewModel.getDistributionType(this.dataviewModel.getUnfilteredDataModel().get("data")),l=this.dataviewModel.get("bins"),c=this.dataviewModel.get("column"),h=this.styles,d=this.styles&&this.styles.custom||!1;return o.FILL_SELECTORS.forEach(function(o){if(a.isPropertyIncluded(e,o)){var u=r.SCALES_MAP[o][i],p=o.substring(0,o.indexOf("-")),g={};u&&(g=!0===d?s.extend(g,h.definition):{color:{range:n[u.palette][l]||n[u.palette][Object.keys(n[u.palette]).length],quantification:u.quantification,attribute:c}}),t["marker"===p?"point":p]=g}}),t}});r.SCALES_MAP={"polygon-fill":{F:{palette:"PinkYl",quantification:"equal"},L:{palette:"Emrld",quantification:"headtails"},J:{palette:"Emrld",quantification:"headtails"},A:{palette:"Geyser",quantification:"quantiles"},C:{palette:"Sunset",quantification:"jenks"},U:{palette:"Sunset",quantification:"jenks"}},"line-color":{F:{palette:"PinkYl",quantification:"equal"},L:{palette:"Emrld",quantification:"headtails"},J:{palette:"Emrld",quantification:"headtails"},A:{palette:"Geyser",quantification:"quantiles"},C:{palette:"Sunset",quantification:"jenks"},U:{palette:"Sunset",quantification:"jenks"}},"marker-fill":{F:{palette:"RedOr",quantification:"equal"},L:{palette:"BluYl",quantification:"headtails"},J:{palette:"BluYl",quantification:"headtails"},A:{palette:"Geyser",quantification:"quantiles"},C:{palette:"SunsetDark",quantification:"jenks"},U:{palette:"SunsetDark",quantification:"jenks"}}},e.exports=r},2528:function(e,t,i){var s=i(1),n=["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74"];function CategoryColors(e){this.updateColors(e)}CategoryColors.prototype.updateColors=function(e){var t=function getColorRange(e){return e&&e.definition&&e.definition.color&&e.definition.color.range||n}(e);this.colors={},s.each(t,function(e){this.colors[e]=null},this)},CategoryColors.prototype.updateData=function(e){s.each(this.colors,function(t,i){s.contains(e,t)?e=s.without(e,t):this.colors[i]=null},this),s.each(e,function(e){var t=this.getNextAvailableColor();t&&(this.colors[t]=e)},this)},CategoryColors.prototype.getNextAvailableColor=function(){for(var e in this.colors)if(null===this.colors[e])return e;return null},CategoryColors.prototype.getColorByCategory=function(e){for(var t in this.colors)if(this.colors[t]===e)return t;return"#A5AA99"},CategoryColors.prototype.getCategoryByColor=function(e){return this.colors[e]},e.exports=CategoryColors},253:function(e,t,i){"use strict";i.d(t,"a",function(){return getBaseURL}),i.d(t,"b",function(){return getMetricsBaseURL});var s=i(68),n=i.n(s),o=i(7),a=i.n(o);function getBaseURL(e){var t;if(e.config){var i,s=e.config.user_name,o=e.config.account_host;return a()(i="https://".concat(s,".")).call(i,o,"/api/v4")}return n()(t=window.location.hostname).call(t,"staging")?"https://public.carto-staging.com/api/v4":"https://public.carto.com/api/v4"}function getMetricsBaseURL(e){return"".concat(e.config.base_url,"/api/v3/metrics")}},2549:function(e,t,i){var s=i(1),n=i(1440);e.exports=n.extend({updateStyle:function(e){this.styles=e.auto_style,this.colors.updateColors(e.auto_style),this.colors.updateData(s.pluck(this.dataviewModel.get("data"),"name"))},_getRange:function(){return s.map(this.dataviewModel.get("data"),function(e){return this.colors.getColorByCategory(e.name)},this)},getDef:function(){var e=this.dataviewModel,t=e.get("data"),i=this._getRange(),o={};return n.FILL_SELECTORS.forEach(function(n){var a,r=n.substring(0,n.indexOf("-"));a={color:{domain:s.pluck(t,"name"),range:i,attribute:e.get("column")}},o["marker"===r?"point":r]=a}),o},_getFillColor:function(){var e=this.dataviewModel,t=e.get("data"),i=e.get("column");return this._getCategoryRamp(t,i)},_getCategoryRamp:function(e,t){for(var i="ramp(["+t+"], ",s="",n="",o=0;o<e.length;o++){var a=e[o],r=o!==e.length-1?", ":"";s+='"'+this.colors.getColorByCategory(a.name)+'"'+r,a.agg?o===e.length-1&&(n=n.substring(0,n.length-2)):"string"!=typeof a.name?n+=a.name+r:n+='"'+String(a.name).replace(/"/g,'\\"')+'"'+r}return i+"("+s+"), ("+n+"), '=')"}})},2550:function(e,t,i){var s={category:i(2549),histogram:i(2527)};e.exports={get:function(e,t,i){var n=s[e.get("type")];if(n)return new n(e,t,i);throw new Error("dataview type not supported")}}},2551:function(e,t,i){var s=i(1),n=i(736),o=i(2526),a=i(2524),r=i(2523),l={auto_style_allowed:"autoStyleEnabled"},c=function(e){return s.reduce(l,function(t,i,s){if(void 0!==e[s])return t[i]=e[s],t},{})},h=function(e,t){s.each(t,function(t){if(void 0===e[t])throw new Error(t+" is required")})},d=function(e,t,i){return s.extend(e,t,{hasInitialState:i})},u=function(e){if(!(e.source instanceof Object&&e.source.cid))throw new Error("Source must be defined and be an instance of AnalysisModel.")},p=function(e,t){this._widgetsCollection=e,this._dataviews=t};p.prototype.getCollection=function(){return this._widgetsCollection},p.prototype.get=function(e){return this._widgetsCollection.get(e)},p.prototype.getList=function(){return this._widgetsCollection.models},p.prototype.createCategoryModel=function(e,t,i){h(e,["title"]);var n=d(e,i,this._widgetsCollection.hasInitialState());u(n);var a=this._dataviews.createCategoryModel(n),r=["id","title","order","collapsed","prefix","suffix","show_stats","show_source","style","hasInitialState"],l=s.pick(n,r),p=c(n);l.attrsNames=r;var g=new o(l,{dataviewModel:a,layerModel:t},p);return g.setInitialState(i),this._widgetsCollection.add(g),g},p.prototype.createHistogramModel=function(e,t,i,n){h(e,["title"]);var o=d(e,i,this._widgetsCollection.hasInitialState());u(o);var r=this._dataviews.createHistogramModel(o);r.has("bins")||r.set("bins",10,{silent:!0});var l=["id","title","order","collapsed","bins","show_stats","show_source","normalized","style","hasInitialState","table_name"],p=s.pick(o,l),g=c(o);p.type="histogram",p.attrsNames=l;var m=new a(p,{dataviewModel:r,layerModel:t},g);return m.setInitialState(i),this._widgetsCollection.add(m),m},p.prototype.createFormulaModel=function(e,t,i){h(e,["title"]);var o=d(e,i,this._widgetsCollection.hasInitialState());u(o);var a=this._dataviews.createFormulaModel(o),r=["id","title","order","collapsed","prefix","suffix","show_stats","show_source","description","hasInitialState"],l=s.pick(o,r);l.type="formula",l.attrsNames=r;var c=new n(l,{dataviewModel:a,layerModel:t});return c.setInitialState(i),this._widgetsCollection.add(c),c},p.prototype.createTimeSeriesModel=function(e,t,i,n){e.column_type=e.column_type||"date",u(e);var o=this._dataviews.createHistogramModel(e),a=["id","style","title","normalized","animated","timezone"],l=s.pick(e,a);l.type="time-series",l.attrsNames=a;var c=new r(l,{dataviewModel:o,layerModel:t},n);return c.setInitialState(i),this._widgetsCollection.add(c),c},p.prototype.setWidgetsState=function(e){this._widgetsCollection.setStates(e)},e.exports=p},2552:function(e,t,i){var s=i(1),n=i(6);e.exports=n.Collection.extend({comparator:"order",initialize:function(){this._allDataviewsFetched=!1,this._initBinds()},_initBinds:function(){this.bind("change:order",s.debounce(this._onChangeOrder.bind(this),10),this),this.bind("change:autoStyle",function(e,t){t&&this.each(function(t){t.layerModel&&t!==e&&t.layerModel.get("layer_name")===e.layerModel.get("layer_name")&&t.get("autoStyle")&&t.set("autoStyle",!1)})},this)},_onChangeOrder:function(){this.sort(),this.trigger("orderChanged",this)},getStates:function(){var e={};return this.each(function(t){var i=t.getState();s.isEmpty(i)||(e[t.get("id")]=i)}),e},setStates:function(e){for(var t in e){this.at(t).setState(e[t])}},hasInitialState:function(){return this._allDataviewsFetched},initialState:function(){this._allDataviewsFetched=!0}})},2553:function(e,t,i){var s=i(4),n=i(58),o=i(1444);e.exports=s.extend({className:"CDB-Widget-title CDB-Widget-contentSpaced",events:{"click .js-autoStyle":"_autoStyle","click .js-cancelAutoStyle":"_cancelAutoStyle"},initialize:function(e){if(!e.widgetModel)throw new Error("widgetModel is required");if(!e.dataviewModel)throw new Error("dataviewModel is required");if(!e.layerModel)throw new Error("layerModel is required");this.widgetModel=e.widgetModel,this.dataviewModel=e.dataviewModel,this._layerModel=e.layerModel,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(o({title:this.widgetModel.get("title"),isAutoStyleEnabled:this._isAutoStyleButtonVisible(),isAutoStyle:this.widgetModel.get("autoStyle"),isCollapsed:this.widgetModel.get("collapsed")})),this._initViews(),this},_initBinds:function(){this.widgetModel.bind("change:title change:collapsed change:autoStyle change:style",this.render,this),this.add_related_model(this.widgetModel),this._layerModel.bind("change:visible change:cartocss",this.render,this),this.add_related_model(this._layerModel)},_initViews:function(){var e=new n({el:this.$el.find(".js-sizes"),gravity:"auto"});this.addView(e);var t=new n({el:this.$el.find(".js-actions"),gravity:"auto"});this.addView(t)},_isAutoStyleButtonVisible:function(){var e=this._layerModel.get("meta"),t=(this._layerModel.get("cartocss")||e&&e.cartocss)&&this.widgetModel.hasColorsAutoStyle();return this.widgetModel.isAutoStyleEnabled()&&this._layerModel.get("visible")&&t},_autoStyle:function(){this.widgetModel.autoStyle()},_cancelAutoStyle:function(){this.widgetModel.cancelAutoStyle()}})},2554:function(e,t,i){var s=i(1),n=i(4),o=i(392),a=i(2553),r=i(1469),l=i(973),c=i(1443),h=i(611),d=i(58),u=i(737),p=i(1442),g=i(610),m=i(609),f=i(608);e.exports=n.extend({className:"CDB-Widget-body",defaults:{chartHeight:72},events:{"click .js-clear":"_resetWidget","click .js-zoom":"_zoom"},initialize:function(){this._dataviewModel=this.model.dataviewModel,this._layerModel=this.model.layerModel,this._originalData=this._dataviewModel.getUnfilteredDataModel(),this.filter=this._dataviewModel.filter,this.lockedByUser=!1,this._numberOfFilters=0,this._initStateApplied=!1,this._originalData.get("hasBeenFetched")?this._initBinds():this.listenToOnce(this._originalData,"change:hasBeenFetched",function(){this._initBinds()}),window.addEventListener("resize",this._onWindowResized.bind(this),{passive:!0})},render:function(){this.clearSubViews(),this._unbinds(),this.$el.toggleClass("is-collapsed",!!this.model.get("collapsed"));var e=this._dataviewModel.getData(),t=this._dataviewModel.hasNulls(),i=this._originalData.getData(),n=!s.size(e)&&!s.size(i),o=this._dataviewModel.get("source").id,a=g.letter(o),r=g.getColorForLetter(a),l=this._dataviewModel.getSourceType()||"",h=this._dataviewModel.isSourceType(),d=h?this.model.get("table_name"):this._layerModel.get("layer_name");return this.$el.html(c({title:this.model.get("title"),sourceId:o,sourceType:m.title(l),isSourceType:h,showStats:this.model.get("show_stats"),showNulls:t,showSource:this.model.get("show_source")&&""!==a,itemsCount:n?"-":e.length,isCollapsed:!!this.model.get("collapsed"),sourceColor:r,layerName:f(d)})),n?(this._addPlaceholder(),this._initTitleView()):(this._setupBindings(),this._initViews()),this},_initViews:function(){this._initTitleView(),this._initDropdownView(),this._renderMiniChart(),this._renderMainChart(),this._renderAllValues()},_onWindowResized:function(){window.innerWidth<1200&&this.histogramChartView&&this.histogramChartView.forceResize()},_initDropdownView:function(){var e=new h({model:this.model,target:".js-actions",container:this.$(".js-header"),flags:{normalizeHistogram:!0}});this.addView(e)},_toggleTooltip:function(e){if(!e||!e.target)return this._clearTooltip();this._showTooltip(e)},_showTooltip:function(e){this.tooltip&&e&&this.tooltip.getElement()===e.target||(this._clearTooltip(),this.tooltip=new d({el:e.target,title:"data-tooltip",trigger:"manual"}),this.tooltip.showTipsy(),this.addView(this.tooltip))},_clearTooltip:function(){this.tooltip&&(this.tooltip.hideTipsy(),this.removeView(this.tooltip),this.tooltip=void 0)},_initTitleView:function(){var e=new a({widgetModel:this.model,dataviewModel:this._dataviewModel,layerModel:this._layerModel});this.$(".js-title").append(e.render().el),this.addView(e)},_initBinds:function(){this.listenTo(this.model,"change:collapsed",this.render),this.listenTo(this.model,"change:normalized",this._onNormalizedChanged),!0===this.model.get("hasInitialState")?this._setInitialState():this.listenTo(this.model,"change:hasInitialState",this._setInitialState),this.listenTo(this._layerModel,"change:layer_name",this.render)},_setInitialState:function(){0===this._dataviewModel.getData().length?this._dataviewModel.once("change:data",this._onInitialState,this):this._onInitialState()},_onNormalizedChanged:function(){var e=this.model.get("normalized");this.histogramChartView.setNormalized(e),this.miniHistogramChartView.setNormalized(e)},_onInitialState:function(){this.add_related_model(this._dataviewModel),this.render(),!0===this.model.get("autoStyle")&&this.model.autoStyle(),this._hasRange()&&(this._numberOfFilters=1),this._isZoomed()&&(this._numberOfFilters=2),0!==this._numberOfFilters?this._setInitialRange():this._completeInitialState()},_setupRange:function(e,t,i,n){var o,a,r=0,l=e.length;s.isNumber(t)&&(r=(o=s.findWhere(e,{start:t}))?o.bin:0),s.isNumber(i)&&(l=(a=s.findWhere(e,{end:i}))?a.bin+1:e.length),(r&&0!==r||l&&l!==e.length)&&(this.filter.setRange(e[r].start,e[l-1].end),this._onChangeFilterEnabled(),this.histogramChartView.selectRange(r,l)),n&&n(r,l)},_setInitialRange:function(){var e=this._dataviewModel.getData(),t=this.model.get("min"),i=this.model.get("max"),s=void 0!==t||void 0!==i;this._setupRange(e,t,i,function(e,t){this.model.set({filter_enabled:s,lo_index:e,hi_index:t}),this._dataviewModel.bind("change:data",this._onHistogramDataChanged,this),this._initStateApplied=!0,this._isZoomed()?(this._onChangeZoomEnabled(),this._onZoomIn()):this._updateStats()}.bind(this))},_completeInitialState:function(){this._dataviewModel.bind("change:data",this._onHistogramDataChanged,this),this._initStateApplied=!0,this._updateStats()},_isZoomed:function(){return this.model.get("zoomed")},_hasRange:function(){var e=this.model.get("min"),t=this.model.get("max");return null!=e||null!=t},_onHistogramDataChanged:function(){this._dataviewModel.changed.url&&this._isZoomed()||(this.lockedByUser?this.lockedByUser=!1:(this._isZoomed()?this._filteredData=this._dataviewModel.getData():(this.histogramChartView.showShadowBars(),this.miniHistogramChartView.replaceData(this._dataviewModel.getData())),this.histogramChartView.replaceData(this._dataviewModel.getData())),this.unsettingRange&&this._unsetRange(),this._updateStats())},_unsetRange:function(){this.unsettingRange=!1,this.histogramChartView.replaceData(this._dataviewModel.getData()),this.model.set({lo_index:null,hi_index:null}),this._isZoomed()||this.histogramChartView.showShadowBars()},_addPlaceholder:function(){this.$(".js-content").append(l())},_renderMainChart:function(){this.histogramChartView=new r({type:"histogram",margin:{top:4,right:4,bottom:4,left:4},hasHandles:!0,hasAxisTip:!0,chartBarColor:this.model.getColor()||"#9DE0AD",width:this.canvasWidth,height:this.defaults.chartHeight,data:this._dataviewModel.getData(),dataviewModel:this._dataviewModel,layerModel:this._layerModel,originalData:this._originalData,displayShadowBars:!this.model.get("normalized"),normalized:this.model.get("normalized"),widgetModel:this.model}),this.$(".js-chart").append(this.histogramChartView.el),this.addView(this.histogramChartView),this.histogramChartView.bind("on_brush_end",this._onBrushEnd,this),this.histogramChartView.bind("hover",this._toggleTooltip,this),this.histogramChartView.render().show(),this._updateStats()},_renderMiniChart:function(){this.miniHistogramChartView=new r({type:"histogram",className:"CDB-Chart--mini",mini:!0,margin:{top:0,right:4,bottom:4,left:4},height:40,showOnWidthChange:!1,dataviewModel:this._dataviewModel,layerModel:this._layerModel,data:this._dataviewModel.getData(),normalized:this.model.get("normalized"),chartBarColor:this.model.getColor()||"#9DE0AD",originalData:this._originalData,widgetModel:this.model}),this.addView(this.miniHistogramChartView),this.$(".js-mini-chart").append(this.miniHistogramChartView.el),this.miniHistogramChartView.bind("on_brush_end",this._onMiniRangeUpdated,this),this.miniHistogramChartView.render()},_setupBindings:function(){this._dataviewModel.bind("change:bins",this._onChangeBins,this),this.model.bind("change:zoomed",this._onChangeZoomed,this),this.model.bind("change:zoom_enabled",this._onChangeZoomEnabled,this),this.model.bind("change:filter_enabled",this._onChangeFilterEnabled,this),this.model.bind("change:total",this._onChangeTotal,this),this.model.bind("change:nulls",this._onChangeNulls,this),this.model.bind("change:max",this._onChangeMax,this),this.model.bind("change:min",this._onChangeMin,this),this.model.bind("change:avg",this._onChangeAvg,this)},_unbinds:function(){this._dataviewModel.off("change:bins",this._onChangeBins,this),this.model.off("change:zoomed",this._onChangeZoomed,this),this.model.off("change:zoom_enabled",this._onChangeZoomEnabled,this),this.model.off("change:filter_enabled",this._onChangeFilterEnabled,this),this.model.off("change:total",this._onChangeTotal,this),this.model.off("change:nulls",this._onChangeNulls,this),this.model.off("change:max",this._onChangeMax,this),this.model.off("change:min",this._onChangeMin,this),this.model.off("change:avg",this._onChangeAvg,this)},_onMiniRangeUpdated:function(e,t){this.lockedByUser=!1,this._clearTooltip(),this.histogramChartView.removeSelection();var i=this._originalData.getData();this.model.set({lo_index:e,hi_index:t,zlo_index:null,zhi_index:null}),this._applyBrushFilter(i,e,t)},_onBrushEnd:function(e,t){this._isZoomed()?this._onBrushEndFiltered(e,t):this._onBrushEndUnfiltered(e,t)},_onBrushEndFiltered:function(e,t){var i=this._filteredData;i&&i.length&&(this.model.get("zlo_index")!==e||this.model.get("zhi_index")!==t)&&(this._numberOfFilters=2,this.lockedByUser=!0,this.model.set({filter_enabled:!0,zlo_index:e,zhi_index:t}),this._applyBrushFilter(i,e,t))},_onBrushEndUnfiltered:function(e,t){var i=this._dataviewModel.getData();i&&i.length&&(this.model.get("lo_index")!==e||this.model.get("hi_index")!==t)&&(this._numberOfFilters=1,this.model.set({filter_enabled:!0,zoom_enabled:!0,lo_index:e,hi_index:t}),this._applyBrushFilter(i,e,t))},_applyBrushFilter:function(e,t,i){t!==i&&t>=0&&t<e.length&&i-1>=0&&i-1<e.length?(this.filter.setRange(e[t].start,e[i-1].end),this._updateStats()):console.error("Error accessing array bounds",t,i,e)},_onChangeFilterEnabled:function(){this.$(".js-filter").toggleClass("is-hidden",!this.model.get("filter_enabled"))},_onChangeBins:function(e,t){this._resetWidget()},_onChangeZoomEnabled:function(){this.$(".js-zoom").toggleClass("is-hidden",!this.model.get("zoom_enabled"))},_renderAllValues:function(){this._changeHeaderValue(".js-nulls","nulls",""),this._changeHeaderValue(".js-val","total","SELECTED"),this._changeHeaderValue(".js-max","max",""),this._changeHeaderValue(".js-min","min",""),this._changeHeaderValue(".js-avg","avg","")},_changeHeaderValue:function(e,t,i){null!=this.model.get(t)?(this._addTitleForValue(e,t,i),new u({el:this.$el}).animateValue(this.model,t,e,p,{formatter:o.formatNumber,templateData:{suffix:" "+i}})):this.$(e).text("0 "+i)},_onChangeNulls:function(){this._changeHeaderValue(".js-nulls","nulls","")},_onChangeTotal:function(){this._changeHeaderValue(".js-val","total","SELECTED")},_onChangeMax:function(){this._changeHeaderValue(".js-max","max","")},_onChangeMin:function(){this._changeHeaderValue(".js-min","min","")},_onChangeAvg:function(){this._changeHeaderValue(".js-avg","avg","")},_addTitleForValue:function(e,t,i){this.$(e).attr("title",this._formatNumberWithCommas(this.model.get(t).toFixed(2))+" "+i)},_formatNumberWithCommas:function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},_calculateBars:function(e){var t,i,n,o,a,r;return this._isZoomed()&&2===this._numberOfFilters?(t=this.model.get("zmin"),i=this.model.get("zmax"),n=this.model.get("zlo_index"),o=this.model.get("zhi_index")):1===this._numberOfFilters&&(t=this.model.get("min"),i=this.model.get("max"),n=this.model.get("lo_index"),o=this.model.get("hi_index")),e.length>0?(s.isNumber(t)||s.isNumber(n)?s.isNumber(t)&&!s.isNumber(n)&&(n=(a=s.findWhere(e,{start:t}))&&a.bin||0):n=0,s.isNumber(i)||s.isNumber(o)?s.isNumber(i)&&!s.isNumber(o)&&(o=(r=s.findWhere(e,{end:i}))&&r.bin+1||e.length):o=e.length):(n=0,o=e.length),{loBarIndex:n,hiBarIndex:o}},_updateStats:function(){var e;if(this._initStateApplied&&null!=(e=!this._isZoomed()||this._isZoomed()&&2===this._numberOfFilters?this.histogramChartView.model.get("data"):this.miniHistogramChartView.model.get("data"))){var t,i,n,o,a,r=this._dataviewModel.get("nulls"),l=this._calculateBars(e),c=l.loBarIndex,h=l.hiBarIndex;e&&e.length&&(t=this._calcSum(e,c,h),i=this._calcAvg(e,c,h),c>=0&&c<e.length&&(n=e[c].start),h>=0&&h-1<e.length&&(o=e[Math.max(0,h-1)].end),this._isZoomed()&&2===this._numberOfFilters?a={zmin:n,zmax:o,zlo_index:c,zhi_index:h}:this._isZoomed()||1!==this._numberOfFilters||(a={min:n,max:o,lo_index:c,hi_index:h}),a=s.extend({total:t,nulls:r,avg:i},a),this.model.set(a))}},_calcAvg:function(e,t,i){var n=e.slice(t,i),o=this._calcSum(e,t,i);return o?s.reduce(n,function(e,t){return t.avg&&t.freq?t.avg*t.freq+e:e},0)/o:0},_calcSum:function(e,t,i){return s.reduce(e.slice(t,i),function(e,t){return t.freq+e},0)},_onChangeZoomed:function(){this.model.get("zoomed")?this._onZoomIn():(this._resetWidget(),this._dataviewModel.fetch())},_showMiniRange:function(){var e=this.model.get("lo_index"),t=this.model.get("hi_index");this.miniHistogramChartView.selectRange(e,t),this.miniHistogramChartView.show()},_zoom:function(){this.model.set({zoomed:!0,zoom_enabled:!1}),this.histogramChartView.removeSelection()},_onZoomIn:function(){this.lockedByUser=!1,this._showMiniRange(),this.histogramChartView.setBounds(),this._dataviewModel.enableFilter(),this._dataviewModel.fetch()},_resetWidget:function(){this._numberOfFilters=0,this.model.set({zoomed:!1,zoom_enabled:!1,filter_enabled:!1,lo_index:null,hi_index:null,min:null,max:null,zlo_index:null,zhi_index:null,zmin:null,zmax:null}),this.filter.unsetRange(),this._dataviewModel.disableFilter(),this.histogramChartView.unsetBounds(),this.miniHistogramChartView.hide(),this._clearTooltip(),this._updateStats()},clean:function(){window.removeEventListener("resize",this._onWindowResized.bind(this)),n.prototype.clean.apply(this)}})},2555:function(e,t,i){var s=i(1);e.exports=function unescapeHTML(e){return s.unescape(e)}},2556:function(e,t,i){var s=i(1),n=i(454),o=i(4),a=i(392),r=i(1446),l=i(611),c=i(1445),h=i(737),d=i(610),u=i(609),p=i(608),g=i(2555),m=i(58);e.exports=o.extend({className:"CDB-Widget-body",initialize:function(){this._dataviewModel=this.model.dataviewModel,this._layerModel=this.model.layerModel,!0===this.model.get("hasInitialState")?this._initBinds():this.listenToOnce(this.model,"change:hasInitialState",this._onInitialState)},_onInitialState:function(){this._initBinds(),this.render()},render:function(){this.clearSubViews();var e=this._dataviewModel.get("data"),t=function(e){var t=n.format("0,000");return s.isNumber(e)?t(e.toFixed(2)):0},i=!s.isUndefined(this._dataviewModel.get("nulls"))&&a.formatNumber(this._dataviewModel.get("nulls"))||"-",o=this.model.get("collapsed"),l=this.model.get("prefix"),m=this.model.get("suffix"),f=this._dataviewModel.get("source").id,_=d.letter(f),v=d.getColorForLetter(_),y=this._dataviewModel.getSourceType()||"",w=this._dataviewModel.isSourceType(),b=w?this.model.get("table_name"):this._layerModel.get("layer_name");return this.$el.html(r({title:this.model.get("title"),sourceId:f,sourceType:u.title(y),isSourceType:w,showStats:this.model.get("show_stats"),showSource:this.model.get("show_source")&&""!==_,operation:this._dataviewModel.get("operation"),value:e,formatedValue:t(e),description:this.model.get("description"),nulls:i,prefix:g(l),suffix:g(m),isCollapsed:o,sourceColor:v,layerName:p(b)})),new h({el:this.$el}).animateValue(this._dataviewModel,"data",".js-value",c,{animationSpeed:700,formatter:t,templateData:{prefix:g(l),suffix:g(m)}}),this.$el.toggleClass("is-collapsed",!!o),this._initViews(),this},_initBinds:function(){this.listenTo(this.model,"change:title change:description change:collapsed change:prefix change:suffix",this.render),this.listenTo(this._dataviewModel,"change:data",this.render),this.listenTo(this._layerModel,"change:layer_name",this.render)},_initViews:function(){var e=new l({model:this.model,target:".js-actions",container:this.$(".js-header")});this.addView(e);var t=new m({el:this.$el.find(".js-actions"),gravity:"auto"});this.addView(t)}})},2557:function(e,t,i){var s=i(1452),n=i(1448),o=i(970);e.exports=s.extend({className:"CDB-Widget-nav is-hidden CDB-Widget-contentSpaced",render:function(){this.clearSubViews(),this.$el.empty();var e=this._totalPages();return this.$el.html(n()),e>1&&this.$el.append(o({currentPage:this._paginatorModel.get("page"),pages:e})),this},_totalPages:function(){return Math.ceil(this._dataviewModel.getSearchCount()/this.options.itemsPerPage)},toggle:function(){this[this._widgetModel.isSearchEnabled()?"show":"hide"]()},_onSearchClicked:function(){this._widgetModel.cleanSearch(),this._widgetModel.toggleSearch()}})},2558:function(e,t,i){var s=i(4),n=i(392),o=i(1450);e.exports=s.extend({tagName:"li",className:"CDB-Widget-listItem",events:{"click .js-button":"_onItemClick"},initialize:function(e){this.dataviewModel=this.options.dataviewModel,this.widgetModel=this.options.widgetModel,this._initBinds()},render:function(){var e=this.model.get("value");return this.$el.html(o({name:this.model.get("name"),value:e,formattedValue:n.formatNumber(e),percentage:e/this.dataviewModel.get("max")*100,isDisabled:!this.model.get("selected"),prefix:this.widgetModel.get("prefix"),suffix:this.widgetModel.get("suffix")})),this},_initBinds:function(){this.model.bind("change:selected",this.render,this),this.widgetModel.bind("change:prefix change:suffix",this.render,this),this.add_related_model(this.widgetModel)},_onItemClick:function(){this.model.set("selected",!this.model.get("selected"))}})},2559:function(e,t,i){var s=i(1457),n=i(2558),o=i(1449);e.exports=s.extend({className:"CDB-Widget-list is-hidden js-list",render:function(){this.clearSubViews(),this.$el.empty();var e=this._searchResultsCollection;return e.isEmpty()||0===e.size()?this._renderPlaceholder():this._renderList(),this},_initBinds:function(){s.prototype._initBinds.apply(this,arguments),this._searchResultsCollection=this._dataviewModel.getSearchResult(),this.listenTo(this._searchResultsCollection,"change:selected",this._onSelectedItemChange),this.listenTo(this._searchResultsCollection,"reset",this.render)},_getData:function(){return this._searchResultsCollection},_renderPlaceholder:function(){this.$el.addClass("CDB-Widget-list--noresults"),this.$el.html(o({q:this._dataviewModel.getSearchQuery()}))},_addItem:function(e){var t=new n({model:e,widgetModel:this._widgetModel,dataviewModel:this._dataviewModel});this.addView(t),this.$el.append(t.render().el)},toggle:function(){this[this._widgetModel.isSearchEnabled()?"show":"hide"]()},_onSelectedItemChange:function(e,t){this._widgetModel.lockedCategories[t?"addItem":"removeItem"](e)}})},2560:function(e,t,i){var s=i(1),n=i(4),o=i(392),a=i(1454),r=i(1453),l=i(737);e.exports=n.extend({className:"CDB-Widget-info CDB-Text CDB-Size-small u-secondaryTextColor u-upperCase u-tSpace",tagName:"dl",initialize:function(){this.widgetModel=this.options.widgetModel,this.dataviewModel=this.options.dataviewModel,this._initBinds()},render:function(){return this.$el.html(a({isSearchEnabled:this.widgetModel.isSearchEnabled(),isSearchApplied:this.dataviewModel.isSearchApplied(),isLocked:this.widgetModel.isLocked(),isOtherAvailable:this.dataviewModel.isOtherAvailable(),resultsCount:this.dataviewModel.getSearchCount(),totalCats:this._getCategoriesSize(),nullsPer:this._getNullPercentage(),catsPer:this._getCurrentCategoriesPercentage()})),new l({el:this.$el}).animateFromValues(this._getPreviousCategoriesPercentage(),this._getCurrentCategoriesPercentage(),".js-cats",r,{defaultValue:"-",animationSpeed:700,formatter:o.formatValue}),this._checkVisibility(),this},_initBinds:function(){this.dataviewModel.bind("change:data change:totalCount",this.render,this),this.widgetModel.bind("change:search change:locked",this.render,this),this.widgetModel.bind("change:show_stats change:collapsed",this._checkVisibility,this),this.add_related_model(this.dataviewModel),this.add_related_model(this.widgetModel)},_getNullPercentage:function(){var e=this.dataviewModel.get("nulls"),t=this.dataviewModel.get("totalCount")||0;return e?(e/t*100).toFixed(2):0},_getPreviousCategoriesPercentage:function(){var e=this.dataviewModel.previous("totalCount")||0,t=this.dataviewModel.getPreviousData();return this._getCategoriesPercentage(t,e)},_getCurrentCategoriesPercentage:function(){var e=this.dataviewModel.get("totalCount")||0,t=this.dataviewModel.getData().toJSON();return this._getCategoriesPercentage(t,e)},_getCategoriesPercentage:function(e,t){if(!t)return 0;var i=e.reduce(function(e,t){return t.agg?e:e+parseFloat(t.value)},0);return i?(i/t*100).toFixed(2):0},_getCategoriesSize:function(){return s.pluck(this.dataviewModel.getData().reject(function(e){return e.get("agg")}),"name").length},_checkVisibility:function(){var e=!!this.widgetModel.get("show_stats")&&!this.widgetModel.get("collapsed");this.$el.toggle(e)}})},2561:function(e,t,i){var s=i(4),n=i(392),o=i(1),a=i(1456),r=i(1455);e.exports=s.extend({tagName:"li",className:"CDB-Widget-listItem",events:{"click .js-button":"_onItemClick"},initialize:function(e){this.widgetModel=this.options.widgetModel,this.dataviewModel=this.options.dataviewModel,this._initBinds()},render:function(){var e=this.model.get("name"),t=this.model.get("value"),i=this.model.get("agg")||this.widgetModel.isLocked()?r:a,s=this.dataviewModel.filter.getAcceptedCategoryNames(),l=o.contains(s,e);return this.$el.html(i({isAggregated:this.model.get("agg"),name:e,value:t,formattedValue:n.formatNumber(t),percentage:t/this.dataviewModel.get("max")*100,color:this.widgetModel.getColor(e),isDisabled:this.model.get("selected")?"":"is-disabled",isAccepted:l,prefix:this.widgetModel.get("prefix"),suffix:this.widgetModel.get("suffix")})),this},_initBinds:function(){this.model.bind("change",this.render,this),this.widgetModel.bind("change:search change:prefix change:suffix change:autoStyle",this.render,this),this.add_related_model(this.widgetModel)},_onItemClick:function(){this.trigger("itemClicked",this.model,this)}})},2562:function(e,t,i){var s=i(4),n=i(1458);e.exports=s.extend({className:"CDB-Widget-filter CDB-Widget-contentSpaced CDB-Widget-contentSpaced--sideMargins",events:{"click .js-all":"_onSelectAll","click .js-lock":"_lockCategories","click .js-unlock":"_unlockCategories"},initialize:function(){this.dataviewModel=this.options.dataviewModel,this.widgetModel=this.options.widgetModel,this._initBinds()},render:function(){var e=this.dataviewModel.filter.acceptedCategories.size(),t=this.dataviewModel.filter.rejectedCategories.size(),i=this.dataviewModel.filter.areAllRejected(),s=this.dataviewModel.getData().size(),o=this.widgetModel.isLocked();return this.$el.html(n({isSearchEnabled:this.widgetModel.isSearchEnabled(),isSearchApplied:this.dataviewModel.isSearchApplied(),isLocked:o,canBeLocked:this.widgetModel.canBeLocked(),allSelected:0===t&&0===e&&!i,canSelectAll:!o&&(t>0||e>0||i),noneSelected:i||!s&&!e,acceptedCats:e,totalLocked:this.widgetModel.lockedCategories.size(),totalCats:s})),this},_initBinds:function(){this.widgetModel.bind("change:search change:locked",this.render,this),this.widgetModel.lockedCategories.bind("change add remove",this.render,this),this.add_related_model(this.widgetModel),this.add_related_model(this.widgetModel.lockedCategories),this.dataviewModel.bind("change:data",this.render,this),this.add_related_model(this.dataviewModel);var e=this.dataviewModel.filter;e.acceptedCategories.bind("add remove reset",this.render,this),e.rejectedCategories.bind("add remove reset",this.render,this),this.add_related_model(e.rejectedCategories),this.add_related_model(e.acceptedCategories)},_lockCategories:function(){this.widgetModel.lockCategories()},_unlockCategories:function(){this.widgetModel.unlockCategories()},_onSelectAll:function(){this.dataviewModel.filter.acceptAll()}})},2563:function(e,t,i){var s=i(1),n=i(18),o=i(4),a=i(611),r=i(58),l=i(1459),c=i(610),h=i(609),d=i(608);e.exports=o.extend({events:{"keyup .js-textInput":"_onKeyupInput","submit .js-form":"_onSubmitForm","click .js-applyLocked":"_applyLocked","click .js-autoStyle":"_autoStyle","click .js-cancelAutoStyle":"_cancelAutoStyle"},initialize:function(){if(!this.options.widgetModel)throw new Error("widgetModel is required");if(!this.options.dataviewModel)throw new Error("dataviewModel is required");if(!this.options.layerModel)throw new Error("layerModel is required");this.model=this.options.widgetModel,this.dataviewModel=this.options.dataviewModel,this.layerModel=this.options.layerModel,this._initBinds()},render:function(){this.clearSubViews();var e=this.dataviewModel.get("source").id,t=c.letter(e),i=c.getColorForLetter(t),s=this.dataviewModel.getSourceType()||"",n=this.dataviewModel.isSourceType(),o=n?this.model.get("table_name"):this.layerModel.get("layer_name");return this.$el.html(l({isCollapsed:this.model.get("collapsed"),isAutoStyleEnabled:this._isAutoStyleButtonVisible(),isAutoStyle:this.model.isAutoStyle(),title:this.model.get("title"),sourceId:e,sourceType:h.title(s),isSourceType:n,showSource:this.model.get("show_source")&&""!==t,sourceColor:i,layerName:d(o),columnName:this.dataviewModel.get("column"),q:this.dataviewModel.getSearchQuery(),isLocked:this.model.isLocked(),canBeLocked:this.model.canBeLocked(),isSearchEnabled:this.model.isSearchEnabled(),canShowApply:this.model.canApplyLocked()})),this._initViews(),this},_initBinds:function(){this.listenTo(this.model,"change:search",this._onSearchToggled),this.listenTo(this.model,"change:title change:collapsed change:autoStyle change:style",this.render),this.listenTo(this.model.lockedCategories,"change add remove",this.render),this.listenTo(this.dataviewModel,"change:column",this.render),this.listenTo(this.dataviewModel.filter,"change",this.render),this.listenTo(this.layerModel,"change:visible change:cartocss change:layer_name",this.render)},_initViews:function(){var e=new a({model:this.model,target:".js-actions",container:this.$el});this.addView(e);var t=new r({el:this.$el.find(".js-colors"),gravity:"auto"});this.addView(t);var i=new r({el:this.$el.find(".js-actions"),gravity:"auto"});this.addView(i)},_isAutoStyleButtonVisible:function(){return this.model.isAutoStyleEnabled()&&this.layerModel.get("visible")&&this.model.hasColorsAutoStyle()},_onSearchToggled:function(){var e=this.model.isSearchEnabled();this[e?"_bindESC":"_unbindESC"](),this.render(),e&&this._focusOnInput()},_onSubmitForm:function(e){e&&e.preventDefault();var t=this.$(".js-textInput").val();this.dataviewModel.getSearchQuery()!==t&&(this.dataviewModel.setSearchQuery(t),this.dataviewModel.isSearchValid()&&this.dataviewModel.applySearch())},_focusOnInput:function(){var e=this;setTimeout(function(){e.$(".js-textInput").focus()},0)},_onKeyupInput:s.debounce(function(e){var t=this.$(".js-textInput").val();13!==e.keyCode&&27!==e.keyCode&&""!==t&&this._onSubmitForm()},250),_bindESC:function(){n(document).bind("keyup."+this.cid,s.bind(this._onKeyUp,this))},_unbindESC:function(){n(document).unbind("keyup."+this.cid)},_onKeyUp:function(e){if(27===e.keyCode)return this._cancelSearch(),!1},_applyLocked:function(){this.model.toggleSearch(),this.model.applyLocked()},_autoStyle:function(){this.model.autoStyle()},_cancelAutoStyle:function(){this.model.cancelAutoStyle()},_cancelSearch:function(){this.model.cleanSearch(),this.model.disableSearch()},clean:function(){this._unbindESC(),o.prototype.clean.call(this)}})},2564:function(e,t,i){var s=i(6),n=i(4),o=i(2563),a=i(2562),r=i(1457),l=i(2560),c=i(1452),h=i(2559),d=i(2557),u=i(1447);e.exports=n.extend({className:"CDB-Widget-body",_ITEMS_PER_PAGE:6,initialize:function(){this._dataviewModel=this.model.dataviewModel,this._layerModel=this.model.layerModel,this._paginatorModel=new s.Model({page:1}),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.toggleClass("is-collapsed",!!this.model.get("collapsed")),this.$el.html(u()),this._initViews(),this},_initBinds:function(){!0===this.model.get("hasInitialState")?this._onInitialState():this.model.bind("change:hasInitialState",this._onInitialState,this),this.model.bind("change:collapsed",function(e,t){this.$el.toggleClass("is-collapsed",!!t)},this)},_onInitialState:function(){this.render(),!0===this.model.get("autoStyle")&&this.model.autoStyle()},_initViews:function(){var e=new o({widgetModel:this.model,dataviewModel:this._dataviewModel,layerModel:this._layerModel});this.$(".js-header").append(e.render().el),this.addView(e);var t=new l({widgetModel:this.model,dataviewModel:this._dataviewModel});this.$(".js-header").append(t.render().el),this.addView(t);var i=new a({widgetModel:this.model,dataviewModel:this._dataviewModel});this.$(".js-content").html(i.render().el),this.addView(i);var s=new r({widgetModel:this.model,dataviewModel:this._dataviewModel,itemsPerPage:this._ITEMS_PER_PAGE,paginatorModel:this._paginatorModel});this.$(".js-content").append(s.render().el),this.addView(s);var n=new c({widgetModel:this.model,dataviewModel:this._dataviewModel,itemsPerPage:this._ITEMS_PER_PAGE,paginatorModel:this._paginatorModel});this.$(".js-footer").append(n.render().el),this.addView(n);var u=new h({widgetModel:this.model,dataviewModel:this._dataviewModel,itemsPerPage:this._ITEMS_PER_PAGE,paginator:!0,paginatorModel:this._paginatorModel});this.$(".js-content").append(u.render().el),this.addView(u);var p=new d({widgetModel:this.model,dataviewModel:this._dataviewModel,itemsPerPage:this._ITEMS_PER_PAGE,paginator:!0,paginatorModel:this._paginatorModel});this.$(".js-footer").append(p.render().el),this.addView(p)}})},2565:function(e,t,i){var s=i(1),n=i(18),o=i(457),a=i(4),r=i(2564),l=i(2556),c=i(2554),h=i(1475),d=i(1441),u=window.matchMedia;e.exports=a.extend({className:"CDB-Widget-canvas",initialize:function(e){this._widgetViewFactory=new h([{type:"formula",createContentView:function(e){return new l({model:e})}},{type:"histogram",createContentView:function(e){return new c({model:e})}},{type:"category",createContentView:function(e){return new r({model:e})}}]),this._widgets=e.widgets,this._widgets.bind("add",this._maybeRenderWidgetView,this),this._widgets.bind("reset",this.render,this),this._widgets.bind("orderChanged",this.render,this),this._widgets.bind("change:collapsed",this._onWidgetUpdate,this),this._widgets.bind("add remove reset",this._onWidgetsChange,this),this.add_related_model(this._widgets),this._resizeHandler=this._onResize.bind(this)},render:function(){return this._cleanScroll(),this._observer&&this._observer.disconnect(),this.clearSubViews(),this.$el.html(d()),this.$el.toggleClass("CDB-Widget-canvas--withMenu",this.model.get("renderMenu")),this._widgets.each(this._maybeRenderWidgetView,this),this._toggleVisiblity(),this._renderScroll(),this._renderShadows(),this._bindScroll(),this._initResize(),this},_initResize:function(){["(max-width: 1600px)","(max-width: 1280px)","(max-width: 759px)"].forEach(function(e){u(e).addListener(this._resizeHandler)},this)},_updateScrollCss:function(){this._onWidgetUpdate();var e=this._container();if(e){var t=e.clientWidth,i=e.clientHeight,s=t<e.scrollWidth,n=i<e.scrollHeight;this._$container().toggleClass("hasXScroll",s),this._$container().toggleClass("hasYScroll",n)}},_$container:function(){return n(this._container())},_container:function(){return this.el.querySelector(".js-container")},_maybeRenderWidgetView:function(e){var t=this._widgetViewFactory.createWidgetView(e);t&&(this.addView(t),this._$container().append(t.render().el))},_bindScroll:function(){this._$container().on("ps-y-reach-start",s.bind(this._onScrollTop,this)).on("ps-y-reach-end",s.bind(this._onScrollBottom,this)).on("ps-scroll-y",s.bind(this._onScroll,this))},_renderScroll:function(){o.initialize(this._container(),{wheelSpeed:1,wheelPropagation:!1,swipePropagation:!0,stopPropagationOnClick:!1,minScrollbarLength:20,useBothWheelAxes:!1,suppressScrollX:!0})},_onWidgetUpdate:function(){o.update(this._container())},_renderShadows:function(){this.$shadowTop=n("<div>").addClass("CDB-Widget-canvasShadow CDB-Widget-canvasShadow--top"),this.$shadowBottom=n("<div>").addClass("CDB-Widget-canvasShadow CDB-Widget-canvasShadow--bottom"),this.$el.append(this.$shadowTop),this.$el.append(this.$shadowBottom)},_onScrollTop:function(){this.$shadowTop.removeClass("is-visible")},_onScroll:function(){var e=this._$container(),t=e.scrollTop(),i=e.get(0).scrollHeight-e.outerHeight();this.$shadowTop.toggleClass("is-visible",t>0),this.$shadowBottom.toggleClass("is-visible",t<i)},_updateScroll:function(){this._$container().scrollLeft=0,this._$container().scrollTop=0},_onResize:function(e){this._updateScroll(),this._onScroll()},_onScrollBottom:function(){this.$shadowBottom.removeClass("is-visible")},_cleanScroll:function(){n(window).off("resize",this._resizeHandler),this._container()&&(this._$container().off("ps-scroll-y"),o.destroy(this._container()))},_toggleVisiblity:function(){this.$el.toggle(!s.isEmpty(this._subviews))},_onWidgetsChange:function(){this._toggleVisiblity(),this.render()},clean:function(){this._cleanScroll(),this._observer&&this._observer.disconnect(),a.prototype.clean.call(this)}})},2566:function(e,t,i){var s=i(84),n=i(4),o=i(1),a=i(18),r=i(1460),l=i(74),c=i(457),h=n.extend({className:"CDB-Dashboard-menu",events:{"click .js-toggle-view":"_toogleView"},initialize:function(){this.viewModel=new s.core.Model({open:!1,footer:a(window).width()<1201}),this._initBinds()},_initBinds:function(){this.listenTo(this.viewModel,"change",this.render),this._resize=o.debounce(this._onResizeWindow.bind(this),20),a(window).on("resize",this._resize)},render:function(){var e=this.model.get("title"),t=this.viewModel.get("open"),i=this.viewModel.get("footer");e&&e.length>120&&(e=e.slice(0,110)+"... %23 map"),this.$el.html(r({hasTranslation:t||i,showLogo:this.model.get("showLogo"),title:this.model.get("title"),description:this.model.get("description"),updatedAt:l(this.model.get("updatedAt")).fromNow(),userName:this.model.get("userName"),url:window.location.href,urlWithoutParams:window.location.protocol+"//"+window.location.host+window.location.pathname,inIframe:window.location!==window.parent.location,shortTitle:e,userAvatarURL:this.model.get("userAvatarURL"),userProfileURL:this.model.get("userProfileURL")})),this.$el.toggleClass("is-active",t);var s=this._getDescription().get(0);return c.initialize(s,{wheelSpeed:2,suppressScrollX:!0}),this},_getDescription:function(){return this.$(".js-scroll-wrapper")},_toogleView:function(){var e=this.viewModel.get("open");this.viewModel.set({open:!e})},_onResizeWindow:function(){this.viewModel.set({footer:a(window).width()<1201})},clean:function(){a(window).off("resize",this._resize),n.prototype.clean.call(this)}});e.exports=h},2567:function(e,t,i){var s=i(454),n=i(4),o=i(74),a=i(392),r=i(1462);e.exports=n.extend({className:"CDB-Widget-timeSeriesTimeInfo",initialize:function(e){if(!e.torqueLayerModel)throw new Error("torqueLayerModel is required");if(!e.dataviewModel)throw new Error("dataviewModel is required");if(!e.timeSeriesModel)throw new Error("timeSeriesModel is required");this._torqueLayerModel=this.options.torqueLayerModel,this._dataviewModel=this.options.dataviewModel,this._timeSeriesModel=this.options.timeSeriesModel,this._initBinds()},render:function(){var e=this._torqueLayerModel.get("time"),t=this._torqueLayerModel.get("column_type"),i=s.scale.linear().domain([0,this._dataviewModel.get("data").length]).range([this._dataviewModel.get("start"),this._dataviewModel.get("end")]),n="",l=a.formatNumber;return"number"===t?n=r({time:l(i(this._torqueLayerModel.get("step")))}):"date"!==t||isNaN(e&&e.getTime())||(l=a.timestampFactory(this._dataviewModel.get("aggregation"),this._dataviewModel.getCurrentOffset()),n=r({time:l(o(e).unix())})),this.$el.html(n),this},_initBinds:function(){this.listenTo(this._torqueLayerModel,"change:step",this.render)}})},2568:function(e,t,i){var s=i(4),n=i(2567),o=i(1468),a=i(1461);e.exports=s.extend({className:"CDB-Widget-contentSpaced",initialize:function(){this._dataviewModel=this.options.dataviewModel,this._torqueLayerModel=this.options.torqueLayerModel,this._rangeFilter=this._dataviewModel.filter,this._selectedAmount=this.options.selectedAmount,this._timeSeriesModel=this.options.timeSeriesModel,this.listenTo(this._rangeFilter,"change",this.render)},render:function(){var e=!0;return this.clearSubViews(),this.$el.addClass(this.className),this.$el.html(a()),this._rangeFilter.isEmpty()&&(this._appendView(".js-torque-controls",new n({dataviewModel:this._dataviewModel,torqueLayerModel:this._torqueLayerModel,timeSeriesModel:this._timeSeriesModel})),e=!1),this._createTimeSeriesHeaderView(e),this},_createTimeSeriesHeaderView:function(e){var t=new o({dataviewModel:this._dataviewModel,layerModel:this._torqueLayerModel,rangeFilter:this._dataviewModel.filter,showClearButton:e,timeSeriesModel:this._timeSeriesModel,selectedAmount:this._selectedAmount});this._appendView(".js-time-series-header",t),t.on("resetFilter",this._resetFilter,this)},_resetFilter:function(){this._torqueLayerModel.set({step:0}),this._torqueLayerModel.resetRenderRange()},_appendView:function(e,t){this.addView(t),this.$(e).append(t.render().el)}})},2569:function(e,t,i){var s=i(4),n=i(1463);e.exports=s.extend({events:{"click .CDB-Widget-controlButton":"_onClick"},initialize:function(){this._torqueLayerModel=this.options.torqueLayerModel,this._rangeFilter=this.options.rangeFilter,this.listenTo(this._torqueLayerModel,"change:isRunning",this.render),this.listenTo(this._torqueLayerModel,"change:start change.end",this.render)},render:function(){return this.$el.html(n({running:this._torqueLayerModel.get("isRunning"),disabled:!this._rangeFilter.isEmpty()})),this},_onClick:function(){this._torqueLayerModel.get("isRunning")?this._torqueLayerModel.pause():this._torqueLayerModel.play()}})},2570:function(e,t,i){var s=i(454),n=i(84),o=i(4),a=i(74),r=i(392),l=i(971);e.exports=o.extend({defaults:{width:6,height:8},initialize:function(){if(!this.options.chartView)throw new Error("chartView is required");if(!this.options.torqueLayerModel)throw new Error("torqeLayerModel is required");if(!this.options.timeSeriesModel)throw new Error("timeSeriesModel is required");this.model=new n.core.Model,this._dataviewModel=this.options.dataviewModel,this._chartView=this.options.chartView,this._torqueLayerModel=this.options.torqueLayerModel,this._timeSeriesModel=this.options.timeSeriesModel,this._chartMargins=this._chartView.model.get("margin"),this._initBinds(),this._updateXScale(),this._createFormatter()},render:function(){if(!this.timeSlider){var e=s.behavior.drag().on("dragstart",this._onDragStart.bind(this)).on("drag",this._onDrag.bind(this)).on("dragend",this._onDragEnd.bind(this)),t=this._chartView.canvas.append("rect");this.timeSlider=t.attr("class","CDB-TimeSlider").attr("width",this.defaults.width).attr("height",this._calcHeight()).attr("rx",3).attr("ry",3).data([{x:0,y:0}]).attr("transform",this._translateXY).call(e),this.setElement(t.node())}return this._isTabletViewport()&&this._generateTimeSliderTip(),this},_isTabletViewport:function(){return l.isTabletViewport()},_generateTimeSliderTip:function(){var e=this._calcHeight()/2+3+2;e=Math.floor(e),this.timeSliderTip=this._chartView.canvas.select(".CDB-WidgetCanvas").append("g").attr("class","CDB-Chart-timeSliderTip").data([{x:16,y:e}]).attr("transform",this._translateXY),this.timeSliderTip.append("rect").attr("class","CDB-Chart-timeSliderTipRect").attr("rx","2").attr("ry","2").attr("height",17),this.timeSliderTip.append("text").attr("class","CDB-Text CDB-Size-small CDB-Chart-timeSliderTipText").attr("dy","11").attr("dx","0")},_onLocalTimezoneChanged:function(){this._createFormatter(),this._updateTimeSliderTip()},_updateTimeSliderTip:function(){var e=this,t=this._isDateTimeSeries()?this._torqueLayerModel.get("time"):this._torqueLayerModel.get("step");if(void 0!==t){var i=this._chartView.canvas,n=i.select(".CDB-Chart-timeSliderTipText"),o=s.scale.linear().domain([0,this._dataviewModel.get("data").length]).range([this._dataviewModel.get("start"),this._dataviewModel.get("end")]);if(n.data([t]).text(function(t){return e._isDateTimeSeries()?this.formatter(a(t).unix()):this.formatter(o(t))}.bind(this)),n.node()){var r=i.select(".CDB-Chart-timeSliderTipRect"),l=n.node().getBBox(),c=l.width+6,h=this._chartView.chartWidth()+16;r.attr("width",c),n.attr("dx",3),n.attr("dy",l.height-Math.abs((l.height-17)/2));var d=this._xScale(this._torqueLayerModel.get("step"))+this.defaults.width-c/2,u=this._calcHeight()/2+3+2;u=Math.floor(u);var p=this.timeSliderTip.data();p[0].y=u;var g=d;d<16?g=16:d+c>=h&&(g=h-c),isNaN(g)||(p[0].x=g,this.timeSliderTip.data(p).transition().ease("linear").attr("transform",this._translateXY))}}},_initBinds:function(){this.listenTo(this._torqueLayerModel,"change:start change:end",this._updateChartandTimeslider),this.listenTo(this._torqueLayerModel,"change:step",this._onChangeStep),this.listenTo(this._torqueLayerModel,"change:time",this._onChangeTime),this.listenTo(this._torqueLayerModel,"change:steps",this._updateChartandTimeslider),this.listenTo(this._chartView.model,"change:width",this._updateChartandTimeslider),this.listenTo(this._chartView.model,"change:height",this._onChangeChartHeight),this.listenTo(this._dataviewModel,"change:bins",this._updateChartandTimeslider),this.listenTo(this._dataviewModel,"change:column_type",this._createFormatter),this.listenTo(this._dataviewModel.filter,"change:min change:max",this._onFilterMinMaxChange),this.listenTo(this._timeSeriesModel,"change:local_timezone",this._onLocalTimezoneChanged),this.listenTo(this._dataviewModel,"change:start change:end",this._updateChartandTimeslider)},clean:function(){this.timeSlider&&this.timeSlider.remove(),o.prototype.clean.call(this)},_onFilterMinMaxChange:function(e,t){this.$el.toggle(!t)},_onDragStart:function(){var e=this._torqueLayerModel.get("isRunning");e&&this._torqueLayerModel.pause(),this.model.set({isDragging:!0,wasRunning:e})},_onDrag:function(e,t){var i=e.x+s.event.dx;if(this._isWithinRange(i)){e.x=i,this.timeSlider.attr("transform",this._translateXY);var n=Math.round(this._xScale.invert(e.x));this._torqueLayerModel.setStep(n)}},_onDragEnd:function(){this.model.set("isDragging",!1),this.model.get("wasRunning")&&this._torqueLayerModel.play()},_translateXY:function(e){return"translate("+[e.x,e.y]+")"},_isWithinRange:function(e){return e>=this._chartMargins.left&&e<=this._width()-this._chartMargins.right},_onChangeStep:function(){if(this.timeSlider&&!this.model.get("isDragging")){var e=this.timeSlider.data(),t=this._xScale(this._torqueLayerModel.get("step"));isNaN(t)||(e[0].x=t,this.timeSlider.data(e).transition().ease("linear").attr("transform",this._translateXY))}},_onChangeChartHeight:function(){var e=this._isTabletViewport()?this._calcHeight()/2+3:this._calcHeight();this.timeSlider.attr("height",e)},_onChangeTime:function(){this._dataviewModel.filter.isEmpty()&&this._isTabletViewport()?(this._chartView.canvas.select(".CDB-Chart-timeSliderTip").node()||this._generateTimeSliderTip(),this._updateTimeSliderTip()):this._removeTimeSliderTip()},_removeTimeSliderTip:function(){var e=this._chartView.canvas.select(".CDB-Chart-timeSliderTip");e.node()&&e.remove()},_updateChartandTimeslider:function(){this._updateXScale(),this._onChangeStep()},_calcHeight:function(){return this._chartView.chartHeight()+this.defaults.height},_createFormatter:function(){this.formatter=r.formatNumber,this._isDateTimeSeries()&&(this.formatter=r.timestampFactory(this._dataviewModel.get("aggregation"),this._dataviewModel.getCurrentOffset()))},_isDateTimeSeries:function(){return"date"===this._dataviewModel.getColumnType()},_updateXScale:function(){var e=1e3*(this._dataviewModel.get("end")-this._dataviewModel.get("start")),t=(this._torqueLayerModel.get("start")-1e3*this._dataviewModel.get("start"))/e,i=(this._torqueLayerModel.get("end")-1e3*this._dataviewModel.get("start"))/e,n=t*this._width()+this._chartMargins.left,o=i*this._width()-this._chartMargins.right;n=n<0?this._chartMargins.left:n,o=o>this._width()?this._width()-this._chartMargins.right:o,this._xScale=s.scale.linear().domain([0,this._torqueLayerModel.get("steps")]).range([n,o])},_width:function(){return this._chartView.model.get("width")}})},2571:function(e,t,i){var s=i(1),n=i(1470),o=i(2570),a=i(2569);e.exports=n.extend({defaults:s.extend({},n.prototype.defaults,{offsetLeft:34}),className:function(){return n.prototype.className+" CDB-Widget-content CDB-Widget-content--torqueTimeSeries u-flex"},initialize:function(){if(!this.options.torqueLayerModel)throw new Error("torqeLayerModel is required");if(!this.options.rangeFilter)throw new Error("rangeFilter is required");if(!this.options.dataviewModel)throw new Error("dataviewModel is required");if(!this.options.timeSeriesModel)throw new Error("timeSeriesModel is required");this._torqueLayerModel=this.options.torqueLayerModel,this._dataviewModel=this.options.dataviewModel,this._timeSeriesModel=this.options.timeSeriesModel,n.prototype.initialize.call(this)},_initBinds:function(){n.prototype._initBinds.call(this),this.listenTo(this._torqueLayerModel,"change:renderRange",this._onRenderRangeChanged),this.listenTo(this._torqueLayerModel,"change:steps change:start change:end",this._reSelectRange),this.listenTo(this._torqueLayerModel,"change:cartocss",this._onUpdateCartocss)},_createHistogramView:function(){this._chartType="date"===this._torqueLayerModel.get("column_type")?"time":"number",n.prototype._createHistogramView.call(this),this._torqueControls=new a({torqueLayerModel:this._torqueLayerModel,rangeFilter:this._rangeFilter}),this.addView(this._torqueControls),this.$el.prepend(this._torqueControls.render().el),this._chartView.setAnimated(),this._chartView.bind("on_brush_click",this._onBrushClick,this),this._timeSliderView=new o({dataviewModel:this._dataviewModel,chartView:this._chartView,torqueLayerModel:this._torqueLayerModel,timeSeriesModel:this._timeSeriesModel,rangeFilter:this._rangeFilter}),this.addView(this._timeSliderView),this._timeSliderView.render()},_onChangeData:function(){n.prototype._onChangeData.call(this),this._chartView&&this._reSelectRange()},_onRenderRangeChanged:function(e,t){void 0===t.start&&void 0===t.end&&(this._chartView.removeSelection(),this._rangeFilter.unsetRange())},_onBrushClick:function(e){var t=this._torqueLayerModel.get("steps"),i=Math.round(t*e);i===t&&(i-=1),n.prototype.resetFilter.apply(this),this._torqueLayerModel.set({step:i})},_onBrushEnd:function(){n.prototype._onBrushEnd.apply(this,arguments),this._reSelectRange()},_timeToStep:function(e,t){var i=this._torqueLayerModel.get("steps"),s=this._torqueLayerModel.get("start"),n=this._torqueLayerModel.get("end"),o=n-s==0?"max"===t?i:0:i*(1e3*e-s)/(n-s);return o=Number(o.toFixed(2))},_reSelectRange:function(e){if(this._rangeFilter.isEmpty())this._torqueLayerModel.play(),this._updateDuration(1);else{this._torqueLayerModel.pause();var t=this._rangeFilter.get("min"),i=this._rangeFilter.get("max"),n=this._timeToStep(t,"min"),o=this._timeToStep(i,"max"),a=this._dataviewModel.get("data"),r=s.findWhere(a,{start:t}),l=s.findWhere(a,{end:i});if(!r||!l)return this._torqueLayerModel.resetRenderRange();var c=this._torqueLayerModel.get("steps"),h=this._chartView.getSelectionExtent()/100;this._updateDuration(h),this._torqueLayerModel.renderRange(this._clampRangeVal(0,c,n),this._clampRangeVal(0,c,o))}},_updateDuration:function(e,t){if(this._torqueLayerModel.getAnimationDuration){var i=this._torqueLayerModel.getAnimationDuration(t||this._torqueLayerModel.get("cartocss"));this._torqueLayerModel.set("customDuration",Math.round(i*e))}},_onUpdateCartocss:function(e,t){var i;if(this._rangeFilter.isEmpty())i=1;else{var s=this._timeToStep(this._rangeFilter.get("min"));i=(this._timeToStep(this._rangeFilter.get("max"))-s)/this._torqueLayerModel.get("steps")}this._updateDuration(i,t,{silent:!0})},_clampRangeVal:function(e,t,i){return Math.max(e,Math.min(t,i))},_getMarginLeft:function(){return 16}})},2572:function(e,t,i){var s=i(1),n=i(4),o=i(1464),a=i(972),r=i(2571),l=i(2568),c=i(611),h=i(610),d=i(609),u=i(608);e.exports=n.extend({className:"CDB-Widget-body CDB-Widget-body--timeSeries",initialize:function(){if(!this.model.dataviewModel)throw new Error("dataviewModel is required");if(!this.model.layerModel)throw new Error("layerModel is required");this._dataviewModel=this.model.dataviewModel,this._layerModel=this.model.layerModel,this._originalData=this._dataviewModel.getUnfilteredDataModel(),this._selectedAmount=0,this._initBinds()},render:function(){this.clearSubViews();var e=this._dataviewModel.get("source").id,t=h.letter(e),i=h.getColorForLetter(t),s=this._dataviewModel.getSourceType()||"",n=this._dataviewModel.isSourceType(),r=n?this.model.get("table_name"):this._layerModel.get("layer_name");return this._isDataEmpty()?this.$el.html(a({hasTorqueLayer:!0})):(this.$el.html(o({sourceId:e,sourceType:d.title(s),isSourceType:n,showSource:this.model.get("show_source")&&""!==t,sourceColor:i,layerName:u(r)})),this._createHeaderView(),this._createTorqueHistogramView(),this._createDropdownView()),this},_createHeaderView:function(){this._headerView&&this._headerView.remove(),this._headerView=new l({el:this.$(".js-torque-header"),dataviewModel:this._dataviewModel,torqueLayerModel:this._layerModel,timeSeriesModel:this.model,selectedAmount:this._selectedAmount}),this.addView(this._headerView),this._headerView.render()},_createTorqueHistogramView:function(){this._histogramView&&this._histogramView.remove(),this._histogramView=new r({timeSeriesModel:this.model,dataviewModel:this._dataviewModel,rangeFilter:this._dataviewModel.filter,torqueLayerModel:this._layerModel,layerModel:this._layerModel,displayShadowBars:!this.model.get("normalized"),normalized:!!this.model.get("normalized")}),this.addView(this._histogramView),this.$el.append(this._histogramView.render().el)},_createDropdownView:function(){this._dropdownView&&this._dropdownView.remove(),this._dropdownView=new c({model:this.model,target:".js-actions",container:this.$(".js-header"),flags:{localTimezone:"date"===this._dataviewModel.getColumnType(),normalizeHistogram:!!this.model.get("normalized"),canCollapse:!1}}),this.addView(this._dropdownView)},_initBinds:function(){this.listenTo(this._originalData,"change:data",this._onOriginalDataChange),this.listenTo(this._dataviewModel,"change:data",this.render),this.listenTo(this._dataviewModel,"change:bins",this._onChangeBins),this.listenTo(this._layerModel,"change:layer_name",this.render),this.add_related_model(this._layerModel)},_isDataEmpty:function(){var e=this._dataviewModel.getData();return s.isEmpty(e)||0===s.size(e)},_onOriginalDataChange:function(){this._dataviewModel.fetch()},_onChangeBins:function(e,t){this._originalData.setBins(t)}})},2573:function(e,t,i){var s=i(74),n=i(1),o={substractOneUnit:function(e,t){if(!n.isNumber(e))return e;var i=s.unix(e).utc();return t&&"week"===t?i.subtract(1,"day"):i.subtract(1,t),i.unix()}};e.exports=o},2574:function(e,t,i){var s=i(18),n=i(1),o=i(6),a=o.Model.extend({initialize:function(e){return n.bindAll(this,"fetch","save","retrigger"),o.Model.prototype.initialize.call(this,e)},fetch:function(e){var t=this;this.trigger("loadModelStarted"),s.when(o.Model.prototype.fetch.call(this,e)).done(function(e){t.trigger("loadModelCompleted",e,t)}).fail(function(e){t.trigger("loadModelFailed",e,t)})},setIdAttribute:function(e){this.idAttribute=e},retrigger:function(e,t,i){i||(i=e);var s=this;t.bind&&t.bind(e,function(){s.trigger(i)},s)},save:function(e,t){var i=this;t&&t.silent||this.trigger("saving");var n=o.Model.prototype.save.apply(this,arguments);return s.when(n).done(function(){t&&t.silent||i.trigger("saved")}).fail(function(){t&&t.silent||i.trigger("errorSaving")}),n}});e.exports=a},2575:function(e,t,i){var s=i(1),n=i(4),o=i(972),a=i(1471),r=i(1470),l=i(1468),c=i(611),h=i(610),d=i(609),u=i(608);e.exports=n.extend({className:"CDB-Widget-body CDB-Widget-body--timeSeries",initialize:function(){if(!this.model.dataviewModel)throw new Error("dataviewModel is required");if(!this.model.layerModel)throw new Error("layerModel is required");this._dataviewModel=this.model.dataviewModel,this._layerModel=this.model.layerModel,this._selectedAmount=0,this._initBinds()},render:function(){this.clearSubViews(),this.$el.empty();var e=this._dataviewModel.get("source").id,t=h.letter(e),i=h.getColorForLetter(t),s=this._dataviewModel.getSourceType()||"",n=this._dataviewModel.isSourceType(),r=n?this.model.get("table_name"):this._layerModel.get("layer_name");return this._isDataEmpty()||this._hasError()?this.$el.append(o({hasTorqueLayer:!1})):(this.$el.append(a({sourceId:e,sourceType:d.title(s),isSourceType:n,showSource:this.model.get("show_source")&&""!==t,sourceColor:i,layerName:u(r)})),this._createHistogramView(),this._createHeaderView(),this._createDropdownView(),this._updateRange()),this},_initBinds:function(){this._dataviewModel.once("error",function(){console.log("the tiler does not support non-torque layers just yet\u2026")}),this.listenTo(this._dataviewModel,"change:data",this.render),this.listenToOnce(this.model,"change:hasInitialState",this.render),this.listenTo(this._layerModel,"change:layer_name",this.render),this.add_related_model(this._layerModel)},_createHistogramView:function(){this._histogramView&&this._histogramView.remove(),this._histogramView=new r({timeSeriesModel:this.model,dataviewModel:this._dataviewModel,layerModel:this._layerModel,rangeFilter:this._dataviewModel.filter,displayShadowBars:!this.model.get("normalized"),normalized:!!this.model.get("normalized")}),this.addView(this._histogramView),this.$(".js-content").append(this._histogramView.render().el)},_createHeaderView:function(){if(this._headerView&&this._headerView.remove(),this._headerView=new l({dataviewModel:this._dataviewModel,layerModel:this._layerModel,rangeFilter:this._dataviewModel.filter,timeSeriesModel:this.model,showClearButton:!0,selectedAmount:this._selectedAmount}),!this._histogramView)throw new Error("Histogram view must be instantiated before the header view");this._headerView.bind("resetFilter",this._histogramView.resetFilter,this._histogramView),this.addView(this._headerView),this.$(".js-title").append(this._headerView.render().el)},_createDropdownView:function(){this._dropdownView&&this._dropdownView.remove(),this._dropdownView=new c({model:this.model,target:".js-actions",container:this.$(".js-header"),flags:{localTimezone:"date"===this._dataviewModel.getColumnType(),normalizeHistogram:!0,canCollapse:!1}}),this.addView(this._dropdownView)},_updateRange:function(){var e=this._calculateBars(),t=this._dataviewModel.get("bins"),i=Math.max(e.loBarIndex,0),s=Math.min(e.hiBarIndex,t);(i>0||s<t)&&this._histogramView.selectRange(i,s)},_calculateBars:function(){var e,t,i=this._dataviewModel.getData(),n=this.model.get("min"),o=this.model.get("max"),a=this.model.get("lo_index"),r=this.model.get("hi_index");return i.length>0?(s.isNumber(n)||s.isNumber(a)?s.isNumber(n)&&!s.isNumber(a)&&(a=(e=s.findWhere(i,{start:n}))&&e.bin||0):a=0,s.isNumber(o)||s.isNumber(r)?s.isNumber(o)&&!s.isNumber(r)&&(r=(t=s.findWhere(i,{end:o}))&&t.bin+1||i.length):r=i.length):(a=0,r=i.length),{loBarIndex:a,hiBarIndex:r}},_appendView:function(e){this.addView(e),this.$el.append(e.render().el)},_isDataEmpty:function(){var e=this._dataviewModel.getUnfilteredData();return s.isEmpty(e)||0===s.size(e)},_hasError:function(){return this._dataviewModel.has("error")}})},2576:function(e,t,i){var s=i(1),n={generic:{level:"error",refresh:!0},limit:{level:"error",error:"Timeout",message:"The server is taking too long to respond, due to poor conectivity or a temporary error with our servers. Please try again soon.",refresh:!0},no_data_available:{level:"alert",error:"No data available",message:"There are no results for the combination of filters applied to your data. Try tweaking your filters, or zoom and pan the map to adjust the Map View.",refresh:!1},too_many_bins:{level:"error",error:"Too many bins returned",message:"There are too many bins returned. Try selecting a less granular aggregation or filtering the data source.",refresh:!1},dataview:{level:"error",refresh:!1}};e.exports=function(e){var t=e&&e.type&&s.has(n,e.type)?e.type:"generic";return s.extend({},e,n[t])}},2577:function(e,t,i){var s=i(4),n=i(1),o=i(1474),a=i(1473);e.exports=s.extend({className:"CDB-Widget-body is-hidden",events:{"click .js-refresh":"_onRefreshClick"},initialize:function(e){this._title=e.title,this._errorModel=e.errorModel,this.listenTo(this._errorModel,"change",this._onErrorModelChanged)},render:function(){var e=this._errorModel.get("error");if(e){var t=this._errorModel.get("placeholder"),i=n.isFunction(t)?t():"";this.$el.addClass("CDB-Widget--"+e.level);var s=e.type?a({placeholder:i,error:e.error,title:this._title,message:e.message,refresh:e.refresh}):o({placeholder:i});this.$el.html(s)}return this},_onErrorModelChanged:function(){this._reset(),n.isEmpty(this._errorModel.get("error"))?this.$el.addClass("is-hidden"):this.$el.removeClass("is-hidden"),this.render()},_onRefreshClick:function(){this._errorModel.get("model").refresh()},_reset:function(){this.$el.removeClass("CDB-Widget--alert CDB-Widget--error"),this.$el.html("")}})},2578:function(e,t,i){var s=i(4);e.exports=s.extend({className:"CDB-Widget-loader",initialize:function(){this._initBinds()},render:function(){return this.$el.append('<div class="CDB-Loader js-loader"></div>'),this},show:function(){this.$(".js-loader").addClass("is-visible"),clearTimeout(this._timeout)},hide:function(){var e=this;this._timeout=setTimeout(function(){e.$(".js-loader").removeClass("is-visible")},500)},_initBinds:function(){this.model.bind("loading",this.show,this),this.model.bind("error",function(e,t){(!t||t&&"abort"!==t.statusText)&&this.hide()},this),this.model.bind("loaded",this.hide,this)}})},2579:function(e,t,i){var s=i(6),n=i(1),o=i(4),a=i(2578),r=i(2577),l=i(2576),c=i(739),h=i(59),d={category:i(974),formula:i(1472),histogram:i(973)};e.exports=o.extend({className:"CDB-Widget CDB-Widget--light",options:{columns_title:[]},initialize:function(){this.errorModel=new s.Model({});var e=this.model.dataviewModel;this.listenTo(this.model,"destroy",this.clean),this.listenTo(this.model,"error",this._onError),this.listenTo(this.model,"setDisabled",this._setDisabled),this.listenTo(e,"statusError",this._onError),this.listenTo(e,"sync change:data",this._onDataChanged)},render:function(){return this.clearSubViews(),this.$el.empty(),this._appendView(new a({model:this.model.dataviewModel})),this._appendView(new r({title:this.model.get("title"),errorModel:this.errorModel})),this._appendView(this.options.contentView),this},_onDataChanged:function(e){return this._noDataAvailable()?(this.options.contentView.$el.addClass("is-hidden"),this.errorModel.set({model:e,error:l({type:"no_data_available"}),placeholder:this._getPlaceholder()})):this._dataHasTooManyBins()?(this.options.contentView.$el.addClass("is-hidden"),this.errorModel.set({model:e,error:l({type:"too_many_bins"}),placeholder:this._getPlaceholder()})):void(n.isEmpty(this.errorModel.get("error"))||(this.errorModel.clear(),this.options.contentView.render(),this.options.contentView.$el.removeClass("is-hidden")))},_onError:function(e,t){if(!t||"abort"!==t.message){var i=l(t);this.options.contentView.$el.addClass("is-hidden"),this.errorModel.set({model:e,error:i,placeholder:this._getPlaceholder()})}},_appendView:function(e){this.$el.append(e.render().el),this.addView(e)},_noDataAvailable:function(){var e=this._isHistogram()?"totalAmount":"data",t=this.model.dataviewModel.get(e);return!h.hasValue(t)||n.isArray(t)&&n.isEmpty(t)},_dataHasTooManyBins:function(){if(this._isHistogram()){var e=this.model.dataviewModel.getUnfilteredData&&this.model.dataviewModel.getUnfilteredData();return!n.isEmpty(e)&&n.size(e)>367}return!1},_isHistogram:function(){return"histogram"===this.model.dataviewModel.get("type")},_extractError:function(e){var t=c(e,"responseJSON.errors_with_context",[]);return t.length>0?t[0]:e&&e.message?(e.type=e.type||"generic",e):{}},_getPlaceholder:function(){var e=this.model.dataviewModel.get("type");return d[e]},_setDisabled:function(e,t){var i=e.get("id")!==t;t&&!i&&this.el.scrollIntoView&&this.el.scrollIntoView(),this.$el.toggleClass("is-disabled",null!==t&&i)}})},2580:function(e,t,i){var s=i(1),n=i(4),o=i(1475),a=i(2575),r=i(2572);e.exports=n.extend({className:"CDB-Dashboard-belowMap",initialize:function(e){this._widgetViewFactory=new o([{match:function(e){if("time-series"===e.get("type")){var t=e.dataviewModel,i=e.layerModel;return t&&"torque"===i.get("type")&&!0===e.get("animated")}return!1},createContentView:function(e){return new r({model:e})},customizeWidgetAttrs:function(e){return e.className+=" CDB-Widget--timeSeries",e}},{type:"time-series",createContentView:function(e){return new a({model:e})},customizeWidgetAttrs:function(e){return e.className+=" CDB-Widget--timeSeries",e}}]),this._widgets=e.widgets,this._widgets.bind("add",this._maybeRenderWidgetView,this),this._widgets.bind("reset",this.render,this),this._widgets.bind("add reset remove",this._onWidgetsChange,this),this.add_related_model(this._widgets)},render:function(){return this.clearSubViews(),this.$el.empty(),this._widgets.each(this._maybeRenderWidgetView,this),this._toggleVisiblity(),this},_maybeRenderWidgetView:function(e){var t=this._widgetViewFactory.createWidgetView(e);t&&(this.addView(t),this.$el.append(t.render().el))},_toggleVisiblity:function(){this.$el.toggle(!s.isEmpty(this._subviews))},_onWidgetsChange:function(){this._widgets.each(function(e){e.forceResize()}),this._toggleVisiblity()}})},2581:function(e,t,i){var s=i(18),n=i(4),o=i(1476),a=i(2580),r=i(2566),l=i(2565);e.exports=n.extend({className:"CDB-Dashboard-canvas",initialize:function(e){this._widgets=e.widgets,this._infoView=e.infoView,this.el.classList.add(this.className),this.$el.html(o()),this._onWindowResize=this._onWindowResize.bind(this),s(window).bind("resize",this._onWindowResize)},render:function(){var e;this.clearSubViews();var t=this.model.get("renderMenu");return this.$el.toggleClass("CDB-Dashboard-canvas--withMenu",t),t&&(e=new r({model:this.model}),this.addView(e),this.$el.append(e.render().el)),this._widgets.some(function(e){return"time-series"===e.get("type")})&&this.$el.toggleClass("CDB-Dashboard-canvas--withTimeSeries"),e=new a({widgets:this._widgets}),this.addView(e),this.$(".js-map-wrapper").toggleClass("CDB-Dashboard-mapWrapper--withMenu",t).append(e.render().el),this._widgets&&this._widgets.length&&this.$el.toggleClass("CDB-Dashboard-canvas--withWidgets"),e=new l({widgets:this._widgets,model:this.model}),this.addView(e),this.$el.append(e.render().el),this},getInitialMapState:function(){return{bounds:this.model.get("initialPosition").bounds}},_onWindowResize:function(){this._widgets.each(function(e){e.forceResize()})},clean:function(){s(window).unbind("resize",this._onWindowResize),n.prototype.clean.call(this)}})},2583:function(e,t,i){var s=i(975),n=i(1);function Dashboard(e){this._dashboard=e,this.onDataviewsFetched(function(){e.widgets._widgetsCollection.initialState(),e.widgets._widgetsCollection.each(function(e){e&&e.applyInitialState&&e.applyInitialState()})})}Dashboard.prototype={getView:function(){return this._dashboard.dashboardView},getMap:function(){return this._dashboard.vis},reloadMap:function(){this.getMap().reload()},forceResize:function(){this._dashboard.widgets.getCollection().each(function(e){e.forceResize()})},getWidgets:function(){return this._dashboard.widgets.getList()},getDashboardURL:function(){return s.getURLFromState(this.getState())},getState:function(){var e={},t=this.getMapState();n.isEmpty(t)||(e.map=t);var i=this._dashboard.widgets.getCollection().getStates();return n.isEmpty(i)||(e.widgets=i),e},getMapState:function(){var e=this._dashboard.vis.map,t=e.getViewBounds(),i=e.get("center"),s=e.get("zoom");return{ne:t[0],sw:t[1],center:i,zoom:s}},setState:function(e){this._dashboard.widgets.setWidgetsState(e.widgets),this._dashboard.vis.mapvis.map.setBounds([e.map.ne,e.map.sw])},onDataviewsFetched:function(e){this._dashboard.areWidgetsInitialised()?e&&e():this._dashboard.vis.once("dataviewsFetched",function(){e&&e()})},onStateChanged:function(e){this.onDataviewsFetched(function(){e&&this._bindChange(e)}.bind(this))},_bindChange:function(e){this._dashboard.widgets.getCollection().bind("change",function(){e(this.getState(),this.getDashboardURL())},this),this._dashboard.vis.map.bind("change",function(){e(this.getState(),this.getDashboardURL())},this)},getWidget:function(e){return this._dashboard.widgets.get(e)},createCategoryWidget:function(e,t){return this._dashboard.widgets.createCategoryModel(e,t,null)},createHistogramWidget:function(e,t){return this._dashboard.widgets.createHistogramModel(e,t,null)},createFormulaWidget:function(e,t){return this._dashboard.widgets.createFormulaModel(e,t,null)},createTimeSeriesWidget:function(e,t){return this._dashboard.widgets.createTimeSeriesModel(e,t,null)}},e.exports=Dashboard},2584:function(e,t,i){var s=i(1),n=i(84),o=i(2583),a=i(2581),r=i(2552),l=i(2551),c=i(975),h=function(e,t,i,o){var h=document.querySelector(e);if(!h)throw new Error("no element found with selector "+e);(i=i||{}).renderMenu=!s.isBoolean(i.renderMenu)||i.renderMenu,i.autoStyle=!!s.isBoolean(i.autoStyle)&&i.autoStyle;var d=new r,u=new n.core.Model({title:t.title,description:t.description,updatedAt:t.updated_at,userName:t.user.fullname,userProfileURL:t.user.profile_url,userAvatarURL:t.user.avatar_url,renderMenu:i.renderMenu,autoStyle:i.autoStyle,showLogo:i.cartodb_logo,initialPosition:{bounds:t.bounds}}),p=new a({el:h,widgets:d,model:u}),g=i.state||c.getStateFromCurrentURL();g&&!s.isEmpty(g.map)&&(s.isArray(g.map.center)&&(t.center=g.map.center),s.isNumber(g.map.zoom)&&(t.zoom=g.map.zoom),g.map.ne&&g.map.sw&&(t.bounds=[g.map.ne,g.map.sw])),n.createVis(p.$("#map"),t,s.extend(i,{skipMapInstantiation:!0})).once("load",function(e){var i=g&&g.widgets||{},a=new l(d,e.dataviews),r={formula:a.createFormulaModel.bind(a),histogram:a.createHistogramModel.bind(a),"time-series":a.createTimeSeriesModel.bind(a),category:a.createCategoryModel.bind(a)};t.widgets.forEach(function(t){var o,a,l=s.extend({},t,t.options),c=r[t.type],h=i[t.id];s.isFunction(c)?(t.layer_id?o=e.map.layers.get(t.layer_id):Number.isInteger(t.layerIndex)&&(o=e.map.layers.at(t.layerIndex)),t.source&&t.source.id&&(a=e.analysis.findNodeById(t.source.id),l.source=a),c(l,o,h)):n.log.error("No widget found for type "+t.type)}),p.render();var c={dashboardView:p,widgets:a,areWidgetsInitialised:function(){var e=a.getCollection();return!(e.size()>0)||e.hasInitialState()},vis:e};e.instantiateMap({success:function(){o&&o(null,c)},error:function(e){o&&o(new Error(e),c)}})})};e.exports=function(e,t,i,a){var r=arguments,l=r[r.length-1];function _load(t){h(e,t,i,function(e,t){var n=new o(t);i.share_urls&&n.onStateChanged(s.debounce(function(e,t){window.history.replaceState("Object","Title",t)},500)),a&&a(e,n)})}s.isFunction(l)&&(a=l),"string"==typeof t?n.core.Loader.get(t,function(e){e?_load(e):a&&a(new Error("Error fetching viz.json file: "+t))}):_load(t)}},259:function(e,t,i){var s=i(3),n=i(1),o=i(4),a=i(1562),r=i(556);e.exports=o.extend({className:"Tab-pane",events:{mouseover:"_onMouseOver"},initialize:function initialize(e){var t;if(!this.collection)throw new Error("A TabPaneCollection should be provided");this._userModel=e.userModel,this._tabPaneItemOptions=this.options.tabPaneItemOptions,this._createContentKey=this.options.createContentKey||"createContentView",this.template=this.options.template||r,this.options.mouseOverAction&&(this._mouseOverAction=this.options.mouseOverAction),s(t=this.collection).call(t,"change:selected",this._renderSelected,this)},render:function render(){this.clearSubViews(),this.$el.empty(),this.$el.html(this.template(this.options)),this._renderCollection();var e=this.getSelectedTabPane();return e&&this._renderSelected(e,!0),this},getTabPaneCollection:function getTabPaneCollection(){return this.collection},getSelectedTabPane:function getSelectedTabPane(){return this.collection.getSelected()},getTabPane:function getTabPane(e){return n.first(this.collection.where({name:e}))},getSelectedTabPaneName:function getSelectedTabPaneName(){var e=this.getSelectedTabPane();return e?e.get("name"):null},setSelectedTabPaneByName:function setSelectedTabPaneByName(e){return this.collection.select("name",e)},_renderSelected:function _renderSelected(e,t){t&&(this._selectedView&&(this._selectedView.clean(),this.removeView(this._selectedView)),this._selectedView=this._renderTabPaneContentView(e))},_renderCollection:function _renderCollection(){this.collection.each(function(e){e.get("createButtonView")&&this._renderTabPaneItemView(e)},this)},_renderTabPaneItemView:function _renderTabPaneItemView(e){var t=new a(n.extend({model:e},this._tabPaneItemOptions));this.addView(t),this.$(".js-menu").append(t.render().el)},_renderTabPaneContentView:function _renderTabPaneContentView(e){var t=e.get(this._createContentKey).call(e);return t&&(this.addView(t),this.$(".js-content").append(t.render().el),"function"==typeof t.afterRender&&t.afterRender()),t},changeStyleMenu:function changeStyleMenu(e){this.$(".js-theme").toggleClass("is-dark",e.isEditing())},_onMouseOver:function _onMouseOver(){this._mouseOverAction&&this._mouseOverAction()}})},262:function(e,t){e.exports={STYLED_BY_VALUE:"Styled by value",DOWNLOADED_LAYER:"Downloaded layer",CREATED_LAYER:"Created Layer",MODIFIED_ANALYSIS:"Modified analysis",CREATED_ANALYSIS:"Created analysis",DELETED_ANALYSIS:"Deleted analysis",DRAGGED_NODE:"Dragged node",APPLIED_SQL:"Applied sql",WEBGL_STATS:"WebGL stats",USED_ADVANCED_MODE:"Used advanced mode",AGGREGATED_GEOMETRIES:"Aggregated geometries",MODIFIED_STYLE_FORM:"Modified Style Form",CHANGED_DEFAULT_GEOMETRY:"Changed default geometry",APPLIED_CARTOCSS:"Applied Cartocss",VISITED_PRIVATE_PAGE:"visited_private_page"}},263:function(e,t,i){var s=i(195),n=i(1),o=i(2977),a=i(262);e.exports={init:function init(e){if(!e||!e.configModel)throw new Error("configModel is required");this._userId=e.userId,this._visId=e.visId,this._configModel=e.configModel},track:function track(e,t){if(!e)throw new Error("eventName is required");this._checkEventIsConfigured(e),new o({eventName:e,eventProperties:t},{userId:this._userId,visId:this._visId,configModel:this._configModel}).save()},_checkEventIsConfigured:function _checkEventIsConfigured(e){var t=s(n).call(n,a);if(!n.contains(t,e))throw new Error('"'.concat(e,'" is not an allowed event type'))}}},264:function(e,t,i){var s=i(1),n=i(6),o=i(4),a=i(84),r=i(783);e.exports=o.extend({className:"IntermediateInfo",initialize:function initialize(e){var t=s.defaults(s.pick(e,["title","desc"]),{title:_t("components.error.default-title"),desc:_t("components.error.default-desc")});this._template=this.options&&this.options.template||r,this.model=new n.Model(t)},render:function render(){return this.$el.html(this._html()),this},_html:function _html(){var e=this.model;return this._template({title:e.get("title"),desc:a.core.sanitize.html(e.get("desc"))})}})},265:function(e,t,i){var s=i(330).default,n=i(65),o=i(32),a=i(13),r=i(3),l=i(18),c=i(1);function NetworkResponseInterceptor(){this._originalAjax=l.ajax,this._successInterceptors=[],this._errorInterceptors=[],this._urlPatterns=[]}NetworkResponseInterceptor.prototype.start=function(){var e,t=r(e=this._onRequestStart).call(e,this);this._onRequestStart=t,l.ajax=t},NetworkResponseInterceptor.prototype.stop=function(){l.ajax=this._originalAjax},NetworkResponseInterceptor.prototype.addURLPattern=function(e){this._urlPatterns.push(e)},NetworkResponseInterceptor.prototype.addSuccessInterceptor=function(e){this._successInterceptors.push(e)},NetworkResponseInterceptor.prototype.addErrorInterceptor=function(e){this._errorInterceptors.push(e)},NetworkResponseInterceptor.prototype._shouldListenToRequest=function(e){var t,i=a(t=this._urlPatterns).call(t,function(t){return o(e).call(e,t)>-1});return n(c).call(c,i)},NetworkResponseInterceptor.prototype._onRequestStart=function(e,t){var i=null,n={};if("string"==typeof e?i=e:"object"===s(e)&&e.url&&(i=e.url),t?n=t:"object"===s(e)&&(n=e),!this._shouldListenToRequest(i))return this._originalAjax.apply(this,arguments);if(n.error||n.success){var o=n.error,a=n.success,l=function interceptErrorFn(){this._applyErrorInterceptors.apply(this,arguments),o&&o.apply(this,arguments)},c=function interceptSuccessFn(){this._applySuccessInterceptors.apply(this,arguments),a&&a.apply(this,arguments)};n.error=r(l).call(l,this),n.success=r(c).call(c,this)}return this._originalAjax(i,n)},NetworkResponseInterceptor.prototype._applyErrorInterceptors=function(e,t,i){var s;this._errorInterceptors.length&&a(s=this._errorInterceptors).call(s,function(s){s(e,t,i)})},NetworkResponseInterceptor.prototype._applySuccessInterceptors=function(e,t,i){var s;this._successInterceptors.length&&a(s=this._successInterceptors).call(s,function(s){s(e,t,i)})},e.exports=new NetworkResponseInterceptor,e.exports.NetworkResponseInterceptor=NetworkResponseInterceptor},2704:function(e,t,i){var s=i(1),n=i(4),o=i(986),a=i(14),r=["modalModel","onPasswordTyped"];e.exports=n.extend({events:{"click .js-ok":"_onConfirm","click .js-cancel":"_closeDialog","keydown #password-confirmation-form":"_onEnterPressed","input .js-password":"_toggleConfirmButton"},initialize:function initialize(e){a(e,r,this),this._isConfirmDisabled=!0},render:function render(){return this.$el.html(o({isConfirmDisabled:this._isConfirmDisabled,updatePassword:this.options.updatePassword})),this._okButton=this.$(".js-ok"),this},_toggleConfirmButton:function _toggleConfirmButton(e){var t=e.target;this._isConfirmDisabled=s.isEmpty(t.value),this._okButton.toggleClass("is-disabled",this._isConfirmDisabled)},_onConfirm:function _onConfirm(e){if(this.killEvent(e),!this._isConfirmDisabled){var t=this.$("#password-confirmation").val();this._onPasswordTyped&&this._onPasswordTyped(t),this._closeDialog()}},_onEnterPressed:function _onEnterPressed(e){13===e.keyCode&&this._onConfirm(e)},_closeDialog:function _closeDialog(){this._modalModel.destroy()}})},2708:function(e,t,i){i(34),i(88);var s=i(89),n=function BytesToSize(e){return this instanceof BytesToSize?(this.bytes=e,this.unit=0===e?0:s(Math.floor(Math.log(e)/Math.log(1024))),this):new BytesToSize(e)};n.prototype.size=function(){return this.bytes/Math.pow(1024,this.unit)},n.prototype.UNIT_SUFFIXES=["B","kB","MB","GB","TB"],n.prototype.suffix=function(){return this.UNIT_SUFFIXES[this.unit]},n.prototype.toString=function(e){var t=this.size();if(e){var i=Math.pow(10,e);t=Math.floor(t*i)/i}else t=Math.floor(t);return t+this.suffix()},e.exports=n},2718:function(e,t,i){var s=i(7),n=i(6),o=i(14);i(1059);var a=["configModel","userId"];e.exports=n.Model.extend({url:function url(e){var t,i=this._configModel.urlVersion("asset",e);return s(t="/api/".concat(i,"/users/")).call(t,this._userId,"/assets")},fileAttribute:"filename",initialize:function initialize(e,t){o(t,a,this)}})},2719:function(e,t,i){(function(e){!function(e){"use strict";var t=function(t,i){this.options=i,this.$elementFilestyle=[],this.$element=e(t)};t.prototype={clear:function(){this.$element.val(""),this.$elementFilestyle.find(":text").val("")},destroy:function(){this.$element.removeAttr("style").removeData("filestyle").val(""),this.$elementFilestyle.remove()},disabled:function(e){if(!0===e)this.options.disabled||(this.$element.attr("disabled","true"),this.$elementFilestyle.find("label").attr("disabled","true"),this.options.disabled=!0);else{if(!1!==e)return this.options.disabled;this.options.disabled&&(this.$element.removeAttr("disabled"),this.$elementFilestyle.find("label").removeAttr("disabled"),this.options.disabled=!1)}},buttonBefore:function(e){if(!0===e)this.options.buttonBefore||(this.options.buttonBefore=!0,this.options.input&&(this.$elementFilestyle.remove(),this.constructor(),this.pushNameFiles()));else{if(!1!==e)return this.options.buttonBefore;this.options.buttonBefore&&(this.options.buttonBefore=!1,this.options.input&&(this.$elementFilestyle.remove(),this.constructor(),this.pushNameFiles()))}},icon:function(e){if(!0===e)this.options.icon||(this.options.icon=!0,this.$elementFilestyle.find("label").prepend(this.htmlIcon()));else{if(!1!==e)return this.options.icon;this.options.icon&&(this.options.icon=!1,this.$elementFilestyle.find(".glyphicon").remove())}},input:function(e){if(!0===e){if(!this.options.input){this.options.input=!0,this.options.buttonBefore?this.$elementFilestyle.append(this.htmlInput()):this.$elementFilestyle.prepend(this.htmlInput()),this.$elementFilestyle.find(".badge").remove();var t="",i=[];void 0===this.$element[0].files?i[0]={name:this.$element[0].value}:i=this.$element[0].files;for(var s=0;s<i.length;s++)t+=i[s].name.split("\\").pop()+", ";""!==t&&this.$elementFilestyle.find(":text").val(t.replace(/\, $/g,"")),this.$elementFilestyle.find(".group-span-filestyle").addClass("input-group-btn")}}else{if(!1!==e)return this.options.input;if(this.options.input){this.options.input=!1,this.$elementFilestyle.find(":text").remove();i=[];void 0===this.$element[0].files?i[0]={name:this.$element[0].value}:i=this.$element[0].files,i.length>0&&this.$elementFilestyle.find("label").append(' <span class="badge">'+i.length+"</span>"),this.$elementFilestyle.find(".group-span-filestyle").removeClass("input-group-btn")}}},size:function(e){if(void 0===e)return this.options.size;var t=this.$elementFilestyle.find("label"),i=this.$elementFilestyle.find("input");t.removeClass("btn-lg btn-sm"),i.removeClass("input-lg input-sm"),"nr"!=e&&(t.addClass("btn-"+e),i.addClass("input-"+e))},buttonText:function(e){if(void 0===e)return this.options.buttonText;this.options.buttonText=e,this.$elementFilestyle.find("label span").html(this.options.buttonText)},buttonName:function(e){if(void 0===e)return this.options.buttonName;this.options.buttonName=e,this.$elementFilestyle.find("label").attr({class:"btn "+this.options.buttonName})},iconName:function(e){if(void 0===e)return this.options.iconName;this.$elementFilestyle.find(".glyphicon").attr({class:".glyphicon "+this.options.iconName})},htmlIcon:function(){return this.options.icon?'<span class="glyphicon '+this.options.iconName+'"></span> ':""},htmlInput:function(){return this.options.input?'<input type="text" class="form-control '+("nr"==this.options.size?"":"input-"+this.options.size)+'" disabled> ':""},pushNameFiles:function(){var e="",t=[];void 0===this.$element[0].files?t[0]={name:this.$element.value}:t=this.$element[0].files;for(var i=0;i<t.length;i++)e+=t[i].name.split("\\").pop()+", ";""!==e?this.$elementFilestyle.find(":text").val(e.replace(/\, $/g,"")):this.$elementFilestyle.find(":text").val("")},constructor:function(){var t,i,s,n=this,o=this.$element.attr("id"),a=[];""!==o&&o||(o="filestyle-"+e(".bootstrap-filestyle").length,this.$element.attr({id:o})),i='<span class="group-span-filestyle '+(this.options.input?"input-group-btn":"")+'"><label for="'+o+'" class="btn '+this.options.buttonName+" "+("nr"==this.options.size?"":"btn-"+this.options.size)+'" '+(this.options.disabled?'disabled="true"':"")+">"+this.htmlIcon()+this.options.buttonText+"</label></span>",t=this.options.buttonBefore?i+this.htmlInput():this.htmlInput()+i,this.$elementFilestyle=e('<div class="bootstrap-filestyle input-group">'+t+"</div>"),(s=this.$elementFilestyle.find("label")).parent().attr("tabindex","0").keypress(function(e){13!==e.keyCode&&32!==e.charCode||s.click()}),this.$element.css({position:"absolute",clip:"rect(0,0,0,0)"}).attr("tabindex","-1").after(this.$elementFilestyle),this.options.disabled&&this.$element.attr("disabled","true"),this.$element.change(function(){var e="";void 0===this.files?a[0]={name:this.value}:a=this.files;for(var t=0;t<a.length;t++)e+=a[t].name.split("\\").pop()+", ";""!==e?n.$elementFilestyle.find(":text").val(e.replace(/\, $/g,"")):n.$elementFilestyle.find(":text").val(""),0==n.options.input?0==n.$elementFilestyle.find(".badge").length?n.$elementFilestyle.find("label").append(' <span class="badge">'+a.length+"</span>"):0==a.length?n.$elementFilestyle.find(".badge").remove():n.$elementFilestyle.find(".badge").html(a.length):n.$elementFilestyle.find(".badge").remove()}),window.navigator.userAgent.search(/firefox/i)>-1&&this.$elementFilestyle.find("label").click(function(){return n.$element.click(),!1})}};var i=e.fn.filestyle;e.fn.filestyle=function(i,s){var n="",o=this.each(function(){if("file"===e(this).attr("type")){var o=e(this),a=o.data("filestyle"),r=e.extend({},e.fn.filestyle.defaults,i,"object"==typeof i&&i);a||(o.data("filestyle",a=new t(this,r)),a.constructor()),"string"==typeof i&&(n=a[i](s))}});return void 0!==typeof n?n:o},e.fn.filestyle.defaults={buttonText:"Choose file",iconName:"glyphicon-folder-open",buttonName:"btn-default",size:"nr",input:!0,icon:!0,buttonBefore:!1,disabled:!1},e.fn.filestyle.noConflict=function(){return e.fn.filestyle=i,this},e(function(){e(".filestyle").each(function(){var t=e(this),i={input:"false"!==t.attr("data-input"),icon:"false"!==t.attr("data-icon"),buttonBefore:"true"===t.attr("data-buttonBefore"),disabled:"true"===t.attr("data-disabled"),size:t.attr("data-size"),buttonText:t.attr("data-buttonText"),buttonName:t.attr("data-buttonName"),iconName:t.attr("data-iconName")};t.filestyle(i)})})}(e)}).call(this,i(18))},2751:function(e,t,i){i(31);var s=i(3),n=i(76),o=i(25);i(31);var a=i(18),r=i(246),l=i(170),c=i(447),h=i(1e3);e.exports=c.extend({className:"Dropdown",initialize:function initialize(e){c.prototype.initialize.apply(this,arguments),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.html(this.template()),this._renderDropdown(),this._checkScroll(),a("body").append(this.el),this},_renderDropdown:function _renderDropdown(){var e;this.dropdown_content=l.createByTemplate(h,{items:this.collection.toJSON(),unreadItems:o(e=this.collection).call(e,function(e){return!e.get("opened")}).length}),this.addView(this.dropdown_content),this.$(".js-content").html(this.dropdown_content.render().el)},_checkScroll:function _checkScroll(){var e;n(s(e=function _context2(){if(this.$el.height()>=300){var e,t=new r({createContentView:s(e=function _context3(){return this.dropdown_content}).call(e,this)});this.addView(t),this.$el.addClass("Dropdown--withScroll"),this.$(".js-content").html(t.render().el)}}).call(e,this),301)},_initBinds:function _initBinds(){}})},2752:function(e,t,i){var s=i(7),n=i(1499),o=i(14),a=["userId","configModel","apiKey"];e.exports=n.extend({url:function url(){var e,t;return s(e=s(t="/api/v3/users/".concat(this._userId,"/notifications/")).call(t,this.id,"?api_key=")).call(e,this._apiKey)},initialize:function initialize(e,t){o(t,a,this)},markAsRead:function markAsRead(){this.save({notification:{read_at:new Date}})}})},2753:function(e,t,i){var s=i(290).default,n=i(6),o=i(1499),a=i(2752),r=i(14),l=["configModel"];e.exports=n.Collection.extend({initialize:function initialize(e){r(e,l,this)},model:function model(e,t){return"org_notification"===e.type?new a(e,s({},t,{configModel:t.collection._configModel})):new o(e)}})},2754:function(e,t,i){var s=i(539).default,n=i(3),o=i(25),a=i(18),r=i(74),l=i(4),c=i(2753),h=i(2751),d=i(999),u=i(998),p=i(997),g=i(14),m={tryTrial:i(996),limitsExceeded:i(995),closeLimits:i(994),upgradedMessage:i(993),trialEndsSoon:i(992)},f=["configModel","user"];e.exports=l.extend({attributes:{href:"#/notifications"},tagName:"a",className:"UserNotifications",events:{click:"_openNotifications"},initialize:function initialize(e){g(e,f,this),this.localStorage=new p,this.collection=new c({configModel:e.configModel}),this.collection.reset(this._generateCollection(),{userId:this._user.get("id"),apiKey:this._user.get("api_key"),silent:!0}),this._initBinds()},render:function render(){var e,t=o(e=this.collection).call(e,function(e){return!e.get("opened")}).length;return this.$el.html(d({notificationsCount:t})),this.$el.toggleClass("has--alerts",t>0),this},_initBinds:function _initBinds(){var e,t,i;n(e=this._user).call(e,"change",this._onUserChange,this),n(t=this.collection).call(t,"reset",this.render,this),n(i=this.collection).call(i,"remove",this.render,this),this.add_related_model(this._user),this.add_related_model(this.collection)},_onUserChange:function _onUserChange(){this.collection.reset(this._generateCollection(),{userId:this._user.get("id"),apiKey:this._user.get("api_key")}),this.render()},_generateCollection:function _generateCollection(){var e=[],t={},i=this._user.viewUrl(),s=this._configModel.get("cartodb_com_hosted");t.isInsideOrg=this._user.isInsideOrg(),t.isOrgOwner=this._user.isOrgOwner(),t.accountType=this._user.get("account_type").toLowerCase(),t.remainingQuota=this._user.get("remaining_byte_quota"),t.publicProfileUrl=i.publicProfile(),t.bytesQuota=this._user.get("quota_in_bytes"),t.userType="regular",t.upgradeUrl=window.upgrade_url||"",t.upgradeContactEmail=this._user.upgradeContactEmail(),t.trialEnd=this._user.get("trial_ends_at")&&r(this._user.get("trial_ends_at")).format("YYYY-MM-DD"),t.userName=this._user.get("name")||this._user.get("username"),t.isInsideOrg&&!t.isOrgOwner?t.userType="org":t.isOrgOwner?t.userType="admin":"internal"!==t.accountType&&"partner"!==t.accountType&&"ambassador"!==t.accountType||(t.userType="internal"),!s&&!t.isInsideOrg&&"free"===t.accountType&&this._user.get("table_count")>0?e.push({iconFont:"CDB-IconFont-gift",severity:"NotificationsDropdown-itemIcon--positive",type:"try_trial",msg:m.tryTrial(t),opened:this.localStorage.get("notification.try_trial")}):this.localStorage.remove("notification.try_trial"),!s&&t.bytesQuota>0&&t.remainingQuota<=0?e.push({iconFont:"CDB-IconFont-barometer",severity:"NotificationsDropdown-itemIcon--negative",type:"limits_exceeded",msg:m.limitsExceeded(t),opened:this.localStorage.get("notification.limits_exceeded")}):this.localStorage.remove("notification.limits_exceeded"),!s&&t.bytesQuota>0&&100*t.remainingQuota/t.bytesQuota<20?e.push({iconFont:"CDB-IconFont-barometer",severity:"NotificationsDropdown-itemIcon--alert",type:"close_limits",msg:m.closeLimits(t),opened:this.localStorage.get("notification.close_limits")}):this.localStorage.remove("notification.close_limits"),!s&&this._user.get("show_upgraded_message")?e.push({iconFont:"CDB-IconFont-heartFill",severity:"NotificationsDropdown-itemIcon--positive",type:"upgraded_message",msg:m.upgradedMessage(t),opened:this.localStorage.get("notification.upgraded_message")}):this.localStorage.remove("notification.upgraded_message"),this._user.get("show_trial_reminder")?e.push({iconFont:"CDB-IconFont-clock",severity:"NotificationsDropdown-itemIcon--alert",type:"trial_ends_soon",msg:m.trialEndsSoon(t),opened:this.localStorage.get("notification.trial_ends_soon")}):this.localStorage.remove("notification.trial_ends_soon");var n=window.organization_notifications||this.options.organizationNotifications;if(n)for(var o=0;o<n.length;o++){var a=n[o],l=a.icon?"CDB-IconFont-"+a.icon:"CDB-IconFont-alert";e.push({iconFont:l,severity:"NotificationsDropdown-itemIcon--alert",id:a.id,msg:a.html_body,read_at:a.read_at,type:"org_notification"})}return e},_openNotifications:function _openNotifications(e){var t=this;if(e&&this.killEvent(e),this.notification)return this.notification.hide(),delete this.notification,this;var i=this.notification=new h({target:this.$el,collection:this.collection,horizontal_offset:5,vertical_offset:-5,template:u});a(i.options.target).unbind("click",i._handleClick),this._closeAnyOtherOpenDialogs(),i.on("onDropdownHidden",function(){return t._onDropdownHidden(i)}),i.render(),i.open(),this.addView(i)},_onDropdownHidden:function _onDropdownHidden(e){var t=this;this.collection.each(function(e){var i=e.get("type");"org_notification"===i?e.markAsRead():i&&(e.set("opened",!0),t.localStorage.set(s({},"notification.".concat(i),!0)))}),this.collection.reset(),e.clean(),this.removeView(e),this.$el.removeClass("has--alerts"),delete this.notification},_closeAnyOtherOpenDialogs:function _closeAnyOtherOpenDialogs(){}})},2755:function(e,t,i){var s=i(18),n=i(14),o=i(1063),a=i(447),r=["viewModel"];e.exports=a.extend({className:"Dropdown BreadcrumbsDropdown",events:{"click a":"_navigateToLinksHref"},initialize:function initialize(e){n(e,r,this),a.prototype.initialize.apply(this,arguments)},render:function render(){var e=this.model.viewUrl().dashboard(),t=e.datasets(),i=e.deepInsights(),n=e.maps();return this.$el.html(this.template({avatarUrl:this.model.get("avatar_url"),userName:this.model.get("username"),mapsUrl:n,datasetsUrl:t,deepInsightsUrl:i,lockedDatasetsUrl:t.lockedItems(),lockedMapsUrl:n.lockedItems(),isDeepInsights:this._viewModel.isDisplayingDeepInsights(),isDatasets:this._viewModel.isDisplayingDatasets(),isMaps:this._viewModel.isDisplayingMaps(),isLocked:this._viewModel.isDisplayingLockedItems()})),s("body").append(this.el),this},_navigateToLinksHref:function _navigateToLinksHref(){this.hide(),this.options.router&&o.apply(this,arguments)}})},2756:function(e,t,i){i(23),i(40);var s=i(1),n=i(18),o=i(14),a=i(447),r=i(59),l=i(1001),c=["model","configModel"];e.exports=a.extend({className:"Dropdown",initialize:function initialize(e){o(e,c,this),a.prototype.initialize.apply(this,arguments)},shortDisplayName:function shortDisplayName(e){var t=e.get("account_type_display_name"),i=s.isUndefined(t)?e.get("account_type"):t;return s.isUndefined(i)?i:"organization user"===(i=i.toLowerCase())?"org. user":i.replace(/lump-sum/gi,"- A").replace(/academic/gi,"aca.").replace(/ - Monthly/i," - M").replace(/ - Annual/i," - A").replace(/Non-Profit/i,"NP").replace(/On-premises/i,"OP").replace(/Internal use engine/i,"engine").replace(/Lite/i,"L").replace(/Cloud Engine &/i,"C. Engine &").replace(/& Enterprise Builder/i,"& E. Builder").replace(/CARTO for /i,"").replace(/CARTO /i,"")},render:function render(){var e=this.model,t=e.get("db_size_in_bytes"),i=e.get("quota_in_bytes"),s=Math.round(t/i*100),o="";s>80&&s<90?o="is--inAlert":s>89&&(o="is--inDanger");var a=this.shortDisplayName(e),c=this.model.viewUrl(),h=window.upgrade_url||this._configModel.get("upgrade_url")||"";return this.$el.html(l({name:e.fullName()||e.get("username"),email:e.get("email"),accountType:a,isOrgAdmin:e.isOrgAdmin(),usedDataStr:r.readablizeBytes(t),usedDataPct:s,progressBarClass:o,availableDataStr:r.readablizeBytes(i),showUpgradeLink:h&&(e.isOrgOwner()||!e.isInsideOrg())&&!this._configModel.get("cartodb_com_hosted"),upgradeUrl:h,publicProfileUrl:c.publicProfile(),apiKeysUrl:c.apiKeys(),organizationUrl:c.organization(),accountProfileUrl:c.accountProfile(),logoutUrl:c.logout(),isViewer:e.isViewer(),isBuilder:e.isBuilder(),orgDisplayEmail:e.isInsideOrg()?e.organization.display_email:null,engineEnabled:e.get("actions").engine_enabled,mobileAppsEnabled:e.get("actions").mobile_sdk_enabled})),n("body").append(this.el),this}})},2778:function(e,t,i){var s=i(13),n=i(1089),o=[40.7127837,-74.0059413];e.exports=function(e){if(e.basemap.urlTemplate){var t=s(n).call(n,e.el,{zoomControl:!1,minZoom:6,maxZoom:6,scrollWheelZoom:!1});t.setView(o,6),t.dragging.disable(),t.touchZoom.disable(),t.doubleClickZoom.disable(),t.attributionControl.setPrefix("");var i=e.basemap.urlTemplate;window.devicePixelRatio>1&&(i=e.basemap.urlTemplate2x||i),n.tileLayer(i,{attribution:e.basemap.attribution}).addTo(t)}else if("googlemaps"===e.basemap.className&&void 0!==google.maps)new google.maps.Map(e.el,{center:{lat:o[0],lng:o[1]},zoom:6,draggable:!1,scrollwheel:!1,panControl:!1,zoomControl:!1,streetViewControl:!1,maxZoom:6,minZoom:6,mapTypeControl:!1,mapTypeId:e.basemap.baseType||google.maps.MapTypeId.ROADMAP,styles:[{featureType:"all",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{visibility:"off"}]}]})}},2822:function(e,t,i){var s=i(18),n=i(447),o=i(1005);e.exports=n.extend({className:"CDB-Text Dropdown Dropdown--public",render:function render(){return this.$el.html(o()),s("body").append(this.el),this}})},2823:function(e,t,i){var s=i(89),n=i(18),o=i(1),a=i(6),r=i(4),l={width:160,speedIn:150,speedOut:300,verticalPosition:"down",horizontalPosition:"right",tick:"right",verticalOffset:0,horizontalOffset:0};e.exports=r.extend({className:"dropdown",initialize:function initialize(e){o.bindAll(this,"open","hide","_handleClick","_keydown","_onDocumentClick"),this.options={},o.defaults(this.options,e,l),e.template&&(this.template=e.template),n(e.target).on("click",this._handleClick),n(document).on("keydown",this._keydown),n(document).on("click",this._onDocumentClick),this.modelView=new a.Model({open:!1}),this.modelView.on("change:open",function(e,t){t?this.hide():this.open()},this)},render:function render(){return this.$el.html(this.template&&this.template(this.options)).css({width:this.options.width}),this},_handleClick:function _handleClick(e){e&&e.preventDefault();var t=this.modelView.get("open");this.modelView.set("open",!t)},_onDocumentClick:function _onDocumentClick(e){var t=n(e.target),i=n(this.options.target);t.get(0)===i.get(0)||0!==t.closest(".Dropdown").length||(this.modelView.set({open:!1},{silent:!0}),this.hide())},_keydown:function _keydown(e){27===e.keyCode&&this.modelView.set("open",!1)},hide:function hide(){this.$el.hide()},show:function show(){this.$el.css({display:"block",opacity:1})},open:function open(e,t){var i=t&&n(t)||this.options.target;this.options.target=i;var o=i[this.options.position||"offset"](),a=i.outerWidth(),r=i.outerHeight(),l=this.$el.outerWidth(),c=this.$el.outerHeight(),h=this.options.verticalPosition,d=this.options.verticalOffset,u=this.options.horizontalPosition,p=this.options.horizontalOffset;this.$el.css({top:o.top+s("up"===h?-c-10-d:r+10-d),left:o.left+s("left"===u?p-15:a-l+15-p)}).addClass(("up"===h?"vertical_top":"vertical_bottom")+" "+("right"===u?"horizontal_right":"horizontal_left")+" tick_"+this.options.tick),this.show()},isOpen:function isOpen(){return this.modelView.get("open")},clean:function clean(){var e=n(this.options.target);this.options.target&&e.off("click",this._handleClick),n(document).off("keydown",this._keydown),n(document).off("click",this._onDocumentClick),r.prototype.clean.apply(this)}})},2824:function(e,t,i){var s=i(18),n=i(1008),o=i(447);e.exports=o.extend({className:"CDB-Text Dropdown",render:function render(){var e=this.model,t=e.viewUrl();return this.$el.html(n({name:e.fullName()||e.get("username"),email:e.get("email"),isOrgOwner:e.isOrgOwner(),dashboardUrl:t.dashboard(),publicProfileUrl:t.publicProfile(),accountProfileUrl:t.accountProfile(),logoutUrl:t.logout()})),s("body").append(this.el),this}})},2843:function(e,t,i){var s=i(360),n=i(25),o=i(1),a=i(6),r=i(1508),l=i(14),c=["configModel","userModel"];e.exports=a.Collection.extend({model:function model(e,t){return new r(e,{userModel:t.collection._userModel,configModel:t.collection._configModel})},url:function url(e){return"/api/"+this._configModel.urlVersion("import",e)+"/imports"},initialize:function initialize(e,t){l(t,c,this)},parse:function parse(e){var t=this;return 0===e.imports.length?this.destroyCheck():o.each(e.imports,function(e){0===n(t).call(t,function(t){return t._importModel.get("item_queue_id")===e}).length&&t.add(new r({id:e},{userModel:t._userModel,configModel:t._configModel}))}),this.models},canImport:function canImport(){var e=this._userModel.getMaxConcurrentImports(),t=this.size(),i=0;return this.each(function(e){(e.hasFailed()||e.hasCompleted())&&++i}),t-i<e},pollCheck:function pollCheck(e){var t=this;this.pollTimer||(this.pollTimer=s(function(){t.fetch()},3e4),this.fetch())},destroyCheck:function destroyCheck(){clearInterval(this.pollTimer),delete this.pollTimer},completedItems:function completedItems(){var e;return n(e=this).call(e,function(e){return e.hasCompleted()})},getCompletedItemsCount:function getCompletedItemsCount(){return this.completedItems().length},failedItems:function failedItems(){var e;return n(e=this).call(e,function(e){return e.hasFailed()})},getFailedItemsCount:function getFailedItemsCount(){return this.failedItems().length},allImportsCompletedOrFailed:function allImportsCompletedOrFailed(){return this.all(function(e){return e.hasCompleted()||e.hasFailed()})}})},2877:function(e,t,i){i(35);var s=i(1),n=i(4),o=i(1058),a=i(1030),r=i(1519),l=s.template("<span class='CDB-Text CDB-Size-small is-semibold u-errorTextColor'><%- private %></span>.<br>")({private:_t("components.modals.publish.share.private")});e.exports=n.extend({className:"Card",tagName:"li",events:{"click .js-change-privacy":"_onChangePrivacyClick"},initialize:function initialize(e){if(!e.model)throw new Error("model is required");if(null==e.isPublished)throw new Error("isPublished is required");this._isPublished=e.isPublished,this._type=this.model.type(),this._hasOrganization=e.hasOrganization,this._title=_t("components.modals.publish.share."+this._type+".title"),this.model.isPrivate()?this._body=_t("components.modals.publish.share."+this._type+".private.body",{private:l}):this._body=_t("components.modals.publish.share."+this._type+".body"),this._link=_t("components.modals.publish.share."+this._type+".link"),this._copy=this._getButtonLabel(),this.$el.toggleClass("is-disabled",this.model.isPrivate())},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),!this.model.isPrivate()&&this._isPublished&&this._initClipboard(),this},_getButtonLabel:function _getButtonLabel(){var e=r(),t=_t("components.modals.publish.share."+this._type+".copy");return"Safari"===e.name&&(t=_t("components.modals.publish.share."+this._type+".select")),t},getValue:function getValue(){return this.$(".js-input").val()},_initViews:function _initViews(){var e=a({id:this.cid,isPrivate:this.model.isPrivate(),type:this._type,title:this._title,body:this._body,content:this.model.content(),link:this._link,copy:this._copy,url:this.model.url(),isPublished:this._isPublished});this.$el.append(e);var t=this.model.createIcon();this.$(".js-icon").append(t())},_initClipboard:function _initClipboard(){this._clipboard&&this._clipboard.destroy();var e=this.$(".js-copy");this._clipboard=new o(e.get(0))},_onChangePrivacyClick:function _onChangePrivacyClick(e){this.killEvent(e),this.options.onChangePrivacy&&this.options.onChangePrivacy()},clean:function clean(){this._clipboard&&this._clipboard.destroy(),n.prototype.clean.call(this)}})},2878:function(e,t,i){var s=i(6);e.exports=s.Model.extend({createIcon:function createIcon(){return this.get("createIcon")},type:function type(){return this.get("type")},content:function content(){return this.get("content")},url:function url(){return this.get("url")},isPrivate:function isPrivate(){return this.get("private")}})},2879:function(e,t,i){var s=i(6),n=i(2878);e.exports=s.Collection.extend({model:n})},2880:function(e,t,i){var s=i(1032),n=i(1031);e.exports=function(e){return[{createIcon:function createIcon(){return s()},type:"get-link",content:e.embedURL(),private:"PRIVATE"===e.get("privacy")},{createIcon:function createIcon(){return n()},type:"embed",content:'<iframe width="100%" height="520" frameborder="0" src="'+encodeURI(e.embedURL())+'" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>',url:encodeURI(e.embedURL()),private:"PRIVATE"===e.get("privacy")}]}},2881:function(e,t,i){var s=i(6);e.exports=s.Model.extend({defaults:{status:"idle",info:"",closable:!0},initialize:function initialize(e,t){void 0===e.id&&this.set("id","notifier"+this.cid),this.set("defaultDelay",t.delay),t.visDefinitionModel&&(this._retriggerEvent(t.visDefinitionModel,"vis:reload"),this._retriggerEvent(t.visDefinitionModel,"vis:error"))},isClosable:function isClosable(){return!0===this.get("closable")},updateClosable:function updateClosable(e){this.set({closable:e})},getButton:function getButton(){return this.get("button")},updateButton:function updateButton(e){this.set({button:e})},getStatus:function getStatus(){return this.get("status")},updateStatus:function updateStatus(e){this.set({status:e})},getInfo:function getInfo(){return this.get("info")},getAction:function getAction(){return this.get("action")},setAction:function setAction(e){this.set({action:e})},updateInfo:function updateInfo(e){this.set({info:e})},update:function update(e){this.set(e)},_retriggerEvent:function _retriggerEvent(e,t){e.on(t,function(){this.trigger(t,arguments)},this)}})},2882:function(e,t,i){var s=i(6),n=i(2881);e.exports=s.Collection.extend({model:function model(e,t){return new n(e,t)},findById:function findById(e){return this.findWhere({id:e})},addNotification:function addNotification(e,t){var i=this._findNotificationByAttrs(e);return i?i.update(e):this.add(e,t)},_findNotificationByAttrs:function _findNotificationByAttrs(e){return this.findWhere({info:e.info})}})},2883:function(e,t,i){i(31),i(31);var s=i(4);e.exports=s.extend({tagName:"button",initialize:function initialize(e){if(!e.template)throw new Error("template is required");if(!e.editorModel)throw new Error("editorModel is required");this.template=e.template,this._editorModel=e.editorModel,this._data={},e.model&&(this._data=e.model.toJSON()),this._initBinds()},_initBinds:function _initBinds(){this.listenTo(this._editorModel,"change:edition",this._changeStyle),this.add_related_model(this._editorModel)},render:function render(){return this.clearSubViews(),this.$el.empty(),this.$el.append(this.template(this._data)),this},_changeStyle:function _changeStyle(){this.$(".js-theme").toggleClass("is-white",this._editorModel.isEditing())}})},2884:function(e,t,i){var s=i(3),n=i(76),o=i(4),a=i(1037),r=i(2883),l=i(1036),c=i(1035);e.exports=o.extend({className:"Notifier-inner",tagName:"li",events:{"click .js-close":"_closeHandler","click .js-action":"_actionHandler"},initialize:function initialize(e){if(!e.notifierModel)throw new Error("notifierModel is required");if(!e.editorModel)throw new Error("editorModel is required");var t;(this._editorModel=e.editorModel,this.template=this.options.template||a,this._notifierModel=e.notifierModel,this.$el.attr("id",this._notifierModel.get("id")),this._delay=this._notifierModel.get("delay")||this._notifierModel.get("defaultDelay"),this._notifierModel.get("delay")&&!1!==this._notifierModel.get("closable"))&&(this._timeout=n(s(t=this._autoClose).call(t,this),this._delay));this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this._changeStyle(),this},_initBinds:function _initBinds(){this.listenTo(this._notifierModel,"change",this.render),this.listenTo(this._notifierModel,"change:status",this._onChangeStatus),this.add_related_model(this._notifierModel),this.listenTo(this._editorModel,"change:edition",this._changeStyle),this.add_related_model(this._editorModel)},_initViews:function _initViews(){var e=this._notifierModel.getButton(),t=this._notifierModel.isClosable(),i=this.template({status:this._notifierModel.getStatus(),info:this._notifierModel.getInfo(),isActionable:e,isClosable:t});this.$el.append(i),e&&this._createActionView(e),t&&this._createCloseView()},_createActionView:function _createActionView(e){var t=new r({template:c,className:"js-action",model:this._notifierModel,editorModel:this._editorModel});this.$(".js-actionButton").append(t.render().el),this.addView(t)},_createCloseView:function _createCloseView(){var e=new r({template:l,className:"CDB-Shape js-close",editorModel:this._editorModel});this.$(".js-closeButton").append(e.render().el),this.addView(e)},_closeHandler:function _closeHandler(){var e=this._notifierModel.getStatus(),t=this._notifierModel.getAction();this._notifierModel.trigger("notification:close",t||e),clearTimeout(this._timeout),this._notifierModel&&this._notifierModel.collection&&this._notifierModel.collection.remove(this._notifierModel)},_actionHandler:function _actionHandler(){var e=this._notifierModel.getStatus(),t=this._notifierModel.getAction();this._notifierModel.trigger("notification:action",t||e)},_changeStyle:function _changeStyle(){this.$(".Notifier-info").toggleClass("u-whiteTextColor",this._editorModel.isEditing()),this.$(".Notifier-actions .CDB-Shape-close").toggleClass("is-blue",!this._editorModel.isEditing()),this.$(".Notifier-actions .CDB-Shape-close").toggleClass("is-white",this._editorModel.isEditing())},_autoClose:function _autoClose(){this._notifierModel.set({action:"autoclose"},{silent:!0}),this._closeHandler()},_onChangeStatus:function _onChangeStatus(e,t){var i;"success"!==t&&"error"!==t||!1===this._notifierModel.get("closable")||!1===this._notifierModel.get("autoclosable")||(this._timeout=n(s(i=this._autoClose).call(i,this),this._delay))}})},2885:function(e,t,i){var s=i(25),n=i(4),o=i(1),a=i(2884),r=i(1034);e.exports=n.extend({className:"Notifier",initialize:function initialize(e){if(!e.collection)throw new Error("collection is mandatory");if(!e.editorModel)throw new Error("editorModel is mandatory");this._editorModel=e.editorModel,this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.html(r()),this._renderAllSubviews(),this._renderLoading(),this},rebindEvents:function rebindEvents(){return this.stopListening(this.collection),this.stopListening(this._editorModel),this._initBinds(),this},_initBinds:function _initBinds(){this.listenTo(this.collection,"reset update change:status",this.render),this.add_related_model(this.collection),this.listenTo(this._editorModel,"change:edition",this._changeStyle),this.add_related_model(this._editorModel)},_renderAllSubviews:function _renderAllSubviews(){this.collection.each(this._renderSubview,this)},_renderSubview:function _renderSubview(e){var t=new a({notifierModel:e,editorModel:this._editorModel}),i=e.get("status");("success"===i||"error"===i?this._getDoneContainer():this._getLoadingContainer()).append(t.render().el),this.addView(t)},_removeSubview:function _removeSubview(e){var t=e.get("id"),i=o.first(s(o).call(o,this._subviews,function(e){return e._notifierModel.get("id")===t}));i&&(this.removeView(i),i.remove())},_renderLoading:function _renderLoading(){this._getLoader().toggleClass("is-visible",this._anyNotificationLoading())},_anyNotificationLoading:function _anyNotificationLoading(){return this.collection.any(function(e){return!o.contains(["success","error","warning"],e.get("status"))})},_changeStyle:function _changeStyle(){this.$el.toggleClass("is-dark",this._editorModel.isEditing())},_getDoneContainer:function _getDoneContainer(){return this.$(".js-status-done")},_getLoadingContainer:function _getLoadingContainer(){return this.$(".js-status-loading")},_getLoader:function _getLoader(){return this.$(".js-loader")}})},2886:function(e,t,i){i(269),i(268),i(35);var s=i(924);e.exports=function(e){if(!e.visDefinitionModel)throw new Error("visDefinitionModel is required");if(!e.name)throw new Error("name is required");var t=e.visDefinitionModel,i=e.onSuccess,n=e.onError,o=e.name,a=e.description,r=e.tags,l=t.get("name");t.save({name:o,description:a,tags:r},{wait:!0,success:function success(e,t){document.title=o+s,i&&i()},error:function error(e,t){document.title=l+s,n&&n(t)}})}},2887:function(e,t,i){var s=i(1),n=i(6),o=i(4),a=i(1520);i(242);var r=i(58),l=i(59),c=["visDefinitionModel","visMetadataModel"];e.exports=o.extend({className:"Metadata-form",initialize:function initialize(e){s.each(c,function(t){if(!e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this)},render:function render(){return this.clearSubViews(),this.$el.html(a()),this._initViews(),this},_initViews:function _initViews(){this._addInputView(),this._addTextareaView(),this._addTagsView(),this._addTooltip()},_addInputView:function _addInputView(){this._inputView=new n.Form.editors.Text({key:"name",model:this._visMetadataModel,schema:{options:this._visDefinitionModel.get("name"),editorAttrs:{placeholder:_t("components.modals.maps-metadata.form.name-placeholder")}}}),this._inputView.on("change",this._commitView,this),this.$(".js-name-field").append(this._inputView.render().$el)},_addTextareaView:function _addTextareaView(){this._textareaView=new n.Form.editors.TextArea({className:"CDB-Textarea Metadata-textarea",key:"description",model:this._visMetadataModel,schema:{options:this._visDefinitionModel.get("description"),editorAttrs:{placeholder:_t("components.modals.maps-metadata.form.description-placeholder")}}}),this._textareaView.on("change",this._commitView,this),this.$(".js-description-field").append(this._textareaView.render().$el)},_addTagsView:function _addTagsView(){this._taglistView=new n.Form.editors.Taglist({key:"tags",model:this._visMetadataModel,schema:{options:{tags:this._visDefinitionModel.get("tags")||[]}}}),this._taglistView.on("change",this._commitView,this),this.$(".js-tags-field").append(this._taglistView.render().$el),this.addView(this._taglistView)},_addTooltip:function _addTooltip(){var e=this.$(".js-markdown").data("tooltip");this._removeTooltip(),this._tooltip=new r({el:this.$(".js-markdown"),html:!0,title:function title(){return e}})},_commitView:function _commitView(e){e.commit(),e.model.changed.hasOwnProperty("name")&&this._sanitizeName(e.model.get("name"))},_sanitizeName:function _sanitizeName(e){this._visMetadataModel.set("name",l.sanitizeHtml(e))},_removeTooltip:function _removeTooltip(){this._tooltip&&this._tooltip.clean()},_removeBinds:function _removeBinds(){this._inputView&&this._inputView.off("change",this._commitView,this),this._textareaView&&this._textareaView.off("change",this._commitView,this),this._taglistView&&this._taglistView.off("change",this._commitView,this)},clean:function clean(){this._removeBinds(),o.prototype.clean.call(this)}})},2888:function(e,t,i){var s=i(4),n=i(1522);e.exports=s.extend({tagName:"ul",className:"Modal-listActions u-flex u-alignCenter ",events:{"click .js-save":"_save","click .js-close":"_close"},initialize:function initialize(e){if(!e.visMetadataModel)throw new Error("visMetadataModel is required");if(!e.onSaveAction)throw new Error("onSaveAction is required");this._visMetadataModel=e.visMetadataModel,this._onSaveAction=e.onSaveAction,this._onCloseAction=e.onCloseAction,this._initBinds()},_initBinds:function _initBinds(){this._visMetadataModel.on("change",this.render,this)},render:function render(){return this.$el.html(n({canFinish:this._visMetadataModel.isValid()})),this},_save:function _save(){this._visMetadataModel.isValid()&&this._onSaveAction()},_close:function _close(){this._onCloseAction&&this._onCloseAction()}})},2889:function(e,t,i){var s=i(18),n=i(1),o=i(4),a=i(1039),r=i(58),l=["username","avatar"];e.exports=o.extend({initialize:function initialize(e){n.each(l,function(t){if(void 0===e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this)},render:function render(){return this.clearSubViews(),this.$el.html(a({avatar:this._avatar,username:this._username})),this._initViews(),this},_initViews:function _initViews(){var e=new r({el:this.$(".js-avatar"),title:function title(){return s(this).attr("data-title")}});this.addView(e)}})},289:function(e,t,i){"use strict";i.d(t,"b",function(){return l}),i.d(t,"c",function(){return isAllowed});var s=i(68),n=i.n(s),o=i(61),a=i.n(o),r=i(12),l={exclude_shared:!1,per_page:12,shared:"no",locked:!1,only_liked:!1,deepInsights:!1,types:"derived,kuviz"},c=Object(r.a)({},l),h=Object(r.a)({},l,{shared:"yes"}),d={mine:c,locked:Object(r.a)({},l,{locked:!0}),shared:Object(r.a)({},l,{shared:"only"}),both:h,favorited:Object(r.a)({},l,{only_liked:!0}),subscribed:Object(r.a)({},l,{subscribed:!0}),sample:Object(r.a)({},l,{sample:!0}),public:Object(r.a)({},l,{privacy:"public"}),link:Object(r.a)({},l,{privacy:"link"}),password:Object(r.a)({},l,{privacy:"password"}),private:Object(r.a)({},l,{privacy:"private"}),builder:Object(r.a)({},l,{types:"derived"}),cartoframes:Object(r.a)({},l,{types:"kuviz"}),external:Object(r.a)({},l)},u=a()(d);function isAllowed(e){return n()(u).call(u,e)}t.a=d},2890:function(e,t,i){var s=i(38),n=i(4),o=i(1),a=i(1040),r=i(2889),l=["users"];e.exports=n.extend({initialize:function initialize(e){o.each(l,function(t){if(!e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this)},render:function render(){return this.clearSubViews(),this.$el.html(a({people:this._getRemainsPeople()})),this._renderUsers(),this},_getRemainsPeople:function _getRemainsPeople(){return Math.max(0,this._users.length-3)},_renderUsers:function _renderUsers(){var e;o.each(s(e=this._users).call(e,0,3),this._renderUser,this)},_renderUser:function _renderUser(e){var t=new r({username:e.username,avatar:e.avatar_url});this.$(".js-content").append(t.render().el),this.addView(t)}})},2891:function(e,t,i){var s=i(1),n=i(4),o=i(1041),a=i(58),r=i(18),l=i(2890),c=["model","permission","name","canChangeReadAccess","hasReadAccess","hasWriteAccessAvailable","canChangeWriteAccess","hasWriteAccess","isSelected"],h=["description","role","avatar","users"];e.exports=n.extend({className:"Share-permission",events:{"change .js-read":"_onChangeRead","change .js-write":"_onChangeWrite","mouseover .js-toggler.is-disabled":"_onHoverDisabledToggler","mouseout .js-toggler":"_destroyTooltip","mouseleave .js-toggler":"_destroyTooltip"},initialize:function initialize(e){s.each(c,function(t){if(void 0===e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this),s.each(h,function(t){this["_"+t]=e[t]},this)},render:function render(){return this.clearSubViews(),this.$el.html(o({name:this._name,avatar:this._avatar,role:this._role,users:this._users,description:this._description,canChangeReadAccess:this._canChangeReadAccess,hasReadAccess:this._hasReadAccess,hasWriteAccessAvailable:this._hasWriteAccessAvailable,canChangeWriteAccess:this._canChangeWriteAccess,hasWriteAccess:this._hasWriteAccess})),this._users&&this._renderUsers(),this.$el.toggleClass("is-selected",this._isSelected),this},_renderUsers:function _renderUsers(){var e=new l({className:"u-flex u-alignCenter",users:this._users});this.$(".js-users").append(e.render().el),this.addView(e)},_onChangeWrite:function _onChangeWrite(){var e=this._permission;e.canChangeWriteAccess(this._model)&&(e.hasWriteAccess(this._model)?e.revokeWriteAccess(this._model):e.grantWriteAccess(this._model))},_onChangeRead:function _onChangeRead(){var e=this._permission;e.canChangeReadAccess(this._model)&&(e.hasReadAccess(this._model)?e.revokeAccess(this._model):e.grantReadAccess(this._model))},_onHoverDisabledToggler:function _onHoverDisabledToggler(e){var t,i,s=this._permission.findRepresentableAclItem(this._model);s&&!s.isOwn(this._model)&&(t=this._inheritedAccessTooltipText(s),i=r(e.currentTarget),this._tooltip=this._createTooltip({$el:i,msg:t}),this._tooltip.showTipsy())},_createTooltip:function _createTooltip(e){return new a({el:e.$el,title:function title(){return e.msg}})},_destroyTooltip:function _destroyTooltip(){this._tooltip&&(this._tooltip.hideTipsy(),this._tooltip.destroyTipsy())},_inheritedAccessTooltipText:function _inheritedAccessTooltipText(e){var t=e.get("type");switch(t){case"group":return _t("components.modals.publish.share.tooltip.group",{name:e.get("entity").get("name")});case"org":return _t("components.modals.publish.share.tooltip.org");default:return console.error("Trying to display inherited access for an unrecognized type "+t),""}}})},2892:function(e,t,i){var s=i(7),n=i(25),o=i(4),a=i(1),r=i(2891),l=["collection","currentUserId","organization","hasOrganization","sharePermissionModel","isVisualization"];e.exports=o.extend({className:"Share-list",initialize:function initialize(e){a.each(l,function(t){if(void 0===e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this),this._sortedCollection=this._sortCollection(),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initBinds:function _initBinds(){this._sharePermissionModel.acl.on("add remove reset change",this.render,this),this.add_related_model(this._sharePermissionModel)},_initViews:function _initViews(){this._hasOrganization&&this._renderOrganization(),a.each(this._sortedCollection,this._renderItem,this)},_sortCollection:function _sortCollection(){var e,t,i=n(e=this._collection).call(e,function(e){var t=this._sharePermissionModel,i=t.hasWriteAccess(e),s=t.hasReadAccess(e);return i||s},this),o=n(t=this._collection).call(t,function(e){var t=this._sharePermissionModel,i=t.hasWriteAccess(e),s=t.hasReadAccess(e);return!i&&!s},this);return s(i).call(i,o)},_renderOrganization:function _renderOrganization(){var e=this._organization,t=this._sharePermissionModel,i=!this._isVisualization,s=t.canChangeWriteAccess(e),n=t.hasWriteAccess(e),o=t.canChangeReadAccess(e),a=t.hasReadAccess(e),l=new r({model:e,permission:t,avatar:e.get("avatar_url"),description:_t("components.modals.publish.share.organization.desc"),name:_t("components.modals.publish.share.organization.title"),canChangeReadAccess:o,hasReadAccess:a,hasWriteAccessAvailable:i,canChangeWriteAccess:s,hasWriteAccess:n,isSelected:a||n});this.$el.append(l.render().$el),this.addView(l)},_renderItem:function _renderItem(e){var t,i=e.get("model"),s=this._sharePermissionModel,n=!this._isVisualization,o=s.canChangeWriteAccess(e),a=s.hasWriteAccess(e),l=s.canChangeReadAccess(e),c=s.hasReadAccess(e),h=this._getRole(i);e.id!==this._currentUserId&&(t=new r({model:e,permission:s,name:e.get("name")||e.get("username"),avatar:e.get("avatar_url"),role:h,users:i.users,canChangeReadAccess:l,hasReadAccess:c,hasWriteAccessAvailable:n,canChangeWriteAccess:o,hasWriteAccess:a,isSelected:c||a}),this.$el.append(t.render().$el),this.addView(t))},_getRole:function _getRole(e){return void 0!==e.viewer&&(!0===e.viewer?_t("components.modals.publish.share.role.viewer"):_t("components.modals.publish.share.role.builder"))}})},2893:function(e,t,i){var s=i(6);e.exports=s.Model.extend({defaults:{per_page:20,page:1,q:""},initialize:function initialize(e,t){if(!t.collection)throw new Error("collection is required");if(!t.collection.totalCount)throw new Error("collection requires to implement totalCount method");this.collection=t.collection,this._initBinds()},_initBinds:function _initBinds(){this.collection.on("sync",this._updateStateFetched,this),this.collection.on("error",this._updateStateError,this)},fetch:function fetch(){return this.trigger("fetching",this),this.collection.fetch({data:this.attributes},{reset:!0})},_updateStateFetched:function _updateStateFetched(){this.trigger("fetched",this)},_updateStateError:function _updateStateError(){this.trigger("error",this)}})},2894:function(e,t,i){var s=i(199),n=i(3),o=i(6),a=i(4),r=i(1),l=i(562),c=i(2893),h=i(86),d=i(1524),u=i(264),p=i(1043),g=i(59),m=i(561),f=i(1042),_=["listCollection","createContentView"];e.exports=a.extend({events:{"click .js-search-link":"_onSearchClick","click .js-clean-search":"_onCleanSearchClick","keydown .js-search-input":"_onKeyDown"},initialize:function initialize(e){r.each(_,function(t){if(void 0===e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this),this._paginationModel=new l({current_page:1}),this._paginationSearchModel=new c({},{collection:this._listCollection}),this._stateModel=new o.Model({state:"idle"}),this._initBinds(),this._initPagination(),this._paginationSearchModel.fetch()},render:function render(){return this.clearSubViews(),this.$el.html(p({q:this._paginationSearchModel.get("q")})),this._initViews(),this},_initBinds:function _initBinds(){var e;this._paginationSearchModel.on("fetching",this.showLoading,this),this._paginationSearchModel.on("fetched",this._updateStateFetched,this),this._paginationSearchModel.on("error",this.showError,this),n(e=this._paginationModel).call(e,"change:current_page",this._fetchByPagination,this),this._stateModel.on("change:state",this.render,this),this.add_related_model(this._paginationModel),this.add_related_model(this._stateModel),this.add_related_model(this._stateModel)},_fetchByPagination:function _fetchByPagination(){this._paginationSearchModel.set("page",this._paginationModel.get("current_page")),this._paginationSearchModel.fetch()},showError:function showError(){this._stateModel.set("state","error")},showLoading:function showLoading(){this._stateModel.set("state","loading")},_updateStateFetched:function _updateStateFetched(){this._paginationModel.set({per_page:this._paginationSearchModel.get("per_page"),total_count:this._listCollection.totalCount()}),this._listCollection.length>0?this._stateModel.set("state","show"):this._stateModel.set("state","no-results")},_initPagination:function _initPagination(){this._paginationView=new m({className:"Pagination Pagination--search Pagination--searchShare",model:this._paginationModel,template:f}),this.addView(this._paginationView)},_initViews:function _initViews(){var e,t=this._stateModel.get("state");if(this.$el.append(this._paginationView.render().el),"loading"===t&&this._content().html(h({title:_t("components.pagination-search.loading.title")})),"error"===t){var i=new u({title:_t("components.pagination-search.error.title"),desc:_t("components.pagination-search.error.desc")});this._content().html(i.render().el),this.addView(i)}"show"===t&&(e=this._createContentView({hasOrganization:""===this._paginationSearchModel.get("q")}),this._content().html(e.render().el),this.addView(e)),"no-results"===t&&this._content().html(d({icon:"CDB-IconFont-defaultUser",title:_t("components.pagination-search.no-results.title"),desc:_t("components.pagination-search.no-results.desc")}))},_focusSearchInput:function _focusSearchInput(){this._searchInput().focus().val()},_onSearchClick:function _onSearchClick(e){this.killEvent(e),this._searchInput().focus()},_onCleanSearchClick:function _onCleanSearchClick(e){this.killEvent(e),this._cleanSearch()},_onKeyDown:function _onKeyDown(e){13===e.which?(this.killEvent(e),this._submitSearch()):27===e.which&&this._paginationSearchModel.get("q")&&(this.killEvent(e),this._cleanSearch())},_submitSearch:function _submitSearch(e){var t;this._makeNewSearch(g.stripHTML(s(t=this._searchInput().val()).call(t)))},_cleanSearch:function _cleanSearch(){this._searchInput().val(""),this._makeNewSearch("")},_makeNewSearch:function _makeNewSearch(e){this._paginationSearchModel.set({q:e,page:1}),this._paginationSearchModel.fetch()},_searchInput:function _searchInput(){return this.$(".js-search-input")},_cleanSearchBtn:function _cleanSearchBtn(){return this.$(".js-clean-search")},_content:function _content(){return this.$(".js-content")}})},2895:function(e,t,i){var s=i(3),n=i(41),o=i(6),a=i(1),r=i(394),l=i(742),c=i(1046);e.exports=o.Collection.extend({model:function model(e,t){var i=e.type,s=e.configModel;return t=a.extend(t,{configModel:s}),e.model&&(e=a.extend({},e,e.model)),"user"===i?new l(a.omit(e,"configModel"),t):"group"===i?new c(a.omit(e,"configModel"),t):void 0},sync:r,url:function url(e){return this.configModel.get("base_url")+"/api/"+this.configModel.urlVersion("organizationGrantables",e)+"/organization/"+this.organization.id+"/grantables"},initialize:function initialize(e,t){if(!t.organization)throw new Error("Organization is required");if(!t.currentUserId)throw new Error("currentUserId is required");if(!t.configModel)throw new Error("configModel is required");this.configModel=t.configModel,this.organization=t.organization,this.currentUserId=t.currentUserId},parse:function parse(e){return this.trigger("fetched",this),this.total_entries=e.total_entries,n(a).call(a,e.grantables,function(e,t){return t.id===this.currentUserId?this.total_entries--:(t.organization=this.organization,t.configModel=this.configModel,e.push(t)),e},[],this)},fetch:function fetch(e){var t;return e=e||{},this.trigger("fetching",this),e.error=s(t=function _context(e,t){this.trigger("error",this)}).call(t,this),o.Collection.prototype.fetch.call(this,e)},totalCount:function totalCount(){return this.total_entries}})},2896:function(e,t,i){var s=i(7),n=i(38),o=i(6),a=i(4);e.exports=o.Model.extend({defaults:{show:!0,createContentView:function createContentView(){return new a}},createContentView:function createContentView(){return this.get("createContentView")(this)},show:function show(){this.set("show",!0)},hide:function hide(){this.set("show",!1)},isHidden:function isHidden(){return!this.get("show")},destroy:function destroy(){var e,t=n(Array.prototype).call(arguments);this.trigger.apply(this,s(e=["destroy"]).call(e,t))}})},2897:function(e,t,i){i(37);var s=i(3),n=i(76),o=i(1),a=i(4),r=i(366);e.exports=a.extend({className:function className(){var e=["Dialog","is-white"];return this.options.escapeOptionsDisabled||e.push("is-opening"),this.options.breadcrumbsEnabled&&e.push("Dialog--withBreadcrumbs"),e.join(" ")},events:{"click .js-close":"_onClose"},initialize:function initialize(){this.listenTo(this.model,"change:show",this._onShowChange),this.listenTo(this.model,"destroy",this._onDestroy),this._escapeOptionsDisabled=this.options.escapeOptionsDisabled,this._breadcrumbsEnabled=this.options.breadcrumbsEnabled,this._keepOpenOnRouteChange=this.options.keepOpenOnRouteChange},render:function render(){this.clearSubViews(),this.$el.html(r({escapeOptionsDisabled:this._escapeOptionsDisabled||!1,breadcrumbsEnabled:this._breadcrumbsEnabled||!1}));var e=this.model.createContentView();return this.addView(e),e.render(),this.$(".js-content").append(e.el),this},show:function show(){this.model.show()},hide:function hide(){this.model.hide()},destroy:function destroy(){this.model.destroy()},keepOpenOnRouteChange:function keepOpenOnRouteChange(){return this.model.get("keepOpenOnRouteChange")},_onShowChange:function _onShowChange(e,t){t?(this.$el.show(),this.$el.removeClass("is-closing").addClass("is-opening")):(this.$el.removeClass("is-opening").addClass("is-closing"),this._delayDueToAnimation(function(){this.$el.hide()}))},_onClose:function _onClose(e){e.stopPropagation(),this.destroy()},_onDestroy:function _onDestroy(){this.hide(),o.invoke(this._subviews,"allOff"),this._delayDueToAnimation(function(){this.clean()})},_delayDueToAnimation:function _delayDueToAnimation(e){n(s(e).call(e,this),120)}})},2907:function(e,t,i){var s=i(6);e.exports=s.Model.extend({idAttribute:"name"})},2908:function(e,t,i){var s=i(6),n=i(2907);e.exports=s.Collection.extend({model:n,initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");if(!t.tableModel)throw new Error("tableModel is required");this._configModel=t.configModel,this._tableModel=t.tableModel},url:function url(){return this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("column")+"/tables/"+this._tableModel.get("name")+"/columns"}})},2909:function(e,t,i){i(35),i(31),i(31);var s=i(6),n=i(1),o=i(619),a=["id","username","avatar_url","name"];e.exports=s.Model.extend({defaults:{access:"r"},isOwn:function isOwn(e){return e.id===this.get("entity").id},validate:function validate(e,t){if(e.access!==o.READ_ONLY&&e.access!==o.READ_WRITE)return"access can't take 'r' or 'rw' values"},toJSON:function toJSON(){var e=n.pick(this.get("entity").toJSON(),a);return e.username||(e.username=e.name,delete e.name),{type:this.get("type")||"user",entity:e,access:this.get("access")}}})},2910:function(e,t,i){var s=i(65),n=i(6),o=i(551),a=i(14),r=["configModel","currentUserId"];e.exports=n.Collection.extend({model:function model(e,t){var i=t.collection;return new o(e,{parse:!0,collection:i})},url:function url(){return this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("user")+"/users/"+this._currentUserId+"/layers"},initialize:function initialize(e,t){a(t,r,this)},isCustomCategory:function isCustomCategory(){return this.where(function(e){var t;return s(t=["NASA","TileJSON","WMS","Mapbox","Custom",void 0]).call(t,function(t){return e.get("category")===t})})},getSelected:function getSelected(){return this.findWhere({selected:!0})},hasCustomBaseLayer:function hasCustomBaseLayer(e){if(e)return this.where({className:e}).length>0}})},2911:function(e,t,i){var s=i(6),n=i(1046);e.exports=s.Collection.extend({model:n,initialize:function initialize(e,t){this.organization=t.organization}})},2913:function(e,t,i){var s=i(3),n=i(76),o=i(1),a=function Poller(e,t){this.model=e,this.numberOfRequests=0,this.polling=!1,this.interval=t.interval,"function"!=typeof this.interval&&(this.interval=function(){return t.interval}),this.stopWhen=t.stopWhen,this.error=t.error,this.autoStart=t.autoStart,this.autoStart&&this.start()};a.prototype.start=function(){this.timeout||this._scheduleFetch()},a.prototype._scheduleFetch=function(){var e;this.timeout=n(s(e=this._fetch).call(e,this),this.interval(this.numberOfRequests))},a.prototype._fetch=function(){var e=this;e.polling||(e.polling=!0,e.model.fetch({success:function success(){e.polling=!1,e.numberOfRequests++,e._continuePolling()&&e._scheduleFetch()},error:function error(t){o.isFunction(e.error)&&e.error(e.model)}}))},a.prototype._continuePolling=function(){return!this.stopWhen||o.isFunction(this.stopWhen)&&!this.stopWhen(this.model)},a.prototype.stop=function(){this.polling=!1,clearTimeout(this.timeout),delete this.timeout},e.exports=a},2914:function(e,t,i){var s=i(1),n=i(2913),o=function ImportModelPoller(e){var t={interval:function interval(e){return e>=30?5e3:2e3},stopWhen:function stopWhen(e){var t=e.get("state");return"complete"===t||"failure"===t}};n.call(this,e,t)};o.prototype=s.extend({},n.prototype),e.exports=o},2915:function(e,t,i){var s=i(6),n=i(14),o=["title","name"];e.exports=s.Model.extend({defaults:{state:"idle"},initialize:function initialize(e){n(e,o,this),this._status=e.status,this._beta=e.beta}})},2916:function(e,t,i){var s=i(4),n=i(14),o=i(1527),a=["title","name"];e.exports=s.extend({events:{"click .js-back":"_goToList"},initialize:function initialize(e){n(e,a,this),this._beta=e.beta},render:function render(){return this.$el.html(o({title:this._title,name:this._name,beta:this._beta,__ASSETS_PATH__:"__ASSETS_PATH__"})),this},_goToList:function _goToList(){this.trigger("showImportsSelector",this)}})},2917:function(e,t,i){var s=i(3),n=i(4),o=i(14),a=i(2916),r=i(1049),l=["model","importView","userModel"];e.exports=n.extend({events:{"click .js-connectnow":"_onConnectClick","click .js-back":"_showImportsSelector"},initialize:function initialize(e){o(e,l,this),this._initBinds()},render:function render(){return this.clearSubViews(),this._initViews(),this},_initBinds:function _initBinds(){var e;s(e=this.model).call(e,"change:state",this._initImportSubView,this)},_initViews:function _initViews(){this._initImportHeaderSubView(),this._initImportSubView()},_initImportHeaderSubView:function _initImportHeaderSubView(){var e=new a({title:this._model.get("title"),name:this._model.get("name"),beta:this._model.get("beta")});s(e).call(e,"showImportsSelector",this._showImportsSelector,this),s(e).call(e,"renderSelectedImportView",this._renderSelectedImportView,this),this.$el.append(e.render().el),this.addView(e)},_initImportSubView:function _initImportSubView(){this._importView.options.state=this._model.get("state"),this.$el.append(this._importView.render().el),this.addView(this._importView)},_showImportsSelector:function _showImportsSelector(){this.trigger("showImportsSelector",this)},_renderSelectedImportView:function _renderSelectedImportView(e){this.trigger("renderSelectedImportView",e,this)},_onConnectClick:function _onConnectClick(){this._model.set("state","loading");var e=this._model.get("title"),t=this._getRequestStatus(),i=r.getFormData(this._userModel,e,t),s=this;r.requestConnectorHubspot(i,function(){s._model.set("state","success")},function(){s._model.set("state","error")})},_getRequestStatus:function _getRequestStatus(){var e=this._model.get("status");return"disabled"===e?"enable":e}})},2918:function(e,t,i){i(23),i(40);var s=i(6),n=i(14),o=["userModel","configModel"];e.exports=s.Model.extend({defaults:{postgres:{name:"PostgreSQL",description:null,enabled:!1},mysql:{name:"MySQL",description:null,enabled:!1},sqlserver:{name:"Microsoft SQL Server",description:null,enabled:!1},hive:{name:"Hive",description:null,enabled:!1},bigquery:{name:"Google BigQuery",description:null,enabled:!1},dataobservatory:{name:"CARTO Data Observatory",description:null,enabled:!1},snowflake:{name:"Snowflake",description:null,enabled:!1},redshift:{name:"Redshift",description:null,enabled:!1},loaded:!1},url:function url(e){var t=this._configModel.urlVersion("connectors");return this._configModel.get("base_url")+"/api/"+t+"/connectors/"},initialize:function initialize(e,t){n(t,o,this)},_isImportEnabled:function _isImportEnabled(e){var t=this["_is"+e.title.replace(" ","")+"ImportEnabled"],i=!0;return t&&(i=t.apply(this,[])),i},_isGoogleDriveImportEnabled:function _isGoogleDriveImportEnabled(){return!!this._configModel.get("oauth_gdrive")},_isDropboxImportEnabled:function _isDropboxImportEnabled(){return!!this._configModel.get("oauth_dropbox")},_isBoxImportEnabled:function _isBoxImportEnabled(){return!!this._configModel.get("oauth_box")},_isTwitterImportEnabled:function _isTwitterImportEnabled(){return this._userModel.get("twitter").enabled},_isInstagramImportEnabled:function _isInstagramImportEnabled(){return!!this._userModel.featureEnabled("instagram_import")&&!!this._configModel.get("oauth_instagram")},_isSalesforceImportEnabled:function _isSalesforceImportEnabled(){return!1},_isMailchimpImportEnabled:function _isMailchimpImportEnabled(){return!!this._configModel.get("oauth_mailchimp")&&!!this._userModel.featureEnabled("mailchimp_import")},_isCCFFEnabled:function _isCCFFEnabled(){return this._userModel.featureEnabled("carto-connectors")},_isPostgreSQLImportEnabled:function _isPostgreSQLImportEnabled(){return this.get("postgres").enabled&&this._isCCFFEnabled()},_isMySQLImportEnabled:function _isMySQLImportEnabled(){return this.get("mysql").enabled&&this._isCCFFEnabled()},_isSQLServerImportEnabled:function _isSQLServerImportEnabled(){return this.get("sqlserver").enabled&&this._isCCFFEnabled()},_isHiveImportEnabled:function _isHiveImportEnabled(){return!1},_isBigQueryImportEnabled:function _isBigQueryImportEnabled(){return this.get("bigquery").enabled&&this._isCCFFEnabled()},_isDataObservatoryEnabled:function _isDataObservatoryEnabled(){return this.get("dataobservatory").enabled&&this._isCCFFEnabled()},_isSnowflakeImportEnabled:function _isSnowflakeImportEnabled(){return this.get("snowflake").enabled&&this._isCCFFEnabled()},_isRedshiftImportEnabled:function _isRedshiftImportEnabled(){return this.get("redshift").enabled&&this._isCCFFEnabled()}})},2919:function(e,t,i){var s=i(4),n=i(14),o=i(1529),a=i(1049),r=["userModel"];e.exports=s.extend({className:"ImportOther",tagName:"button",events:{"click .js-request":"_onRequest","keyup .js-input":"_onKeyup","click .js-submit":"_onSubmit","click .js-ok":"_onOk"},initialize:function initialize(e){n(e,r,this),this._hasError=!1},render:function render(){return this.$el.html(o({hasError:this._hasError})),this},_onRequest:function _onRequest(){this._goToStep(2)},_onKeyup:function _onKeyup(){this.$(".js-input").val()?this._enableSubmit():this._disableSubmit()},_onOk:function _onOk(){this._goToStep(1)},_goToStep:function _goToStep(e){this.$(".js-step").removeClass("is-active"),this.$(".js-step".concat(e)).addClass("is-active")},_onSubmit:function _onSubmit(){this._goToStep(3);var e=this.$(".js-input").val(),t=this,i=a.getFormData(this._userModel,e);a.requestConnectorHubspot(i,function(){t._hasError=!1,t._goToStep(4),t._resetInput(),t._disableSubmit()},function(){t._hasError=!0})},_resetInput:function _resetInput(){this.$(".js-input").val("")},_disableSubmit:function _disableSubmit(){this.$(".js-submit").attr("disabled","disabled"),this.$(".js-submit").addClass("is-disabled")},_enableSubmit:function _enableSubmit(){this.$(".js-submit").removeAttr("disabled"),this.$(".js-submit").removeClass("is-disabled")}})},2920:function(e,t,i){var s=i(1050);e.exports=s.extend({step1:{selector:".js-step1",description:_t("components.modals.add-layer.imports.request.soon.desc"),buttonClass:"js-request",cta:_t("components.modals.add-layer.imports.request.soon.cta")},step3:{selector:".js-step3",titleClass:"title--success",title:_t("components.modals.add-layer.imports.request.success.title"),description:_t("components.modals.add-layer.imports.request.success.desc"),buttonClass:"js-ok success-icon",cta:_t("components.modals.add-layer.imports.request.ok")},step4:{selector:".js-step4",titleClass:"title--error",title:_t("components.modals.add-layer.imports.request.error.title"),description:_t("components.modals.add-layer.imports.request.error.desc"),buttonClass:"js-ok success-icon",cta:_t("components.modals.add-layer.imports.request.ok")},_renderSteps:function _renderSteps(){this.step1.title=this._title,this._renderStep(this.step1),this._renderStep(this.step3),this._renderStep(this.step4)},_getRequestType:function _getRequestType(){return"soon"}})},2921:function(e,t,i){var s=i(1050);e.exports=s.extend({step1:{selector:".js-step1",description:_t("components.modals.add-layer.imports.request.beta.desc"),buttonClass:"js-request",cta:_t("components.modals.add-layer.imports.request.beta.cta")},step3:{selector:".js-step3",titleClass:"title--success",title:_t("components.modals.add-layer.imports.request.success.title"),description:_t("components.modals.add-layer.imports.request.success.desc"),buttonClass:"js-ok success-icon",cta:_t("components.modals.add-layer.imports.request.ok")},step4:{selector:".js-step4",titleClass:"title--error",title:_t("components.modals.add-layer.imports.request.error.title"),description:_t("components.modals.add-layer.imports.request.error.desc"),buttonClass:"js-ok success-icon",cta:_t("components.modals.add-layer.imports.request.ok")},_renderSteps:function _renderSteps(){this.step1.title=this._title,this._renderStep(this.step1),this._renderStep(this.step3),this._renderStep(this.step4)},_getRequestType:function _getRequestType(){return"beta"}})},2922:function(e,t,i){var s=i(4),n=i(14),o=i(1532),a=i(1050),r=i(2921),l=i(2920),c=["userModel","configModel","title","name","loaded"];e.exports=s.extend({className:"ImportButton",tagName:"button",events:{"click .js-content":"_onClick"},initialize:function initialize(e){n(e,c,this)},render:function render(){return this.$el.html(o({name:this._name,title:this._title})),this.$el.addClass("js-"+this._name+"Button"),this._initViews(),this},_initViews:function _initViews(){var e;(e=this.options.beta?new r({el:this.$(".ImportButton__overlay"),name:this._name,title:this._title,userModel:this._userModel,configModel:this._configModel}):this.options.soon?new l({el:this.$(".ImportButton__overlay"),name:this._name,title:this._title,userModel:this._userModel,configModel:this._configModel}):new a({el:this.$(".ImportButton__overlay"),name:this._name,title:this._title,userModel:this._userModel,configModel:this._configModel})).render(),this.addView(e)},_onClick:function _onClick(){this._loaded&&this.trigger("importSelected",this)}})},2923:function(e,t,i){var s=i(626),n=i(625);e.exports=s.extend({render:function render(){var e=this.model.get("value"),t=this._genDescription(),i=this._configModel.get("upgrade_url"),s=this._userModel.isActionEnabled("sync_tables"),o=this._configModel.get("cartodb_com_hosted");return this.$el.html(n({title:e,description:t,ext:"sql",interval:this.model.get("interval"),importCanSync:this.options.acceptSync,userCanSync:s,showTrial:this._userModel.canStartTrial(),showUpgrade:!s&&!o&&i&&!this._userModel.isInsideOrg(),upgradeUrl:i})),this}})},2924:function(e,t,i){i(23),i(101),i(40);var s=i(44),n=i(3),o=i(28),a=i(1),r=i(355),l=i(821),c=i(1534),h=i(908),d=i(1051);e.exports=l.extend({events:{"keyup .js-textInput":"_onTextChanged","submit .js-form":"_onSubmitForm"},render:function render(){var e;(this.$el.html(c({title:this.options.title,state:this.model.get("state"),errorMessages:this.model.get("errorMessages"),sqlHint:this.options.sql_hint||_t("components.modals.add-layer.imports.database.sql-hint")})),this._initCodeMirror(),this.dbConnectorsClient=(new r.AuthenticatedClient).dbConnectors(),this.formFields)&&(this.codeEditor.setValue(this.formFields.sqlQuery),o(e=this.$el).call(e,".js-textInput")[0].value=this.formFields.importAs);return this},_initCodeMirror:function _initCodeMirror(){var e;this.codeEditor=h.fromTextArea(this.$("textarea")[0],{mode:"text/x-pgsql",theme:"material",tabSize:2,lineWrapping:!0,lineNumbers:!1,scrollbarStyle:"simple",addModeClass:!0,matchBrackets:!0,placeholder:this.options.placeholder_query}),this.codeEditor.on("change",a.debounce(n(e=this._onTextChanged).call(e,this),150),this)},_initBinds:function _initBinds(){var e,t;n(e=this.model).call(e,"change:state",this._checkVisibility,this),n(t=this.model).call(t,"change:errorMessages",this.render,this)},_checkVisibility:function _checkVisibility(){var e=this.model.get("state");"connected"===e||"list"===e?this.show():this.hide()},_onTextChanged:function _onTextChanged(){this._isFormFilled()?d.enableButton(this.$(".js-submit")):d.disableButton(this.$(".js-submit"))},_isFormFilled:function _isFormFilled(){return""!==this.codeEditor.getValue()&&""!==this.$(".js-textInput").val()},_onSubmitForm:function _onSubmitForm(e){e&&this.killEvent(e);var t=this.codeEditor.getValue();t&&(this.formFields={sqlQuery:t,importAs:this.$(".js-textInput").val()},this._performDryRun(t))},_performDryRun:function _performDryRun(e){var t=this,i={provider:this.options.service,connection:this.model.connection,sql_query:e,import_as:this.formFields.importAs};this.dbConnectorsClient.dryRun(this.options.service,i,function(i,s,n){i?t._handleErrors(n):t._goToConnectStep(e)})},_goToConnectStep:function _goToConnectStep(e){this._prepareUploadModel(e),this._updateUploadModel(),this._goSelectDataset()},_prepareUploadModel:function _prepareUploadModel(e){this.trigger("urlSelected",this);var t=this.model.get("service_name")?"service":"url";this.model.setUpload({type:t,value:e,service_item_id:e,state:"idle"})},_updateUploadModel:function _updateUploadModel(){try{var e={provider:this.options.service,connection:this.model.connection,sql_query:this.formFields.sqlQuery.replace(/\n/g," "),import_as:this.formFields.importAs};this.model.set("service_item_id",s(e))}catch(e){this.model.set("state","connected"),this.model.setUpload({value:"",service_item_id:""}),this.model.set("errorMessages",[_t("components.modals.add-layer.imports.database.sql-error")])}},_goSelectDataset:function _goSelectDataset(){"error"!==this.model.get("state")&&(this.model.set("state","selected"),this.trigger("urlSubmitted",this))},_handleErrors:function _handleErrors(e){var t=[];e.responseJSON&&e.responseJSON.errors?t.push(this._getPrintableError(e.responseJSON.errors)):t.push(_t("components.modals.add-layer.imports.database.general-error")),this.model.set("state","list"),this.model.setUpload({value:"",service_item_id:""}),this.model.set("errorMessages",t)},_getPrintableError:function _getPrintableError(e){var t=e.replace("Error connecting to ".concat(this.options.service,": "),""),i=t.match(/\bERROR:\s*([\s\S]+)/m);return i&&(t=i[1]),t}})},2925:function(e,t,i){var s=i(820);e.exports=s.extend({events:{"click .js-back":"_goToPreviousStep"},render:function render(){var e=this.options.acceptSync&&this._userModel.get("actions")&&this._userModel.isActionEnabled("sync_tables")&&"file"!==this.model.get("type");return this.$el.html(this.template({type:this.model.get("type"),fileEnabled:this.options.fileEnabled,acceptSync:e,state:this.model.get("state"),title:this.options.title})),this._checkVisibility(),this},_checkVisibility:function _checkVisibility(){var e=this.model.get("state");"connected"===e||"selected"===e?this.show():this.hide()},_goToPreviousStep:function _goToPreviousStep(){this.model.set("state","connected"),this.model.set("service_name","connector")}})},2926:function(e,t,i){var s=i(3),n=i(28),o=i(1661).default,a=i(355),r=i(14),l=i(4),c=i(1537),h=i(1536),d=i(1051),u=["configModel","model","service"];e.exports=l.extend({events:{"keyup .js-textInput":"_onTextChanged","submit .js-form":"_onSubmitForm"},initialize:function initialize(e){r(e,u,this),this._initBinds()},render:function render(){this.$el.html(c({title:this.options.title,params:this.options.params,errorMessage:this._model.get("errorMessage")})),this._addSidebar(),this.form={submit:this.$(".js-submit")};var e,t=o(this.options.params);try{for(t.s();!(e=t.n()).done;){var i=e.value;this.form[i.key]=this.$(".js-".concat(i.key))}}catch(e){t.e(e)}finally{t.f()}if(this._model.connection){var s,n=o(this.options.params);try{for(n.s();!(s=n.n()).done;){var a=s.value;this.form[a.key].val(this._model.connection[a.key])}}catch(e){n.e(e)}finally{n.f()}}return this},_addSidebar:function _addSidebar(){var e;n(e=this.$el).call(e,".ImportPanel-sidebar").append(h(this.options))},_initBinds:function _initBinds(){var e,t;s(e=this._model).call(e,"change:state",this._checkVisibility,this),s(t=this._model).call(t,"change:errorMessage",this.render,this)},_checkVisibility:function _checkVisibility(){"idle"===this._model.get("state")?this.show():this.hide()},_onTextChanged:function _onTextChanged(){this._isFormFilled()?d.enableButton(this.form.submit):d.disableButton(this.form.submit)},_isFormFilled:function _isFormFilled(){var e,t=!0,i=o(this.options.params);try{for(i.s();!(e=i.n()).done;){var s=e.value;s.optional||(t&=""!==this.form[s.key].val())}}catch(e){i.e(e)}finally{i.f()}return t},_onSubmitForm:function _onSubmitForm(e){e&&this.killEvent(e),this._model.connection=this._getFormParams(),this._model.connection&&this._checkConnection(this._model.connection)},_getFormParams:function _getFormParams(){var e,t={},i=o(this.options.params);try{for(i.s();!(e=i.n()).done;){var s=e.value;t[s.key]=this.form[s.key].val()}}catch(e){i.e(e)}finally{i.f()}return t},_checkConnection:function _checkConnection(e){var t=this;this._resetErrorMessage(),(new a.AuthenticatedClient).dbConnectors().checkConnection(this._service,e,function(e,i,s){e?t._checkConnectionError(s):s&&s.connected&&t._checkConnectionSuccess()})},_checkConnectionSuccess:function _checkConnectionSuccess(){this._model.set("state","connected"),this._model.set("service_name","connector"),this._resetErrorMessage()},_checkConnectionError:function _checkConnectionError(e){e.responseJSON&&!1===e.responseJSON.connected?this._model.set("errorMessage",_t("components.modals.add-layer.imports.database.connection-error")):this._model.set("errorMessage",_t("components.modals.add-layer.imports.database.general-error"))},_resetErrorMessage:function _resetErrorMessage(){this._model.set("errorMessage",void 0)}})},2927:function(e,t,i){var s=i(3),n=i(14),o=i(1538),a=i(345),r=i(627),l=i(2926),c=i(2925),h=i(1535),d=i(2924),u=i(2923),p=["userModel","configModel","service"];e.exports=r.extend({options:{fileExtensions:[],type:"service",acceptSync:!0,fileEnabled:!1,fileAttrs:{ext:!1,title:"",description:""}},initialize:function initialize(e){n(e,p,this),this._initModels(),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.html(o(this.options)),this.model.set("state","idle"),this._initViews(),this},_initModels:function _initModels(){this.model=new a({type:this.options.type,service_name:this._service},{userModel:this._userModel,configModel:this._configModel})},_initBinds:function _initBinds(){var e,t;this.model.unbind("change:state",this._checkState,this),this.model.unbind("change",this._triggerChange,this),s(e=this.model).call(e,"change:state",this._checkState,this),s(t=this.model).call(t,"change",this._triggerChange,this)},_initViews:function _initViews(){var e=new l({el:this.$(".ImportPanel-connectForm"),userModel:this._userModel,model:this.model,configModel:this._configModel,title:this.options.title,service:this._service,params:this.options.params});e.render(),this.addView(e);var t=new c({el:this.$(".ImportPanel-header"),model:this.model,userModel:this._userModel,collection:this.collection,fileEnabled:this.options.fileEnabled,acceptSync:this.options.acceptSync,title:this.options.title,template:h});t.render(),this.addView(t);var i=new d({el:this.$(".ImportPanel-queryForm"),userModel:this._userModel,model:this.model,configModel:this._configModel,title:this.options.title,service:this.options.service,placeholder_query:this.options.placeholder_query,sql_hint:this.options.sql_hint});i.render(),this.addView(i);var s=new u({el:this.$(".DatasetSelected"),userModel:this._userModel,model:this.model,acceptSync:this.options.acceptSync,fileAttrs:this.options.fileAttrs,configModel:this._configModel});s.render(),this.addView(s)}})},2928:function(e,t,i){var s=i(626),n=i(625);e.exports=s.extend({render:function render(){var e=this.model.get("value"),t=this._genDescription(),i=this._configModel.get("upgrade_url"),s=this._userModel.isActionEnabled("sync_tables"),o=this._configModel.get("cartodb_com_hosted");return this.$el.html(n({title:e,description:t,ext:"sql",interval:this.model.get("interval"),importCanSync:this.options.acceptSync,userCanSync:s,showTrial:this._userModel.canStartTrial(),showUpgrade:!s&&!o&&i&&!this._userModel.isInsideOrg(),upgradeUrl:i})),this}})},2929:function(e,t,i){var s=i(6),n=i(14),o=["configModel"];e.exports=s.Model.extend({defaults:{projects:[]},url:function url(){var e=this._configModel.urlVersion("connectors");return this._configModel.get("base_url")+"/api/"+e+"/connectors/bigquery/projects"},parse:function parse(e,t){this.set("projects",e)},initialize:function initialize(e,t){n(t,o,this)}})},293:function(e,t){e.exports={Type:{SIMPLE:"simple",ANIMATION:"animation",HEATMAP:"heatmap",POLYGON:"polygon",REGIONS:"regions",HEXABINS:"hexabins",SQUARES:"squares",NONE:"none"},Blending:{SIMPLE:["none","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","xor","src-over"],ANIMATION:["lighter","multiply","source-over","xor"]}}},2930:function(e,t,i){var s=i(28),n=i(3),o=i(4),a=i(2929),r=i(1540),l=i(14),c=["configModel"];e.exports=o.extend({_LOCAL_STORAGE_KEY:"carto.bigQuery.billingProject",initialize:function initialize(e){l(e,c,this),this._initModels()},render:function render(){return this.$el.html(r({options:this.model.get("projects")})),this._initSelect(),this},_initModels:function _initModels(){var e,t=this;this.model=new a({},{configModel:this._configModel}),n(e=this.model).call(e,"change:loaded",this.render,this),this.model.fetch({complete:function complete(){t.model.set("loaded",!0)}})},_initSelect:function _initSelect(){var e,t=this,i=s(e=this.$el).call(e,"select")[0];i.value=localStorage.getItem(this._LOCAL_STORAGE_KEY),i.onchange=function(){localStorage.setItem(t._LOCAL_STORAGE_KEY,this.value)}}})},2931:function(e,t,i){i(23),i(101),i(40);var s=i(44),n=i(3),o=i(28),a=i(1),r=i(355),l=i(821),c=i(2930),h=i(908),d=i(14),u=i(1539),p=i(1051),g=["userModel","configModel","authModel"];e.exports=l.extend({connector:{provider:"bigquery",project:"%DATABASE%",import_as:"%TABLE_NAME%",sql_query:"%QUERY%"},events:{"keyup .js-textInput":"_onTextChanged","submit .js-form":"_onSubmitForm"},initialize:function initialize(e){d(e,g,this),this.template=u,this._initBinds(),this._checkVisibility()},render:function render(){var e,t;(this.$el.html(this.template({state:this.model.get("state"),errorMessages:this.model.get("errorMessages")})),this._initViews(),this._initCodeMirror(),this.formFields)&&(o(e=this.$el).call(e,".js-select")[0].value=this.formFields.billingProject,this.codeEditor.setValue(this.formFields.sqlQuery),o(t=this.$el).call(t,".js-textInput")[0].value=this.formFields.importAs)},_initViews:function _initViews(){var e=new c({el:this.$(".ImportOptions__select"),configModel:this._configModel});e.render(),this.addView(e)},_initCodeMirror:function _initCodeMirror(){var e;this.codeEditor=h.fromTextArea(this.$("textarea")[0],{mode:"text/x-pgsql",theme:"material",tabSize:2,lineWrapping:!0,lineNumbers:!1,scrollbarStyle:"simple",addModeClass:!0,matchBrackets:!0,placeholder:_t("components.modals.add-layer.imports.bigquery.placeholder")}),this.codeEditor.on("change",a.debounce(n(e=this._onTextChanged).call(e,this),150),this)},_initBinds:function _initBinds(){var e,t;n(e=this.model).call(e,"change:state",this._checkVisibility,this),n(t=this.model).call(t,"change:errorMessages",this.render,this)},_checkVisibility:function _checkVisibility(){"list"===this.model.get("state")?this.show():this.hide()},_onTextChanged:function _onTextChanged(){this._isFormFilled()?p.enableButton(this.$(".js-submit")):p.disableButton(this.$(".js-submit"))},_isFormFilled:function _isFormFilled(){return""!==this.$(".js-select").val()&&""!==this.codeEditor.getValue()&&""!==this.$(".js-textInput").val()},_onSubmitForm:function _onSubmitForm(e){e&&this.killEvent(e);var t=this.codeEditor.getValue();t&&(this.formFields={billingProject:this.$(".js-select").val(),sqlQuery:t,importAs:this.$(".js-textInput").val()},this._authModel.isServiceAuthentication()?this._goToConnectStep():this._authModel.isUserAuthentication()&&this._performDryRunBeforeConnectStep())},_performDryRunBeforeConnectStep:function _performDryRunBeforeConnectStep(){var e=this,t=(new r.AuthenticatedClient).dbConnectors(),i={billing_project:this.formFields.billingProject,sql_query:this.formFields.sqlQuery.replace(/\n/g," ")};t.dryRun("bigquery",i,function(t,i,s){t?e._handleErrors(s):s&&s.hasOwnProperty("total_bytes_processed")&&e._goToConnectStep()})},_goToConnectStep:function _goToConnectStep(){this._prepareUploadModel(this.formFields.sqlQuery),this._updateUploadModel(),this._goSelectDataset()},_updateUploadModel:function _updateUploadModel(){try{this.connector.billing_project=this.formFields.billingProject,this.connector.import_as=this.formFields.importAs,this.connector.sql_query=this.formFields.sqlQuery.replace(/\n/g," "),this.model.set("service_item_id",s(this.connector))}catch(e){this._handleErrors()}},_prepareUploadModel:function _prepareUploadModel(e){this.trigger("urlSelected",this);var t=this.model.get("service_name")?"service":"url";this.model.setUpload({type:t,value:e,service_item_id:e,state:"idle"})},_goSelectDataset:function _goSelectDataset(){"error"!==this.model.get("state")&&(this.model.set("state","selected"),this.trigger("urlSubmitted",this))},_handleErrors:function _handleErrors(e){var t=[];e.responseJSON&&e.responseJSON.errors?t.push(this._getPrintableError(e.responseJSON.errors)):t.push(_t("components.modals.add-layer.imports.database.general-error")),this.model.set("state","list"),this.model.setUpload({value:"",service_item_id:""}),this.model.set("errorMessages",t)},_getPrintableError:function _getPrintableError(e){var t=e.replace("Error connecting to provider bigquery: ",""),i=t.match(/\bERROR:\s*([\s\S]+)/m);return i&&(t=i[1]),t}})},2932:function(e,t,i){var s=i(820);e.exports=s.extend({events:{"click .js-back":"_goToPreviousStep"},_goToPreviousStep:function _goToPreviousStep(){this.model.set("state","list"),this.model.set("service_name","connector")}})},2933:function(e,t,i){i(34),i(67);var s=i(3),n=i(1543),o=i(2932),a=i(627),r=i(1542),l=i(1541),c=i(345),h=i(2931),d=i(2928),u=i(1568),p=i(1567),g=i(1572);e.exports=a.extend({_DATASOURCE_NAME:"",_WINDOW_INTERVAL:1e3,options:{fileExtensions:[],type:"service",service:"bigquery",acceptSync:!0,fileEnabled:!1,fileAttrs:{ext:!1,title:"",description:""}},initialize:function initialize(e){if(!e.service)throw new Error("service provider is required");if(!e.userModel)throw new Error("userModel is required");if(!e.configModel)throw new Error("configModel is required");this._userModel=e.userModel,this._configModel=e.configModel,this._DATASOURCE_NAME=this.options.service,this._authModel=new n({configModel:this._configModel}),this.model=new c({type:this.options.type,service_name:this._DATASOURCE_NAME},{userModel:this._userModel,configModel:this._configModel}),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.html(l(this.options)),this.model.set("state","idle"),this._initViews(),this._authModel.isServiceAuthentication()&&this._prepareModelToUpload(),this},_initModels:function _initModels(){this._serviceTokenModel=new u(null,{datasourceName:this._DATASOURCE_NAME,configModel:this._configModel}),this._serviceOauthModel=new p(null,{datasourceName:this._DATASOURCE_NAME,configModel:this._configModel})},_initBinds:function _initBinds(){var e,t,i,n;(this._initModels(),s(e=this.model).call(e,"change",this._triggerChange,this),s(t=this.model).call(t,"change:state",this._checkState,this),this._authModel.isUserAuthentication())&&(s(i=this._serviceTokenModel).call(i,"change:oauth_valid",this._onOauthChange,this),s(n=this._serviceOauthModel).call(n,"change:url",this._openWindow,this),this.add_related_model(this._serviceOauthModel),this.add_related_model(this._serviceTokenModel))},_initViews:function _initViews(){this._addDataHeaderView(),this._authModel.isUserAuthentication()&&this._addServiceLoaderView(),this._addSelectedDatasetView(),this._addFormView()},_addDataHeaderView:function _addDataHeaderView(){var e=new o({el:this.$(".ImportPanel-header"),model:this.model,userModel:this._userModel,collection:this.collection,fileEnabled:this.options.fileEnabled,acceptSync:this.options.acceptSync,template:r});e.render(),this.addView(e)},_addServiceLoaderView:function _addServiceLoaderView(){var e=new g({el:this.$(".ServiceLoader"),model:this.model,serviceTokenModel:this._serviceTokenModel,serviceOauthModel:this._serviceOauthModel});e.render(),this.addView(e)},_addSelectedDatasetView:function _addSelectedDatasetView(){var e=new d({el:this.$(".DatasetSelected"),userModel:this._userModel,model:this.model,acceptSync:this.options.acceptSync,fileAttrs:this.options.fileAttrs,configModel:this._configModel});e.render(),this.addView(e)},_addFormView:function _addFormView(){var e=new h({el:this.$(".ImportPanel-form"),userModel:this._userModel,configModel:this._configModel,authModel:this._authModel,model:this.model,fileEnabled:this.options.fileEnabled});e.render(),this.addView(e)},_onOauthChange:function _onOauthChange(){this._serviceTokenModel.get("oauth_valid")&&this._prepareModelToUpload()},_prepareModelToUpload:function _prepareModelToUpload(){this._checkConnection()},_checkConnection:function _checkConnection(){var e=this._configModel.urlVersion("connectors"),t=this._configModel.get("base_url"),i=this;fetch(t+"/api/"+e+"/connectors/bigquery/connect/").then(function(e){return e.json()}).then(function(e){e&&e.connected?(i.model.set("state","list"),i.model.set("service_name","connector")):i.model.set("state","error")}).catch(function(e){console.error(e),i.model.set("state","error")})},_openWindow:function _openWindow(){var e=this._serviceOauthModel.get("url"),t=this,i=window.open(e,null,"menubar=no,toolbar=no,width=600,height=495"),s=window.setInterval(function(){i&&i.closed?(t._prepareModelToUpload(),clearInterval(s)):i||(t.model.set("state","error"),clearInterval(s))},this._WINDOW_INTERVAL)}})},2934:function(e,t,i){var s=i(3),n=i(4),o=i(59),a=i(1545);e.exports=n.extend({initialize:function initialize(e){this._userModel=e.userModel,this._initBinds()},render:function render(){var e=this._userModel.get("twitter"),t=e.quota-e.monthly_use,i=Math.min(100,Math.ceil(100*this.model.get("value")/t));return this.$el.html(a({value:this.model.get("value"),remaining:t,per:i,hardLimit:e.hard_limit,remainingFormatted:o.formatNumber(t),quota:e.quota,block_price:e.block_price,block_size:o.readizableNumber(e.block_size)})),this},_initBinds:function _initBinds(){var e;s(e=this.model).call(e,"change",this.render,this)}})},2935:function(e,t,i){var s=i(3),n=i(6),o=i(4),a=i(1);i(369);var r=i(2934),l=i(14),c=["userModel"];e.exports=o.extend({initialize:function initialize(e){l(e,c,this),this._disabled=!(!e||!e.disabled)&&e.disabled,this.model=new n.Model,this._initBinds(),this._setModel()},render:function render(){return this.clearSubViews(),this._destroySlider(),this._initViews(),this},_initBinds:function _initBinds(){var e;s(e=this.model).call(e,"change:value",this._onValueChange,this)},_setModel:function _setModel(){var e=this._userModel.get("twitter"),t=e.quota-e.monthly_use,i=1*t/100,s=t>0?80*t/100:t+1;this.model.set({max:e.hard_limit?t:t+1,min:i,step:i,value:t>0?s:e.quota,disabled:this._disabled||t<=0})},_initViews:function _initViews(){var e,t;this._setModel(),this.$(".js-slider").slider(a.extend({range:"min",orientation:"horizontal",slide:s(e=this._onSlideChange).call(e,this),change:s(t=this._onSlideChange).call(t,this)},this.model.attributes));var i=new r({el:this.$(".js-info"),userModel:this._userModel,model:this.model});i.render(),this.addView(i)},_onSlideChange:function _onSlideChange(e,t){this.model.set("value",t.value)},_onValueChange:function _onValueChange(){this.trigger("maxCreditsChange",this.getMaxCredits(),this)},getMaxCredits:function getMaxCredits(){var e=this._userModel.get("twitter"),t=e.quota-e.monthly_use,i=this.model.get("value");return i>t?0:i},_destroySlider:function _destroySlider(){this.$(".js-slider").data("ui-slider")&&this.$(".js-slider").slider("destroy")},clean:function clean(){this._destroySlider(),o.prototype.clean.call(this)}})},2936:function(e,t,i){i(23),i(64);var s=i(3),n=i(4),o=i(1),a=i(18),r=i(1546);e.exports=n.extend({className:"TwitterCategory",_MAX_CATEGORIES:4,_MAX_TERMS:29,events:{"keydown .js-terms":"_onInputChange","keypress .js-terms":"_onInputChange","keyup .js-terms":"_onInputChange"},initialize:function initialize(){this._initBinds()},render:function render(){return this.$el.empty(),this.$el.append(r({disabled:this.model.get("disabled"),terms:this.model.get("terms"),category:this.model.get("category"),counter:this.model.get("counter")})),this.show(),this},_initBinds:function _initBinds(){var e;o.bindAll(this,"_onInputChange"),s(e=this.model).call(e,"change:category",this._onCategoryChange,this)},_onCategoryChange:function _onCategoryChange(){this.$(".js-category").text(_t("components.modals.add-layer.imports.twitter.category")+" "+this.model.get("category"))},_onInputChange:function _onInputChange(e){var t=a(e.target).val(),i={};return 13===e.keyCode?(e.preventDefault(),this.trigger("submit",this.model,this),!1):(this.$(".CDB-IconFont-twitter").toggleClass("is-highlighted",t.length>0),(0===this.model.get("counter")||this.model.get("terms").length>this._MAX_TERMS)&&37!==e.keyCode&&39!==e.keyCode&&8!==e.keyCode&&t.length>0?(this.killEvent(e),this.trigger("limit",this.model,this),!1):(this.trigger("nolimit",this.model,this),t=t?t.split(","):[],i.terms=t,void this.model.set(i)))},show:function show(){this.$el.addClass("enabled")},hide:function hide(){this.$el.removeClass("enabled")}})},2937:function(e,t,i){var s=i(6),n=i(1547);e.exports=s.Collection.extend({model:n})},2938:function(e,t,i){i(34),i(23),i(88),i(40),i(31);var s=i(28),n=i(25),o=i(3);i(31);var a=i(4),r=i(1),l=i(18),c=i(2937),h=i(1547),d=i(2936);e.exports=a.extend({_MAX_CATEGORIES:4,_MAX_TERMS:29,initialize:function initialize(e){this._disabled=!(!e||!e.disabled)&&e.disabled;var t=this._generateCategory();this.collection=new c([t]),this._initBinds()},render:function render(){return this.clearSubViews(),this.collection.each(this._addCategory,this),this},_initBinds:function _initBinds(){var e,t;o(e=this.collection).call(e,"change",this._manageCategories,this),o(t=this.collection).call(t,"change",this._onCategoryChange,this),this.add_related_model(this.collection)},_manageCategories:function _manageCategories(){var e,t=this.collection.size(),i=n(e=this.collection).call(e,function(e){return 0===e.get("terms").length});if(0===i.length&&t<this._MAX_CATEGORIES){var o=this._generateCategory();return this.collection.add(o),this._addCategory(o),!1}if(i.length>0){var a=r.first(i),l=s(r).call(r,this._subviews,function(e){return a.cid===e.model.cid}),c=l.$el.index();if(1===t)return!1;if(c===t-1)return!1;c!==t-1&&i.length>1&&(a=i[1],l=s(r).call(r,this._subviews,function(e){return a.cid===e.model.cid}),this._removeCategory(l)),this._sortCategoryIndex()}},_sortCategoryIndex:function _sortCategoryIndex(){var e=this;this.$(".twitter-category").each(function(t,i){var n,o,a=s(n=l(i)).call(n,".js-category").text().replace(_t("components.modals.add-layer.imports.twitter.category")+" ","");a!==t+1&&s(o=e.collection).call(o,function(e){return e.get("category")===a}).set("category",(t+1).toString())})},_generateCategory:function _generateCategory(){return new h({disabled:this._disabled,terms:[],category:(this.collection?this.collection.size()+1:1).toString()})},_addCategory:function _addCategory(e){var t=new d({model:e});o(t).call(t,"submit",this._onCategorySubmit,this),o(t).call(t,"limit",this._onCategoryLimit,this),o(t).call(t,"nolimit",this._onCategoryNoLimit,this),this.$el.append(t.render().el),this.addView(t),this.trigger("addCategory")},_removeCategory:function _removeCategory(e){e.hide(),e.clean(),e.model.destroy(),this.trigger("removeCategory")},_onCategorySubmit:function _onCategorySubmit(){this.trigger("submitCategory",this.collection.toJSON(),this)},_onCategoryLimit:function _onCategoryLimit(){this.trigger("limitCategory",this.collection.toJSON(),this)},_onCategoryNoLimit:function _onCategoryNoLimit(){this.trigger("noLimitCategory",this.collection.toJSON(),this)},_onCategoryChange:function _onCategoryChange(){this.trigger("changeCategory",this.collection.toJSON(),this)},getCategories:function getCategories(){return this.collection.toJSON()}})},2939:function(e,t,i){var s=i(3),n=i(61),o=i(6),a=i(1),r=i(18),l=i(84),c=i(14),h=i(198),d=i(1563),u=a.template("SELECT DISTINCT <%= column %> FROM (<%= sql %>) _table_sql WHERE <%= column %>::text ilike '%<%= search %>%' ORDER BY <%= column %> ASC"),p=["configModel","rowModel","column"];e.exports=h.extend({initialize:function initialize(e,t){c(t,p,this),this._query=t.nodeDefModel.querySchemaModel.get("query");var i=t.configModel;this.SQL=new l.SQL({user:i.get("user_name"),sql_api_template:i.get("sql_api_template"),api_key:i.get("api_key")}),this.stateModel=new o.Model({state:a.isEmpty(e)?"empty":"fetched"}),h.prototype.initialize.call(this,e,t)},model:function model(e,t){var i=n(e)[0],s={};return s.val=e[i],s.label=e[i],new d(s)},_onSelectedChange:function _onSelectedChange(e,t){"multiple"!==this.type&&t&&this.each(function(t){t.cid!==e.cid&&t.set({selected:!1},{silent:!0})},this)},buildQuery:function buildQuery(e){var t=this.options.column;return u({sql:this._query,search:e,column:this._rowModel.get(t)})},fetch:function fetch(e){var t,i;this.deferred=r.Deferred();var n=this.buildQuery(e);return this.stateModel.set("state","fetching"),this.SQL.execute(n,null,{extra_params:["page","rows_per_page"],page:0,rows_per_page:40,success:s(t=function _context(e){this._onFetchSuccess(e),this.stateModel.set("state","fetched"),this.deferred.resolve()}).call(t,this),error:s(i=function _context2(){this.stateModel.set("state","error"),this.deferred.reject()}).call(i,this)}),this.deferred.promise()},_onFetchSuccess:function _onFetchSuccess(e){this.reset(e.rows),a.isEmpty(this.models)&&this.stateModel.set("state","empty")},isFetching:function isFetching(){return"fetching"===this.getState()},getState:function getState(){return this.stateModel.get("state")},getItem:function getItem(e){return this.findWhere({val:e})},isAsync:function isAsync(){return!0}})},2940:function(e,t,i){var s=i(3),n=i(76),o=i(1),a=i(4),r=i(14),l=i(59),c=i(745),h=["model"];e.exports=a.extend({className:"CDB-Box-modalHeader",events:{"input .js-input-search":"_search"},initialize:function initialize(e){r(e,h,this)},render:function render(){var e;return this.$el.html(c()),n(s(e=function _context(){this._getInput().focus()}).call(e,this),100),this},_onClickFilters:function _onClickFilters(e){this.killEvent(e),this.trigger("filters")},_search:o.debounce(function(e){var t=this._getInput().val();t=t.toLowerCase(),t=l.sanitizeHtml(t),this.model.set("query",t)},500),_getInput:function _getInput(){return this.$(".js-input-search")}})},2941:function(e,t,i){var s=i(6),n=i(4),o=i(396),a=i(14),r=i(746),l=i(2940),c=i(744),h=["searchCollection","lazySearch"];e.exports=n.extend({className:"CDB-Box-modal CustomList",module:"components:lazy-load:lazy-list-view",initialize:function initialize(e){a(e,h,this),this._type=e.type||_t("components.backbone-forms.lazy-select.type"),this.model=new s.Model({query:"",visible:!1}),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this.$el.html(r()),this._createSearchView(),this._renderListSection(),this},_initBinds:function _initBinds(){this.listenTo(this._searchCollection.stateModel,"change:state",this._renderListSection),this.listenTo(this.model,"change:query",this._search),this.listenTo(this.model,"change:visible",function(e,t){t?this.render():this.clearSubViews(),this._toggleVisibility()})},_createListView:function _createListView(){this._listView&&(this._listView.clean(),this.removeView(this._listView)),this._listView=new o({className:"",typeLabel:this._type,showSearch:!1,collection:this._searchCollection,searchPlaceholder:this.options.searchPlaceholder}),this.addView(this._listView),this._listView.show(),this.$(".js-list").html(this._listView.$el)},_createStatusView:function _createStatusView(e){var t=c({status:e,type:this._type});this.$(".js-list").html(t)},_renderListSection:function _renderListSection(){var e=this._searchCollection.stateModel.get("state");"fetched"===e?this._createListView():this._createStatusView(e)},_createSearchView:function _createSearchView(){this._searchView=new l({model:this.model}),this.addView(this._searchView),this.$(".js-search").append(this._searchView.render().el)},_search:function _search(){var e=this.model.get("query");this._lazySearch(e)},_isSerching:function _isSerching(){return!!this.model.get("query")},show:function show(){this.model.set("visible",!0)},hide:function hide(){this.model.set("visible",!1)},toggle:function toggle(){this.model.set("visible",!this.model.get("visible"))},isVisible:function isVisible(){return this.model.get("visible")},_toggleVisibility:function _toggleVisibility(){this.$el.toggleClass("is-visible",!!this.isVisible())}})},2942:function(e,t,i){var s=i(3),n=i(6),o=i(186),a=i(748),r=i(747),l=i(2941),c=i(451),h=i(71),d=i(2939);n.Form.editors.LazySelect=n.Form.editors.Base.extend({tagName:"div",className:"u-ellipsis Editor-formSelect",events:{"click .js-button":"_onButtonClick","keydown .js-button":"_onButtonKeyDown","focus .js-button":function focusJsButton(){this.trigger("focus",this)},blur:function blur(){this.trigger("blur",this)}},options:{selectedItemTemplate:r},initialize:function initialize(e){var t;n.Form.editors.Base.prototype.initialize.call(this,e),o.setOptions(this,e),this.template=e.template||a,this.dialogMode=this.options.dialogMode||h.Mode.DEFAULT;var i={configModel:this.options.configModel,nodeDefModel:this.options.nodeDefModel,rowModel:this.model,column:this.options.column};null!=this.options.options?this.searchCollection=new d(this.options.options,i):this.searchCollection=this.options.collection,this._initBinds();var r=this.model.get(this.options.keyAttr);null!=r&&this.setValue(r);var c=s(t=function _context(e){this.searchCollection.fetch(e)}).call(t,this),u=this.model.get(this.options.column);this._listView=new l({configModel:this.options.configModel,searchCollection:this.searchCollection,lazySearch:c,type:u,searchPlaceholder:this.options.searchPlaceholder})},render:function render(){var e=!this.searchCollection.length,t=this.options.disabled,i=this.model.get(this.options.keyAttr),s=this._getPlaceholder(),n=this._hasValue(),o=n?s:i,a=i||"";return this.$el.html(this.template({title:a,label:o,keyAttr:this.options.keyAttr,isEmpty:e,isDisabled:t,isNull:n})),this._popupManager=new c(this.cid,this.$el,this._listView.$el),this._popupManager.append(this.dialogMode),this},_initBinds:function _initBinds(){var e,t=s(e=function _context2(){this._listView.hide(),this._popupManager&&this._popupManager.untrack()}).call(e,this);this.applyESCBind(t),this.applyClickOutsideBind(t),this.listenTo(this.searchCollection,"change:selected",this._onItemSelected)},_destroyBinds:function _destroyBinds(){this.stopListening(this.searchCollection),n.Form.editors.Base.prototype._destroyBinds.call(this)},_getPlaceholder:function _getPlaceholder(e){var t=this.options.keyAttr;return this.options.placeholder||_t("components.backbone-forms.select.placeholder",{keyAttr:t})},_hasValue:function _hasValue(){var e=this.model.get(this.options.keyAttr);return null==e||""===e},_onItemSelected:function _onItemSelected(e){this._listView.hide(),this._popupManager.untrack(),this._renderButton(e).focus(),this.trigger("change",this)},_onButtonClick:function _onButtonClick(){this._listView.toggle(),this._listView.isVisible()?this._popupManager.track():this._popupManager.untrack()},_onButtonKeyDown:function _onButtonKeyDown(e){13===e.which&&(e.preventDefault(),this._listView.isVisible()?this._popupManager.track():(e.stopPropagation(),this._onButtonClick()))},focus:function focus(){this.$(".js-button").focus()},blur:function blur(){this.$(".js-button").blur()},getValue:function getValue(){var e=this.searchCollection.getSelectedItem();return e?e.getValue():this.value},setValue:function setValue(e){var t=this.searchCollection.getSelectedItem();t?this._renderButton(t):this._renderButton(e),this.value=e},_renderButton:function _renderButton(e){var t=this.$(".js-button"),i=e.getName&&e.getName()||e,s=this.options.selectedItemTemplate({label:i});return t.toggleClass("is-empty",""===i).attr("title",i).html(s),t},remove:function remove(){this._popupManager&&this._popupManager.destroy(),this._listView&&this._listView.clean(),this._destroyBinds(),n.Form.editors.Base.prototype.remove.call(this)}})},2943:function(e,t,i){i(23),i(40),e.exports=function(e){function clearPlaceholder(e){e.state.placeholder&&(e.state.placeholder.parentNode.removeChild(e.state.placeholder),e.state.placeholder=null)}function setPlaceholder(e){clearPlaceholder(e);var t=e.state.placeholder=document.createElement("pre");t.style.cssText="height: 0; overflow: visible",t.className="CodeMirror-placeholder";var i=e.getOption("placeholder");"string"==typeof i&&(i=document.createTextNode(i)),t.appendChild(i),e.display.lineSpace.insertBefore(t,e.display.lineSpace.firstChild)}function onBlur(e){isEmpty(e)&&setPlaceholder(e)}function onChange(e){var t=e.getWrapperElement(),i=isEmpty(e);t.className=t.className.replace(" CodeMirror-empty","")+(i?" CodeMirror-empty":""),i?setPlaceholder(e):clearPlaceholder(e)}function isEmpty(e){return 1===e.lineCount()&&""===e.getLine(0)}e.defineOption("placeholder","",function(t,i,s){var n=s&&s!=e.Init;if(i&&!n)t.on("blur",onBlur),t.on("change",onChange),t.on("swapDoc",onChange),onChange(t);else if(!i&&n){t.off("blur",onBlur),t.off("change",onChange),t.off("swapDoc",onChange),clearPlaceholder(t);var o=t.getWrapperElement();o.className=o.className.replace(" CodeMirror-empty","")}i&&!t.hasFocus()&&onBlur(t)})}},2944:function(e,t,i){i(429),i(23),i(88),i(101),i(64);var s=i(28),n=i(32),o=i(430),a=i(38);e.exports=function(e){var t=e.Pos;function SearchCursor(e,i,s,r){if(this.atOccurrence=!1,this.doc=e,null==r&&"string"==typeof i&&(r=!1),s=s?e.clipPos(s):t(0,0),this.pos={from:s,to:s},"string"!=typeof i)i.global||(i=new RegExp(i.source,i.ignoreCase?"ig":"g")),this.matches=function(s,n){if(s){var o;i.lastIndex=0;for(var r=a(o=e.getLine(n.line)).call(o,0,n.ch),l=0;;){i.lastIndex=l;var c=i.exec(r);if(!c)break;if(d=(h=c).index,(l=h.index+(h[0].length||1))==r.length)break}(u=h&&h[0].length||0)||(0==d&&0==r.length?h=void 0:d!=e.getLine(n.line).length&&u++)}else{i.lastIndex=n.ch;r=e.getLine(n.line);var h,d,u=(h=i.exec(r))&&h[0].length||0;(d=h&&h.index)+u==r.length||u||(u=1)}if(h&&u)return{from:t(n.line,d),to:t(n.line,d+u),match:h}};else{var l=i;r&&(i=i.toLowerCase());var c=r?function(e){return e.toLowerCase()}:function(e){return e},h=i.split("\n");if(1==h.length)i.length?this.matches=function(s,r){if(s){var h,d=a(h=e.getLine(r.line)).call(h,0,r.ch),u=c(d);if((g=o(u).call(u,i))>-1)return g=adjustPos(d,u,g),{from:t(r.line,g),to:t(r.line,g+l.length)}}else{var p,g;d=a(p=e.getLine(r.line)).call(p,r.ch),u=c(d);if((g=n(u).call(u,i))>-1)return g=adjustPos(d,u,g)+r.ch,{from:t(r.line,g),to:t(r.line,g+l.length)}}}:this.matches=function(){};else{var d=l.split("\n");this.matches=function(i,s){var n,o=h.length-1;if(i){var r;if(s.line-(h.length-1)<e.firstLine())return;if(c(a(r=e.getLine(s.line)).call(r,0,d[o].length))!=h[h.length-1])return;for(var l=t(s.line,d[o].length),u=s.line-1,p=o-1;p>=1;--p,--u)if(h[p]!=c(e.getLine(u)))return;var g=(m=e.getLine(u)).length-d[0].length;if(c(a(m).call(m,g))!=h[0])return;return{from:t(u,g),to:l}}if(!(s.line+(h.length-1)>e.lastLine())){var m;g=(m=e.getLine(s.line)).length-d[0].length;if(c(a(m).call(m,g))==h[0]){var f=t(s.line,g);for(u=s.line+1,p=1;p<o;++p,++u)if(h[p]!=c(e.getLine(u)))return;if(c(a(n=e.getLine(u)).call(n,0,d[o].length))==h[o])return{from:f,to:t(u,d[o].length)}}}}}}}function adjustPos(e,t,i){if(e.length==t.length)return i;for(var s=Math.min(i,e.length);;){var n=a(e).call(e,0,s).toLowerCase().length;if(n<i)++s;else{if(!(n>i))return s;--s}}}SearchCursor.prototype={findNext:function findNext(){var e;return s(e=this).call(e,!1)},findPrevious:function findPrevious(){var e;return s(e=this).call(e,!0)},find:function find(e){var i=this,s=this.doc.clipPos(e?this.pos.from:this.pos.to);function savePosAndFail(e){var s=t(e,0);return i.pos={from:s,to:s},i.atOccurrence=!1,!1}for(;;){if(this.pos=this.matches(e,s))return this.atOccurrence=!0,this.pos.match||!0;if(e){if(!s.line)return savePosAndFail(0);s=t(s.line-1,this.doc.getLine(s.line-1).length)}else{var n=this.doc.lineCount();if(s.line==n-1)return savePosAndFail(n);s=t(s.line+1,0)}}},from:function from(){if(this.atOccurrence)return this.pos.from},to:function to(){if(this.atOccurrence)return this.pos.to},replace:function replace(i,s){if(this.atOccurrence){var n=e.splitLines(i);this.doc.replaceRange(n,this.pos.from,this.pos.to,s),this.pos.to=t(this.pos.from.line+n.length-1,n[n.length-1].length+(1==n.length?this.pos.from.ch:0))}}},e.defineExtension("getSearchCursor",function(e,t,i){return new SearchCursor(this.doc,e,t,i)}),e.defineDocExtension("getSearchCursor",function(e,t,i){return new SearchCursor(this,e,t,i)}),e.defineExtension("selectMatches",function(t,i){for(var s=[],n=this.getSearchCursor(t,this.getCursor("from"),i);n.findNext()&&!(e.cmpPos(n.to(),this.getCursor("to"))>0);)s.push({anchor:n.from(),head:n.to()});s.length&&this.setSelections(s,0)})}},2945:function(e,t,i){var s=i(32),n=i(1);e.exports=function(e){var t=e.Pos;function scriptHint(i,o,a,r){var l=i.getCursor(),c=a(i,l),h=c,d=[];for(c.state=e.innerMode(i.getMode(),c.state).state,/^[\w$_-]*$/.test(c.string)||(c=h={start:l.ch,end:l.ch,string:"",state:c.state,type:"."===c.string?"property":null});"property"===h.type;){if("."!==(h=a(i,t(l.line,h.start))).string)return;if(")"===(h=a(i,t(l.line,h.start))).string){var u,p=1;do{switch((h=a(i,t(l.line,h.start))).string){case")":p++;break;case"(":p--}}while(p>0);if(h=a(i,t(l.line,h.start)),0!==s(u=h.type).call(u,"variable"))return;h.type="function"}d.push(h)}return{list:function getCompletions(e,t,i,o){var a=[],r=e.string.toLowerCase();function maybeAdd(e){var t=n.isObject(e)?e.text:e;t=t.toLowerCase(),0!==s(t).call(t,r)||r===t||function arrayContains(e,t){return-1!==s(e).call(e,t)}(a,t)||a.push(e)}return function gatherCompletions(e){for(var t in e)maybeAdd(e[t])}(o.list),n.each(i,maybeAdd),a}(c,0,o,r),from:t(l.line,c.start),to:t(l.line,c.end)}}e.registerHelper("hint","custom-list",function columnsHint(e,t){return scriptHint(e,[],function(e,t){return e.getTokenAt(t)},t)})}},2947:function(e,t,i){i(23),i(40),i(2946);var s=i(38),n=i(76);e.exports=function(e){"use strict";var t="CodeMirror-hint",i="CodeMirror-hint-active";function Completion(e,t){this.cm=e,this.options=t,this.widget=null,this.debounce=0,this.tick=0,this.startPos=this.cm.getCursor("start"),this.startLen=this.cm.getLine(this.startPos.line).length-this.cm.getSelection().length;var i=this;e.on("cursorActivity",this.activityFunc=function(){i.cursorActivity()})}e.showHint=function(e,t,i){if(!t)return e.showHint(i);i&&i.async&&(t.async=!0);var s={hint:t};if(i)for(var n in i)s[n]=i[n];return e.showHint(s)},e.defineExtension("showHint",function(t){t=function parseOptions(e,t,i){var s=e.options.hintOptions,n={};for(var o in r)n[o]=r[o];if(s)for(var o in s)void 0!==s[o]&&(n[o]=s[o]);if(i)for(var o in i)void 0!==i[o]&&(n[o]=i[o]);n.hint.resolve&&(n.hint=n.hint.resolve(e,t));return n}(this,this.getCursor("start"),t);var i=this.listSelections();if(!(i.length>1)){if(this.somethingSelected()){if(!t.hint.supportsSelection)return;for(var s=0;s<i.length;s++)if(i[s].head.line!=i[s].anchor.line)return}this.state.completionActive&&this.state.completionActive.close();var n=this.state.completionActive=new Completion(this,t);n.options.hint&&(e.signal(this,"startCompletion",this),n.update(!0))}});var o=window.requestAnimationFrame||function(e){return n(e,1e3/60)},a=window.cancelAnimationFrame||clearTimeout;function getText(e,t){var i=t&&t.autocompleteSuffix?t.autocompleteSuffix:"",s=t&&t.autocompletePrefix?t.autocompletePrefix:"";return"string"!=typeof e&&(e=e.text),s+e+i}function getHintElement(e,t){for(;t&&t!=e;){if("LI"===t.nodeName.toUpperCase()&&t.parentNode==e)return t;t=t.parentNode}}function styleHint(e){var t=document.createElement(e.displayText||getText(e));(t=document.createElement("span")).className="CDB-Size-small has-letter",t.innerHTML=e.displayText||getText(e);var i=function getType(e){return"string"==typeof e?"":e.type}(e);return i&&(t.className="CDB-Size-small has-letter",t.dataset.type=i),t}function Widget(s,o){this.completion=s,this.data=o,this.picked=!1;var a,r=this,l=s.cm,c=this.hints=document.createElement("ul");c.className="CodeMirror-hints",this.selectedHint=o.selectedHint||0;for(var h=o.list,d=0;d<h.length;++d){var u=c.appendChild(document.createElement("li")),p=h[d],g=t+(d!=this.selectedHint?"":" "+i);null!=p.className&&(g=p.className+" "+g),u.className=g,p.render?p.render(u,o,p):(a=styleHint(p),u.appendChild(a)),u.hintId=d}var m=l.cursorCoords(s.options.alignWithWord?o.from:null),f=m.left,_=m.bottom,v=!0;c.style.left=f+"px",c.style.top=_+"px";var y=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth),w=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(s.options.container||document.body).appendChild(c);var b=c.getBoundingClientRect();if(b.bottom-w>0){var C=b.bottom-b.top;if(m.top-(m.bottom-b.top)-C>0)c.style.top=(_=m.top-C)+"px",v=!1;else if(C>w){c.style.height=w-5+"px",c.style.top=(_=m.bottom-b.top)+"px";var M=l.getCursor();o.from.ch!=M.ch&&(m=l.cursorCoords(M),c.style.left=(f=m.left)+"px",b=c.getBoundingClientRect())}}var k,S=b.right-y;(S>0&&(b.right-b.left>y&&(c.style.width=y-5+"px",S-=b.right-b.left-y),c.style.left=(f=m.left-S)+"px"),l.addKeyMap(this.keyMap=function buildKeyMap(e,t){var i={Up:function Up(){t.moveFocus(-1)},Down:function Down(){t.moveFocus(1)},PageUp:function PageUp(){t.moveFocus(1-t.menuSize(),!0)},PageDown:function PageDown(){t.moveFocus(t.menuSize()-1,!0)},Home:function Home(){t.setFocus(0)},End:function End(){t.setFocus(t.length-1)},Enter:t.pick,Tab:t.pick,Esc:t.close},s=e.options.customKeys,n=s?{}:i;function addBinding(e,s){var o;o="string"!=typeof s?function bound(e){return s(e,t)}:i.hasOwnProperty(s)?i[s]:s,n[e]=o}if(s)for(var o in s)s.hasOwnProperty(o)&&addBinding(o,s[o]);var a=e.options.extraKeys;if(a)for(var o in a)a.hasOwnProperty(o)&&addBinding(o,a[o]);return n}(s,{moveFocus:function moveFocus(e,t){r.changeActive(r.selectedHint+e,t)},setFocus:function setFocus(e){r.changeActive(e)},menuSize:function menuSize(){return r.screenAmount()},length:h.length,close:function close(){s.close()},pick:function pick(){r.pick()},data:o})),s.options.closeOnUnfocus)&&(l.on("blur",this.onBlur=function(){k=n(function(){s.close()},100)}),l.on("focus",this.onFocus=function(){clearTimeout(k)}));var x=l.getScrollInfo();return l.on("scroll",this.onScroll=function(){var e=l.getScrollInfo(),t=l.getWrapperElement().getBoundingClientRect(),i=_+x.top-e.top,n=i-(window.pageYOffset||(document.documentElement||document.body).scrollTop);if(v||(n+=c.offsetHeight),n<=t.top||n>=t.bottom)return s.close();c.style.top=i+"px",c.style.left=f+x.left-e.left+"px"}),e.on(c,"dblclick",function(e){var t=getHintElement(c,e.target||e.srcElement);t&&null!=t.hintId&&(r.changeActive(t.hintId),r.pick())}),e.on(c,"click",function(e){var t=getHintElement(c,e.target||e.srcElement);t&&null!=t.hintId&&(r.changeActive(t.hintId),s.options.completeOnSingleClick&&r.pick())}),e.on(c,"mousedown",function(){n(function(){l.focus()},20)}),e.signal(o,"select",h[0],c.firstChild),!0}function fetchHints(e,t,i,s){if(e.async)e(t,s,i);else{var n=e(t,i);n&&n.then?n.then(s):s(n)}}Completion.prototype={close:function close(){this.active()&&(this.cm.state.completionActive=null,this.tick=null,this.cm.off("cursorActivity",this.activityFunc),this.widget&&this.data&&e.signal(this.data,"close"),this.widget&&this.widget.close(),e.signal(this.cm,"endCompletion",this.cm))},active:function active(){return this.cm.state.completionActive==this},pick:function pick(t,i){var s=t.list[i];s.hint?s.hint(this.cm,t,s):this.cm.replaceRange(getText(s,this.options),s.from||t.from,s.to||t.to,"complete"),e.signal(t,"pick",s),this.close()},cursorActivity:function cursorActivity(){this.debounce&&(a(this.debounce),this.debounce=0);var e=this.cm.getCursor(),t=this.cm.getLine(e.line);if(e.line!=this.startPos.line||t.length-e.ch!=this.startLen-this.startPos.ch||e.ch<this.startPos.ch||this.cm.somethingSelected()||e.ch&&this.options.closeCharacters.test(t.charAt(e.ch-1)))this.close();else{var i=this;this.debounce=o(function(){i.update()}),this.widget&&this.widget.disable()}},update:function update(e){if(null!=this.tick){var t=this,i=++this.tick;fetchHints(this.options.hint,this.cm,this.options,function(s){t.tick==i&&t.finishUpdate(s,e)})}},finishUpdate:function finishUpdate(t,i){this.data&&e.signal(this.data,"update");var s=this.widget&&this.widget.picked||i&&this.options.completeSingle;this.widget&&this.widget.close(),t&&this.data&&function isNewCompletion(t,i){return e.cmpPos(i.from,t.from)>0&&t.to.ch-t.from.ch!=i.to.ch-i.from.ch}(this.data,t)||(this.data=t,t&&t.list.length&&(s&&1==t.list.length?this.pick(t,0):(this.widget=new Widget(this,t),e.signal(t,"shown"))))}},Widget.prototype={close:function close(){if(this.completion.widget==this){this.completion.widget=null,this.hints.parentNode.removeChild(this.hints),this.completion.cm.removeKeyMap(this.keyMap);var e=this.completion.cm;this.completion.options.closeOnUnfocus&&(e.off("blur",this.onBlur),e.off("focus",this.onFocus)),e.off("scroll",this.onScroll)}},disable:function disable(){this.completion.cm.removeKeyMap(this.keyMap);var e=this;this.keyMap={Enter:function Enter(){e.picked=!0}},this.completion.cm.addKeyMap(this.keyMap)},pick:function pick(){this.completion.pick(this.data,this.selectedHint)},changeActive:function changeActive(t,s){if(t>=this.data.list.length?t=s?this.data.list.length-1:0:t<0&&(t=s?0:this.data.list.length-1),this.selectedHint!=t){var n=this.hints.childNodes[this.selectedHint];n.className=n.className.replace(" "+i,""),(n=this.hints.childNodes[this.selectedHint=t]).className+=" "+i,n.offsetTop<this.hints.scrollTop?this.hints.scrollTop=n.offsetTop-3:n.offsetTop+n.offsetHeight>this.hints.scrollTop+this.hints.clientHeight&&(this.hints.scrollTop=n.offsetTop+n.offsetHeight-this.hints.clientHeight+3),e.signal(this.data,"select",this.data.list[this.selectedHint],n)}},screenAmount:function screenAmount(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}},e.registerHelper("hint","auto",{resolve:function resolveAutoHints(t,i){var s,n=t.getHelpers(i,"hint");if(n.length){var o=function resolved(e,t,i){var s=function applicableHelpers(e,t){if(!e.somethingSelected())return t;for(var i=[],s=0;s<t.length;s++)t[s].supportsSelection&&i.push(t[s]);return i}(e,n);!function run(n){if(n==s.length)return t(null);fetchHints(s[n],e,i,function(e){e&&e.list.length>0?t(e):run(n+1)})}(0)};return o.async=!0,o.supportsSelection=!0,o}return(s=t.getHelper(t.getCursor(),"hintWords"))?function(t){return e.hint.fromList(t,{words:s})}:e.hint.anyword?function(t,i){return e.hint.anyword(t,i)}:function(){}}}),e.registerHelper("hint","fromList",function(t,i){var n=t.getCursor(),o=t.getTokenAt(n),a=e.Pos(n.line,o.end);if(o.string&&/\w/.test(o.string[o.string.length-1]))var r=o.string,l=e.Pos(n.line,o.start);else r="",l=a;for(var c=[],h=0;h<i.words.length;h++){var d=i.words[h];s(d).call(d,0,r.length)==r&&c.push(d)}if(c.length)return{list:c,from:l,to:a}}),e.commands.autocomplete=e.showHint;var r={hint:e.hint.auto,completeSingle:!0,alignWithWord:!0,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:!0,completeOnSingleClick:!0,container:null,customKeys:null,extraKeys:null};e.defineOption("hintOptions",null)}},2948:function(e,t,i){var s=i(89);e.exports=function(e){function Bar(t,i,s){this.orientation=i,this.scroll=s,this.screen=this.total=this.size=1,this.pos=0,this.node=document.createElement("div"),this.node.className=t+"-"+i,this.inner=this.node.appendChild(document.createElement("div"));var n=this;function onWheel(t){var i=e.wheelEventPixels(t)["horizontal"===n.orientation?"x":"y"],s=n.pos;n.moveTo(n.pos+i),n.pos!==s&&e.e_preventDefault(t)}e.on(this.inner,"mousedown",function(t){if(1===t.which){e.e_preventDefault(t);var i="horizontal"===n.orientation?"pageX":"pageY",s=t[i],o=n.pos;e.on(document,"mousemove",move),e.on(document,"mouseup",done)}function done(){e.off(document,"mousemove",move),e.off(document,"mouseup",done)}function move(e){if(1!==e.which)return done();n.moveTo(o+(e[i]-s)*(n.total/n.size))}}),e.on(this.node,"click",function(t){e.e_preventDefault(t);var i,s=n.inner.getBoundingClientRect();i="horizontal"===n.orientation?t.clientX<s.left?-1:t.clientX>s.right?1:0:t.clientY<s.top?-1:t.clientY>s.bottom?1:0,n.moveTo(n.pos+i*n.screen)}),e.on(this.node,"mousewheel",onWheel),e.on(this.node,"DOMMouseScroll",onWheel)}Bar.prototype.setPos=function(e,t){return e<0&&(e=0),e>this.total-this.screen&&(e=this.total-this.screen),!(!t&&e===this.pos)&&(this.pos=e,this.inner.style["horizontal"===this.orientation?"left":"top"]=e*(this.size/this.total)+"px",!0)},Bar.prototype.moveTo=function(e){this.setPos(e)&&this.scroll(e,this.orientation)};function SimpleScrollbars(e,t,i){this.addClass=e,this.horiz=new Bar(e,"horizontal",i),t(this.horiz.node),this.vert=new Bar(e,"vertical",i),t(this.vert.node),this.width=null}Bar.prototype.update=function(e,t,i){var s=this.screen!==t||this.total!==e||this.size!==i;s&&(this.screen=t,this.total=e,this.size=i);var n=this.screen*(this.size/this.total);n<10&&(this.size-=10-n,n=10),this.inner.style["horizontal"===this.orientation?"width":"height"]=n+"px",this.setPos(this.pos,s)},SimpleScrollbars.prototype.update=function(e){if(null==this.width){var t=window.getComputedStyle?window.getComputedStyle(this.horiz.node):this.horiz.node.currentStyle;t&&(this.width=s(t.height,10))}var i=this.width||0,n=e.scrollWidth>e.clientWidth+1,o=e.scrollHeight>e.clientHeight+1;return this.vert.node.style.display=o?"block":"none",this.horiz.node.style.display=n?"block":"none",o&&(this.vert.update(e.scrollHeight,e.clientHeight,e.viewHeight-(n?i:0)),this.vert.node.style.bottom=n?i+"px":"0"),n&&(this.horiz.update(e.scrollWidth,e.clientWidth,e.viewWidth-(o?i:0)-e.barLeft),this.horiz.node.style.right=o?i+"px":"0",this.horiz.node.style.left=e.barLeft+"px"),{right:o?i:0,bottom:n?i:0}},SimpleScrollbars.prototype.setScrollTop=function(e){this.vert.setPos(e)},SimpleScrollbars.prototype.setScrollLeft=function(e){this.horiz.setPos(e)},SimpleScrollbars.prototype.clear=function(){var e=this.horiz.node.parentNode;e.removeChild(this.horiz.node),e.removeChild(this.vert.node)},e.scrollbarModel.simple=function(e,t){return new SimpleScrollbars("CodeMirror-simplescroll",e,t)},e.scrollbarModel.overlay=function(e,t){return new SimpleScrollbars("CodeMirror-overlayscroll",e,t)}}},2949:function(e,t,i){i(23),i(101),i(64);var s=i(32),n=i(1551);e.exports=function(e){e.defineMode("cartocss",function(e){var t,i=e.indentUnit;function ret(e,i){return t=i,e}var o="a abbr acronym address applet area article aside audio b base basefont bdi bdo big blockquote body br button canvas caption cite code col colgroup command datalist dd del details dfn dir div dl dt em embed fieldset figcaption figure font footer form frame frameset h1 h2 h3 h4 h5 h6 head header hgroup hr html i iframe img input ins keygen kbd label legend li link map mark menu meta meter nav noframes noscript object ol optgroup option output p param pre progress q rp rt ruby s samp script section select small source span strike strong style sub summary sup table tbody td textarea tfoot th thead time title tr track tt u ul var video wbr".split(" "),a=function keySet(e){for(var t={},i=0;i<e.length;++i)t[e[i]]=!0;return t}(n);var r=/(^\:root$|^\:nth\-child$|^\:nth\-last\-child$|^\:nth\-of\-type$|^\:nth\-last\-of\-type$|^\:first\-child$|^\:last\-child$|^\:first\-of\-type$|^\:last\-of\-type$|^\:only\-child$|^\:only\-of\-type$|^\:empty$|^\:link|^\:visited$|^\:active$|^\:hover$|^\:focus$|^\:target$|^\:lang$|^\:enabled^\:disabled$|^\:checked$|^\:first\-line$|^\:first\-letter$|^\:before$|^\:after$|^\:not$|^\:required$|^\:invalid$)/;function tokenBase(e,i){var n=e.next();if("@"===n)return e.eatWhile(/[\w\-]/),ret("meta",e.current());if("/"===n&&e.eat("*"))return i.tokenize=tokenCComment,tokenCComment(e,i);if("<"===n&&e.eat("!"))return i.tokenize=tokenSGMLComment,tokenSGMLComment(e,i);if("="===n)ret(null,"compare");else{if("|"===n&&e.eat("="))return ret(null,"compare");if("'"===n||"'"===n)return i.tokenize=function tokenString(e){return function(t,i){for(var s,n=!1;null!=(s=t.next())&&(s!==e||n);)n=!n&&"\\"===s;return n||(i.tokenize=tokenBase),ret("string","string")}}(n),i.tokenize(e,i);if("/"===n){if(e.eat("/"))return i.tokenize=tokenSComment,tokenSComment(e,i);if("string"===t||"("===t)return ret("string","string");if(void 0!==i.stack[i.stack.length-1])return ret(null,n);if(e.eatWhile(/[\a-zA-Z0-9\-_.\s]/),/\/|\)|#/.test(e.peek()||e.eatSpace()&&")"===e.peek())||e.eol())return ret("string","string")}else{if("!"===n)return e.match(/^\s*\w*/),ret("keyword","important");if(/\d/.test(n))return e.eatWhile(/[\w.%]/),ret("number","unit");if(/[,+<>*\/]/.test(n))return"="===e.peek()||"a"===t?ret("string","string"):ret(null,"select-op");if(!/[;{}:\[\]()~\|]/.test(n)){if("."===n)return"("===t||"string"===t?ret("string","string"):(e.eatWhile(/[\a-zA-Z0-9\-_]/)," "===e.peek()&&e.eatSpace(),")"===e.peek()?ret("number","unit"):ret("tag","tag"));if("#"===n)return e.eatWhile(/[A-Za-z0-9]/),(4===e.current().length||7===e.current().length)&&null!=e.current().match(/[A-Fa-f0-9]{6}|[A-Fa-f0-9]{3}/,!1)?e.current().substring(1)!==e.current().match(/[A-Fa-f0-9]{6}|[A-Fa-f0-9]{3}/,!1)[0]?ret("atom","tag"):(e.eatSpace(),/[\/<>.({!$%^&*_\-\\?=+\|#'~`]/.test(e.peek())?ret("atom","tag"):"}"===e.peek()?ret("color","unit"):/[a-zA-Z\\]/.test(e.peek())?ret("color","unit"):(e.eol(),ret("color","unit"))):(e.eatWhile(/[\w\\\-]/),ret("atom","tag"));if("&"===n)return e.eatWhile(/[\w\-]/),ret(null,n);var l;if(e.eatWhile(/[\w\\\-_%.{]/),"string"===t)return ret("string","string");if(null!=e.current().match(/(^http$|^https$)/))return e.eatWhile(/[\w\\\-_%.{:\/]/),ret("string","string");if("<"===e.peek()||">"===e.peek())return ret("tag","tag");if(/\(/.test(e.peek()))return ret(null,n);if("/"===e.peek()&&void 0!==i.stack[i.stack.length-1])return ret("string","string");if(e.current().match(/\-\d|\-.\d/))return ret("number","unit");if(function inTagsArray(e){for(var t=0;t<o.length;t++)if(e===o[t])return!0}(e.current().toLowerCase()))return ret("tag","tag");if(/\/|[\s\)]/.test(e.peek()||e.eol()||e.eatSpace()&&"/"===e.peek())&&-1!==s(l=e.current()).call(l,"."))return"{"===e.current().substring(e.current().length-1,e.current().length)?(e.backUp(1),ret("tag","tag")):(e.eatSpace(),/[{<>.a-zA-Z\/]/.test(e.peek())||e.eol()?ret("tag","tag"):ret("string","string"));if(e.eol()||"["===e.peek()||"#"===e.peek()||"tag"===t)return"{"===e.current().substring(e.current().length-1,e.current().length)&&e.backUp(1),ret("tag","tag");if("compare"===t||"a"===t||"("===t)return ret("string","string");if("|"===t||"-"===e.current()||"["===t)return ret(null,n);if(":"===e.peek()){e.next();var c=":"===e.peek();if(c)e.backUp(1);else{var h=e.pos,d=e.current().length;e.eatWhile(/[a-z\\\-]/);var u=e.pos;if(null!=e.current().substring(d-1).match(r))return e.backUp(u-(h-1)),ret("tag","tag");e.backUp(u-(h-1))}return c?ret("tag","tag"):ret("variable","variable")}return a.hasOwnProperty(e.current())?ret("color","unit"):ret("variable","variable")}if(":"===n)return e.eatWhile(/[a-z\\\-]/),r.test(e.current())?ret("tag","tag"):":"===e.peek()?(e.next(),e.eatWhile(/[a-z\\\-]/),e.current().match(/\:\:\-(o|ms|moz|webkit)\-/)?ret("string","string"):r.test(e.current().substring(1))?ret("tag","tag"):ret(null,n)):ret(null,n);if("~"!==n)return ret(null,n);if("r"===t)return ret("string","string")}}}function tokenSComment(e,t){return e.skipToEnd(),t.tokenize=tokenBase,ret("comment","comment")}function tokenCComment(e,t){for(var i,s=!1;null!=(i=e.next());){if(s&&"/"===i){t.tokenize=tokenBase;break}s="*"===i}return ret("comment","comment")}function tokenSGMLComment(e,t){for(var i,s=0;null!=(i=e.next());){if(s>=2&&">"===i){t.tokenize=tokenBase;break}s="-"===i?s+1:0}return ret("comment","comment")}return{startState:function startState(e){return{tokenize:tokenBase,baseIndent:e||0,stack:[]}},token:function token(e,i){if(e.eatSpace())return null;var s=i.tokenize(e,i),n=i.stack[i.stack.length-1];return"hash"===t&&"rule"===n?s="atom":"variable"===s&&("rule"===n?s=null:n&&"@media{"!==n||(s="when"===e.current()?"variable":/[\s,|\s\)|\s]/.test(e.peek())?"tag":t)),"rule"===n&&/^[\{\};]$/.test(t)&&i.stack.pop(),"{"===t?"@media"===n?i.stack[i.stack.length-1]="@media{":i.stack.push("{"):"}"===t?i.stack.pop():"@media"===t?i.stack.push("@media"):"{"===n&&"comment"!==t&&i.stack.push("rule"),s},indent:function indent(e,t){var s=e.stack.length;return/^\}/.test(t)&&(s-="rule"===e.stack[e.stack.length-1]?2:1),e.baseIndent+s*i},electricChars:"}"}}),e.defineMIME("text/x-carto","cartocss")}},2950:function(e,t,i){i(23),i(101),i(64),e.exports=function(e){e.defineMode("mustache",function(){return{token:function token(e,t){var i;if(e.match("{{")){if(null==(i=e.peek())||null!=i&&i.match(/[{]{1,}/))return e.next(),"mustache-error";if(null!=i&&i.match(/[a-zA-Z\u00C0-\u024F_]+/))return null}if(e.match("}}")){if(null!=(i=e.peek())&&i.match(/[}]{1,}/))return e.next(),"mustache-error";if(null==i)return null}return e.match("}")&&(null==(i=e.peek())||null!=i&&i.match(/[}]{1,}/))?(e.next(),"mustache-error"):e.match("{")&&(null==(i=e.peek())||null!=i&&i.match(/[{]{1,}/))?(e.next(),"mustache-error"):e.match(/[a-zA-Z\u00C0-\u024F_]+/,!0)?"mustache-text":void e.next()}}}),function(){function set(e){for(var t={},i=e.split(" "),s=0;s<i.length;++s)t[i[s]]=!0;return t}e.defineMIME("text/mustache",{name:"mustache",client:set("source"),keywords:set("{{  }}")})}()}},2951:function(e,t,i){i(23),i(101),i(64),e.exports=function(e){"use strict";e.defineMode("sql",function(t,i){var s=i.client||{},n=i.atoms||{false:!0,true:!0,null:!0},o=i.builtin||{},a=i.keywords||{},r=i.operatorChars||/^[*+\-%<>!=&|~^]/,l=i.support||{},c=i.hooks||{},h=i.dateSQL||{date:!0,time:!0,timestamp:!0};function tokenBase(e,t){var i=e.next();if(c[i]){var d=c[i](e,t);if(!1!==d)return d}if(1==l.hexNumber&&("0"==i&&e.match(/^[xX][0-9a-fA-F]+/)||("x"==i||"X"==i)&&e.match(/^'[0-9a-fA-F]+'/)))return"number";if(1==l.binaryNumber&&(("b"==i||"B"==i)&&e.match(/^'[01]+'/)||"0"==i&&e.match(/^b[01]+/)))return"number";if(i.charCodeAt(0)>47&&i.charCodeAt(0)<58)return e.match(/^[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/),1==l.decimallessFloat&&e.eat("."),"number";if("?"==i&&(e.eatSpace()||e.eol()||e.eat(";")))return"variable-3";if("'"==i||'"'==i&&l.doubleQuote)return t.tokenize=function tokenLiteral(e){return function(t,i){for(var s,n=!1;null!=(s=t.next());){if(s==e&&!n){i.tokenize=tokenBase;break}n=!n&&"\\"==s}return"string"}}(i),t.tokenize(e,t);if((1==l.nCharCast&&("n"==i||"N"==i)||1==l.charsetCast&&"_"==i&&e.match(/[a-z][a-z0-9]*/i))&&("'"==e.peek()||'"'==e.peek()))return"keyword";if(/^[\(\),\;\[\]]/.test(i))return null;if(l.commentSlashSlash&&"/"==i&&e.eat("/"))return e.skipToEnd(),"comment";if(l.commentHash&&"#"==i||"-"==i&&e.eat("-")&&(!l.commentSpaceRequired||e.eat(" ")))return e.skipToEnd(),"comment";if("/"==i&&e.eat("*"))return t.tokenize=tokenComment,t.tokenize(e,t);if("."!=i){if(r.test(i))return e.eatWhile(r),null;if("{"==i&&(e.match(/^( )*(d|D|t|T|ts|TS)( )*'[^']*'( )*}/)||e.match(/^( )*(d|D|t|T|ts|TS)( )*"[^"]*"( )*}/)))return"number";e.eatWhile(/^[_\w\d]/);var u=e.current().toLowerCase();return h.hasOwnProperty(u)&&(e.match(/^( )+'[^']*'/)||e.match(/^( )+"[^"]*"/))?"number":n.hasOwnProperty(u)?"atom":o.hasOwnProperty(u)?"builtin":a.hasOwnProperty(u)?"keyword":s.hasOwnProperty(u)?"string-2":null}return 1==l.zerolessFloat&&e.match(/^(?:\d+(?:e[+-]?\d+)?)/i)?"number":1==l.ODBCdotTable&&e.match(/^[a-zA-Z_]+/)?"variable-2":void 0}function tokenComment(e,t){for(;;){if(!e.skipTo("*")){e.skipToEnd();break}if(e.next(),e.eat("/")){t.tokenize=tokenBase;break}}return"comment"}function pushContext(e,t,i){t.context={prev:t.context,indent:e.indentation(),col:e.column(),type:i}}return{startState:function startState(){return{tokenize:tokenBase,context:null}},token:function token(e,t){if(e.sol()&&t.context&&null==t.context.align&&(t.context.align=!1),e.eatSpace())return null;var i=t.tokenize(e,t);if("comment"==i)return i;t.context&&null==t.context.align&&(t.context.align=!0);var s=e.current();return"("==s?pushContext(e,t,")"):"["==s?pushContext(e,t,"]"):t.context&&t.context.type==s&&function popContext(e){e.indent=e.context.indent,e.context=e.context.prev}(t),i},indent:function indent(i,s){var n=i.context;if(!n)return e.Pass;var o=s.charAt(0)==n.type;return n.align?n.col+(o?0:1):n.indent+(o?0:t.indentUnit)},blockCommentStart:"/*",blockCommentEnd:"*/",lineComment:l.commentSlashSlash?"//":l.commentHash?"#":null}}),function(){function set(e){for(var t={},i=e.split(" "),s=0;s<i.length;++s)t[i[s]]=!0;return t}e.defineMIME("text/x-pgsql",{name:"sql",client:set("source"),keywords:set("alter and as asc between by count create delete desc distinct drop from group having in insert into is join like not on or order select set table union update values where limit a abort abs absent absolute access according action ada add admin after aggregate all allocate also always analyse analyze any are array array_agg array_max_cardinality asensitive assertion assignment asymmetric at atomic attribute attributes authorization avg backward base64 before begin begin_frame begin_partition bernoulli binary bit_length blob blocked bom both breadth c cache call called cardinality cascade cascaded case cast catalog catalog_name ceil ceiling chain characteristics characters character_length character_set_catalog character_set_name character_set_schema char_length check checkpoint class class_origin clob close cluster coalesce cobol collate collation collation_catalog collation_name collation_schema collect column columns column_name command_function command_function_code comment comments commit committed concurrently condition condition_number configuration conflict connect connection connection_name constraint constraints constraint_catalog constraint_name constraint_schema constructor contains content continue control conversion convert copy corr corresponding cost covar_pop covar_samp cross csv cube cume_dist current current_catalog current_date current_default_transform_group current_path current_role current_row current_schema current_time current_timestamp current_transform_group_for_type current_user cursor cursor_name cycle data database datalink datetime_interval_code datetime_interval_precision day db deallocate dec declare default defaults deferrable deferred defined definer degree delimiter delimiters dense_rank depth deref derived describe descriptor deterministic diagnostics dictionary disable discard disconnect dispatch dlnewcopy dlpreviouscopy dlurlcomplete dlurlcompleteonly dlurlcompletewrite dlurlpath dlurlpathonly dlurlpathwrite dlurlscheme dlurlserver dlvalue do document domain dynamic dynamic_function dynamic_function_code each element else empty enable encoding encrypted end end-exec end_frame end_partition enforced enum equals escape event every except exception exclude excluding exclusive exec execute exists exp explain expression extension external extract false family fetch file filter final first first_value flag float floor following for force foreign fortran forward found frame_row free freeze fs full function functions fusion g general generated get global go goto grant granted greatest grouping groups handler header hex hierarchy hold hour id identity if ignore ilike immediate immediately immutable implementation implicit import including increment indent index indexes indicator inherit inherits initially inline inner inout input insensitive instance instantiable instead integrity intersect intersection invoker isnull isolation k key key_member key_type label lag language large last last_value lateral lead leading leakproof least left length level library like_regex link listen ln load local localtime localtimestamp location locator lock locked logged lower m map mapping match matched materialized max maxvalue max_cardinality member merge message_length message_octet_length message_text method min minute minvalue mod mode modifies module month more move multiset mumps name names namespace national natural nchar nclob nesting new next nfc nfd nfkc nfkd nil no none normalize normalized nothing notify notnull nowait nth_value ntile null nullable nullif nulls number object occurrences_regex octets octet_length of off offset oids old only open operator option options ordering ordinality others out outer output over overlaps overlay overriding owned owner p pad parameter parameter_mode parameter_name parameter_ordinal_position parameter_specific_catalog parameter_specific_name parameter_specific_schema parser partial partition pascal passing passthrough password percent percentile_cont percentile_disc percent_rank period permission placing plans pli policy portion position position_regex power precedes preceding prepare prepared preserve primary prior privileges procedural procedure program public quote range rank read reads reassign recheck recovery recursive ref references referencing refresh regr_avgx regr_avgy regr_count regr_intercept regr_r2 regr_slope regr_sxx regr_sxy regr_syy reindex relative release rename repeatable replace replica requiring reset respect restart restore restrict result return returned_cardinality returned_length returned_octet_length returned_sqlstate returning returns revoke right role rollback rollup routine routine_catalog routine_name routine_schema row rows row_count row_number rule savepoint scale schema schema_name scope scope_catalog scope_name scope_schema scroll search second section security selective self sensitive sequence sequences serializable server server_name session session_user setof sets share show similar simple size skip snapshot some source space specific specifictype specific_name sql sqlcode sqlerror sqlexception sqlstate sqlwarning sqrt stable standalone start state statement static statistics stddev_pop stddev_samp stdin stdout storage strict strip structure style subclass_origin submultiset substring substring_regex succeeds sum symmetric sysid system system_time system_user t tables tablesample tablespace table_name temp template temporary then ties timezone_hour timezone_minute to token top_level_count trailing transaction transactions_committed transactions_rolled_back transaction_active transform transforms translate translate_regex translation treat trigger trigger_catalog trigger_name trigger_schema trim trim_array true truncate trusted type types uescape unbounded uncommitted under unencrypted unique unknown unlink unlisten unlogged unnamed unnest until untyped upper uri usage user user_defined_type_catalog user_defined_type_code user_defined_type_name user_defined_type_schema using vacuum valid validate validator value value_of varbinary variadic var_pop var_samp verbose version versioning view views volatile when whenever whitespace width_bucket window within work wrapper write xmlagg xmlattributes xmlbinary xmlcast xmlcomment xmlconcat xmldeclaration xmldocument xmlelement xmlexists xmlforest xmliterate xmlnamespaces xmlparse xmlpi xmlquery xmlroot xmlschema xmlserialize xmltable xmltext xmlvalidate year yes loop repeat"),builtin:set("bigint int8 bigserial serial8 bit varying varbit boolean bool box bytea character char varchar cidr circle date double precision float8 inet integer int int4 interval json jsonb line lseg macaddr money numeric decimal path pg_lsn point polygon real float4 smallint int2 smallserial serial2 serial serial4 text time without zone with timetz timestamp timestamptz tsquery tsvector txid_snapshot uuid xml"),atoms:set("false true null unknown"),operatorChars:/^[*+\-%<>!=&|^]/,dateSQL:set("date time timestamp"),support:set("ODBCdotTable decimallessFloat zerolessFloat binaryNumber hexNumber nCharCast charsetCast commentHash commentSpaceRequired")})}()}},2952:function(e,t){e.exports=["cdb_geocode_street_point","cdb_isodistance","cdb_isochrone","cdb_route_point_to_point","cdb_route_with_waypoints"]},2953:function(e,t,i){i(37),i(429),i(23),i(88);var s=i(3),n=i(4),o=i(18),a=i(1),r=i(789),l=i(1551),c=["editor"],h=a.template("1px solid  <%- color %>"),d=function stopPropagation(e){e.stopPropagation()};e.exports=n.extend({initialize:function initialize(e){var t,i;a.each(c,function(t){if(void 0===e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this),this._updateColors=s(t=a.debounce(this._updateColors,5)).call(t,this),this._onDocumentClick=s(i=this._onDocumentClick).call(i,this),this._editor=e.editor,this._initBinds()},_initBinds:function _initBinds(){var e,t=this,i=s(e=function _context3(){this._destroyPicker()}).call(e,this);this._enableUpdateBind(),this._editor.on("mousedown",function(e,i){var n;a.delay(s(n=t._onClick).call(n,t,e,i),50)}),this._editor.on("keydown",i),this._editor.on("viewportChange",i),this._editor.on("scroll",i),this._editor.getWrapperElement().addEventListener("click",d)},_disableBinds:function _disableBinds(){this._editor.getWrapperElement().removeEventListener("click",d),this._editor.off(null,null,this)},_enableUpdateBind:function _enableUpdateBind(){this._editor.on("update",this._updateColors)},_disableUpdateBind:function _disableUpdateBind(){this._editor.off("update",this._updateColors)},_onClick:function _onClick(e,t){var i=this._editor.getCursor(!0),s=this._editor.getTokenAt(i);"color"===s.type?this._createPicker(t,i,s):this._destroyPicker()},_updateColors:function _updateColors(e){var t=e.getWrapperElement();a.each(t.querySelectorAll(".cm-color"),function(e){this._paintColor(e.textContent,e)},this)},_replaceColor:function _replaceColor(e,t){var i,s,n=this._editor.getCursor(),o=this._getMatch(n,"name"),r=this._getMatch(n,"hex"),l=o||r;if(l){i={line:n.line,ch:l.start},s={line:n.line,ch:l.end},this._editor.replaceRange(e,i,s,"paste");var c=this._editor.getWrapperElement();a.each(c.querySelectorAll(".cm-color"),function(e){var t=e.style,i=e.innerText;t&&t.borderBottom||this._paintColor(i,e)},this)}},_paintColor:function _paintColor(e,t){t.style.borderBottom=h({color:e})},_getMatch:function _getMatch(e,t){if(t){var i;switch(t.toLowerCase()){case"name":i=new RegExp(l.join("|"),"g");break;case"hsl":i=/hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)/g;break;case"rgb":i=/rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)/;break;case"hex":i=/#[a-fA-F0-9]{3,6}/g;break;default:return void console.log("Invalid color match selection")}for(var s=this._editor.getLine(e.line),n=i.exec(s);n;){var o=n[0],a=o.length,r=n.index,c=n.index+a;if(e.ch>=r&&e.ch<=c)return n=null,{start:r,end:c,string:o};n=i.exec(s)}}},_createPicker:function _createPicker(e,t,i){var n,l,c=this._editor.cursorCoords();this._destroyPicker(),this._colorPicker=new r({className:"Editor-boxModal ColorPicker--cm Editor-boxModal--darked Editor-FormDialog CDB-Text",value:i.string,disableOpacity:!0}),this._colorPicker.$el.attr("data-colorpicker-cid",this.cid),s(n=this._colorPicker).call(n,"change",a.debounce(s(l=this._onColorPickerChange).call(l,this,e),5),this);var h=c.top+20;h+220>o(window).outerHeight()&&(h=c.top-220-20),this._colorPicker.$el.css({left:c.left,top:h}),document.body.appendChild(this._colorPicker.render().el),document.addEventListener("click",this._onDocumentClick)},_onDocumentClick:function _onDocumentClick(e){0===o(e.target).closest('[data-colorpicker-cid="'+this.cid+'"]').length&&this._destroyPicker()},_onColorPickerChange:function _onColorPickerChange(e,t){this._disableUpdateBind(),this._replaceColor(t.hex,e.target),this.trigger("codeSaved"),this._enableUpdateBind()},_destroyPicker:function _destroyPicker(){this._colorPicker&&(this.removeView(this._colorPicker),this._colorPicker.clean(),delete this._colorPicker),document.removeEventListener("click",this._onDocumentClick)},clean:function clean(){this._disableBinds(),n.prototype.clean.call(this)}})},2954:function(e,t,i){var s=i(3),n=i(18),o=i(6),a=i(753),r=i(552);o.Form.editors.CodeEditor=o.Form.editors.TextArea.extend({render:function render(){return this.setValue(this.value),this._codemirrorModel=new o.Model({content:this.value,readonly:!1,lineNumbers:!1}),a.init({tokens:this.options.tokens,tableName:!1,columnsName:!1}),this._initViews(),this._toggleDisableState(),this},getValue:function getValue(){var e=this.$el.val();return""===(e=this.codeMirrorView.getContent())?null:e},_initViews:function _initViews(){var e;this._destroyEditor();var t=a.reset().hints;this.codeMirrorView=new r({model:this._codemirrorModel,hints:t,mode:"text/mustache",autocompleteChars:2,autocompletePrefix:"{{",autocompleteSuffix:"}}",placeholder:this.options.placeholder,tips:[]}),s(e=this.codeMirrorView).call(e,"codeChanged",function(){this.trigger("change",this.codeMirrorView.getContent())},this);var i=n(this.codeMirrorView.render().el);this.$el.replaceWith(i),this.setElement(i),this.$el.addClass("CodeMirror-formInput"),this._addTrackingClass()},_addTrackingClass:function _addTrackingClass(){if(this.options.trackingClass){var e=this.options.trackingClass+" track-"+this.options.key+this.options.editorType;this.$el.addClass(e)}},_hasEditor:function _hasEditor(){return this.options.editor&&!!this.codeMirrorView},_destroyEditor:function _destroyEditor(){this._hasEditor()&&this.codeMirrorView.remove()},remove:function remove(){this._destroyEditor(),o.Form.editors.Base.prototype.remove.apply(this)},clean:function clean(){this.$el.remove()}})},2955:function(e,t,i){var s=i(3),n=i(13),o=i(1),a=i(6),r=i(186),l=i(198),c=i(71),h=i(559);a.Form.editors.Suggest=a.Form.editors.Select.extend({initialize:function initialize(e){a.Form.editors.Base.prototype.initialize.call(this,e),r.setOptions(this,e),this.template=e.template||h,this.dialogMode=this.options.dialogMode||c.Mode.DEFAULT,this._setupCollection(),this._initViews(),this.setValue(this.model.get(this.options.keyAttr)),this._initBinds()},_setupCollection:function _setupCollection(){var e={label:this.value,val:this.value};if(this.collection=new l(this.options.options),this.options.editorAttrs&&this.options.editorAttrs.collectionData){var t=n(o).call(o,this.options.editorAttrs.collectionData,function(e){return{label:e,val:e}});this.collection.reset(t)}this.value&&!this.collection.findWhere(e)&&this.collection.add(e)},_initBinds:function _initBinds(){var e,t,i,n=s(e=function _context(){this._listView.hide(),this._popupManager.untrack()}).call(e,this);s(t=this.collection).call(t,"change:selected",this._onItemSelected,this),s(i=this.collection).call(i,"reset",this.render,this),this.applyESCBind(n),this.applyClickOutsideBind(n)},_renderButton:function _renderButton(e){var t=this.$(".js-button"),i=e.getName(),s=null===i||"null"===i,n=s?"null":i,a=o.extend({},e.attributes,{label:n}),r=this.options.selectedItemTemplate(a);return t.html(r).toggleClass("is-empty",s),t}})},2956:function(e,t,i){i(31),i(31);var s=i(6),n=i(59),o=i(74),a=[{val:0,label:_t("months.january")},{val:1,label:_t("months.february")},{val:2,label:_t("months.march")},{val:3,label:_t("months.april")},{val:4,label:_t("months.may")},{val:5,label:_t("months.june")},{val:6,label:_t("months.july")},{val:7,label:_t("months.august")},{val:8,label:_t("months.september")},{val:9,label:_t("months.october")},{val:10,label:_t("months.november")},{val:11,label:_t("months.december")}];e.exports=s.Model.extend({initialize:function initialize(){this.schema={day:{type:"Text",title:"",validators:["required",/^(([0]?[1-9])|([1-2][0-9])|(3[01]))$/,function(e,t){if(!o(n.formatDate(t)).isValid())return{type:"date",message:_t("components.datepicker.invalid-date")}}]},month:{type:"Select",title:"",position:{left:0,"min-width":"200px"},options:a},year:{title:"",type:"Text",validators:["required",/^([0-9]{0,4})$/]},time:{title:"",type:"Text",validators:["required",/^([01]{1}[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$/]}}},getFormattedDate:function getFormattedDate(){return n.formatDate(this.toJSON())}})},2957:function(e,t,i){var s=i(3),n=i(6),o=i(4),a=i(74),r=i(2956);e.exports=o.extend({tagName:"div",className:"Table-editorDate",events:{keyup:"_onKeyUp"},initialize:function initialize(){var e,t=this.model.get("value"),i={};i=t?a(t).utc():a().utc(),this._formModel=new r({day:i.date(),month:i.month(),year:i.year(),time:i.format("HH:mm:ss"),utcOffset:i.utcOffset()}),s(e=this._formModel).call(e,"change",this._setValue,this),this.add_related_model(this._formModel),this._setValue()},render:function render(){var e;return this._formView=new n.Form({model:this._formModel}),s(e=this._formView).call(e,"change",function(){this.commit()}),this.$el.html(this._formView.render().el),this},_setValue:function _setValue(){this.model.set("value",this._formModel.getFormattedDate())},_onKeyUp:function _onKeyUp(){this._setValue()},clean:function clean(){this._formView.remove(),o.prototype.clean.apply(this)}})},2958:function(e,t,i){var s=i(4),n=i(2957);e.exports=s.extend({className:"CDB-Box-modal CustomList CustomList--inputs is-visible has-visibility js-datetimePicker",initialize:function initialize(){this._initBinds()},render:function render(){return this.clearSubViews(),this._datetimeEditorView=new n({model:this.model}),this.addView(this._datetimeEditorView),this.$el.append(this._datetimeEditorView.render().el),this},_initBinds:function _initBinds(){this.listenTo(this.model,"change:show",this._onShowChange),this.listenTo(this.model,"destroy",this._onDestroy)},_onShowChange:function _onShowChange(e,t){t?(this.$el.show(),this.$el.removeClass("is-closing").addClass("is-opening")):(this.$el.removeClass("is-opening").addClass("is-closing"),this.$el.hide())},show:function show(){this.model.show()},hide:function hide(){this.model.hide()},_onDestroy:function _onDestroy(){this.hide(),this.clean()}})},2959:function(e,t,i){var s=i(7),n=i(38),o=i(6);e.exports=o.Model.extend({defaults:{show:!1},show:function show(){this.set("show",!0)},hide:function hide(){this.set("show",!1)},isHidden:function isHidden(){return!this.get("show")},destroy:function destroy(){var e,t=n(Array.prototype).call(arguments);this.trigger.apply(this,s(e=["destroy"]).call(e,t))}})},2960:function(e,t,i){var s=i(3),n=i(6),o=i(186),a=i(74),r=i(2959),l=i(2958),c=i(754),h=i(71),d=i(451);n.Form.editors.DateTime=n.Form.editors.Base.extend({className:"Editor-formInput u-flex u-alignCenter",events:{"click .js-input":"_onInputClick"},initialize:function initialize(e){n.Form.editors.Base.prototype.initialize.call(this,e),o.setOptions(this,e),this.dialogMode=this.options.dialogMode||h.Mode.DEFAULT,this._initBinds(),this.render()},render:function render(){return n.Form.editors.Base.prototype.render.apply(this,arguments),this._removeDateTimeDialog(),this.$el.html(c({value:this._getFormattedDatetime()})),this._initViews(),this},_getFormattedDatetime:function _getFormattedDatetime(){if(this.value){var e=new Date(this.value).toUTCString(),t=a(e).utc();return t.format("YYYY-MM-DD")+"T"+t.format("HH:mm:ss")+"Z"}return null},_initViews:function _initViews(){var e;this.options.editorAttrs&&this.options.editorAttrs.disabled&&this.$el.addClass("is-disabled"),this._datetimeDialogModel=new r({value:this._getFormattedDatetime()}),s(e=this._datetimeDialogModel).call(e,"change:value",this._onInputChanged,this),this._datetimeDialogView=new l({model:this._datetimeDialogModel}),this._popupManager=new d(this.cid,this.$el,this._datetimeDialogView.$el)},_initBinds:function _initBinds(){var e,t=s(e=function _context2(){this._removeDateTimeDialog()}).call(e,this);this.applyESCBind(t),this.applyClickOutsideBind(t)},_onInputClick:function _onInputClick(){this._datetimeDialogView.render(),this._popupManager.append(this.dialogMode),this._popupManager.track()},_removeDateTimeDialog:function _removeDateTimeDialog(){this._datetimeDialogView&&(this._popupManager.untrack(),this._datetimeDialogView.remove())},_onInputChanged:function _onInputChanged(e){var t=this._datetimeDialogModel.get("value");this.setValue(t),this.trigger("change",this)},_updateInput:function _updateInput(e){this.$(".js-input").toggleClass("is-empty",!e).text(e)},getValue:function getValue(){return this._datetimeDialogModel.get("value")},setValue:function setValue(e){this._updateInput(e),this.value=e},remove:function remove(){this._removeDateTimeDialog(),this._popupManager&&this._popupManager.destroy(),n.Form.editors.Base.prototype.remove.apply(this)}})},2961:function(e,t,i){var s=i(13),n=i(6);e.exports=n.Collection.extend({removeTag:function removeTag(e){var t=this.findWhere({label:e});t&&this.remove(t)},addTag:function addTag(e){!this.findWhere({label:e})&&this.add({label:e})},getValue:function getValue(){var e;return s(e=this).call(e,function(e){return e.get("label")})}})},2962:function(e,t,i){var s=i(4);e.exports=s.extend({tagName:"li",initialize:function initialize(e){if(!e.label)throw new Error("label is required");this._label=e.label},render:function render(){return this.clearSubViews(),this.$el.html(this._label),this}})},2963:function(e,t,i){var s=i(199),n=i(13),o=i(28),a=i(3),r=i(1),l=i(6),c=i(755),h=i(2962),d=i(2961),u=i(186);i(18),i(369),i(1052),l.Form.editors.Taglist=l.Form.editors.Base.extend({className:"Form-tags CDB-Text",events:{mouseover:"_onMouseOver",mouseout:"_onMouseOut"},initialize:function initialize(e){l.Form.editors.Base.prototype.initialize.call(this,e),u.setOptions(this,e),this._tagCollection=new d(this._normalize(e.schema.options.tags)),this.isEditable=e.schema.options.isEditable||void 0===e.schema.options.isEditable},render:function render(){return this._initViews(),this},_initViews:function _initViews(){var e,t,i=this,s=this.isEditable||0!==this._tagCollection.length?_t("components.taglist.placeholder"):_t("components.taglist.none");this.$el.html(c()),this._tagCollection.each(this._renderTag,this),this.$(".js-tagsList").tagit({allowSpaces:!0,caseSensitive:!1,placeholderText:s,readOnly:!this.isEditable,onBlur:function onBlur(){i.isEditable&&i.$el.removeClass("is-focus"),i.trigger("blur",i)},onFocus:function onFocus(){i.isEditable&&i.$el.removeClass("is-hover").addClass("is-focus"),i.trigger("focus",i)},preprocessTag:function preprocessTag(e){return e.toLowerCase()},afterTagAdded:a(e=i._onTagAdded).call(e,i),afterTagRemoved:a(t=i._onTagRemoved).call(t,i)})},_renderTag:function _renderTag(e){var t=new h({label:e.get("label")});this.$(".js-tagsList").append(t.render().el)},focus:function focus(){this.hasFocus||this.$el.focus()},blur:function blur(){this.hasFocus&&this.$el.blur()},getValue:function getValue(){return this._tagCollection.getValue()},setValue:function setValue(e){this._tagCollection.reset(this._normalize(e)),this._destroyTagit(),this.render(),this.trigger("change",this)},_onMouseOver:function _onMouseOver(){!this.$el.hasClass("is-focus")&&this.$el.addClass("is-hover")},_onMouseOut:function _onMouseOut(){!this.$el.hasClass("is-focus")&&this.$el.removeClass("is-hover")},_onTagRemoved:function _onTagRemoved(e,t){var i,s=o(i=t.tag).call(i,".tagit-label").text();this._tagCollection.removeTag(s),this.trigger("change",this)},_onTagAdded:function _onTagAdded(e,t){var i,s=o(i=t.tag).call(i,".tagit-label").text();this._tagCollection.addTag(s),this.trigger("change",this)},_normalize:function _normalize(e){return n(r).call(r,e,function(e){return{label:s(e).call(e)}})},_destroyTagit:function _destroyTagit(){this.$(".ui-widget").length>0&&this.$(".js-tagsList").tagit("destroy")},remove:function remove(){this._destroyTagit(),l.Form.editors.Base.prototype.remove.apply(this)},clean:function clean(){this.$el.remove()}})},2964:function(e,t,i){var s=i(3),n=i(6),o=i(4),a=i(756),r=[1,5];e.exports=o.extend({events:{"click .js-back":"_onClickBack","click .js-bins":"_onClickBins","click .js-quantification":"_onClickQuantification"},render:function render(){return this.clearSubViews(),this._removeForm(),this.$el.empty(),this.$el.append(a({bins:this.model.get("bins"),attribute:this.model.get("attribute"),quantification:this.model.get("quantification")})),this._initForm(),this},_initForm:function _initForm(){this._formView&&this._formView.remove();var e=this._getRangeOrCalculateItIfNeeded();this._formView=this._createFormView(e),this._renderFormView()},_renderFormView:function _renderFormView(){this.$(".js-content").append(this._formView.render().$el)},_getRangeOrCalculateItIfNeeded:function _getRangeOrCalculateItIfNeeded(){var e,t,i=this.model.get("fixed"),s=this.model.get("range");if(s&&(e=+s[0],t=+s[1]),i){var n=this._calculateRangeFromFixed(i);e=n[0],t=n[1],this.model.set("range",n),this.model.unset("fixed")}return[e,t]},_createFormView:function _createFormView(e){var t,i=e[0],o=e[1],a=new n.Model({min:i,max:o}),r=s(t=this._getNumberType).call(t,this);a.schema={min:r(),max:r()},s(a).call(a,"change",function(e){this.model.set("range",[+e.get("min"),+e.get("max")])},this);var l=new n.Form({className:"Editor-boxList",model:a});return s(l).call(l,"change",function(){this.commit()}),l},_calculateRangeFromFixed:function _calculateRangeFromFixed(e,t){t=t||30;var i=e/(this.options.max-this.options.min),s=Math.floor(Math.max(this.options.min,e-t*i)),n=Math.floor(Math.min(this.options.max,e+t*i));return[s=Math.max(s,r[0]),n=Math.max(n,r[1])]},_getNumberType:function _getNumberType(){return{type:"Number",validators:["required",{type:"interval",min:this.options.min,max:this.options.max}]}},_removeForm:function _removeForm(){this._formView&&this._formView.remove()},_onClickBack:function _onClickBack(e){this.killEvent(e),this.trigger("back",this)},_onClickQuantification:function _onClickQuantification(e){this.killEvent(e),this.trigger("selectQuantification",this)},_onClickBins:function _onClickBins(e){this.killEvent(e),this.trigger("selectBins",this)},clean:function clean(){this._removeForm(),o.prototype.clean.call(this)}})},2965:function(e,t,i){var s=i(25),n=i(3),o=i(76),a=i(1),r=i(6),l=i(4),c=i(757),h=i(1057),d=i(1056),u=i(368),p=i(795),g=i(505),m=i(2964),f=i(451),_=i(174),v=i(14),y=["columns","popupConfig"];e.exports=l.extend({className:"Form-StyleByValue u-ellipsis",events:{"click .js-button":"_showByValueDialog","click .js-back":"_onClickBack"},initialize:function initialize(e){v(e,y,this),this._settings=_.Settings.NUMBER,this._setupModel()},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},afterRender:function afterRender(){this._openPopupForColumn()},_openPopupForColumn:function _openPopupForColumn(){var e=this.model.get("attribute");if(a.isUndefined(e)){var t=this;this.timeoutId=o(function(){t.timeoutId=null,t._showByValueDialog()},200)}},_setupModel:function _setupModel(){var e={};if(!this.model.get("quantification")){var t=this._settings.quantifications;e.quantification=t.items[t.defaultIndex]}var i=this.model.get("bins"),s=this._settings.bins;i||(e.bins=s.items[s.defaultIndex]),+i>+a.last(s.items)&&(e.bins=a.last(s.items)),this.model.set(e),this.listenTo(this.model,"change:attribute change:range",this.render)},_initViews:function _initViews(){this._initDialog(),this._initPopup(),this._initInputColumn()},_initDialog:function _initDialog(){if(!this._dialogView){var e=new h;this.listenToOnce(e,"destroy",function(){this._dialogView=null,this.stopListening(e)}),this._dialogView=new d({model:e})}},_initPopup:function _initPopup(){this._popupManager=new f(this._popupConfig.cid,this._popupConfig.$el,this._dialogView.$el)},_initInputColumn:function _initInputColumn(){var e=this.model.get("attribute"),t=this.model.get("range"),i=e||_t("form-components.editors.style.select-by-column"),s=t?t[0]+" - "+t[1]:"";this.$el.append(c({columnSelected:!!e,label:i,rangeSelected:!!t,range:s}))},removeDialog:function removeDialog(){this._dialogView.clean(),this._popupManager.untrack()},removePopupManager:function removePopupManager(){this._popupManager.destroy()},_createStackView:function _createStackView(){var e,t,i,s,o=new u({collection:new r.Collection([{createStackView:n(e=this._createColumnsView).call(e,this)},{createStackView:n(t=this._createSizeValueContentView).call(t,this)},{createStackView:n(i=this._createQuantificationView).call(i,this)},{createStackView:n(s=this._createBinsView).call(s,this)}])});return o.model.set("position",this._getDialogStepPosition()),o},_showByValueDialog:function _showByValueDialog(){var e;this._dialogView.model.set("createContentView",n(e=this._createStackView).call(e,this)),this._dialogView.render(),this._dialogView.show(),this._popupManager.append(this._popupConfig.mode),this._popupManager.track()},_getDialogStepPosition:function _getDialogStepPosition(){var e=1;return this.model.get("attribute")?this.model.get("quantification")||(e=2):e=0,e},_createColumnsView:function _createColumnsView(e,t){var i,o=new p({stackLayoutModel:e,columns:s(i=this._columns).call(i,function(e){return"number"===e.type}),showSearch:!0,typeLabel:"column"});return n(o).call(o,"selectItem",function(t){this.model.set("attribute",t.get("val"));var i=1;this.model.get("quantification")||(i=2),e.goToStep(i)},this),o},_createSizeValueContentView:function _createSizeValueContentView(e,t){var i=new m({stackLayoutModel:e,model:this.model,min:this.options.min,max:this.options.max});return n(i).call(i,"back",function(t){e.prevStep()},this),n(i).call(i,"selectQuantification",function(t){e.goToStep(2)},this),n(i).call(i,"selectBins",function(t){e.goToStep(3)},this),i},_createQuantificationView:function _createQuantificationView(e,t){var i=new p({headerTitle:_t("form-components.editors.fill.quantification.title"),stackLayoutModel:e,columns:this._settings.quantifications.items,itemTemplate:g,showSearch:!1});return n(i).call(i,"selectItem",function(t){this.model.set("quantification",t.get("val")),e.prevStep()},this),n(i).call(i,"back",function(t){e.prevStep()},this),i},_createBinsView:function _createBinsView(e,t){var i=new p({headerTitle:_t("form-components.editors.fill.bins"),stackLayoutModel:e,columns:this._settings.bins.items});return n(i).call(i,"selectItem",function(t){this.model.set("bins",t.get("val")),e.goToStep(1)},this),n(i).call(i,"back",function(t){e.goToStep(1)},this),i},_onClickBack:function _onClickBack(e){this.killEvent(e)},clean:function clean(){this.timeoutId&&clearTimeout(this.timeoutId),l.prototype.clean.apply(this)}})},2966:function(e,t,i){var s=i(3),n=i(6),o=i(4);e.exports=o.extend({render:function render(){return this.clearSubViews(),this._removeForm(),this.$el.empty(),this._initForm(),this},_initForm:function _initForm(){var e,t;this._formModel=new n.Model({value:this.model.get("fixed")}),this._formModel.schema={value:{type:"Number",title:"",validators:["required",{type:"interval",min:this.options.min,max:this.options.max,step:this.options.step}]}},s(e=this._formModel).call(e,"change",function(e){this.model.set("fixed",e.get("value"))},this),this._formView=new n.Form({model:this._formModel}),s(t=this._formView).call(t,"change",function(){this.commit()}),this.$el.append(this._formView.render().$el)},_removeForm:function _removeForm(){this._formView&&this._formView.remove()},clean:function clean(){this._removeForm(),o.prototype.clean.call(this)}})},2967:function(e,t,i){i(31);var s=i(3);i(31);var n=i(1),o=i(6),a=i(556),r=i(1552),l=i(186),c=i(2966),h=i(2965),d=i(174);o.Form.editors.Size=o.Form.editors.Base.extend({className:"Form-InputSize CDB-Text",events:{focus:function focus(){this.trigger("focus",this)},blur:function blur(){this.trigger("blur",this)}},initialize:function initialize(e){o.Form.editors.Base.prototype.initialize.call(this,e),l.setOptions(this,e),this._sizeModel=new o.Model(this.model.get(e.key)),this._initBinds(),this._initViews()},_initBinds:function _initBinds(){this._updateSizeModelOnChangeBind(),this.applyESCBind(this._removeDialogs),this.applyClickOutsideBind(this._removeDialogs)},_updateSizeModelOnChangeBind:function _updateSizeModelOnChangeBind(){var e,t=this;s(e=this._sizeModel).call(e,"change",function(){t.model.set(t.key,t._sizeModel.toJSON())},this)},_removeDialogs:function _removeDialogs(){this._valueView&&this._valueView.removeDialog()},_removePopupManagers:function _removePopupManagers(){this._valueView&&this._valueView.removePopupManager()},_initViews:function _initViews(){this._tabPaneTabs=this._getTabPanes(),this._setSelectedTab(),this._tabPaneView=r(this._tabPaneTabs,this._getTabPaneOptions()),this.listenTo(this._tabPaneView.collection,"change:selected",this._onChangeTabPaneViewTab),this.$el.append(this._tabPaneView.render().$el)},_getTabPanes:function _getTabPanes(){var e=[],t=this.options.editorAttrs;return t&&t.hidePanes?(n.contains(t.hidePanes,d.Panes.FIXED)||e.push(this._buildFixedPane()),n.contains(t.hidePanes,d.Panes.BY_VALUE)||e.push(this._buildByValuePane())):e=[this._buildFixedPane(),this._buildByValuePane()],e},_setSelectedTab:function _setSelectedTab(){var e=this._getSelectedTabPaneIndex();this._tabPaneTabs[e].selected=!0},_getTabPaneOptions:function _getTabPaneOptions(){return{tabPaneOptions:{template:a,tabPaneItemOptions:{tagName:"li",klassName:"CDB-NavMenu-item"}},tabPaneItemLabelOptions:{tagName:"div",className:"CDB-Text CDB-Size-medium"}}},_buildFixedPane:function _buildFixedPane(){var e=this,t=this.options.editorAttrs.geometryName;return{name:d.Panes.FIXED,label:_t("form-components.editors.fill.input-number.fixed"),tooltip:_t("editor.style.tooltips.size.fixed-tab",{type:t}),tooltipGravity:"s",createContentView:function createContentView(){return e._generateFixedContentView()}}},_buildByValuePane:function _buildByValuePane(){var e=this,t=this.options.editorAttrs.geometryName;return{name:d.Panes.BY_VALUE,label:_t("form-components.editors.fill.input-number.by-value"),tooltip:_t("editor.style.tooltips.size.by-value-tab",{type:t}),tooltipGravity:"s",createContentView:function createContentView(){return e._generateByValueContentView()}}},_getSelectedTabPaneIndex:function _getSelectedTabPaneIndex(){var e=this._sizeModel.get("range"),t=this._tabPaneTabs.length>1;return e&&t?1:0},_onChangeTabPaneViewTab:function _onChangeTabPaneViewTab(){var e=this._tabPaneView.getSelectedTabPaneName();e===d.Panes.FIXED?this._updateFixedValue():this._updateRangeValue(),this.trigger("change",e,this)},_updateFixedValue:function _updateFixedValue(){var e=this._sizeModel.get("range");if(e){var t=.5*(+e[0]+ +e[1]);this._sizeModel.set("fixed",t),this._sizeModel.unset("range")}},_updateRangeValue:function _updateRangeValue(){var e=this._sizeModel.get("fixed");if(null!==e&&!n.isUndefined(e)&&this._sizeModel.get("attribute")){var t=this.options.editorAttrs,i=t&&t.defaultRange||[e,e];this._sizeModel.set("range",i),this._sizeModel.unset("fixed")}},_generateFixedContentView:function _generateFixedContentView(){var e=this.options.editorAttrs;return this._fixedView=new c({model:this._sizeModel,min:e&&e.min||d.Size.DefaultInput100.MIN,max:e&&e.max||d.Size.DefaultInput100.MAX,step:e&&e.step||d.Size.DefaultInput100.STEP}),this._fixedView},_generateByValueContentView:function _generateByValueContentView(){var e=this.options.editorAttrs;return this._valueView=new h({model:this._sizeModel,columns:this.schema.options,min:e&&e.min||d.Size.DefaultInput100.MIN,max:e&&e.max||d.Size.DefaultInput100.MAX,popupConfig:{cid:this.cid,$el:this.$el,mode:this.options.dialogMode}}),this._valueView},focus:function focus(){this.hasFocus||this.$(".js-menu").focus()},blur:function blur(){this.hasFocus&&this.$(".js-menu").blur()},getValue:function getValue(){return this._sizeModel.toJSON()},remove:function remove(){this._removeDialogs(),this._removePopupManagers(),this._tabPaneView.clean(),this._valueView&&this._valueView.clean(),this._fixedView&&this._fixedView.clean(),o.Form.editors.Base.prototype.remove.apply(this)},clean:function clean(){this.$el.remove()}})},2968:function(e,t,i){var s=i(4),n=i(758);e.exports=s.extend({className:"Label",initialize:function initialize(){if(!this.model)throw new Error("A model should be provided");this.model.on("change:label",this.render,this),this.model.on("change:selected",this.render,this)},render:function render(){return this.$el.html(n({customId:this.model.cid+this.model.get("name"),label:this.model.get("label"),name:this.model.get("name"),help:this.model.get("help")||"",selected:this.model.get("selected"),selectedChild:this.model.get("selectedChild")||""})),this}})},2969:function(e,t,i){i(37);var s=i(28),n=i(3),o=i(13),a=i(76),r=i(1),l=i(18),c=i(4),h=i(1556),d=i(58),u=i(759),p=i(174),g=i(59),m=i(14),f=["columns","query","configModel","userModel","modals"];e.exports=c.extend({tagName:"li",className:"CDB-OptionInput-item",events:{click:"_onClick"},initialize:function initialize(e){if(this.options.editorAttrs&&(this._editorAttrs=this.options.editorAttrs,this._help=this._editorAttrs.help,this._imageEnabled=this._editorAttrs.imageEnabled,this._hideNumericColumns=this.options.hideNumericColumns,this._removeByValueCategory=this.options.removeByValueCategory,this._editorAttrs.hidePanes&&!r.contains(this._editorAttrs.hidePanes,p.Panes.BY_VALUE))){if(!e.configModel)throw new Error("configModel param is required");if(!e.userModel)throw new Error("userModel param is required");if(!e.modals)throw new Error("modals param is required");if(!e.query)throw new Error("query param is required")}if(!e.columns)throw new Error("columns is required");m(e,f,this),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this.$el.toggleClass("is-disabled",this.options.disabled),this.$el.html(u({value:this._getValue(),attribute:this.model.get("attribute"),opacity:this._getOpacity(),colorBar:this._getColorbar(),help:this._help.color||""})),this._initViews(),this},afterRender:function afterRender(){this._openPopupForColumn()},_openPopupForColumn:function _openPopupForColumn(){var e=this.model.get("attribute");if(r.isUndefined(e)){var t=this;a(function(){t.$el.click()},200)}},_getColorbar:function _getColorbar(){var e=this._getValue();if(!r.isArray(e))return"";var t=100/e.length,i=0,s=this;return"background: linear-gradient(90deg, "+o(e).call(e,function(e){var n=i,o=i+t,a=s._getColorStep(e,[n,o]);return i=o,a}).join(", ")+")"},_getColorStep:function _getColorStep(e,t){return e+" "+t[0]+"%, "+e+" "+t[1]+"%"},_initViews:function _initViews(){if(this._help.color){var e=new d({el:this.$(".js-help"),gravity:"w",title:function title(){return l(this).data("tooltip")},offset:8});this.addView(e)}},_initBinds:function _initBinds(){var e,t=this;n(e=this.model.set("createContentView",function(){return t._createContentView()})).call(e,this),this.model.on("change:selected",this._onToggleSelected,this),this.model.on("change:opacity change:range change:attribute",this.render,this)},_getColumn:function _getColumn(){return s(r).call(r,this._columns,function(e){return e.label===this.model.get("attribute")},this)},_iconStylingEnabled:function _iconStylingEnabled(){return this._imageEnabled},_createContentView:function _createContentView(){return this._inputColorValueContentView=new h({model:this.model,columns:this._columns,hideNumericColumns:this._hideNumericColumns,removeByValueCategory:this._removeByValueCategory,configModel:this._configModel,categorizeColumns:this._categorizeColumns,imageEnabled:this._imageEnabled,userModel:this._userModel,modals:this._modals,hideTabs:this._hideTabs,query:this._query}),this.model.on("change",this._onChangeValue,this),this._inputColorValueContentView},_onClick:function _onClick(){this.options.disabled||this.trigger("click",this.model)},_getValue:function _getValue(){return this.model.get("range")&&this.model.get("range").length?this._getRangeColorValues():null},_getRangeColorValues:function _getRangeColorValues(){return o(r).call(r,this.model.get("range"),function(e){return g.hexToRGBA(e,this._getOpacity())},this)},_getOpacity:function _getOpacity(){return null!=this.model.get("opacity")?this.model.get("opacity"):1},_onToggleSelected:function _onToggleSelected(){this.$el.toggleClass("is-active",this.model.get("selected"))},_onChangeValue:function _onChangeValue(e){this.model.set({quantification:e.get("quantification"),range:e.get("range")})}})},2970:function(e,t,i){var s=i(3),n=i(1553),o=i(2969),a=i(174),r=i(14),l=["columns","query","configModel","userModel","editorAttrs","modals","dialogMode","valueColorInputModel","popupConfig"];e.exports=n.extend({initialize:function initialize(e){r(e,l,this),this._initViews()},_initInputFields:function _initInputFields(){n.prototype._initInputFields.call(this),this._initColorByValueInput()},_initColorByValueInput:function _initColorByValueInput(){var e,t=this._valueColorInputModel.get("quantification");t&&a.Quantification.REFERENCE[t]&&this._valueColorInputModel.set("quantification",a.Quantification.REFERENCE[t],{silent:!0}),this._valueColorInputView=new o({model:this._valueColorInputModel,columns:this.options.columns,hideNumericColumns:this.options.hideNumericColumns,removeByValueCategory:this.options.removeByValueCategory,query:this.options.query,configModel:this.options.configModel,userModel:this.options.userModel,modals:this.options.modals,imageEnabled:this.options.imageEnabled,editorAttrs:this.options.editorAttrs?this.options.editorAttrs:{},disabled:this.options.editorAttrs&&this.options.editorAttrs.disabled}),s(e=this._valueColorInputView).call(e,"click",this._onInputClick,this),this.$(".js-content").append(this._valueColorInputView.render().$el),this._inputCollection&&this._inputCollection.push(this._valueColorInputModel)},afterRender:function afterRender(){this._valueColorInputView&&this._valueColorInputView.afterRender()}})},2971:function(e,t,i){var s=i(56),n=i(3),o=i(1),a=i(18),r=i(4),l=i(760),c=i(555),h=i(1055),d=i(58),u=i(59);e.exports=r.extend({tagName:"li",className:"CDB-OptionInput-item",events:{click:"_onClick"},initialize:function initialize(e){this.options.editorAttrs&&(this._editorAttrs=this.options.editorAttrs,this._help=this._editorAttrs.help),this._imageEnabled=!0,this._columns=e.columns,this._configModel=e.configModel,this._userModel=e.userModel,this._modals=e.modals,this._query=e.query,this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this.$el.html(l({help:this._help.image||"",image:this.model.get("image"),isCustomMarker:"custom-marker"===this.model.get("kind")})),this._initViews(),this},_initViews:function _initViews(){if(this.iconView=new c({imageClass:"Editor-fillImageAsset",imageUrl:this._getImageURL(),color:this._getColor()}),this.addView(this.iconView),this.$(".js-image-container").append(this.iconView.render().el),this._help.image){var e=new d({el:this.$(".js-help"),gravity:"w",title:function title(){return a(this).data("tooltip")},offset:8});this.addView(e)}},_initBinds:function _initBinds(){var e,t=this;n(e=this.model.set("createContentView",function(){return t._createContentView()})).call(e,this),this.model.on("change:images change:image",this.render,this),this.model.on("change:opacity change:fixed",this._updateImageColor,this)},_categoryImagesPresent:function _categoryImagesPresent(){var e=this.model.get("images");return s(e).call(e,function(e){if(!o.isEmpty(e))return!0}),!1},_updateImageColor:function _updateImageColor(){this.iconView&&this.iconView.updateImageColor(this._getColor())},_getColor:function _getColor(){var e=this.model.get("fixed");return e?u.hexToRGBA(e,this._getOpacity()):e},_getOpacity:function _getOpacity(){return null!=this.model.get("opacity")?this.model.get("opacity"):1},_onClick:function _onClick(){this.options.disabled||this.trigger("click",this.model)},_onChangeFile:function _onChangeFile(e){var t,i;e?(t=e.kind,i=e.url):(t=null,i=null),this.model.set({kind:t,image:i})},_createContentView:function _createContentView(){return this._inputColorFileView=new h({model:this.model,userModel:this._userModel,configModel:this._configModel,modals:this._modals}),this._initInputColorFileViewBindings(),this._inputColorFileView},_initInputColorFileViewBindings:function _initInputColorFileViewBindings(){var e;this._inputColorFileView&&(n(e=this._inputColorFileView).call(e,"change",this._onChangeFile,this),this._inputColorFileView.on("onClean",function(){this._inputColorFileView.unbind("change",this._onChangeFile,this)},this))},_getImageURL:function _getImageURL(){return this.model.get("image")&&this._isIconStylingEnabled()?this.model.get("image"):""},_getKind:function _getKind(){return this.model.get("kind")&&this._isIconStylingEnabled()?this.model.get("kind"):""},_isIconStylingEnabled:function _isIconStylingEnabled(){return this._imageEnabled}})},2972:function(e,t,i){var s=i(28),n=i(3),o=i(1),a=i(18),r=i(4),l=i(789),c=i(58),h=i(761),d=i(59);e.exports=r.extend({tagName:"li",className:"CDB-OptionInput-item",events:{click:"_onClick"},initialize:function initialize(e){if(this.options.editorAttrs&&(this._editorAttrs=this.options.editorAttrs,this._help=this._editorAttrs.help),!e.columns)throw new Error("columns is required");this._columns=e.columns,this._configModel=e.configModel,this._userModel=e.userModel,this._modals=e.modals,this._query=e.query,this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this.$el.toggleClass("is-disabled",this.options.disabled),this.$el.html(h({value:this._getValue(),opacity:this._getOpacity(),help:this._help&&this._help.color||null})),this._initViews(),this},_initViews:function _initViews(){if(this._help&&this._help.color){var e=new c({el:this.$(".js-help"),gravity:"w",title:function title(){return a(this).data("tooltip")},offset:8});this.addView(e)}},_initBinds:function _initBinds(){var e,t=this;n(e=this.model.set("createContentView",function(){return t._createContentView()})).call(e,this),this.model.on("change:selected",this._onToggleSelected,this),this.model.on("change:opacity change:fixed",this.render,this)},_getColumn:function _getColumn(){return s(o).call(o,this._columns,function(e){return e.label===this.model.get("attribute")},this)},_createContentView:function _createContentView(){return this._colorPickerView=new l({value:this.model.get("fixed"),opacity:this.model.get("opacity"),disableOpacity:this._disableOpacity||!1}),this._initColorPickerViewBindings(),this._colorPickerView},_initColorPickerViewBindings:function _initColorPickerViewBindings(){var e;this._colorPickerView&&(n(e=this._colorPickerView).call(e,"change",this._onChangeValue,this),this._colorPickerView.on("onClean",function(){this._colorPickerView.unbind("change",this._onChangeValue,this)},this))},_onClick:function _onClick(){this.options.disabled||this.trigger("click",this.model)},_getValue:function _getValue(){var e=this.model.get("fixed");return e?d.hexToRGBA(e,this._getOpacity()):e},_getOpacity:function _getOpacity(){return null!=this.model.get("opacity")?this.model.get("opacity"):1},_onToggleSelected:function _onToggleSelected(){this.$el.toggleClass("is-active",this.model.get("selected"))},_onChangeValue:function _onChangeValue(e){this.model.set({fixed:e.hex,opacity:e.opacity})}})},2973:function(e,t,i){var s=i(28),n=i(3),o=i(32),a=i(6),r=i(1),l=["color","image"];e.exports=a.Collection.extend({constructor:function constructor(e,t){t=r.extend(t||{},{silent:!1}),a.Collection.prototype.constructor.call(this,e,t)},comparator:function comparator(e){return o(l).call(l,e.get("type"))},initialize:function initialize(){var e,t;n(e=this).call(e,"change",this._onModelsChanged,this),n(t=this).call(t,"change:selected",this._onSelectedChange,this)},getSelected:function getSelected(){var e;return s(e=this).call(e,function(e){return e.get("selected")})},unselect:function unselect(){this.each(function(e){e.set("selected",!1)},this)},_onSelectedChange:function _onSelectedChange(e,t){t&&this.each(function(t){t!==e&&t.set("selected",!1)},this)},_onModelsChanged:function _onModelsChanged(e){var t=e.changed;r.isEmpty(t)||1===r.size(t)&&e.changed.hasOwnProperty("selected")||this.trigger("onInputChanged",e)}})},2974:function(e,t,i){var s=i(3),n=i(1553),o=i(2972),a=i(2971),r=i(14),l=["columns","editorAttrs","dialogMode","popupConfig","fixedColorInputModel","imageInputModel"];e.exports=n.extend({initialize:function initialize(e){r(e,l,this),this._editorAttrs.imageEnabled&&(this._configModel=this.options.configModel,this._userModel=this.options.userModel,this._modals=this.options.modals),this._initViews()},_initInputFields:function _initInputFields(){n.prototype._initInputFields.call(this),this._initFillColorInput(),this._initFillImageInput()},_initFillColorInput:function _initFillColorInput(){var e;this._fillInputColorView=new o({model:this._fixedColorInputModel,columns:this._columns,configModel:this._configModel,userModel:this._userModel,modals:this._modals,editorAttrs:this._editorAttrs||{},disabled:this._editorAttrs&&this._editorAttrs.disabled}),s(e=this._fillInputColorView).call(e,"click",this._onInputClick,this),this.$(".js-content").append(this._fillInputColorView.render().$el),this._inputCollection&&this._inputCollection.push(this._fixedColorInputModel)},_initFillImageInput:function _initFillImageInput(){var e;this._editorAttrs.imageEnabled&&(this._fillInputImageView=new a({model:this._imageInputModel,columns:this._columns,configModel:this._configModel,userModel:this._userModel,modals:this._modals,query:this._query,editorAttrs:this._editorAttrs||{},disabled:this._editorAttrs&&this._editorAttrs.disabled}),s(e=this._fillInputImageView).call(e,"click",this._onInputClick,this),this.$(".js-content").append(this._fillInputImageView.render().$el),this._inputCollection&&this._inputCollection.push(this._imageInputModel))},_unbindFormInputs:function _unbindFormInputs(){this._fillInputColorView.unbind("click",this._onInputClick,this),this._fillInputImageView&&this._fillInputImageView.unbind("click",this._onInputClick,this),this._inputCollection.unbind("onInputChanged",this._onInputChanged,this)},clean:function clean(){this._unbindFormInputs(),n.prototype.clean.call(this)}})},2975:function(e,t,i){i(247),i(31),i(31);var s=i(1),n=i(6),o=i(186),a=i(2974),r=i(2970),l=i(71),c=i(174),h=i(556),d=i(1552);n.Form.editors.FillColor=n.Form.editors.Base.extend({className:"Form-InputFill Editor-formInput--FillColor",initialize:function initialize(e){n.Form.editors.Base.prototype.initialize.call(this,e),o.setOptions(this,e),this.options.editorAttrs&&(this.options=s.extend(this.options,{columns:this.options.options,query:this.options.query,configModel:this.options.configModel,userModel:this.options.userModel,editorAttrs:this.options.editorAttrs,modals:this.options.modals}),this._colorKeyAttribute=e.key,this._colorAttributes=this.model.get(this._colorKeyAttribute),this._sizeAttributes=this.model.get("fillSize"),this._imageInputModel=new n.Model(s.extend({type:"image"},this._colorAttributes)),this._fixedColorInputModel=new n.Model(s.extend({type:"color"},this._colorAttributes)),this._valueColorInputModel=new n.Model(s.extend({type:"color"},this._colorAttributes))),this._initViews()},_initViews:function _initViews(){var e=this,t=this.options.editorAttrs.geometryName,i={name:c.Panes.FIXED,label:_t("form-components.editors.fill.input-number.solid"),tooltip:_t("editor.style.tooltips.fill.fixed-tab",{type:t}),tooltipGravity:"s",createContentView:function createContentView(){return e._generateFixedContentView()}},n={name:c.Panes.BY_VALUE,label:_t("form-components.editors.fill.input-number.by-value"),tooltip:_t("editor.style.tooltips.fill.by-value-tab",{type:t}),tooltipGravity:"s",createContentView:function createContentView(){return e._generateValueContentView()}};if(this._tabPaneTabs=[],this.options.editorAttrs&&this.options.editorAttrs.hidePanes){var o=this.options.editorAttrs.hidePanes;s.contains(o,c.Panes.FIXED)||this._tabPaneTabs.push(i),s.contains(o,c.Panes.BY_VALUE)||this._tabPaneTabs.push(n)}else this._tabPaneTabs=[i,n];var a={tabPaneOptions:{template:h,tabPaneItemOptions:{tagName:"li",klassName:"CDB-NavMenu-item"}},tabPaneItemLabelOptions:{tagName:"div",className:"CDB-Text CDB-Size-medium"}},r=this._getSelectedTabPaneIndex();this._tabPaneTabs[r].selected=!0,this._tabPaneView=d(this._tabPaneTabs,a),this.$el.append(this._tabPaneView.render().$el)},_getSelectedTabPaneIndex:function _getSelectedTabPaneIndex(){return this._colorAttributes&&this._colorAttributes.range&&this._tabPaneTabs.length>1?1:0},_removeDialogs:function _removeDialogs(){this._removeFillColorFixedDialog(),this._removeFillColorByValueDialog()},_removeFillColorFixedDialog:function _removeFillColorFixedDialog(){this._fillColorFixedView&&this._fillColorFixedView.removeDialog()},_removeFillColorByValueDialog:function _removeFillColorByValueDialog(){this._fillColorByValueView&&this._fillColorByValueView.removeDialog()},_generateFixedContentView:function _generateFixedContentView(){return this._fillColorFixedView=new a({model:this.model,columns:this.options.columns,configModel:this.options.configModel,userModel:this.options.userModel,modals:this.options.modals,query:this.options.query,editorAttrs:this.options.editorAttrs,dialogMode:l.Mode.FLOAT,hideTabs:this.options.hideTabs,fixedColorInputModel:this._fixedColorInputModel,imageInputModel:this._imageInputModel,popupConfig:{cid:this.cid,$el:this.$el}}),this.applyESCBind(this._removeFillColorFixedDialog),this.applyClickOutsideBind(this._removeFillColorFixedDialog),this._fillColorFixedView.on("onInputChanged",function(e){this.trigger("change",e)},this),this._fillColorFixedView},_generateValueContentView:function _generateValueContentView(){return this._fillColorByValueView=new r({columns:this.options.columns,query:this.options.query,configModel:this.options.configModel,userModel:this.options.userModel,editorAttrs:this.options.editorAttrs,model:this.model,dialogMode:l.Mode.FLOAT,categorizeColumns:this.options.categorizeColumns,hideNumericColumns:this.options.hideNumericColumns,removeByValueCategory:this.options.removeByValueCategory,modals:this.options.modals,hideTabs:this.options.hideTabs,valueColorInputModel:this._valueColorInputModel,popupConfig:{cid:this.cid,$el:this.$el}}),this.applyESCBind(this._removeFillColorByValueDialog),this.applyClickOutsideBind(this._removeFillColorByValueDialog),this._fillColorByValueView.on("onInputChanged",function(e){this.trigger("change",e)},this),this._fillColorByValueView},getValue:function getValue(e){return this._tabPaneView.getSelectedTabPaneName()===c.Panes.FIXED?this._getFillFixedValues():this._getFillByValueValues()},_getFillFixedValues:function _getFillFixedValues(){var e=this._fixedColorInputModel.toJSON(),t=this._imageInputModel.toJSON();e.range&&(e.fixed=e.range[0],e.opacity=1);var i=s.omit(e,["createContentView","selected","type","image","marker","range"]),n=s.omit(t,["createContentView","selected","type","fixed","range"]),o=s.extend({},n,i);return this._fixedColorInputModel.set(o),this._imageInputModel.set(o),o},_getFillByValueValues:function _getFillByValueValues(){var e=s.omit(this._valueColorInputModel.toJSON(),["createContentView","selected","type"]);return this._valueColorInputModel.set(e),e},remove:function remove(){this._removeDialogs(),this._tabPaneView.clean(),this._fillColorByValueView&&this._fillColorByValueView.clean(),this._fillColorFixedView&&this._fillColorFixedView.clean(),n.Form.editors.Base.prototype.remove.apply(this)}})},2976:function(e,t){e.exports={green:{3:["#E5F5F9","#99D8C9","#2CA25F"],4:["#EDF8FB","#B2E2E2","#66C2A4","#238B45"],5:["#EDF8FB","#B2E2E2","#66C2A4","#2CA25F","#006D2C"],6:["#EDF8FB","#CCECE6","#99D8C9","#66C2A4","#2CA25F","#006D2C"],7:["#EDF8FB","#D7FAF4","#CCECE6","#66C2A4","#41AE76","#238B45","#005824"]},blue:{3:["#EDF8B1","#7FCDBB","#2C7FB8"],4:["#FFFFCC","#A1DAB4","#41B6C4","#225EA8"],5:["#FFFFCC","#A1DAB4","#41B6C4","#2C7FB8","#253494"],6:["#FFFFCC","#C7E9B4","#7FCDBB","#41B6C4","#2C7FB8","#253494"],7:["#FFFFCC","#C7E9B4","#7FCDBB","#41B6C4","#1D91C0","#225EA8","#0C2C84"]},pink:{3:["#E7E1EF","#C994C7","#DD1C77"],4:["#F1EEF6","#D7B5D8","#DF65B0","#CE1256"],5:["#F1EEF6","#D7B5D8","#DF65B0","#DD1C77","#980043"],6:["#F1EEF6","#D4B9DA","#C994C7","#DF65B0","#DD1C77","#980043"],7:["#F1EEF6","#D4B9DA","#C994C7","#DF65B0","#E7298A","#CE1256","#91003F"]},black:{3:["#F0F0F0","#BDBDBD","#636363"],4:["#F7F7F7","#CCCCCC","#969696","#525252"],5:["#F7F7F7","#CCCCCC","#969696","#636363","#252525"],6:["#F7F7F7","#D9D9D9","#BDBDBD","#969696","#636363","#252525"],7:["#F7F7F7","#D9D9D9","#BDBDBD","#969696","#737373","#525252","#252525"]},red:{3:["#FFEDA0","#FEB24C","#F03B20"],4:["#FFFFB2","#FECC5C","#FD8D3C","#E31A1C"],5:["#FFFFB2","#FECC5C","#FD8D3C","#F03B20","#BD0026"],6:["#FFFFB2","#FED976","#FEB24C","#FD8D3C","#F03B20","#BD0026"],7:["#FFFFB2","#FED976","#FEB24C","#FD8D3C","#FC4E2A","#E31A1C","#B10026"]},inverted_green:{3:["#2CA25F","#99D8C9","#E5F5F9"],4:["#238B45","#66C2A4","#B2E2E2","#EDF8FB"],5:["#006D2C","#2CA25F","#66C2A4","#B2E2E2","#EDF8FB"],6:["#006D2C","#2CA25F","#66C2A4","#99D8C9","#CCECE6","#EDF8FB"],7:["#005824","#238B45","#41AE76","#66C2A4","#CCECE6","#D7FAF4","#EDF8FB"]},inverted_blue:{3:["#2C7FB8","#7FCDBB","#EDF8B1"],4:["#225EA8","#41B6C4","#A1DAB4","#FFFFCC"],5:["#253494","#2C7FB8","#41B6C4","#A1DAB4","#FFFFCC"],6:["#253494","#2C7FB8","#41B6C4","#7FCDBB","#C7E9B4","#FFFFCC"],7:["#0C2C84","#225EA8","#1D91C0","#41B6C4","#7FCDBB","#C7E9B4","#FFFFCC"]},inverted_pink:{3:["#DD1C77","#C994C7","#E7E1EF"],4:["#CE1256","#DF65B0","#D7B5D8","#F1EEF6"],5:["#980043","#DD1C77","#DF65B0","#D7B5D8","#F1EEF6"],6:["#980043","#DD1C77","#DF65B0","#C994C7","#D4B9DA","#F1EEF6"],7:["#91003F","#CE1256","#E7298A","#DF65B0","#C994C7","#D4B9DA","#F1EEF6"]},inverted_black:{3:["#636363","#BDBDBD","#F0F0F0"],4:["#525252","#969696","#CCCCCC","#F7F7F7"],5:["#252525","#636363","#969696","#CCCCCC","#F7F7F7"],6:["#252525","#636363","#969696","#BDBDBD","#D9D9D9","#F7F7F7"],7:["#252525","#525252","#737373","#969696","#BDBDBD","#D9D9D9","#F7F7F7"]},inverted_red:{3:["#F03B20","#FEB24C","#FFEDA0"],4:["#E31A1C","#FD8D3C","#FECC5C","#FFFFB2"],5:["#BD0026","#F03B20","#FD8D3C","#FECC5C","#FFFFB2"],6:["#BD0026","#F03B20","#FD8D3C","#FEB24C","#FED976","#FFFFB2"],7:["#B10026","#E31A1C","#FC4E2A","#FD8D3C","#FEB24C","#FED976","#FFFFB2"]},spectrum1:{3:["#1a9850","#fff2cc","#d73027"],4:["#1a9850","#d2ecb4","#fed6b0","#d73027"],5:["#1a9850","#8cce8a","#fff2cc","#f79272","#d73027"],6:["#1a9850","#8cce8a","#d2ecb4","#fed6b0","#f79272","#d73027"],7:["#1a9850","#8cce8a","#d2ecb4","#fff2cc","#fed6b0","#f79272","#d73027"]},spectrum2:{3:["#0080ff","#fff2cc","#ff4d4d"],4:["#0080ff","#7fbfff","#ffa6a6","#ff4d4d"],5:["#0080ff","#40a0ff","#fff2cc","#ff7a7a","#ff4d4d"],6:["#0080ff","#40a0ff","#7fbfff","#ffa6a6","#ff7a7a","#ff4d4d"],7:["#0080ff","#40a0ff","#7fbfff","#fff2cc","#ffa6a6","#ff7a7a","#ff4d4d"]},purple_states:{3:["#F1E6F1","#B379B3","#8A4E8A"],4:["#F1E6F1","#D8BBD8","#A05AA0","#8A4E8A"],5:["#F1E6F1","#D8BBD8","#B379B3","#A05AA0","#8A4E8A"],6:["#F1E6F1","#D8BBD8","#CCA5CC","#B379B3","#A05AA0","#8A4E8A"],7:["#F1E6F1","#D8BBD8","#CCA5CC","#C08FC0","#B379B3","#A05AA0","#8A4E8A"]},red_states:{3:["#F2D2D3","#D4686C","#C1373C"],4:["#F2D2D3","#EBB7B9","#CC4E52","#C1373C"],5:["#F2D2D3","#EBB7B9","#D4686C","#CC4E52","#C1373C"],6:["#F2D2D3","#EBB7B9","#E39D9F","#D4686C","#CC4E52","#C1373C"],7:["#F2D2D3","#EBB7B9","#E39D9F","#DB8286","#D4686C","#CC4E52","#C1373C"]},blue_states:{3:["#ECF0F6","#6182B5","#43618F"],4:["#ECF0F6","#B2C2DB","#4E71A6","#43618F"],5:["#ECF0F6","#B2C2DB","#6182B5","#4E71A6","#43618F"],6:["#ECF0F6","#B2C2DB","#9BB0D0","#6182B5","#4E71A6","#43618F"],7:["#ECF0F6","#B2C2DB","#9BB0D0","#849EC5","#6182B5","#4E71A6","#43618F"]},inverted_purple_states:{3:["#8A4E8A","#B379B3","#F1E6F1"],4:["#8A4E8A","#A05AA0","#D8BBD8","#F1E6F1"],5:["#8A4E8A","#A05AA0","#B379B3","#D8BBD8","#F1E6F1"],6:["#8A4E8A","#A05AA0","#B379B3","#CCA5CC","#D8BBD8","#F1E6F1"],7:["#8A4E8A","#A05AA0","#B379B3","#C08FC0","#CCA5CC","#D8BBD8","#F1E6F1"]},inverted_red_states:{3:["#C1373C","#D4686C","#F2D2D3"],4:["#C1373C","#CC4E52","#EBB7B9","#F2D2D3"],5:["#C1373C","#CC4E52","#D4686C","#EBB7B9","#F2D2D3"],6:["#C1373C","#CC4E52","#D4686C","#E39D9F","#EBB7B9","#F2D2D3"],7:["#C1373C","#CC4E52","#D4686C","#DB8286","#E39D9F","#EBB7B9","#F2D2D3"]},inverted_blue_states:{3:["#43618F","#6182B5","#ECF0F6"],4:["#43618F","#4E71A6","#B2C2DB","#ECF0F6"],5:["#43618F","#4E71A6","#6182B5","#B2C2DB","#ECF0F6"],6:["#43618F","#4E71A6","#6182B5","#9BB0D0","#B2C2DB","#ECF0F6"],7:["#43618F","#4E71A6","#6182B5","#849EC5","#9BB0D0","#B2C2DB","#ECF0F6"]}}},2977:function(e,t,i){var s=i(6),n=i(1);e.exports=s.Model.extend({defaults:{eventName:"",eventProperties:{}},url:function url(){return this._configModel.get("base_url")+"/api/v3/metrics"},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");this._userId=t.userId,this._visId=t.visId,this._configModel=t.configModel},toJSON:function toJSON(){return{name:this.get("eventName"),properties:n.extend({},this.get("eventProperties"),{visualization_id:this._visId,user_id:this._userId})}}})},2978:function(e,t,i){var s=i(3),n=i(816);e.exports=n.extend({module:"components:form-components:editors:fill:input-color:input-qualitative-ramps:categories-list:list-view:categories-custom-list-view",_renderItem:function _renderItem(e,t){var i=this.options.itemView,n=this.options.imageEnabled&&t<this.options.maxValues,o=new i({model:e,typeLabel:this.options.typeLabel,template:this.options.itemTemplate,imageEnabled:n});this.$(".js-list").append(o.render().el),this.addView(o),s(o).call(o,"customEvent",function(e,t){this.trigger("customEvent",e,t,this)},this)}})},2979:function(e,t,i){var s=i(1),n=i(18),o=i(555),a=i(453);e.exports=a.extend({module:"components:form-components:editors:fill:input-color:input-qualitative-ramps:categories-list:list-item-view:categories-list-item-view",render:function render(){this.clearSubViews(),this.$el.empty();var e=null==this.model.getName()?"null":this.model.getName();return this.$el.append(this.options.template(s.extend({typeLabel:this.options.typeLabel,isSelected:this.model.get("selected"),isDisabled:this.model.get("disabled"),isDestructive:this.model.get("destructive"),name:e,val:this.model.getValue(),options:this.model.get("renderOptions"),image:this.model.get("image"),imageEnabled:this.options.imageEnabled}))),this._loadImages(),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")),this},_loadImages:function _loadImages(){this.iconView=new o({imageClass:"CDB-Text u-actionTextColor js-assetPicker",imageUrl:this.model.get("image"),color:this.model.get("val")}),this.addView(this.iconView),this.$(".js-image-container").append(this.iconView.render().el)},_onClick:function _onClick(e){this.killEvent(e);var t=n(e.target),i=t.closest(".js-image-container").length>0,s=t.closest(".js-assetPicker").length>0;this.model.set({selectedClass:s||i?["js-assetPicker"]:[],selected:!0})}})},2980:function(e,t,i){var s=i(3),n=i(396),o=i(452),a=i(2979),r=i(2978);e.exports=n.extend({module:"components:form-components:editors:fill:input-color:input-qualitative-ramps:categories-list:list-view:categories-list-view",options:{showSearch:!0,allowFreeTextInput:!1,typeLabel:"column",itemTemplate:o,itemView:a},_renderList:function _renderList(){var e;this._listView=new r({model:this.model,allowFreeTextInput:this.options.allowFreeTextInput,collection:this.collection,typeLabel:this.options.typeLabel,itemView:this.options.itemView,itemTemplate:this.options.itemTemplate,size:this.options.size,maxValues:this.options.maxValues,imageEnabled:this.options.imageEnabled}),this.$el.append(this._listView.render().el),this._listView.highlight(),this.addView(this._listView),s(e=this._listView).call(e,"customEvent",function(e,t){this.trigger(e,t,this)},this)}})},2981:function(e,t,i){var s=i(32),n=i(13),o=i(1),a=i(18),r=i(4),l=i(59),c=i(2980),h=i(198),d=i(763),u=i(762);e.exports=r.extend({module:"components:form-components:editors:fill:input-color:input-qualitative-ramps:categories-list:list-view:input-categories-list-view",events:{"click .js-color":"_onClickColor","click .js-back":"_onClickBack"},initialize:function initialize(e){this._showSearch=e.showSearch||!1,this._typeLabel=e.typeLabel,this._maxValues=e.maxValues,this._requiredNumberOfColors=e.requiredNumberOfColors},render:function render(){return this.clearSubViews(),this.$el.empty(),this.$el.append(d({range:this.model.get("range"),attribute:this.model.get("attribute"),requiredNumberOfColors:this._requiredNumberOfColors})),this._setupCollection(),this._initBinds(),this._listView=new c({itemTemplate:u,collection:this._collection,showSearch:this._showSearch,typeLabel:this._typeLabel,maxValues:this._maxValues,imageEnabled:this.options.imageEnabled}),this.addView(this._listView),this.$(".js-content").append(this._listView.render().$el),this},_setupCollection:function _setupCollection(){this._collection=new h(null,{silent:!1});var e=this.model.get("range"),t=this.model.get("domain"),i=this.model.get("images");if(e&&e.length&&t&&t.length){var s=n(o).call(o,e,function(e,s){var n=null==t[s]||o.isString(t[s])&&l.isBlank(t[s]),a=t[s];s>=this._maxValues?a=_t("form-components.editors.fill.input-qualitative-ramps.others"):n&&(a=_t("form-components.editors.fill.input-qualitative-ramps.null"));var r={label:a,val:e};return i&&i.length&&(r.image=i[s]),r},this);this._collection.reset(s)}},_initBinds:function _initBinds(){this.listenTo(this.model,"change:range",this.render),this.listenTo(this.model,"change:domain",this.render),this.listenTo(this.model,"change:index",this.render),this.listenTo(this._collection,"change:selected",this._onSelectItem)},_onClickBack:function _onClickBack(e){this.killEvent(e),this.trigger("back",this)},_onClickColor:function _onClickColor(e){this.killEvent(e);var t=a(e.target).index(),i=this._collection.at(t);i&&this._onSelectItem(i)},_onSelectItem:function _onSelectItem(e){var t,i={index:s(t=this._collection).call(t,e),target:o.contains(e.get("selectedClass"),"js-assetPicker")?"asset":"color"};this.trigger("selectItem",i,this)}})},2982:function(e,t,i){var s=i(1),n=i(344),o="colorblind",a="diverging",r="qualitative",l="quantitative";e.exports={getColorRamps:function getColorRamps(e){if(!e)throw new Error("Number of colors per ramp is required");var t=[];return s.each(n,function(i){i&&i[e]&&t.push(i[e])}),t},getColorRampsByTag:function getColorRampsByTag(e,t){if(!e)throw new Error("Number of colors per ramp is required");var i=[];return s.each(n,function(n){n&&n[e]&&s.contains(n.tags,t)&&i.push(n[e])}),i},getColorblindRamps:function getColorblindRamps(e){return this.getColorRampsByTag(e,o)},getDivergingRamps:function getDivergingRamps(e){return this.getColorRampsByTag(e,a)},getQualitativeRamps:function getQualitativeRamps(e){return this.getColorRampsByTag(e,r)},getQuantitativeRamps:function getQuantitativeRamps(e){return this.getColorRampsByTag(e,l)}}},2983:function(e,t,i){var s=i(1),n=i(4);e.exports=n.extend({module:"components:form-components:editors:fill:input-color:input-qualitative-ramps:color-ramps-list:list-item-view:color-ramps-list-item-view",className:"CDB-ListDecoration-item CustomList-item CustomList-item--invert js-listItem",tagName:"li",events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave","click .js-listItemLink":"_onClick"},initialize:function initialize(e){this.options=s.extend({},this.options,e),this.listenTo(this.model,"change",this.render)},render:function render(){return this.clearSubViews(),this.$el.empty(),this.$el.append(this.options.template({typeLabel:this.options.typeLabel,isSelected:this.model.get("selected"),isDisabled:this.model.get("disabled"),isDestructive:this.model.get("destructive"),name:this.model.getName(),val:this.model.getValue(),options:this.model.get("renderOptions")})),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")).toggleClass("is-selected",!!this.model.get("selected")),this},_onMouseLeave:function _onMouseLeave(){this.$el.removeClass("is-highlighted")},_onMouseEnter:function _onMouseEnter(){this.$el.addClass("is-highlighted")},_onClick:function _onClick(e){this.killEvent(e),this.model.get("selected")?this.trigger("customEvent","customize",this.model.getValue(),this):this.model.set("selected",!0)}})},2984:function(e,t,i){i(37);var s=i(13),n=i(3),o=i(1),a=i(84),r=i(4),l=i(766),c=i(765),h=i(764),d=i(2983),u=i(396),p=i(198),g=i(2982),m={CUSTOM_COLOR:"custom-color",RAMP_SELECTED:"ramp-selected",CUSTOMIZE:"customize"};e.exports=r.extend({module:"components:form-components:editors:fill:input-color:input-qualitative-ramps:color-ramps-list:list-view:color-ramps-list-view",events:{"click .js-customize":"_onClickCustomize","click .js-clear":"_onClickClear","click .js-customRamp":"_onClickCustomRamp","click .js-back":"_onClickBack"},initialize:function initialize(e){this.model=e.model,this._maxValues=e.maxValues,this._requiredNumberOfColors=e.requiredNumberOfColors,this._initModels(),this._initBinds()},render:function render(){var e;this.clearSubViews(),this.$el.empty(),this.$el.append(c());var t=this._customRamp.get("range");if(this._listView=new u({collection:this.collection,showSearch:!1,typeLabel:this._typeLabel,itemTemplate:h,itemView:d}),n(e=this._listView).call(e,"customize",function(e){this.trigger("customize",e,this)},this),this.$(".js-rampsList").append(this._listView.render().el),this.addView(this._listView),t&&t.length)this.$(".js-customList").addClass("is-customized"),this.$(".js-customList").prepend(l({customRamp:t}));else{var i=this.collection.getSelectedItem();i||(i=this.collection.first()),this._selectRamp(i)}return this},_selectRamp:function _selectRamp(e){if(e){var t=e.get("val");this.$(".js-listItemLink").removeClass("is-selected"),this.$('.js-listItem[data-val="'+t.join(",")+'"] .js-listItemLink').addClass("is-selected")}},_initModels:function _initModels(){this._customRamp=new a.core.Model,this._setupCollection()},_initBinds:function _initBinds(){this.listenTo(this.collection,"change:selected",this._onSelectItem)},_onSelectItem:function _onSelectItem(e){var t=e.get("val");this.model.set("range",t),this.trigger(m.RAMP_SELECTED,t,this)},_setupCollection:function _setupCollection(){var e=g.getQualitativeRamps(this._requiredNumberOfColors),t=this.model.get("range");e=s(o).call(o,e,function(e,i){var s=!1;return e&&e.length&&t&&t.length&&(s=e.join().toLowerCase()===t.join().toLowerCase()),e?{selected:s,name:i,val:e}:null},this),this.collection=new p(o.compact(e),{silent:!1}),this.collection.getSelectedItem()||this._customRamp.set("range",this.model.get("range"))},_onClickCustomize:function _onClickCustomize(e){this.killEvent(e);var t=this.collection.getSelectedItem();this._customRamp.set("range",t),this.trigger(m.CUSTOMIZE,t,this)},_onClickClear:function _onClickClear(e){this.killEvent(e),this._customRamp.set("range",null),this.collection.getSelectedItem()||this.collection.first().set("selected",!0,{silent:!0}),this.render(),this._listView.highlight()},_onClickCustomRamp:function _onClickCustomRamp(e){this.killEvent(e),this._customRamp.get("range")&&this.trigger("customize",this.collection.getSelectedItem(),this)}},{EVENTS:m})},2985:function(e,t,i){var s=i(4),n=i(767),o=i(555);e.exports=s.extend({events:{"click .js-back":"_onClickBack","click .js-colorPicker":"_onClickColorPicker"},initialize:function initialize(e){this._imageEnabled=e.imageEnabled,this._initBinds()},render:function render(e,t){this.clearSubViews(),this.$el.empty();var i=this._getRampItem();return this.$el.append(n({index:this.model.get("index")||0,color:i.color||"",label:i.title||_t("form-components.editors.fill.input-qualitative-ramps.others"),image:i.image||"",imageEnabled:this._imageEnabled})),this._loadImages(),this},_initBinds:function _initBinds(){this.listenTo(this.model,"change:image",this.render)},_getRampItem:function _getRampItem(){var e=this.model.get("ramp");return e?e[this.model.get("index")]:{color:"",title:_t("form-components.editors.fill.input-qualitative-ramps.others"),image:""}},_loadImages:function _loadImages(){var e=this._getRampItem();this.iconView=new o({imageClass:"CDB-Text u-actionTextColor js-assetPicker",imageUrl:e.image,color:e.color}),this.addView(this.iconView),this.$(".js-image-container").append(this.iconView.render().el)},_onClickBack:function _onClickBack(e){this.killEvent(e),this.trigger("back",this)},_onClickColorPicker:function _onClickColorPicker(e){this.killEvent(e),this.trigger("goToColorPicker",this)}})},2986:function(e,t,i){var s=i(3),n=i(1),o=i(6),a=i(4),r=i(768),l=i(2985),c=i(1055),h=i(14),d=["configModel","modals","ramp","userModel"];e.exports=a.extend({initialize:function initialize(e){h(e,d,this),this._imageEnabled=e.imageEnabled,this.model=new o.Model({index:this.options.index,ramp:e.ramp})},render:function render(){return this.clearSubViews(),this.$el.html(r()),this._initViews(),this},_initViews:function _initViews(){var e,t,i;this._headerView=new l({model:this.model,imageEnabled:this._imageEnabled}),s(e=this._headerView).call(e,"goToColorPicker",this._onGoToColorPicker,this),s(t=this._headerView).call(t,"back",this._onClickBack,this),this.$(".js-header").append(this._headerView.render().el),this.addView(this._headerView),this._assetPicker=new c({model:this.model,userModel:this._userModel,configModel:this._configModel,modals:this._modals,imageEnabled:this._imageEnabled}),s(i=this._assetPicker).call(i,"change",n.debounce(this._onChangeImage,50),this),this.$(".js-content").append(this._assetPicker.render().el),this.addView(this._assetPicker)},_getRampItem:function _getRampItem(){var e=this.model.get("ramp");return e?e[this.model.get("index")]:{color:"",title:_t("form-components.editors.fill.input-qualitative-ramps.others"),image:""}},_onChangeImage:function _onChangeImage(e){var t=e&&e.url||"",i=e&&e.kind||"";this._getRampItem().image=t,this.model.trigger("change:image"),this.trigger("change:image",{url:t,kind:i,index:this.model.get("index")},this)},_onClickBack:function _onClickBack(e){this.killEvent(e),this.trigger("back",this)},_onGoToColorPicker:function _onGoToColorPicker(e){this.killEvent(e),this.trigger("goToColorPicker",this)}})},2987:function(e,t,i){i(185),i(255);var s=i(237),n=i(3),o=i(18),a=i(1),r=i(4),l=i(555),c=i(770);e.exports=r.extend({events:{"click .js-color":"_onClickColor","click .js-assetPicker":"_onClickAssetPicker","keyup .js-a":"_onChangeOpacity"},initialize:function initialize(e){this.listenTo(this.model,"change",this.render)},render:function render(e,t){var i;if(e&&e.changed&&void 0!==e.changed.opacity)return this._reRenderOpacity(),this;this.clearSubViews(),this.$el.empty();var s=this._getRampItem();return this.$el.append(c({ramp:this.model.get("ramp"),index:this.model.get("index"),opacity:this.model.get("opacity"),label:s.title||_t("form-components.editors.fill.input-qualitative-ramps.others"),color:s.color||"",iconStylingEnabled:this.options.iconStylingEnabled,isCategorized:a.has(s,"image"),image:s.image||"",imageEnabled:this.options.imageEnabled})),this._slider=this.$(".js-slider").slider({range:"min",value:this._inverseSliderValue(this.model.get("opacity")),min:0,max:1,step:.02,orientation:"horizontal",disabled:!1,slide:n(i=this._onSlideChange).call(i,this)}),this._loadImages(),this},_getRampItem:function _getRampItem(){var e=this.model.get("ramp");return e?e[this.model.get("index")]:{color:"",title:_t("form-components.editors.fill.input-qualitative-ramps.others"),image:""}},_loadImages:function _loadImages(){var e=this._getRampItem();this.iconView=new l({imageClass:"CDB-Text u-actionTextColor js-assetPicker",imageUrl:e.image,color:e.color}),this.addView(this.iconView),this.$(".js-image-container").append(this.iconView.render().el)},_onClickColor:function _onClickColor(e){this.killEvent(e),this.model.set("index",o(e.target).index())},_onClickBack:function _onClickBack(e){this.killEvent(e),this.trigger("back",this)},_onClickAssetPicker:function _onClickAssetPicker(e){this.killEvent(e),this.trigger("goToAssetPicker",this)},_onSlideChange:function _onSlideChange(e,t){this.model.set("opacity",this._inverseSliderValue(t.value))},_inverseSliderValue:function _inverseSliderValue(e){return s(Number(1-e).toFixed(2))},_onChangeOpacity:function _onChangeOpacity(){var e=this.$(".js-a"),t=e.val(),i=this._isValidOpacity(t);e.toggleClass("has-error",!i),i&&this.model.set("opacity",s(t))},_isValidOpacity:function _isValidOpacity(e){return/^((0(\.\d+)?)|(1(\.0)?))$/.test(e)},_reRenderOpacity:function _reRenderOpacity(){var e,t,i=this.$(".js-a"),n=this.$(".js-slider"),o=this.model.get("opacity");i.length>0&&(e=i.val(),(!this._isValidOpacity(e)||this._isValidOpacity(e)&&s(e)!==o)&&i.val(o)),void 0!==n.slider("instance")&&void 0!==(t=n.slider("value"))&&t!==this._inverseSliderValue(o)&&n.slider("value",this._inverseSliderValue(o))}})},2989:function(e,t,i){var s=i(4),n=i(1);e.exports=s.extend({className:"CDB-ListDecoration-item CustomList-item CustomList-item--invert js-listItem",tagName:"li",events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave","click .js-listItemLink":"_onClick","click .js-invert":"_onClickInvert"},initialize:function initialize(e){this.options=n.extend({},this.options,e),this.listenTo(this.model,"change",this.render)},render:function render(){return this.clearSubViews(),this.$el.empty(),this.$el.append(this.options.template(n.extend({typeLabel:this.options.typeLabel,isSelected:this.model.get("selected"),isInverted:this.model.get("inverted"),isDisabled:this.model.get("disabled"),isDestructive:this.model.get("destructive"),name:this.model.getName(),val:this.model.getValue(),options:this.model.get("renderOptions")}))),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")).toggleClass("is-selected",!!this.model.get("selected")).toggleClass("is-inverted",!!this.model.get("inverted")),this},_onMouseLeave:function _onMouseLeave(){this.$el.removeClass("is-highlighted")},_onMouseEnter:function _onMouseEnter(){this.$el.addClass("is-highlighted")},_onClick:function _onClick(e){this.killEvent(e),this.model.get("selected")?this.trigger("customEvent","customize",this.model.get("val"),this):this.model.set("selected",!0)},_onClickInvert:function _onClickInvert(e){this.killEvent(e),this.model.set("inverted",!this.model.get("inverted")),this.trigger("customEvent","invert",this.model,this)}})},2990:function(e,t,i){i(37);var s=i(38),n=i(7),o=i(374),a=i(13),r=i(25),l=i(3),c=i(1),h=i(84),d=i(4),u=i(396),p=i(198),g=i(774),m=i(2989),f=i(773),_=i(344),v=i(772);e.exports=d.extend({module:"components:form-components:editors:fill:input-color:input-quantitative-ramps:input-ramp-list-view",events:{"click .js-customize":"_onClickCustomize","click .js-clear":"_onClickClear","click .js-customRamp":"_onClickCustomRamp","click .js-back":"_onClickBack","click .js-switch":"_onClickSwitch","click .js-quantification":"_onClickQuantification","click .js-bins":"_onClickBins"},initialize:function initialize(e){this._showSearch=e.showSearch||!1,this._typeLabel=e.typeLabel,this._initModels(),this._initBinds()},render:function render(){this.clearSubViews(),this.$el.empty(),this.$el.append(v({bins:this.model.get("bins"),attribute:this.model.get("attribute"),quantification:this.model.get("quantification")})),this._initViews();var e=this._customRamp.get("range");if(e&&e.length)this.$(".js-customList").addClass("is-customized"),this.$(".js-customList").prepend(f({customRamp:e}));else{var t=this.collection.getSelectedItem();t||(t=this.collection.first()),this._selectRamp(t)}return this},_initModels:function _initModels(){this._customRamp=new h.core.Model,this._setupCollection()},_initBinds:function _initBinds(){this.listenTo(this.model,"change:bins",this._onChangeBins),this.listenTo(this.model,"change:attribute_type",this._updateRampOnAttributeChange),this.listenTo(this.collection,"change:selected",this._onSelectItem)},_initViews:function _initViews(){var e,t;this._listView=new u({collection:this.collection,showSearch:this._showSearch,typeLabel:this._typeLabel,itemTemplate:g,itemView:m}),l(e=this._listView).call(e,"invert",this._invertRamp,this),l(t=this._listView).call(t,"customize",function(e){this.trigger("customize",e,this)},this),this.$(".js-content").append(this._listView.render().el),this.addView(this._listView)},_getRamps:function _getRamps(){var e=this.model.get("attribute_type"),t={number:["quantitative","diverging"],string:["qualitative"]},i=_;return t[e]&&(i=r(c).call(c,i,function(i){return!!i.tags&&c.contains(t[e],i.tags[0])})),i=a(c).call(c,i,function(e,t){var i,s=e[this.model.get("bins")],n=this.model.get("range"),a=!1,r=!1;s&&s.length&&n&&n.length&&((a=s.join().toLowerCase()===n.join().toLowerCase())||(r=a=o(i=c.clone(s)).call(i).join().toLowerCase()===n.join().toLowerCase()));return s?{selected:a,inverted:r,name:t,val:s}:null},this)},_setupCollection:function _setupCollection(){var e=this._getRamps();this.collection=new p(c.compact(e),{silent:!1}),this.collection.getSelectedItem()||this._customRamp.set("range",this.model.get("range"))},_updateRampOnAttributeChange:function _updateRampOnAttributeChange(e,t){var i=this._getRamps();this.collection.reset(c.compact(i),{silent:!0}),this._customRamp.set("range",!1);var s=this.collection.first();s&&s.set("selected",!0),this.render()},_invertRamp:function _invertRamp(e){var t,i;if(e){this._customRamp.set("range",null),e.set("selected",!1);var s=o(t=n(i=[]).call(i,e.get("val"))).call(t);e.set({val:s,selected:!0}),this.model.set("range",s)}},_selectRamp:function _selectRamp(e){if(e){var t=e.get("val");this.$(".js-listItemLink").removeClass("is-selected"),this.$('.js-listItem[data-val="'+t.join(",")+'"] .js-listItemLink').addClass("is-selected")}},_onClickClear:function _onClickClear(e){this.killEvent(e),this._customRamp.set("range",null),this.collection.getSelectedItem()||this.collection.first().set("selected",!0),this.render(),this._listView.highlight()},_onClickCustomRamp:function _onClickCustomRamp(e){this.killEvent(e),this.model.get("range")===this._customRamp.get("range")?this.trigger("customize",this.collection.getSelectedItem(),this):this.model.set("range",this._customRamp.get("range")),this.$(".js-listItemLink").removeClass("is-selected"),this.$(".js-customRamp").addClass("is-selected")},_onClickCustomize:function _onClickCustomize(e){this.killEvent(e);var t=this.collection.getSelectedItem();this._customRamp.set("range",t),this.trigger("customize",t,this)},_onChangeBins:function _onChangeBins(){var e=this._customRamp.get("range");if(e){var t;if(this.model.get("bins")>e.length)e=a(t=c.range(this.model.get("bins"))).call(t,function(t){return t>=e.length?"#CCCCCC":e[t]});else e=s(e).call(e,0,this.model.get("bins"));this.model.set("range",e),this._customRamp.set("range",e)}},_onSelectItem:function _onSelectItem(e){this._selectRamp(e),this.trigger("selectItem",e,this)},_onClickSwitch:function _onClickSwitch(e){this.killEvent(e),this.trigger("switch",this)},_onClickBack:function _onClickBack(e){this.killEvent(e),this.trigger("back",this)},_onClickQuantification:function _onClickQuantification(e){this.killEvent(e),this.trigger("selectQuantification",this)},_onClickBins:function _onClickBins(e){this.killEvent(e),this.trigger("selectBins",this)}})},2991:function(e,t,i){var s=i(13),n=i(3),o=i(6),a=i(1),r=i(4),l=i(2990),c=i(368),h=i(1555);e.exports=r.extend({module:"components:form-components:editors:fill:input-color:input-quantitative-ramps:input-ramp-content-view",events:{"click .js-back":"_onClickBack"},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initViews:function _initViews(){var e=this,t=new o.Collection([{createStackView:function createStackView(t,i){var s;return n(s=e._createInputRampListView(t,i)).call(s,e)}},{createStackView:function createStackView(t,i){var s;return n(s=e._createColorPickerView(t,i)).call(s,e)}}]);this._stackLayoutView=new c({collection:t}),this.$el.append(this._stackLayoutView.render().$el),this.addView(this._stackLayoutView)},_createColorPickerView:function _createColorPickerView(e,t){var i=s(a).call(a,this.model.get("range"),function(e,t){return{val:e,color:e,title:this.model.get("attribute")}},this),o=void 0!==this.model.get("opacity")?this.model.get("opacity"):1,r=new h({index:0,ramp:i,opacity:o});return n(r).call(r,"back",function(t){e.prevStep()},this),n(r).call(r,"change",this._updateRange,this),n(r).call(r,"change:opacity",function(e){this.model.set("opacity",e)},this),r},_createInputRampListView:function _createInputRampListView(e,t){var i=new l({model:this.model,showSearch:this.options.showSearch||!1,typeLabel:this.options.typeLabel});return n(i).call(i,"customize",function(t){e.nextStep()},this),n(i).call(i,"change_ramp",this._updateRamp,this),n(i).call(i,"change",this._updateRange,this),n(i).call(i,"back",function(e){this.trigger("back",this)},this),n(i).call(i,"switch",function(e){this.trigger("switch",this)},this),n(i).call(i,"selectItem",function(e){this.trigger("selectItem",e.get("val"),this)},this),n(i).call(i,"selectBins",function(e){this.trigger("selectBins",this)},this),n(i).call(i,"selectQuantification",function(e){this.trigger("selectQuantification",this)},this),i},_updateRamp:function _updateRamp(e){this.model.set("range",e)},_updateRange:function _updateRange(e){this.model.set("range",a.pluck(e,"color"))},_onClickBack:function _onClickBack(e){this.killEvent(e),this.trigger("back",this)}})},2992:function(e,t,i){i(37);var s=i(13),n=i(28),o=i(3),a=i(1),r=i(6),l=i(4),c=i(368),h=i(795),d=i(505),u=i(2991),p=i(344),g=i(174);e.exports=l.extend({module:"components:form-components:editors:fill:input-color:input-quantitative-ramps:main-view",initialize:function initialize(e){this._settings=e.settings||g.Settings.COLOR_RAMPS,this._setupModel(),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_setupModel:function _setupModel(){var e={};this.model.get("quantification")||(e.quantification=this._settings.quantifications.items[this._settings.quantifications.defaultIndex]),this.model.get("bins")||(e.bins=this._settings.bins.items[this._settings.bins.defaultIndex]),+this.model.get("bins")>+this._settings.bins.items[this._settings.bins.items.length-1]&&(e.bins=this._settings.bins.items[this._settings.bins.items.length-1]),this.model.set(e)},_initBinds:function _initBinds(){var e=this.model.get("range");this.listenTo(this.model,"change:bins",this._updateRange),this.listenTo(this.model,"change:attribute",this.render),this.listenTo(this.model,"change:quantification",this._onChangeQuantification),this.model.unset("fixed"),e&&this._isValidRange(e)||this.model.set("range",this._getDefaultRamp())},_isValidRange:function _isValidRange(e){return e&&e.length>1||!1},_initViews:function _initViews(){var e=this,t=[{createStackView:function createStackView(t,i){var s;return o(s=e._createInputRampContentView(t,i)).call(s,e)}}];this.options.hideTabs&&a.contains(this.options.hideTabs,g.Tabs.QUANTIFICATION)||t.push({createStackView:function createStackView(t,i){var s;return o(s=e._createQuantificationListView(t,i)).call(s,e)}}),this.options.hideTabs&&a.contains(this.options.hideTabs,g.Tabs.BINS)||t.push({createStackView:function createStackView(t,i){var s;return o(s=e._createBinsListView(t,i)).call(s,e)}});var i=new r.Collection(t);this._stackLayoutView=new c({collection:i}),this.$el.append(this._stackLayoutView.render().$el),this.addView(this._stackLayoutView)},_updateRange:function _updateRange(){var e=this.model.previous("bins");if(e){var t=n(a).call(a,p,function(t){var i=t[e],s=this.model.get("range");return i&&s&&i.join("").toLowerCase()===s.join("").toLowerCase()},this);if(t){var i=this.model.get("bins");this.model.set("range",t[i])}}},_createInputRampContentView:function _createInputRampContentView(e,t){var i=new u({stackLayoutModel:e,model:this.model});return o(i).call(i,"back",function(e){this.trigger("back")},this),o(i).call(i,"selectItem",function(e){this.model.unset("domain"),this.model.set("range",e)},this),o(i).call(i,"selectQuantification",function(t){e.goToStep(1)},this),o(i).call(i,"selectBins",function(t){e.goToStep(2)},this),i},_createBinsListView:function _createBinsListView(e,t){var i=new h({headerTitle:_t("form-components.editors.fill.bins"),stackLayoutModel:e,columns:this._settings.bins.items});return o(i).call(i,"selectItem",function(t){this.model.set("bins",t.get("val")),e.goToStep(0)},this),o(i).call(i,"back",function(t){e.goToStep(0)},this),i},_createQuantificationListView:function _createQuantificationListView(e,t){var i=new h({headerTitle:_t("form-components.editors.fill.quantification.title"),stackLayoutModel:e,itemTemplate:d,columns:this._settings.quantifications.items,showSearch:!1});return o(i).call(i,"selectItem",function(t){this.model.set("quantification",t.get("val")),e.prevStep()},this),o(i).call(i,"back",function(t){e.goToStep(0)},this),i},_getDefaultRamp:function _getDefaultRamp(){return s(a).call(a,p,function(e){return e[this.model.get("bins")]},this)[0]},_onChangeQuantification:function _onChangeQuantification(){"category"===this.model.get("quantification")&&this.trigger("switch",this)},remove:function remove(){l.prototype.remove.apply(this)}})},2993:function(e,t,i){var s=i(3),n=i(4),o=i(776),a=i(58);e.exports=n.extend({className:"Carousel-item",tagName:"li",events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave",click:"_onClick"},initialize:function initialize(e){this._itemClassName=e&&e.itemOptions?e.itemOptions.className:"",this._initBinds()},render:function render(){var e,t,i,n;return this.clearSubViews(),s(e=this.$el).call(e,"mouseenter",s(t=this._onMouseEnter).call(t,this)),s(i=this.$el).call(i,"mouseleave",s(n=this._onMouseLeave).call(n,this)),this.$el.html(o({name:this.model.getName(),className:this._itemClassName,template:this.model.get("template")()})),this.model.getValue()&&this.$el.addClass("js-"+this.model.getValue()),this.$el.toggleClass("is-selected",!!this.model.get("selected")),this._initViews(),this},_initViews:function _initViews(){if(this.model.get("tooltip")){var e,t=new a({el:this.$el,gravity:"s",title:s(e=function _context5(){return this.model.get("tooltip")}).call(e,this)});this.addView(t)}},_initBinds:function _initBinds(){var e;s(e=this.model).call(e,"change:selected",this.render,this)},_onMouseEnter:function _onMouseEnter(){this.model.set("highlighted",!0)},_onMouseLeave:function _onMouseLeave(){this.model.set("highlighted",!1)},_onClick:function _onClick(e){this.killEvent(e),this.model.set("selected",!0)}})},2994:function(e,t,i){var s=i(6);e.exports=s.Model.extend({defaults:{selected:!1,label:"",template:function template(){return""}},getName:function getName(){return this.get("label")||this.getValue()},getValue:function getValue(){return this.get("val")}})},2995:function(e,t,i){var s=i(76),n=i(3),o=i(4),a=i(457),r=i(777),l=i(504),c=i(2993),h=i(1);e.exports=o.extend({className:"Carousel",tagName:"div",initialize:function initialize(e){var t;if(!e.collection){if(!e.options)throw new Error("options array {value, label} is required");this.collection=new l(e.options),this.options=e}this._bindedCheckShadows=n(t=this._checkShadows).call(t,this),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.html(r()),this._renderList(),this._applyCustomScroll(),this},_initBinds:function _initBinds(){var e;n(e=this.collection).call(e,"change:selected",this._checkScroll,this)},_renderList:function _renderList(){this.collection.each(function(e){this._createItem(e)},this)},_createItem:function _createItem(e){var t=this.options,i=t&&t.listItemOptions?t.listItemOptions.className:"Carousel-item",s=new c({className:i,model:e,itemOptions:this.options.itemOptions});this._listContainer().append(s.render().el),this.addView(s)},_applyCustomScroll:function _applyCustomScroll(){a.initialize(this._listContainer().get(0),{wheelSpeed:1,wheelPropagation:!1,swipePropagation:!0,suppressScrollY:!0,stopPropagationOnClick:!1,minScrollbarLength:120,useBothWheelAxes:!0}),this._checkScroll(),this._bindScroll()},_destroyCustomScroll:function _destroyCustomScroll(){this._unbindScroll(),a.destroy(this._listContainer().get(0))},_bindScroll:function _bindScroll(){this._listContainer().on("ps-x-reach-start",this._bindedCheckShadows).on("ps-x-reach-end",this._bindedCheckShadows).on("ps-scroll-x",this._bindedCheckShadows)},_unbindScroll:function _unbindScroll(){this._listContainer().off("ps-x-reach-start",this._bindedCheckShadows).off("ps-x-reach-end",this._bindedCheckShadows).off("ps-scroll-x",this._bindedCheckShadows)},_checkScroll:function _checkScroll(){var e=this.$(".is-selected").position();e&&(this._listContainer().scrollLeft(e.left-20),this._bindedCheckShadows())},_listContainer:function _listContainer(){return this.$(".js-list")},_checkShadows:function _checkShadows(){var e=this._listContainer().scrollLeft(),t=this._listContainer().get(0).scrollWidth-this._listContainer().outerWidth();this.$(".js-leftShadow").toggleClass("is-visible",e>0),this.$(".js-rightShadow").toggleClass("is-visible",e<t)},clean:function clean(){this._destroyCustomScroll(),o.prototype.clean.apply(this)},initScroll:function initScroll(){s(n(h).call(h,function(){this._checkShadows(),this._checkScroll(),a.update(this._listContainer().get(0))},this),0)}})},2996:function(e,t,i){var s=i(4),n=i(621),o="selected";e.exports=s.extend({tagName:"li",className:"AssetsList-item AssetsList-item--medium",events:{"click .js-asset":"_onClick"},initialize:function initialize(){this.listenTo(this.model,"change:state",this._changeState)},render:function render(){return this.clearSubViews(),this.$el.append(n({type:"icon",name:this.model.get("name"),public_url:this.model.get("public_url")})),this},_onClick:function _onClick(e){this.killEvent(e),this.trigger(o,this.model),this.model.set("state",o)},_changeState:function _changeState(){this.$el.toggleClass("is-selected",this.model.get("state")===o)}})},2997:function(e,t,i){var s=i(38),n=i(13),o=i(3),a=i(1),r=i(4),l=i(2996),c=i(1558),h=i(14),d=["icons","selectedAsset"];e.exports=r.extend({tagName:"ul",className:"AssetsList",initialize:function initialize(e){h(e,d,this),this._setupAssets(e)},render:function render(){return this.clearSubViews(),this._renderAssets(),this},_renderAssets:function _renderAssets(){this._assetsCollection.each(function(e){var t=new l({model:e});this.model&&t.model.getURLFor(e.get("icon"))===this.model.get("image")&&t.model.set("state","selected"),o(t).call(t,"selected",this._selectItem,this),this.$el.append(t.render().el),this.addView(t)},this)},_setupAssets:function _setupAssets(e){a.isEmpty(e)||(this._icons=n(a).call(a,this._icons,function(t){return a.extend(t,e)}));var t=this._icons;this.options.limit&&(t=s(t).call(t,0,this.options.limit)),this._assetsCollection=new c(t),this.add_related_model(this._assetsCollection)},_selectItem:function _selectItem(e){this._selectedAsset.set({url:e.get("public_url"),kind:e.get("kind")}),this._assetsCollection.deselectAll(e)}})},2998:function(e,t,i){var s=i(3);i(1228);var n=i(921),o=i(18),a=i(6),r=i(4),l=i(59),c=i(14),h=i(1053),d=i(780),u=["configModel","userModel"];e.exports=r.extend({className:"Form-modal",events:{"keyup .js-url":"_onURLChanged","click .js-submit":"_onClickSubmit"},initialize:function initialize(e){c(e,u,this),this._stateModel=new a.Model({status:"show",uploads:0}),this.listenTo(this._stateModel,"change:status",this.render),this._assetCollection=new h(null,{configModel:this._configModel,userModel:this._userModel})},render:function render(){return this.clearSubViews(),this.$el.html(d()),this._initDropzone(),this},_initDropzone:function _initDropzone(){var e,t,i=o("html")[0],a=this;this.dragster=new Dragster(i),s(e=o(i)).call(e,"dragster:enter",function(e){a._showDropzone()}),s(t=o(i)).call(t,"dragster:leave",function(e){a._hideDropzone()}),i.dropzone||(this.dropzone=new n(i,{url:":)",autoProcessQueue:!1,previewsContainer:!1}),this.dropzone.on("dragover",function(){a._showDropzone()}),this.dropzone.on("drop",function(e){a.trigger("upload-files",e.dataTransfer.files),a._hideDropzone()}))},_showDropzone:function _showDropzone(){this.$(".Form-upload").addClass("is-dropping")},_hideDropzone:function _hideDropzone(){this.$(".Form-upload").removeClass("is-dropping")},_destroyDropzone:function _destroyDropzone(){var e=o("html")[0];this.dragster&&(this.dragster.removeListeners(),this.dragster.reset(),o(e).unbind("dragster:enter dragster:leave")),this.dropzone&&this.dropzone.destroy()},_hasError:function _hasError(){return"error"===this._stateModel.get("status")},_onClickSubmit:function _onClickSubmit(e){this.killEvent(e);var t=this._getURL();t?l.isURL(t)?(this._hideURLError(),this.trigger("upload-url",t)):this._showURLError():this._hideURLError()},_getURL:function _getURL(){return this.$(".js-url").val()},_onURLChanged:function _onURLChanged(){var e=this._getURL();e?l.isURL(e)?this._hideURLError():this._showURLError():this._hideURLError()},_showURLError:function _showURLError(){this.$(".js-url-error").addClass("is-visible")},_hideURLError:function _hideURLError(){this.$(".js-url-error").removeClass("is-visible")},clean:function clean(){this._destroyDropzone(),r.prototype.clean.apply(this)}})},2999:function(e,t,i){var s=i(6),n=i(1054),o=i(14),a=["configModel","orgId"];e.exports=s.Collection.extend({model:n,url:function url(e){return this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("organization-assets",e)+"/organization/"+this._orgId+"/assets"},initialize:function initialize(e,t){o(t,a,this)},deselectAll:function deselectAll(e){this.each(function(t){t!==e&&"selected"===t.get("state")&&t.set("state","")})}})},3000:function(e,t,i){var s=i(3),n=i(4),o=i(14),a=i(1559),r=i(781),l=["userAssetCollection","organizationAssetCollection","selectedAsset"];e.exports=n.extend({initialize:function initialize(e){o(e,l,this),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.html(r),this._organizationAssetCollection.deselectAll(),this._organizationAssetCollection.each(this._renderAsset,this),this},_initBinds:function _initBinds(){this.listenTo(this._organizationAssetCollection,"reset",this.render),this.listenTo(this._organizationAssetCollection,"change",this._onChangeAssets)},_getSelectedAsset:function _getSelectedAsset(){var e=this._organizationAssetCollection.where({state:"selected"});return e&&e[0]},_renderAsset:function _renderAsset(e){var t=new a({model:e,assetHeight:48,selectedAsset:this._selectedAsset});e.get("public_url")===this.model.get("image")&&e.set("state","selected"),s(t).call(t,"selected",this._selectAsset,this),this.$(".js-assets").append(t.render().el),this.addView(t)},_onChangeAssets:function _onChangeAssets(){var e=this._getSelectedAsset();this._selectedAsset.set({url:e&&e.get("public_url"),kind:"custom-marker"})},_selectAsset:function _selectAsset(e){e.set("state","selected"),this._organizationAssetCollection.deselectAll(e),this._userAssetCollection.deselectAll()}})},3001:function(e,t,i){var s=i(4),n=i(14),o=i(784),a=["title","editable"];e.exports=s.extend({events:{"click .js-remove":"_onClickRemove","click .js-select-all":"_onClickSelectAll","click .js-deselect-all":"_onClickDeselectAll"},initialize:function initialize(e){n(e,a,this),this._assetsCollection=this.options.assetsCollection,this._initBinds()},render:function render(){this.clearSubViews();var e=this._getSelectedAssetsCount(),t=this._assetsCollection.size();return this.$el.html(o({title:this._title,editable:this._editable,assetsCount:t,selectedCount:e,allSelected:e===t})),this},_initBinds:function _initBinds(){this.listenTo(this._assetsCollection,"add change remove",this.render)},_onClickRemove:function _onClickRemove(){this.trigger("remove")},_onClickSelectAll:function _onClickSelectAll(){this.trigger("select-all")},_onClickDeselectAll:function _onClickDeselectAll(){this.trigger("deselect-all")},_getSelectedAssetsCount:function _getSelectedAssetsCount(){var e=this._assetsCollection.where({state:"selected"});return e?e.length:0}})},3002:function(e,t,i){var s=i(3),n=i(18),o=i(1),a=i(4),r=i(1559),l=i(14),c=i(6),h=i(86),d=i(3001),u=i(264),p=i(622),g=i(782),m=["userModel","userAssetCollection","selectedAsset"];e.exports=a.extend({initialize:function initialize(e){if(l(e,m,this),this._userModel.isInsideOrg()){if(!e.organizationAssetCollection)throw new Error("organizationAssetCollection is required");this._organizationAssetCollection=e.organizationAssetCollection}this._stateModel=new c.Model,this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.html(g),this._isLoading()?this._renderLoading():this._hasError()?this._renderError():this._renderRegularView(),this},_addHeaderView:function _addHeaderView(){var e,t,i;this._assetHeaderView=new d({editable:!0,title:this.options.title,assetsCollection:this._userAssetCollection}),this.addView(this._assetHeaderView),this.$(".js-nav").append(this._assetHeaderView.render().el),s(e=this._assetHeaderView).call(e,"select-all",this._selectAllAssets,this),s(t=this._assetHeaderView).call(t,"deselect-all",this._deselectAllAssets,this),s(i=this._assetHeaderView).call(i,"remove",this._removeSelectedAssets,this)},_renderRegularView:function _renderRegularView(){this._addHeaderView(),this._renderAddButton(),this._userAssetCollection.deselectAll(),this._userAssetCollection.each(this._renderAsset,this)},_renderAddButton:function _renderAddButton(){var e=new r({model:new c.Model({type:"text",name:"+"}),assetHeight:48});s(e).call(e,"selected",function(){this.trigger("init-upload")},this),this.addView(e),this.$(".js-assets").append(e.render().$el)},_initBinds:function _initBinds(){var e,t;this._keyDown=s(e=this._onKeyDown).call(e,this),n(document).on("keydown",this._keyDown),this._keyUp=s(t=this._onKeyUp).call(t,this),n(document).on("keyup",this._keyUp),this.listenTo(this._stateModel,"change:status",this.render),this.listenTo(this._userAssetCollection,"change",this._onChangeAssets)},_getSelectedAsset:function _getSelectedAsset(){return this._userAssetCollection.findWhere({state:"selected"})},_getSelectedAssetsCount:function _getSelectedAssetsCount(){var e=this._userAssetCollection.where({state:"selected"});return e?e.length:0},_onKeyDown:function _onKeyDown(e){this._shiftKeyPressed=e.shiftKey},_onKeyUp:function _onKeyUp(e){this._shiftKeyPressed=e.shiftKey},_onClickBack:function _onClickBack(e){this.killEvent(e),this._stateModel.unset("status")},_renderAsset:function _renderAsset(e){var t=new r({model:e,assetHeight:48,selectedAsset:this._selectedAsset});e.get("public_url")===this.model.get("image")&&e.set("state","selected"),s(t).call(t,"selected",this._selectAsset,this),this.$(".js-assets").append(t.render().el),this.addView(t)},_onChangeAssets:function _onChangeAssets(){if(1===this._getSelectedAssetsCount()){var e=this._getSelectedAsset();this._selectedAsset.set({url:e&&e.get("public_url"),kind:"custom-marker"})}else this._selectedAsset.set({url:"",kind:""})},_selectAllAssets:function _selectAllAssets(){this._userAssetCollection.selectAll()},_deselectAllAssets:function _deselectAllAssets(){this._userAssetCollection.deselectAll()},_selectAsset:function _selectAsset(e){this._shiftKeyPressed?e.set("state","selected"===e.get("state")?"":"selected"):e.set("state","selected"),this._shiftKeyPressed||(this._userAssetCollection.deselectAll(e),this._userModel.isInsideOrg()&&this._organizationAssetCollection.deselectAll())},_removeSelectedAssetsFromView:function _removeSelectedAssetsFromView(){var e=this._userAssetCollection.select(function(e){return"selected"===e.get("state")},this);o.each(e,function(e){this.$("#"+e.get("id")).remove()},this)},_removeSelectedAssets:function _removeSelectedAssets(){this._stateModel.set("status","loading");var e=this._userAssetCollection.select(function(e){return"selected"===e.get("state")},this);o.each(e,function(e){var t;e.destroy({complete:s(t=this._onDestroyFinished).call(t,this)})},this)},_onDestroyFinished:function _onDestroyFinished(e){200===e.status?(this._removeSelectedAssetsFromView(),this._stateModel.unset("status"),this._selectedAsset.unset("kind"),this._selectedAsset.unset("url")):this._stateModel.set({error_message:e.statusText,status:"error"})},_isLoading:function _isLoading(){return"loading"===this._stateModel.get("status")},_hasError:function _hasError(){return"error"===this._stateModel.get("status")},_renderLoading:function _renderLoading(){this.$el.html(h({title:_t("components.modals.assets-picker.loading")}))},_renderError:function _renderError(){this.$el.html(new u({title:this._stateModel.get("error_message"),desc:_t("components.modals.assets-picker.error-desc"),template:p}).render().el)},_disableBinds:function _disableBinds(){n(document).off("keydown",this._keyDown),n(document).off("keyup",this._keyUp)},clean:function clean(){this._disableBinds(),a.prototype.clean.apply(this)}})},3003:function(e,t,i){var s=i(3),n=i(4),o=i(14),a=i(246),r=i(3002),l=["userModel","userAssetCollection","title","selectedAsset"];e.exports=n.extend({className:"Tab-paneContentInner",events:{"change .js-uploadInput":"_onFileSelected"},initialize:function initialize(e){if(o(e,l,this),this._userModel.isInsideOrg()){if(!e.organizationAssetCollection)throw new Error("organizationAssetCollection is required");this._organizationAssetCollection=e.organizationAssetCollection}},render:function render(){return this.clearSubViews(),this.$el.empty(),this._renderAssets(),this},_renderAssets:function _renderAssets(){var e,t=new a({createContentView:s(e=function _context(){var e=new r({title:this._title,model:this.model,organizationAssetCollection:this._organizationAssetCollection,userAssetCollection:this._userAssetCollection,selectedAsset:this._selectedAsset,userModel:this._userModel});return s(e).call(e,"init-upload",function(){this.trigger("init-upload")},this),e}).call(e,this)});this.addView(t),this.$el.append(t.render().el)}})},3004:function(e,t,i){var s=i(65),n=i(3),o=i(18),a=i(1),r=i(4),l=i(6),c=i(59),h=i(1560),d=i(3003),u=i(3e3),p=i(2999),g=i(2998),m=i(14),f=i(1053),_=i(557),v=i(246),y=i(2997),w=i(86),b=i(264),C=i(622),M=i(104),k=i(779),S=i(778),x="custom-marker",T=["modalModel","configModel","userModel"];e.exports=r.extend({className:"Dialog-content Dialog-content--expanded",events:{"click .js-add":"_onSetImage","click .js-upload":"_initUpload","change .js-fileInput":"_onFileSelected","click .js-back":"_onClickBack"},initialize:function initialize(e){m(e,T,this),this._initModels(),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.html(k({disclaimer:h.disclaimer})),this._hasFetchedAllCollections()?this._initTabPane():this._isLoading()?this._renderLoading():this._hasError()&&this._renderError(),this},_hasFetchedAllCollections:function _hasFetchedAllCollections(){return"show"===this._stateModel.get("status")},_initModels:function _initModels(){var e=this;this._selectedAsset=new l.Model({url:this.model.get("image")}),this._stateModel=new l.Model({status:"loading",modalEnabled:!1,uploads:0}),this._assetCollections=[],this._userAssetCollection=new f(null,{configModel:this._configModel,userModel:this._userModel}),this._assetCollections.push(this._userAssetCollection),this._userModel.isInsideOrg()&&(this._organizationAssetCollection=new p(null,{configModel:this._configModel,orgId:this._userModel.getOrganization().get("id")}),this._assetCollections.push(this._organizationAssetCollection));var t=a.invoke(this._assetCollections,"fetch");o.when.apply(o,t).then(function(){e._stateModel.set("status","show")},function(t,i){e._setError(i)})},_initBinds:function _initBinds(){this.listenTo(this._selectedAsset,"change:url",this._onChangeSelectedAsset),this.listenTo(this._stateModel,"change:status",this.render),this.listenTo(this._stateModel,"change:modalEnabled",this._onChangeSetButton)},_onClickBack:function _onClickBack(e){this.killEvent(e),this._stateModel.set("status","show"),this._assetsTabPaneView.setSelectedTabPaneByName("upload-file")},_upload:function _upload(e){var t,i,s,o;this._userAssetCollection.create(e,{beforeSend:n(t=this._beforeAssetUpload).call(t,this),success:n(i=this._onAssetUploaded).call(i,this),error:n(s=this._onAssetUploadError).call(s,this),complete:n(o=this._onAssetUploadComplete).call(o,this)})},_renderError:function _renderError(){this._hideDisclaimer(),this.$(".js-body").html(new b({title:c.capitalize(this._stateModel.get("error_message")),desc:_t("components.modals.assets-picker.error-desc"),template:C}).render().el)},_renderLoading:function _renderLoading(){this._hideDisclaimer(),this.$(".js-body").html(w({title:_t("components.modals.assets-picker.loading")}))},_isLoading:function _isLoading(){return"loading"===this._stateModel.get("status")},_hasError:function _hasError(){return"error"===this._stateModel.get("status")},_initTabPane:function _initTabPane(){var e,t,i,s,o=[{name:"maki-icons",label:_t("components.modals.add-asset.icons"),createContentView:n(e=this._createMakiIconsView).call(e,this)},{name:"your-uploads",label:_t("components.modals.add-asset.your-uploads"),createContentView:n(t=this._createYourUploadsView).call(t,this)}];this._userModel.isInsideOrg()&&this._organizationAssetCollection.length>0&&o.push({name:"organization-uploads",label:_t("components.modals.add-asset.organization-uploads"),createContentView:n(s=this._createOrganizationUploadsView).call(s,this)});o.push({name:"upload-file",label:_t("components.modals.add-asset.upload-file"),createContentView:n(i=this._createUploadFileView).call(i,this)});var a={tabPaneOptions:{template:S,disclaimer:h.disclaimer,tabPaneItemOptions:{tagName:"li",klassName:"CDB-NavMenu-item"}},tabPaneItemLabelOptions:{tagName:"button",className:"CDB-NavMenu-link u-upperCase"}};this._assetsTabPaneView=_(o,a),this.listenTo(this._assetsTabPaneView.collection,"change",this._onChangeSelectedTab),this.addView(this._assetsTabPaneView),this.$(".js-body").append(this._assetsTabPaneView.render().el),this._initSetButtonState()},_onChangeSelectedTab:function _onChangeSelectedTab(){switch(this._assetsTabPaneView.getSelectedTabPaneName()){case"maki-icons":this._setDisclaimer(h.disclaimer),this._toggleSetButton();break;case"upload-file":this._hideDisclaimer(),this._disableSetButton();break;default:this._hideDisclaimer(),this._toggleSetButton()}},_toggleSetButton:function _toggleSetButton(){this._stateModel.set("modalEnabled",void 0!==this._selectedAsset.get("url"))},_initSetButtonState:function _initSetButtonState(){if(this.model.get("image")){var e=!1;"marker"===this.model.get("kind")&&(e=!0),e||a.each(this._assetCollections,function(t){e||(e=s(t).call(t,function(e){return this.model.get("image")===e.get("public_url")},this))},this),e&&this._enableSetButton()}},_enableSetButton:function _enableSetButton(){this._stateModel.set("modalEnabled",!0)},_disableSetButton:function _disableSetButton(){this._stateModel.set("modalEnabled",!1)},_createYourUploadsView:function _createYourUploadsView(){var e,t=new v({createContentView:n(e=function _context9(){return new d({model:this.model,selectedAsset:this._selectedAsset,title:_t("components.modals.add-asset.your-uploads"),organizationAssetCollection:this._organizationAssetCollection,userAssetCollection:this._userAssetCollection,userModel:this._userModel})}).call(e,this)});return this._userAssetsView=t,n(t).call(t,"init-upload",this._initUpload,this),this._hideDisclaimer(),this._userAssetsView},_createOrganizationUploadsView:function _createOrganizationUploadsView(){var e,t=new v({createContentView:n(e=function _context10(){return new u({title:_t("components.modals.add-asset.organization-uploads"),model:this.model,organizationAssetCollection:this._organizationAssetCollection,userAssetCollection:this._userAssetCollection,selectedAsset:this._selectedAsset})}).call(e,this)});return this._hideDisclaimer(),t},_createUploadFileView:function _createUploadFileView(){var e,t=n(e=new g({model:this.model,userModel:this._userModel,configModel:this._configModel})).call(e,this);return n(t).call(t,"upload-complete",this._onUploadComplete,this),n(t).call(t,"upload-files",this._uploadFiles,this),n(t).call(t,"upload-url",this._uploadURL,this),t},_createMakiIconsView:function _createMakiIconsView(){var e;return new v({createContentView:n(e=function _context12(){return new y({model:this.model,selectedAsset:this._selectedAsset,title:_t("components.modals.add-asset.maki-icons"),icons:h.icons,folder:"maki-icons",kind:"marker",size:"18"})}).call(e,this)})},_onUploadComplete:function _onUploadComplete(){this._assetsTabPaneView.setSelectedTabPaneByName("your-uploads")},_onChangeSetButton:function _onChangeSetButton(){this.$(".js-add").toggleClass("is-disabled",!this._stateModel.get("modalEnabled"))},_onChangeSelectedAsset:function _onChangeSelectedAsset(){this._selectedAsset.get("url")||(this.model.unset("image"),this.model.unset("kind")),this._stateModel.set("modalEnabled",!!this._selectedAsset.get("url"))},_initUpload:function _initUpload(e){this.killEvent(e),this.$(".js-fileInput").click()},_setDisclaimer:function _setDisclaimer(e){this.$(".js-disclaimer").html(e)},_hideDisclaimer:function _hideDisclaimer(){this.$(".js-disclaimer").html("")},_getSelectedFiles:function _getSelectedFiles(){return this.$(".js-fileInput").prop("files")},_uploadURL:function _uploadURL(e){this._upload({type:"url",kind:x,url:e})},_uploadFiles:function _uploadFiles(e){a.each(e,function(e){this._upload({kind:x,type:"file",filename:e})},this)},_onFileSelected:function _onFileSelected(){this._uploadFiles(this._getSelectedFiles())},_beforeAssetUpload:function _beforeAssetUpload(){this._stateModel.set("uploads",this._stateModel.get("uploads")+1),this._stateModel.get("uploads")>0&&this._stateModel.set("status","loading")},_onAssetUploaded:function _onAssetUploaded(e){this._resetFileSelection()},_setError:function _setError(e){this._stateModel.set({error_message:M(e),status:"error"})},_onAssetUploadError:function _onAssetUploadError(e,t){this._userAssetCollection.remove(e),this._resetFileSelection(),this._setError(t)},_onAssetUploadComplete:function _onAssetUploadComplete(){this._stateModel.set("uploads",this._stateModel.get("uploads")-1),this._stateModel.get("uploads")<1&&!this._hasError()&&(this._stateModel.set("status","show"),this._onUploadComplete())},_resetFileSelection:function _resetFileSelection(){this.$(".js-fileInput").val("")},_onSetImage:function _onSetImage(e){this.killEvent(e),this._stateModel.get("modalEnabled")&&(this.model.set({image:this._selectedAsset.get("url"),kind:this._selectedAsset.get("kind")}),this.trigger("change",{url:this._selectedAsset.get("url"),kind:this._selectedAsset.get("kind")},this),this._modalModel.destroy(this.model))}})},3006:function(e,t,i){var s=i(3),n=i(4),o=i(790);e.exports=n.extend({className:"Label",initialize:function initialize(){var e;if(!this.model)throw new Error("A model should be provided");s(e=this.model).call(e,"change:label",this.render,this)},render:function render(){return this.clearSubViews(),this.$el.html(o({color:this.model.get("label"),selectedChild:this.model.get("selectedChild")||""})),this}})},3007:function(e,t,i){i(23),i(101);var s=i(3),n=i(791),o=i(4),a=i(555);e.exports=o.extend({tagName:"i",className:"CDB-IconFont",initialize:function initialize(e){var t,i;if(!this.model)throw new Error("A model should be provided");s(t=this.model).call(t,"change:label",this.render,this),s(i=this.model).call(i,"change:color",this._updateColor,this)},render:function render(){this.clearSubViews();var e=this._getLabelType();return this.$el.html(n({type:e,label:this.model.get("label"),kind:this.model.get("kind"),selectedChild:this.model.get("selectedChild")||""})),"file"===e&&this._loadImages(),this},_loadImages:function _loadImages(){this.iconView=new a({imageClass:"Tab-paneLabelImage",imageUrl:this._getImageURL(),color:this.model.get("color")}),this.addView(this.iconView),this.$(".js-image-container").append(this.iconView.render().el)},_updateColor:function _updateColor(){this.iconView&&this.iconView.updateImageColor(this.model.get("color"))},_getLabelType:function _getLabelType(){var e=this.model.get("label");return e&&e.match(/^http/)?"file":"text"},_getImageURL:function _getImageURL(){return this.model.get("label")}})},3008:function(e,t,i){i(35);var s=i(56),n=i(13),o=i(1),a=i(4),r=i(259),l=i(241),c=i(3007),h=i(3006);e.exports=function(e,t){var i=(t=t||{}).tabPaneItemLabelOptions,d=n(e).call(e,function(e){var t;return s(t=["label","createContentView"]).call(t,function(t){if(!e[t])throw new Error(t+" should be provided")}),{name:e.name,selected:e.selected,label:e.label,color:e.color,kind:e.kind,selectedChild:e.selectedChild,createButtonView:function createButtonView(){return"color"===e.type?new h(o.extend({model:this},i)):new c(o.extend({model:this,type:e.type},i))},createContentView:function createContentView(){return e.createContentView&&e.createContentView()||new a}}}),u=new l(d),p=t.tabPaneOptions;return new r(o.extend({collection:u},p))}},3009:function(e,t,i){var s=i(3),n=i(1),o=i(4),a=i(558),r=i(3008),l=i(789),c=i(1055),h=i(174);e.exports=o.extend({initialize:function initialize(e){if(this.options.editorAttrs){var t=this.options.editorAttrs;if(this._imageEnabled=t.imageEnabled,t.hidePanes&&(this._hidePanes=t.hidePanes,this._imageEnabled&&!n.contains(this._hidePanes,h.Panes.FILE))){if(!e.configModel)throw new Error("configModel param is required");if(!e.userModel)throw new Error("userModel param is required");if(!e.modals)throw new Error("modals param is required")}t.disableOpacity&&(this._disableOpacity=!0)}this._userModel=e.userModel,this._configModel=e.configModel,this._modals=e.modals,this._query=e.query},render:function render(){return this.clearSubViews(),this._imageEnabled&&this._setupTabPanes(),this._tabPaneView?this.$el.append(this._tabPaneView.render().$el):this.$el.append(this._generateFixedContentView().render().$el),this},_setupTabPanes:function _setupTabPanes(){var e=this,t={name:"fixed",type:"color",label:this.model.get("fixed"),createContentView:function createContentView(){return e._generateFixedContentView()}},i={name:"file",type:this.model.get("image")?"image":"text",label:this.model.get("image")||_t("form-components.editors.fill.input-color.img"),kind:this.model.get("kind")||"marker",color:this.model.get("fixed"),createContentView:function createContentView(){return e._generateFileContentView()}};this._tabPaneTabs=[],this.options.editorAttrs&&this.options.editorAttrs.hidePanes?(this._hidePanes=this.options.editorAttrs.hidePanes,n.contains(this._hidePanes,h.Panes.FIXED)||this._tabPaneTabs.push(t),n.contains(this._hidePanes,h.Panes.FILE)||this._tabPaneTabs.push(i)):this._tabPaneTabs=[t,i];var s={tabPaneOptions:{template:a,tabPaneItemOptions:{tagName:"li",klassName:"CDB-NavMenu-item"}},tabPaneItemLabelOptions:{tagName:"button",className:"CDB-NavMenu-link u-upperCase"}};this.model.get("image")&&this._tabPaneTabs.length>1&&(this._tabPaneTabs[1].selected=!0),this.listenTo(this.model,"change:image",this._updateImageTabPane),this.listenTo(this.model,"change:fixed",this._updateTextTabPane),this._tabPaneView=r(this._tabPaneTabs,s),this.addView(this._tabPaneView)},_updateTextTabPane:function _updateTextTabPane(){this._updateImageTabPane(),this._tabPaneView.collection.at(0).set("label",this.model.get("fixed"))},_updateImageTabPane:function _updateImageTabPane(){this.model.get("image")?this._tabPaneView.collection.at(1).set({label:this.model.get("image"),color:this.model.get("fixed")}):this._tabPaneView.collection.at(1).set("label",_t("form-components.editors.fill.input-color.img"))},_generateFixedContentView:function _generateFixedContentView(){var e=new l({value:this.model.get("fixed"),opacity:this.model.get("opacity"),disableOpacity:this._disableOpacity});return s(e).call(e,"change",this._onChangeValue,this),e},_generateFileContentView:function _generateFileContentView(){var e=new c({model:this.model,userModel:this._userModel,configModel:this._configModel,modals:this._modals});return s(e).call(e,"change",this._onChangeFile,this),e},_onChangeFile:function _onChangeFile(e){e&&e.url?this.model.set({image:e.url,kind:e.kind}):this.model.unset("image")},_onChangeValue:function _onChangeValue(e){this.model.set({fixed:e.hex,opacity:e.opacity})}})},3010:function(e,t,i){var s=i(3),n=i(1),o=i(4),a=i(558),r=i(557),l=i(3009),c=i(1556),h=i(174);e.exports=o.extend({initialize:function initialize(e){if(this.options.editorAttrs){var t=this.options.editorAttrs;if(t.hidePanes&&(this._hidePanes=t.hidePanes,!n.contains(this._hidePanes,h.Panes.BY_VALUE))){if(!e.configModel)throw new Error("configModel param is required");if(!e.userModel)throw new Error("userModel param is required");if(!e.modals)throw new Error("modals param is required");if(!e.query)throw new Error("query param is required")}t.categorizeColumns&&(this._categorizeColumns=!0),t.hideTabs&&(this._hideTabs=t.hideTabs),t.imageEnabled&&(this._imageEnabled=!0)}if(!e.columns)throw new Error("columns is required");this._columns=e.columns,this._configModel=e.configModel,this._userModel=e.userModel,this._modals=e.modals,this._query=e.query,this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initBinds:function _initBinds(){this.model.on("change:fixed",this._onChangeFixed,this)},_onChangeFixed:function _onChangeFixed(){this.model.get("fixed")&&!this.model.get("range")||(this.model.unset("image",{silent:!0}),this.model.unset("images",{silent:!0}))},_initViews:function _initViews(){var e,t=this,i={name:"fixed",label:_t("form-components.editors.fill.input-color.solid"),createContentView:function createContentView(){return t._generateFixedContentView()}},o={name:"value",label:_t("form-components.editors.fill.input-color.value"),createContentView:function createContentView(){return t._generateValueContentView()}};this._tabPaneTabs=[],this._hidePanes?(n.contains(this._hidePanes,h.Panes.FIXED)||this._tabPaneTabs.push(i),n.contains(this._hidePanes,h.Panes.BY_VALUE)||this._tabPaneTabs.push(o)):this._tabPaneTabs=[i,o];var l={tabPaneOptions:{template:a,tabPaneItemOptions:{tagName:"li",klassName:"CDB-NavMenu-item"}},tabPaneItemLabelOptions:{tagName:"button",className:"CDB-NavMenu-link u-upperCase"}};this.model.get("range")&&this._tabPaneTabs.length>1&&(this._tabPaneTabs[1].selected=!0),this._tabPaneView=r(this._tabPaneTabs,l),s(e=this._tabPaneView.collection).call(e,"change:selected",this._onChangeTabPaneViewTab,this),this.$el.append(this._tabPaneView.render().$el),this.addView(this._tabPaneView)},_onChangeTabPaneViewTab:function _onChangeTabPaneViewTab(){var e=this._tabPaneView.getSelectedTabPaneName();"fixed"===e&&(n.each(["domain","bins","attribute","quantification"],function(e){this.model.unset(e,{silent:!0})},this),this.model.get("fixed")||(this.model.get("range")?(this.model.set("fixed",this.model.get("range")[0]),this.model.unset("range")):this.model.set("fixed","#0303FF"))),this.trigger("change",e,this)},_generateFixedContentView:function _generateFixedContentView(){return new l({model:this.model,configModel:this._configModel,userModel:this._userModel,modals:this._modals,editorAttrs:this.options.editorAttrs})},_generateValueContentView:function _generateValueContentView(){return new c({model:this.model,columns:this._columns,configModel:this._configModel,categorizeColumns:this._categorizeColumns,imageEnabled:this._imageEnabled,userModel:this._userModel,modals:this._modals,hideTabs:this._hideTabs,query:this._query})}})},3011:function(e,t,i){var s=i(13),n=i(3),o=i(28),a=i(1),r=i(18),l=i(4),c=i(792),h=i(3010),d=i(59),u=i(2976),p=i(555),g=i(58),m=i(174);e.exports=l.extend({tagName:"section",className:"CDB-OptionInput-item",events:{click:"_onClick"},initialize:function initialize(e){if(this.options.editorAttrs){this._editorAttrs=this.options.editorAttrs,this._imageEnabled=this._editorAttrs.imageEnabled,this._help=this._editorAttrs.help;var t=this._editorAttrs.hidePanes;if(t&&!a.contains(t,m.Panes.BY_VALUE)){if(!e.configModel)throw new Error("configModel param is required");if(!e.userModel)throw new Error("userModel param is required");if(!e.modals)throw new Error("modals param is required");if(!e.query)throw new Error("query param is required")}}if(!e.columns)throw new Error("columns is required");this._columns=e.columns,this._configModel=e.configModel,this._userModel=e.userModel,this._modals=e.modals,this._query=e.query,this._initBinds()},render:function render(){this.clearSubViews(),this.$el.empty(),this.options.disabled&&this.$el.addClass("is-disabled");var e=this._getColumn(),t=e&&e.type,i=this.model.get("domain")&&this.model.get("domain").length;this.model.get("range")&&a.isString(this.model.get("range"))&&this._migrateRange();var s=this.model.get("range")&&this.model.get("range").length,n="string"===t||i&&s,o=this._getImageURL(),r=this._iconStylingEnabled()&&!this._getImageURL()&&this._categoryImagesPresent();return this.$el.html(c({categoryImagesPresent:r,imageURL:o,kind:this._getKind(),showCategories:n,value:this._getValue(),opacity:this._getOpacity(),help:this._help||""})),this._initViews(),this},_initViews:function _initViews(){if(this.iconView=new p({imageClass:"Editor-fillImageAsset",imageUrl:this._getImageURL(),color:this.model.get("fixed")}),this.addView(this.iconView),this.$(".js-image-container").append(this.iconView.render().el),this._help){var e=new g({el:this.$(".js-help"),gravity:"w",title:function title(){return r(this).data("tooltip")},offset:8});this.addView(e)}},_categoryImagesPresent:function _categoryImagesPresent(){var e=this.model.get("images");for(var t in e)if(!a.isEmpty(e[t]))return!0;return!1},_iconStylingEnabled:function _iconStylingEnabled(){return this._imageEnabled},_getKind:function _getKind(){return this.model.get("kind")&&this._iconStylingEnabled()?this.model.get("kind"):""},_getImageURL:function _getImageURL(){return this.model.get("image")&&this._iconStylingEnabled()?this.model.get("image"):""},_migrateRange:function _migrateRange(){var e=this.model.get("range"),t=this.model.get("bins")||3;u[e]&&u[e][t]&&this.model.set("range",u[e][t])},_getColumn:function _getColumn(){return o(a).call(a,this._columns,function(e){return e.label===this.model.get("attribute")},this)},_createContentView:function _createContentView(){var e=new h({configModel:this._configModel,userModel:this._userModel,modals:this._modals,query:this._query,model:this.model,columns:this._columns,editorAttrs:this._editorAttrs});return n(e).call(e,"change",this.render,this),e},_onClick:function _onClick(e){this.options.disabled||this.trigger("click",this.model)},_initBinds:function _initBinds(){var e,t=this;n(e=this.model.set("createContentView",function(){return t._createContentView()})).call(e,this),this.model.on("change:images",this.render,this),this.model.on("change:selected",this._onToggleSelected,this),this.model.on("change:opacity",this.render,this),this.model.on("change:fixed",this.render,this),this.model.on("change:fixed",this._updateColor,this),this.model.on("change:image",this.render,this),this.model.on("change:range",this.render,this)},_updateColor:function _updateColor(){this.iconView&&this.iconView.updateImageColor(this.model.get("fixed"))},_getValue:function _getValue(){var e=this.model.get("fixed");return e&&(e=d.hexToRGBA(e,this._getOpacity())),this.model.get("range")&&this.model.get("range").length&&(e=s(a).call(a,this.model.get("range"),function(e){return d.hexToRGBA(e,this._getOpacity())},this)),e},_getOpacity:function _getOpacity(){return null!=this.model.get("opacity")?this.model.get("opacity"):1},_onToggleSelected:function _onToggleSelected(){this.$el.toggleClass("is-active",this.model.get("selected"))}})},3012:function(e,t,i){var s=i(3),n=i(6),o=i(4),a=i(793);e.exports=o.extend({events:{"click .js-back":"_onClickBack","click .js-bins":"_onClickBins","click .js-quantification":"_onClickQuantification"},render:function render(){return this.clearSubViews(),this._removeForm(),this.$el.empty(),this.$el.append(a({bins:this.model.get("bins"),attribute:this.model.get("attribute"),quantification:this.model.get("quantification")})),this._initForm(),this},_calculateRangeFromFixed:function _calculateRangeFromFixed(e,t){t=t||30;var i=e/(this.options.max-this.options.min);return[Math.floor(Math.max(this.options.min,e-t*i)),Math.floor(Math.min(this.options.max,e+t*i))]},_initForm:function _initForm(){var e,t;this._formView&&this._formView.remove();var i,o,a=this.model.get("range");if(i=o=this.model.get("fixed"),a&&(i=+a[0],o=+a[1]),i===o){var r=this._calculateRangeFromFixed(i);i=r[0],o=r[1],this.model.set("range",r)}this._formModel=new n.Model({min:i,max:o}),this._formModel.schema={min:{type:"Number",validators:["required",{type:"interval",min:this.options.min,max:this.options.max}]},max:{type:"Number",validators:["required",{type:"interval",min:this.options.min,max:this.options.max}]}},s(e=this._formModel).call(e,"change",function(e){this.model.set("range",[+e.get("min"),+e.get("max")])},this),this._formView=new n.Form({className:"Editor-boxList",model:this._formModel}),s(t=this._formView).call(t,"change",function(){this.commit()}),this.$(".js-content").append(this._formView.render().$el)},_removeForm:function _removeForm(){this._formView&&this._formView.remove()},_onClickBack:function _onClickBack(e){this.killEvent(e),this.trigger("back",this)},_onClickQuantification:function _onClickQuantification(e){this.killEvent(e),this.trigger("selectQuantification",this)},_onClickBins:function _onClickBins(e){this.killEvent(e),this.trigger("selectBins",this)},clean:function clean(){this._removeForm(),o.prototype.clean.call(this)}})},3013:function(e,t,i){var s=i(7),n=i(38),o=i(6);e.exports=o.Model.extend({defaults:{position:0},initialize:function initialize(e,t){this.stackLayoutItems=t.stackLayoutItems},goToStep:function goToStep(e){if(e>=this.stackLayoutItems.size())throw new Error("There is no "+e+" stack view in the collection");this.set({position:e},{silent:!0}),this._rememberStep.apply(this,arguments),this._triggerPositionChanged(e,n(Array.prototype).call(arguments,1))},nextStep:function nextStep(){var e=this.get("position"),t=++e;this.goToStep.apply(this,s(Array.prototype).apply([t],arguments))},prevStep:function prevStep(){var e=this.get("position"),t=--e;this.goToStep.apply(this,s(Array.prototype).apply([t],arguments))},goBack:function goBack(){this._goBackToArguments&&this.goToStep.apply(this,this._goBackToArguments)},_triggerPositionChanged:function _triggerPositionChanged(e,t){this.trigger("positionChanged",e,n(Array.prototype).call(t))},_rememberStep:function _rememberStep(){this._goBackToArguments=this._lastStepArguments||[0],this._lastStepArguments=arguments}})},3014:function(e,t,i){var s=i(25),n=i(3),o=i(6),a=i(4),r=i(368),l=i(795),c=i(505),h=i(3012),d=i(174);e.exports=a.extend({events:{"click .js-back":"_onClickBack"},initialize:function initialize(e){if(!e.columns)throw new Error("columns param is required");this._columns=e.columns,this._settings=d.Settings.NUMBER,this._setupModel()},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_setupModel:function _setupModel(){var e={};this.model.get("quantification")||(e.quantification=this._settings.quantifications.items[this._settings.quantifications.defaultIndex]),this.model.get("bins")||(e.bins=this._settings.bins.items[this._settings.bins.defaultIndex]),+this.model.get("bins")>+this._settings.bins.items[this._settings.bins.items.length-1]&&(e.bins=this._settings.bins.items[this._settings.bins.items.length-1]),this.model.set(e)},_initViews:function _initViews(){var e=this,t=new o.Collection([{createStackView:function createStackView(t,i){var s;return n(s=e._createInputRampContentView(t,i)).call(s,e)}},{createStackView:function createStackView(t,i){var s;return n(s=e._createInputNumberContentView(t,i)).call(s,e)}},{createStackView:function createStackView(t,i){var s;return n(s=e._createQuantificationListView(t,i)).call(s,e)}},{createStackView:function createStackView(t,i){var s;return n(s=e._createBinsListView(t,i)).call(s,e)}}]);this._stackLayoutView=new r({collection:t});var i=1;this.model.get("attribute")?this.model.get("quantification")||(i=2):i=0,this._stackLayoutView.model.set("position",i),this.$el.append(this._stackLayoutView.render().$el),this.addView(this._stackLayoutView)},_createInputRampContentView:function _createInputRampContentView(e,t){var i,o=new l({stackLayoutModel:e,columns:s(i=this._columns).call(i,function(e){return"number"===e.type}),showSearch:!0,typeLabel:"column"});return n(o).call(o,"selectItem",function(e){this.model.set("attribute",e.get("val"));var t=1;this.model.get("quantification")||(t=2),this._stackLayoutView.model.goToStep(t)},this),o},_createInputNumberContentView:function _createInputNumberContentView(e,t){var i=new h({stackLayoutModel:e,model:this.model,min:this.options.min,max:this.options.max});return n(i).call(i,"back",function(t){e.prevStep()},this),n(i).call(i,"selectQuantification",function(t){e.goToStep(2)},this),n(i).call(i,"selectBins",function(t){e.goToStep(3)},this),i},_createQuantificationListView:function _createQuantificationListView(e,t){var i=new l({headerTitle:_t("form-components.editors.fill.quantification.title"),stackLayoutModel:e,columns:this._settings.quantifications.items,itemTemplate:c,showSearch:!1});return n(i).call(i,"selectItem",function(t){this.model.set("quantification",t.get("val")),e.prevStep()},this),n(i).call(i,"back",function(t){e.prevStep()},this),i},_createBinsListView:function _createBinsListView(e,t){var i=new l({headerTitle:_t("form-components.editors.fill.bins"),stackLayoutModel:e,columns:this._settings.bins.items});return n(i).call(i,"selectItem",function(t){this.model.set("bins",t.get("val")),e.goToStep(1)},this),n(i).call(i,"back",function(t){e.goToStep(1)},this),i},_onClickBack:function _onClickBack(e){this.killEvent(e)}})},3015:function(e,t,i){var s=i(3),n=i(6),o=i(4);e.exports=o.extend({render:function render(){return this.clearSubViews(),this._removeForm(),this.$el.empty(),this._initForm(),this},_initForm:function _initForm(){var e,t;this._formModel=new n.Model({value:this.model.get("fixed")}),this._formModel.schema={value:{type:"Number",validators:["required",{type:"interval",min:this.options.min,max:this.options.max,step:this.options.step}]}},s(e=this._formModel).call(e,"change",function(e){this.model.set("fixed",e.get("value"))},this),this._formView=new n.Form({className:"CDB-ListDecoration-itemPadding",model:this._formModel}),s(t=this._formView).call(t,"change",function(){this.commit()}),this.$el.append(this._formView.render().$el)},_removeForm:function _removeForm(){this._formView&&this._formView.remove()},clean:function clean(){this._removeForm(),o.prototype.clean.call(this)}})},3016:function(e,t,i){var s=i(1),n=i(4),o=i(558),a=i(557),r=i(3015),l=i(3014),c=i(174);e.exports=n.extend({initialize:function initialize(e){if(!e.columns)throw new Error("columns param is required");this._columns=e.columns,this.listenTo(this.model,"change:attribute",this._updateRangeValue)},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initViews:function _initViews(){var e=this,t={name:"fixed",label:_t("form-components.editors.fill.input-number.fixed"),createContentView:function createContentView(){return e._generateFixedContentView()}},i={name:"value",label:_t("form-components.editors.fill.input-number.by-value"),createContentView:function createContentView(){return e._generateValueContentView()}};if(this._tabPaneTabs=[],this.options.editorAttrs&&this.options.editorAttrs.hidePanes){var n=this.options.editorAttrs.hidePanes;s.contains(n,c.Panes.FIXED)||this._tabPaneTabs.push(t),s.contains(n,c.Panes.BY_VALUE)||this._tabPaneTabs.push(i)}else this._tabPaneTabs=[t,i];var r={tabPaneOptions:{template:o,tabPaneItemOptions:{tagName:"li",klassName:"CDB-NavMenu-item"}},tabPaneItemLabelOptions:{tagName:"button",className:"CDB-NavMenu-link u-upperCase"}};this.model.get("range")&&this._tabPaneTabs.length>1&&(this._tabPaneTabs[1].selected=!0),this._tabPaneView=a(this._tabPaneTabs,r),this.listenTo(this._tabPaneView.collection,"change:selected",this._onChangeTabPaneViewTab),this.addView(this._tabPaneView),this.$el.append(this._tabPaneView.render().$el)},_onChangeTabPaneViewTab:function _onChangeTabPaneViewTab(){var e=this._tabPaneView.getSelectedTabPaneName();"fixed"===e?this._updateFixedValue():this._updateRangeValue(),this.trigger("change",e,this)},_updateFixedValue:function _updateFixedValue(){if(this.model.get("range")){var e=this.model.get("range"),t=.5*(+e[0]+ +e[1]);this.model.set("fixed",t),this.model.unset("range")}},_updateRangeValue:function _updateRangeValue(){if(null!==this.model.get("fixed")&&void 0!==this.model.get("fixed")&&this.model.get("attribute")){var e=this.options.editorAttrs,t=e&&e.defaultRange||[this.model.get("fixed"),this.model.get("fixed")];this.model.set("range",t),this.model.unset("fixed")}},_generateFixedContentView:function _generateFixedContentView(){var e=this.options.editorAttrs;return new r({model:this.model,min:e&&e.min||0,max:e&&e.max||100,step:e&&e.step||1})},_generateValueContentView:function _generateValueContentView(){var e=this.options.editorAttrs;return new l({model:this.model,columns:this._columns,min:e&&e.min||0,max:e&&e.max||100})},_onChangeValue:function _onChangeValue(e){this.model.set("fixed",e.value)}})},3017:function(e,t,i){i(37),i(255),i(23),i(40);var s=i(13),n=i(3),o=i(18),a=i(4),r=i(797),l=i(3016),c=i(58);e.exports=a.extend({tagName:"li",className:"CDB-OptionInput-item",events:{click:"_onClick"},initialize:function initialize(e){if(!e.columns)throw new Error("columns is required");this._columns=e.columns,this.options.editorAttrs&&this.options.editorAttrs.help&&(this._help=this.options.editorAttrs.help),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this.options.disabled&&this.$el.addClass("is-disabled"),this.$el.html(r({help:this._help||"",value:this._getValue()})),this._initViews(),this},_initViews:function _initViews(){if(this._help){var e=new c({el:this.$(".js-help"),gravity:"w",title:function title(){return o(this).data("tooltip")}});this.addView(e)}},_createContentView:function _createContentView(){var e=new l({model:this.model,columns:this._columns,editorAttrs:this.options.editorAttrs});return n(e).call(e,"change",this.render,this),e},_onClick:function _onClick(e){this.options.disabled||this.trigger("click",this.model)},_initBinds:function _initBinds(){var e;this.model.set("createContentView",n(e=function _context(){return this._createContentView()}).call(e,this)),this.listenTo(this.model,"change:selected",this._onToggleSelected),this.listenTo(this.model,"change:fixed",this._onChangeValue),this.listenTo(this.model,"change:range",this._onChangeValue)},_getValue:function _getValue(){function dropDecimal(e){return e.replace(/\.0$/,"")}var e;return this.model.get("range")?s(e=this.model.get("range")).call(e,function(e){return dropDecimal((+e).toFixed(1))}).join(".."):dropDecimal((+this.model.get("fixed")).toFixed(1))},_onChangeValue:function _onChangeValue(){this.$(".js-value").text(this._getValue())},_onToggleSelected:function _onToggleSelected(){this.$el.toggleClass("is-active",this.model.get("selected"))}})},3018:function(e,t,i){i(247),i(31);var s=i(41),n=i(28),o=i(3),a=i(32);i(31);var r=i(6),l=i(1),c=["size","color"];e.exports=r.Collection.extend({constructor:function constructor(e,t){t=l.extend(t||{},{silent:!1}),r.Collection.prototype.constructor.call(this,e,t)},comparator:function comparator(e){return a(c).call(c,e.get("type"))},initialize:function initialize(){var e,t;o(e=this).call(e,"change:selected",this._onSelectedChange,this),o(t=this).call(t,"change",this._onModelsChanged,this)},getSelected:function getSelected(){var e;return n(e=this).call(e,function(e){return e.get("selected")})},unselect:function unselect(){this.each(function(e){e.set("selected",!1)},this)},_onSelectedChange:function _onSelectedChange(e,t){t&&this.each(function(t){t!==e&&t.set("selected",!1)},this)},_onModelsChanged:function _onModelsChanged(e){var t=e.changed;l.isEmpty(t)||1===l.size(t)&&e.changed.hasOwnProperty("selected")||this.trigger("inputChanged",e,this)},getValues:function getValues(){var e;return s(e=this).call(e,function(e,t){var i={},s=t.toJSON();return s.fixed?(i.fixed=s.fixed,"color"===s.type&&(s.image&&(i.image=s.image),s.kind&&(i.kind=s.kind),i.opacity=s.opacity)):i=l.omit(s,["createContentView","selected","type"]),e[s.type]=i,e},{})}})},3019:function(e,t,i){var s=i(3),n=i(1),o=i(6),a=i(186),r=i(1057),l=i(1056),c=i(71),h=i(3018),d=i(3017),u=i(3011),p=i(620),g=i(451),m={size:d,color:u,image:u},f={Jenks:"jenks","Equal Interval":"equal","Heads/Tails":"headtails",Quantile:"quantiles"};o.Form.editors.Fill=o.Form.editors.Base.extend({className:"Form-InputFill CDB-OptionInput CDB-Text js-input",events:{focus:function focus(){this.trigger("focus",this)},blur:function blur(){this.trigger("blur",this)}},initialize:function initialize(e){o.Form.editors.Base.prototype.initialize.call(this,e),a.setOptions(this,e),this.options=n.extend(this.options,{columns:this.options.options,query:this.options.query,configModel:this.options.configModel,userModel:this.options.userModel,editorAttrs:this.options.editorAttrs,modals:this.options.modals}),this._keyAttr=e.key,this.dialogMode=this.options.dialogMode||c.Mode.DEFAULT,this._initBinds(),this._initViews()},_initViews:function _initViews(){this.$el.append(p()),this.options.editorAttrs&&this.options.editorAttrs.disabled&&this.$el.addClass("is-disabled"),this._initFillDialog(),this._initInputFields(),this._popupManager=new g(this.cid,this.$el,this._dialogView.$el)},_initInputFields:function _initInputFields(){var e,t;this._inputCollection=new h,n.each(this.model.get(this._keyAttr),function(e,t){this._inputCollection.add(n.extend({type:t},e))},this),this._inputCollection.each(function(e){var i=e.get("type"),n=m[i];if(!n)throw new Error(i+" is not a valid type of constructor");e.get("quantification")&&f[e.get("quantification")]&&e.set("quantification",f[e.get("quantification")],{silent:!0}),t=new n({model:e,columns:this.options.columns,query:this.options.query,configModel:this.options.configModel,userModel:this.options.userModel,modals:this.options.modals,editorAttrs:this.options.editorAttrs?this.options.editorAttrs[i]:{},disabled:this.options.editorAttrs&&this.options.editorAttrs.disabled}),s(t).call(t,"click",this._onInputClick,this),this.$(".js-content").append(t.render().$el)},this),s(e=this._inputCollection).call(e,"inputChanged",this._onInputChanged,this)},_initBinds:function _initBinds(){this.applyESCBind(function(){this._removeDialog()}),this.applyClickOutsideBind(function(){this._removeDialog()})},_onInputClick:function _onInputClick(e){e.get("selected")?this._removeDialog():(e.set("selected",!0),this._dialogView.model.set("createContentView",e.get("createContentView")),this._dialogView.render(),this._dialogView.show(),this._popupManager.append(this.dialogMode),this._popupManager.track())},_onInputChanged:function _onInputChanged(e){this._adjustImageSize(e),this.trigger("change",this)},_adjustImageSize:function _adjustImageSize(e){if("color"===e.get("type")||"marker"===e.get("kind")){var t=this._inputCollection.findWhere({type:"size"});if(!e.get("image")&&e.hasChanged("image")&&e.previous("image"))t.set("fixed",7);else if(e.get("images")||!e.hasChanged("images")){var i=e.get("image")&&e.hasChanged("image")&&!e.previous("image"),s=n.isEmpty(n.compact(e.get("images"))),o=n.isEmpty(n.compact(e.previous("images"))),a=!s&&e.hasChanged("images")&&o;(i||a)&&t&&t.get("fixed")<20&&t.set("fixed",20)}else t.set("fixed",7)}},_initFillDialog:function _initFillDialog(){var e=new r;this.listenToOnce(e,"destroy",function(){this._dialogView=null,this.stopListening(e)}),this._dialogView=new l({model:e})},_removeDialog:function _removeDialog(e){this._inputCollection.unselect(),this._dialogView.clean(),this._popupManager.untrack()},focus:function focus(){this.hasFocus||this.$(".js-fillInput").focus()},blur:function blur(){this.hasFocus&&this.$(".js-fillInput").blur()},getValue:function getValue(){return this._inputCollection.getValues()},setValue:function setValue(e){},remove:function remove(){this._removeDialog(),this._popupManager.destroy(),this._inputCollection.unbind("inputChanged",this._onInputChanged,this),o.Form.editors.Base.prototype.remove.apply(this)}})},3020:function(e,t,i){var s=i(76),n=i(32),o=i(3),a=i(195),r=i(18),l=i(1),c=i(6),h=i(186),d=i(798),u=window.MutationObserver,p="lowest";c.Form.editors.Slider=c.Form.editors.Base.extend({className:"rangeslider--no-fill",options:{direction:"horizontal",initial:p},events:{"change .js-slider":"_onValueChange",focus:function focus(){this.trigger("focus",this)},blur:function blur(){this.trigger("blur",this)}},initialize:function initialize(e){var t,i;if(c.Form.editors.Base.prototype.initialize.call(this,e),h.setOptions(this,e),!this.options.labels)throw new Error("labels is required");if(a(this.options)&&this.options.labels.length!==a(this.options).length)throw new Error("values and labels should have the same length");void 0!==this.options.value&&(this.value=this.options.value),this._onValueChange=o(t=this._onValueChange).call(t,this),this._onSlideChange=o(i=this._onSlideChange).call(i,this),this._values=a(this.options),this._labels=this.options.labels,this._getInitialTickID(),this._updateUI()},render:function render(){var e=this.options.disabled||this._labels.length<=0,t=0===this._labels.length?4:this._labels.length-1,i=this._getStepPercentage();return this.$el.html(d({orientation:this.options.direction,disabled:e,min:0,max:t,value:this.rangeIndex})),this._renderSlider(),this._addTicks(i),this._updateUI(),this},_getInitialTickID:function _getInitialTickID(){var e,t=this.value;this._values&&this._values.length>0?-1===(t=n(e=this._values).call(e,this.value))&&(t=this.options.initial===p?0:this._values.length-1):this.value||(t=0);this.rangeIndex=t},_getNumberOfValues:function _getNumberOfValues(){return this._values&&this._values.length||0},_renderSlider:function _renderSlider(){var e,t,i,s,n;u?(e=document.body,t=this.$(".js-slider").get(0),i=o(n=function _context4(){e.contains(t)&&(this._initializeSlider(),s.disconnect())}).call(n,this),s=new u(i),i(),s.observe(e,{subtree:!0,childList:!0})):this._initializeSlider()},_initializeSlider:function _initializeSlider(){var e,t=this._getNumberOfValues(),i=o(e=function _context5(){this.$(".js-slider").rangeslider({polyfill:!1,fillClass:"rangesliderFill",handleClass:"rangesliderHandle",onSlideEnd:this._onSlideChange})}).call(e,this);1!==t&&(u?i():s(i,0)),this.$(".js-slider").toggle(1!==t)},_updateUI:function _updateUI(){this._updateLabel(this.rangeIndex),this._highlightTick(this.rangeIndex)},_addTicks:function _addTicks(e){var t=this._getNumberOfValues(),i=this._labels.length>0?this._labels.length:5;l.each(l.range(i),function(t,i){r('<div class="rangeslider-tick js-tick"></div>').css("left",e*i+6+"px").appendTo(this.$(".js-ticks"))},this),this.$(".js-ticks").toggle(1!==t)},_highlightTick:function _highlightTick(e){this.$(".js-tick").removeClass("is-highlighted"),r(this.$(".js-tick").get(e)).addClass("is-highlighted")},_updateLabel:function _updateLabel(e){var t=this._labels[e];this._labels.length<=0&&(t=_t("form-components.editors.slide.no-values")),this.$(".js-label").text(t)},_getStepPercentage:function _getStepPercentage(){return 148/this._getSteps()},_getSteps:function _getSteps(){var e=this._labels.length-1;return e<0&&(e=4),e},_onValueChange:function _onValueChange(e){var t=this.$(".js-slider").val();this._onSlideChange(null,t)},_onSlideChange:function _onSlideChange(e,t){this.rangeIndex=+t,this.value=this._values&&this._values.length>0?this._values[this.rangeIndex]:this.rangeIndex,this._updateUI(this.rangeIndex),this.trigger("change",this)},getValue:function getValue(){var e=this._values&&this._values.length>0?this._values[this.rangeIndex]:null;return this.value||e},setValue:function setValue(e){var t,i=this._values?n(t=this._values).call(t,e):e;this.$(".js-slider").val(i).change(),this.value=e},_destroySlider:function _destroySlider(){this.$(".js-slider").off("change",this._onValueChange),this.$(".js-slider").rangeslider("destroy")},remove:function remove(){this._destroySlider(),c.Form.editors.Base.prototype.remove.apply(this)},clean:function clean(){this.$el.remove()}})},3021:function(e,t,i){var s=i(6),n=i(186);s.Form.editors.List.CategoryModel=s.Form.editors.NestedModel.extend({initialize:function initialize(e){if(s.Form.editors.Base.prototype.initialize.call(this,e),n.setOptions(this,e),!this.form)throw new Error('Missing required option "form"');if(!e.schema.model)throw new Error('Missing required "schema.model" option for NestedModel editor')},render:function render(){var e=this.form.constructor,t=this.value||{},i=this.schema.model,s=t.constructor===i?t:new i(t,this.options);return this.nestedForm=new e({model:s,idPrefix:this.cid+"_",fieldTemplate:"nestedField"}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this}})},3022:function(e,t,i){var s=i(3),n=i(6),o=i(1);i(369),n.Form.editors.SortableList=n.Form.editors.List.extend({initialize:function initialize(){n.Form.editors.List.prototype.initialize.apply(this,arguments)},render:function render(){return n.Form.editors.List.prototype.render.apply(this,arguments),this._initSortable(),this},addItem:function addItem(){return n.Form.editors.List.prototype.addItem.apply(this,arguments),this._updateEditability(),this},removeItem:function removeItem(){return n.Form.editors.List.prototype.removeItem.apply(this,arguments),this._updateEditability(),this},_initSortable:function _initSortable(){var e;this.$list.sortable({axis:"y",items:".js-sortable",tolerance:"pointer",containment:this.$list,forceHelperSize:!0,forcePlaceholderSize:!0,update:s(e=this._onSortableUpdate).call(e,this)})},_onSortableUpdate:function _onSortableUpdate(e,t){var i=[],s=this.$list,n=this.items;o.each(n,function(e){var t=e.$el.index(s.$el);i[t]=e}),this.items=i,this.commit()},_updateEditability:function _updateEditability(){this.items.length>1?(this.$(".js-sortable").addClass("is-movable"),this.$(".js-editable").removeClass("is-hidden")):(this.$(".js-sortable").removeClass("is-movable"),this.$(".js-editable").addClass("is-hidden"))}})},3023:function(e,t,i){var s=i(250),n=i(199),o=i(28),a=i(6),r=i(18),l=i(1),c=i(186),h=i(58);a.Form.editors.List.Item=a.Form.editors.Base.extend({events:{'click [data-action="remove"]':function clickDataActionRemove(e){e.preventDefault(),this.list.removeItem(this)},"keydown input[type=text]":function keydownInputTypeText(e){var t;13===e.keyCode&&(e.preventDefault(),this.list.addItem(null,!0),o(t=this.list.$list).call(t,"input:last").focus())}},initialize:function initialize(e){c.setOptions(this,e),this.list=e.list,this.schema=e.schema||this.list.schema,this.Editor=e.Editor||a.Form.editors.Text,this.template=e.template||this.schema.itemTemplate||this.constructor.template,this.errorClassName=e.errorClassName||this.constructor.errorClassName},render:function render(){this.editor=new this.Editor({key:this.options.key,schema:this.schema,value:this.options.value,list:this.options.list,item:this,form:this.options.form,trackingClass:this.options.trackingClass},{userModel:this.options.userModel,configModel:this.options.configModel,modals:this.options.modals}).render();var e=r(n(r).call(r,this.template()));o(e).call(e,"[data-editor]").append(this.editor.el);var t=o(e).call(e,".js-remove-help");return t.length&&(this._removeTooltip(),this._tooltip=new h({el:t,gravity:"w",title:function title(){return _t("editor.legend.tooltips.item.remove")}})),this.setElement(e),this},getValue:function getValue(){return this.editor.getValue()},setValue:function setValue(e){this.editor.setValue(e)},focus:function focus(){this.editor.focus()},blur:function blur(){this.editor.blur()},validate:function validate(){var e=this.getValue(),t=this.list.form?this.list.form.getValue():{},i=this.schema.validators,n=this.getValidator;if(!i)return null;var o=null;return s(l).call(l,i,function(i){return!!(o=n(i)(e,t))}),o?this.setError(o):this.clearError(),o||null},setError:function setError(e){this.$el.addClass(this.errorClassName),this.$el.attr("title",e.message)},clearError:function clearError(){this.$el.removeClass(this.errorClassName),this.$el.attr("title",null)},_removeTooltip:function _removeTooltip(){this._tooltip&&this._tooltip.clean()},remove:function remove(){this._removeTooltip(),this.editor.remove(),a.Form.editors.Base.prototype.remove.apply(this)},clean:function clean(){this.$el.remove()}},{template:l.template('      <div>        <span data-editor></span>        <button type="button" data-action="remove">&times;</button>      </div>    ',null,a.Form.templateSettings),errorClassName:"error"})},3024:function(e,t,i){i(37);var s=i(3),n=i(13),o=i(32),a=i(76),r=i(180),l=i(41),c=i(28),h=i(199),d=i(18),u=i(1),p=i(6),g=i(186),m=i(58),f=["userModel","configModel","modals","layerDefinitionModel","trackingClass"];p.Form.editors.List=p.Form.editors.Base.extend({events:{'click [data-action="add"]':function clickDataActionAdd(e){e.preventDefault(),this._canAddNewItems()&&this.addItem(null,!0)}},initialize:function initialize(e){e=e||{};var t=p.Form.editors;t.Base.prototype.initialize.call(this,e),g.setOptions(this,e);var i,s=this.schema;if(!s)throw new Error("Missing required option 'schema'");this.template=e.template||s.listTemplate||this.constructor.template,this.Editor=(i=s.itemType)?t.List[i]?t.List[i]:t[i]:t.Text,u.each(f,function(e){this.options[e]&&(this["_"+e]=this.options[e])},this),this.items=[],this.errors=[],this._initBinds()},render:function render(){var e=this,t=this.value||[],i=d(h(d).call(d,this.template()));return this.$list=i.is("[data-items]")?i:c(i).call(i,"[data-items]"),this.setElement(i),this.$el.attr("id",this.id),this.$el.attr("name",this.key),t.length?u.each(t,function(t){e.addItem(t)}):this.Editor.isAsync||this.addItem(null,!0),this.hasFocus&&this.trigger("blur",this),this.validate(),this},_initBinds:function _initBinds(){this.options.maxItems&&this.listenTo(this,"add remove",this._setAddButtonState)},addItem:function addItem(e,t){var i=this,s=p.Form.editors,n={list:this,form:this.form,schema:this.schema,value:e,Editor:this.Editor,key:this.key},o=l(u).call(u,f,function(e,t){return this.options[t]&&(e[t]=this["_"+t]),e},{},this),h=u.extend({},n,o),d=new s.List.Item(h).render(),g=function _addItem(){i.items.push(d),i.$list.append(d.el),d.editor.on("all",function(e){if("change"!==e){var t=u.toArray(arguments);t[0]="item:"+e,r(t).call(t,1,0,i),s.List.prototype.trigger.apply(this,t)}},i),d.editor.on("change",function(){d.addEventTriggered||(d.addEventTriggered=!0,this.trigger("add",this,d.editor)),this.trigger("item:change",this,d.editor),this.trigger("change",this)},i),d.editor.on("focus",function(){this.hasFocus||this.trigger("focus",this)},i),d.editor.on("blur",function(){if(this.hasFocus){var e=this;a(function(){c(u).call(u,e.items,function(e){return e.editor.hasFocus})||e.trigger("blur",e)},0)}},i),(t||e)&&(d.addEventTriggered=!0),t&&(i.trigger("add",i,d.editor),i.trigger("change",i))};return this.Editor.isAsync?d.editor.on("readyToAdd",g,this):(g(),d.editor.focus()),d},removeItem:function removeItem(e){var t,i=this.schema.confirmDelete;if(!i||confirm(i)){var s=o(u).call(u,this.items,e);this.items[s].remove(),r(t=this.items).call(t,s,1),e.addEventTriggered&&(this.trigger("remove",this,e.editor),this.trigger("change",this)),this.items.length||this.Editor.isAsync||this.addItem()}},getValue:function getValue(){var e=n(u).call(u,this.items,function(e){return e.getValue()});return u.without(e,void 0,"")},setValue:function setValue(e){this.value=e,this.render()},focus:function focus(){this.hasFocus||this.items[0]&&this.items[0].editor.focus()},blur:function blur(){if(this.hasFocus){var e=c(u).call(u,this.items,function(e){return e.editor.hasFocus});e&&e.editor.blur()}},remove:function remove(){u.invoke(this.items,"remove"),p.Form.editors.Base.prototype.remove.call(this)},validate:function validate(){if(!this.validators)return null;var e=n(u).call(u,this.items,function(e){return e.validate()});this.options.maxItems&&this.options.maxItems<this.items.length&&e.push(_t("form-components.editors.list.max-items")),this.errors=u.compact(e);var t=!!this.errors.length;return this._setAddButtonState(),t?void 0:null},_errorPresenter:function _errorPresenter(e){var t;return u.unique(n(t=this.errors).call(t,function(e){return e.message})).join("\n")},_setAddButtonState:function _setAddButtonState(){var e,t=this._getAddButtonElement(),i=!!this.errors.length;(t.toggleClass("is-disabled",i),i)?this._errorTooltip=new m({el:t,gravity:"s",offset:0,title:s(e=this._errorPresenter).call(e,this)}):this._errorTooltip&&(this._errorTooltip.clean(),this._errorTooltip=null);this.options.maxItems&&t.toggle(this.items.length<this.options.maxItems)},_getAddButtonElement:function _getAddButtonElement(){return this.$('[data-action="add"]')},_canAddNewItems:function _canAddNewItems(){var e=this.options,t=e.maxItems&&e.maxItems<=this.items.length||!1;return!this.errors.length&&!t}},{template:u.template('      <div>        <div data-items></div>        <button type="button" data-action="add">Add</button>      </div>    ',null,p.Form.templateSettings)})},3025:function(e,t,i){var s=i(32),n=i(25),o=i(198),a=i(1);e.exports=o.extend({search:function search(e){var t;return e=e.toLowerCase(),a(n(t=this).call(t,function(t){var i=t.getName().toLowerCase(),n=t.get("type").toLowerCase();return~s(i).call(i,e)&&"number"===n}))}})},3026:function(e,t,i){var s=i(6);e.exports=s.Model.extend({defaults:{visible:!1,operator:"count",attribute:""},isValidOperator:function isValidOperator(){var e=this.get("operator"),t=this.get("attribute");return"count"===e||!(!e||!t)}})},3027:function(e,t,i){i(31);var s=i(3);i(31);var n=i(4),o=i(1),a=i(18),r=i(396),l=i(623),c=i(3026),h=i(801),d=i(800);e.exports=n.extend({className:"Editor-dropdown Editor-boxModal Editor-dropdownOperators",tagName:"div",events:{'change input[name="operator"]':"_onOperationChange"},initialize:function initialize(e){this.model=new c({operator:e.operator,attribute:e.attribute,visible:!1}),e.attribute&&this.collection.setSelected(e.attribute),this._initBinds()},render:function render(){var e;return this.clearSubViews(),this.$el.empty(),this.$el.append(d({operator:this.model.get("operator")})),this._renderList(),this._dropdownOverlay=new l({onClickAction:s(e=this.hide).call(e,this),visible:this.model.get("visible")}),this.addView(this._dropdownOverlay),this},_initBinds:function _initBinds(){var e,t,i,n;s(e=this.model).call(e,"change:operator change:attribute",o.debounce(s(t=this._onModelChange).call(t,this),10)),s(i=this.model).call(i,"change:visible",function(e,t){this._toggleVisibility(),t?this.render():(this._destroyList(),this.$(".js-list").html(h()))},this),s(n=this.collection).call(n,"change:selected",this._onAttributeSelected,this),this.add_related_model(this.collection)},_hasList:function _hasList(){return!!this._listView},_renderList:function _renderList(){if("count"!==this.model.get("operator")){if(this._hasList())return;this._listView=new r({className:"CDB-Dropdown-options CDB-Text CDB-Size-medium",collection:this.collection,showSearch:!0,typeLabel:this.options.keyAttr}),this.$(".js-list").html(this._listView.render().el)}else this._destroyList(),this.$(".js-list").html(h())},_destroyList:function _destroyList(){this._hasList()&&(this.removeView(this._listView),this._listView.clean(),delete this._listView)},_onModelChange:function _onModelChange(){this.model.isValidOperator()&&this.trigger("change",this.model.toJSON(),this)},_onOperationChange:function _onOperationChange(e){var t=a(e.target).val();"count"===t&&(this.model.set("attribute",""),this.collection.removeSelected()),this.model.set("operator",t),this._renderList()},_onAttributeSelected:function _onAttributeSelected(e){e.get("selected")&&this.model.set("attribute",e.getValue())},_toggleVisibility:function _toggleVisibility(){this.$el.toggleClass("is-visible",!!this.model.get("visible"))},show:function show(){this.model.set("visible",!0)},hide:function hide(){this.model.set("visible",!1)},toggle:function toggle(){this.model.set("visible",!this.model.get("visible"))},isVisible:function isVisible(){return this.model.get("visible")},remove:function remove(){this._destroyList(),this.$el.empty(),n.prototype.remove.call(this)}})},3028:function(e,t,i){var s=i(3),n=i(6),o=i(186),a=i(1),r=i(18),l=i(3027),c=i(3025),h=i(799),d=i(451),u=i(71),p=i(58);n.Form.editors.Operators=n.Form.editors.Base.extend({tagName:"div",className:"Editor-formSelect u-ellipsis",events:{"click .js-button":"_onButtonClick","keydown .js-button":"_onButtonKeyDown","focus .js-button":function focusJsButton(){this.trigger("focus",this)},blur:function blur(){this.trigger("blur",this)}},initialize:function initialize(e){n.Form.editors.Base.prototype.initialize.call(this,e),o.setOptions(this,e),this.collection=new c(this.options.options),this.dialogMode=this.options.dialogMode||u.Mode.DEFAULT,this.options.editorAttrs&&this.options.editorAttrs.help&&(this._help=this.options.editorAttrs.help),this._initViews(),this.setValue(this.model.get(this.options.keyAttr)),this._initBinds()},_initViews:function _initViews(){var e,t=this.model.get(this.options.keyAttr);this.$el.append(r("<div>").addClass("js-operator")),this._setOperatorTemplate(),this._operatorsListView=new l({operator:t.operator,attribute:t.attribute,collection:this.collection}),s(e=this._operatorsListView).call(e,"change",this._onOperatorsChange,this),this._popupManager=new d(this.cid,this.$el,this._operatorsListView.$el),this._popupManager.append(this.dialogMode),this.options.disabled&&this.undelegateEvents()},_setOperatorTemplate:function _setOperatorTemplate(){this.$(".js-operator").html(h({name:this._getOperatorsTextValue(),disabled:this.options.disabled,keyAttr:this.options.keyAttr,help:this._help||""})),this._help&&(this._removeTooltip(),this._helpTooltip=new p({el:this.$(".js-help"),gravity:"w",title:function title(){return r(this).data("tooltip")}}))},_initBinds:function _initBinds(){var e,t=s(e=function _context2(){this._operatorsListView.hide(),this._popupManager.untrack()}).call(e,this);this.applyESCBind(t),this.applyClickOutsideBind(t)},_onOperatorsChange:function _onOperatorsChange(e){this.model.set(this.options.keyAttr,e),this._setOperatorTemplate(),this.$(".js-button").focus(),this.trigger("change",this)},_getOperatorsTextValue:function _getOperatorsTextValue(){var e=this.model.get(this.options.keyAttr);return e&&e.operator?e.operator.toUpperCase()+(e.attribute?"("+e.attribute+")":""):""},_onButtonClick:function _onButtonClick(e){this._operatorsListView.toggle(),this._operatorsListView.isVisible()?this._popupManager.track():this._popupManager.untrack()},_onButtonKeyDown:function _onButtonKeyDown(e){13===e.which&&(e.preventDefault(),this._operatorsListView.isVisible()?this._popupManager.untrack():(e.stopPropagation(),this._operatorsListView.toggle(),this._popupManager.track()))},getValue:function getValue(){var e=this.model.get(this.options.keyAttr);return a.omit(e,"visible")},setValue:function setValue(e){var t=this._getOperatorsTextValue();this.value=t,this._setOperatorTemplate()},_removeTooltip:function _removeTooltip(){this._helpTooltip&&this._helpTooltip.clean()},remove:function remove(){this._removeTooltip(),this._popupManager&&this._popupManager.destroy(),this._operatorsListView&&this._operatorsListView.clean(),n.Form.editors.Base.prototype.remove.call(this)},clean:function clean(){this.$el.remove()}})},3029:function(e,t,i){var s=i(453),n=i(1);e.exports=s.extend({render:function render(){return this.$el.empty(),this.clearSubViews(),this.$el.append(this.options.template(n.extend({typeLabel:this.options.typeLabel,isSelected:this.model.get("selected"),isSourceType:this.model.get("isSourceType"),name:this.model.getName(),val:this.model.getValue()},this.model.attributes))),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")),this}})},3030:function(e,t,i){var s=i(6),n=i(3029),o=i(803),a=i(802);s.Form.editors.NodeDataset=s.Form.editors.Select.extend({options:{selectedItemTemplate:o,itemListTemplate:a,customListItemView:n}})},3031:function(e,t,i){var s=i(3),n=i(18),o=i(1),a=i(6),r=i(186),l=i(58),c=i(804);a.Form.editors.EnablerEditor=a.Form.editors.Base.extend({tagName:"div",className:"Editor-checker u-flex u-alignCenter",events:{"click .js-check":"_onCheckClicked"},initialize:function initialize(e){if(a.Form.editors.Base.prototype.initialize.call(this,e),r.setOptions(this,e),this.validators=null,!this.options.editor)throw new Error("editor options is required");this._editorOptions=this.options.editor,this.value=this.model.get(e.key),this._checkModel=new a.Model({enabled:!!this.value}),this.template=c,this._initBinds()},render:function render(){return this.$el.html(this.template({label:this.options.label,isChecked:this._isChecked(),help:this.options.help||"",isDisabled:!!this.options.isDisabled,id:this.cid})),this.options.help&&(this._helpTooltip=new l({el:this.$(".js-help"),gravity:"s",offset:0,title:function title(){return n(this).data("tooltip")}})),this._renderComponent(),this},_initBinds:function _initBinds(){var e;s(e=this._checkModel).call(e,"change:enabled",function(e,t){this._manageValue(t),this._renderComponent(),this._triggerChange()},this)},_manageValue:function _manageValue(e){e?(this.validators=this.options.validators,this.value=this.options.defaultValue||"",this._editorComponent.setValue(this.options.defaultValue||"")):(this.validators=null,this.value="",this._editorComponent.setValue("")),this.model.set(this.options.keyAttr,this.value),this.validate()},_isChecked:function _isChecked(){return this._checkModel.get("enabled")},_renderComponent:function _renderComponent(){var e;this._editorComponent&&this._removeComponent();var t=!this._isChecked()||this.options.isDisabled,i=a.Form.editors[this._editorOptions.type],n=o.extend(this._editorOptions.editorAttrs||{},{disabled:t});this._editorComponent=new i(o.extend({model:this.model,key:this.options.keyAttr,editorAttrs:n,trackingClass:this.options.trackingClass,editorType:this._editorOptions.type},o.omit(this._editorOptions,"editorAttrs","type"))),s(e=this._editorComponent).call(e,"change",this._setEditorComponentValue,this),this.$(".js-editor").html(this._editorComponent.render().el);try{this._editorComponent.focus()}catch(e){}},_removeComponent:function _removeComponent(){this._editorComponent.remove(),this._editorComponent.unbind("change",this._setEditorComponentValue,this)},_setEditorComponentValue:function _setEditorComponentValue(){this.value=this._editorComponent.getValue(),this._triggerChange()},_triggerChange:function _triggerChange(){this.trigger("change",this)},getValue:function getValue(){return this._checkModel.get("enabled")&&this._editorComponent&&this._editorComponent.getValue()||""},setValue:function setValue(e){this._checkModel.set("enabled",!!e),this._editorComponent&&this._editorComponent.setValue(e),this.value=e},_onCheckClicked:function _onCheckClicked(e){this._checkModel.set("enabled",n(e.target).is(":checked"))},remove:function remove(){this._editorComponent&&this._removeComponent(),this._helpTooltip&&this._helpTooltip.clean(),a.Form.editors.Base.prototype.remove.call(this)}})},3032:function(e,t,i){var s=i(3),n=i(13),o=i(1),a=i(6),r=i(805);a.Form.editors.Toggle=a.Form.editors.Radio.extend({className:"Editor-formLabel CDB-Text CDB-Size-medium u-alignCenter",_arrayToHtml:function _arrayToHtml(e){var t,i=this.getName(),a=this.id,l=n(o).call(o,e,s(t=function _context(e,t){var s=this.form.model.get(this.key),n={name:i,id:a+"-"+t};return o.isObject(e)?(n.value=e.val||0===e.val?e.val:"",n.label=e.label,n.help=e.help,n.labelHTML=e.labelHTML,n.selected=void 0!==s?s===e.val:e.selected):(n.value=e,n.label=e,n.selected=void 0!==s?s===e:e.selected),n}).call(t,this));return r({items:l})}})},3033:function(e,t,i){var s=i(6),n=i(186),o=i(18),a=i(58),r=i(807),l=i(806);s.Form.editors.Enabler=s.Form.editors.Base.extend({tagName:"div",events:{"change .js-input":"_onCheckChange","focus .js-input":function focusJsInput(){this.trigger("focus",this)},"blur .js-input":function blurJsInput(){this.trigger("blur",this)}},initialize:function initialize(e){s.Form.editors.Base.prototype.initialize.call(this,e),n.setOptions(this,e),this.template=e.schema&&e.schema.editorAttrs&&e.schema.editorAttrs.reversed?l:e.template||r,this._initViews()},_initViews:function _initViews(){this.$el.html(this.template({checked:!this.options.disabled&&this.model.get(this.options.key),label:this.options.label,id:this.options.inputId,title:this.options.title,help:this.options.help||"",disabled:this.options.disabled})),this.options.help&&(this._removeTooltip(),this._helpTooltip=new a({el:this.$(".js-help"),gravity:"s",title:function title(){return o(this).data("tooltip")}})),this.options.disabled&&this.undelegateEvents()},_onCheckChange:function _onCheckChange(){var e=this.$(".js-input").is(":checked");this.model.set("enabler",e),this.trigger("change",this)},getValue:function getValue(){return this.$(".js-input").is(":checked")},setValue:function setValue(e){this.$(".js-input")[e?"attr":"removeAttr"]("checked",""),this.model.set(this.key,e)},_removeTooltip:function _removeTooltip(){this._helpTooltip&&this._helpTooltip.clean()},remove:function remove(){this._removeTooltip(),s.Form.editors.Base.prototype.remove.apply(this)}})},3034:function(e,t,i){i(34),i(88);var s=i(13),n=i(28),o=i(6),a=i(186),r=i(808),l=i(1),c=i(18),h=i(58);o.Form.editors.Radio=o.Form.editors.Radio.extend({className:"CDB-Text CDB-Size-medium u-flex u-alignCenter",initialize:function initialize(e){o.Form.editors.Base.prototype.initialize.apply(this,arguments),a.setOptions(this,e)},render:function render(){return this.setOptions(this.schema.options),this._setHelp(),this},_setHelp:function _setHelp(){n(l).call(l,this.schema.options,function(e){return e.help})&&(this._helpTooltip=this._createTooltip({$el:this.$(".js-help")}))},_createTooltip:function _createTooltip(e){return new h({el:e.$el||this.$el,gravity:e.gravity||"s",className:e.className||"",offset:e.offset||0,title:function title(){return e.msg||c(this).data("tooltip")}})},getValue:function getValue(){var e=this.$("input[type=radio]:checked").val();return""===e?null:e},_arrayToHtml:function _arrayToHtml(e){var t=this.form.model.get(this.key),i=s(l).call(l,e,function(e,i){var s=e.val,n={name:this.getName(),value:null===s?"":s.toString(),help:e.help,id:this.id,label:e.label,className:e.className};return t===s?n.selected=!0:n.disabled=e.disabled,n},this);return r({items:i})},_destroyBinds:function _destroyBinds(){},remove:function remove(){this._helpTooltip&&this._helpTooltip.clean(),o.Form.editors.Base.prototype.remove.call(this)}})},3035:function(e,t,i){var s=i(453);e.exports=s.extend({_onClick:function _onClick(e){this.killEvent(e),this.model.set("selected",!this.model.get("selected"))}})},3036:function(e,t,i){var s=i(1),n=i(198);e.exports=n.extend({_initBinds:function _initBinds(){},setSelected:function setSelected(e){var t,i={silent:!0};return s.isArray(e)?this.each(function(n){s.contains(e,n.getValue())?(n.set({selected:!0},i),t=n):n.set({selected:!1},i)}):this.each(function(s){s.getValue()===e?(s.set({selected:!0},i),t=s):s.set({selected:!1},i)}),t}})},3037:function(e,t,i){var s=i(13),n=i(3),o=i(6),a=i(186),r=i(1),l=i(396),c=i(3036),h=i(624),d=i(3035),u=i(809),p=i(559),g=i(451),m=i(71);o.Form.editors.MultiSelect=o.Form.editors.Base.extend({tagName:"div",className:"u-ellipsis Editor-formSelect",events:{"click .js-button":"_onButtonClick","keydown .js-button":"_onButtonKeyDown","focus .js-button":function focusJsButton(){this.trigger("focus",this)},blur:function blur(){this.trigger("blur",this)}},options:{selectedItemTemplate:h,itemListTemplate:u,customListItemView:d},initialize:function initialize(e){a.setOptions(this,e),this.collection=new c(e.schema.options),this.dialogMode=this.options.dialogMode||m.Mode.DEFAULT,this._initViews(),this.setValue(this.model.get(e.key)),o.Form.editors.Base.prototype.initialize.call(this,e),this._initBinds()},_getLabel:function _getLabel(){var e=r.compact(this.collection.pluck("selected")).length;return _t("components.backbone-forms.select.selected",{count:e})},_initViews:function _initViews(){var e,t,i,s=this.options.loading,o=!this.collection.length,a=!!o||this.options.disabled,r=this._getLabel(),c=null===r,h=c?"null":r;this.$el.html(p({label:h,keyAttr:this.options.keyAttr,isDisabled:a,isLoading:s,isEmpty:o,isNull:c,placeholder:null,help:this.options.help})),a&&this.undelegateEvents(),this._listView=new l({collection:this.collection,showSearch:this.options.showSearch,typeLabel:this.options.keyAttr,itemTemplate:this.options.itemListTemplate,itemView:this.options.customListItemView,actions:[{label:_t("components.backbone-forms.select.none"),action:n(e=this._deselectAll).call(e,this)},{label:_t("components.backbone-forms.select.all"),action:n(t=this._selectAll).call(t,this)}],searchPlaceholder:"Search"}),n(i=this._listView).call(i,"hidden",this._onHide,this),this._popupManager=new g(this.cid,this.$el,this._listView.$el),this._popupManager.append(this.dialogMode)},_initBinds:function _initBinds(){var e,t,i=n(e=function _context4(){this._listView.hide(),this._popupManager.untrack()}).call(e,this);n(t=this.collection).call(t,"change:selected",r.debounce(this._onItemSelected,50),this),this.applyESCBind(i),this.applyClickOutsideBind(i)},_selectAll:function _selectAll(){this.collection.each(function(e){e.set("selected",!0)})},_deselectAll:function _deselectAll(){this.collection.each(function(e){e.set("selected",!1)})},_onItemSelected:function _onItemSelected(e){this._renderButton(e).focus(),this.trigger("change",this)},_onButtonClick:function _onButtonClick(e){this._listView.toggle(),this._listView.isVisible()?this._popupManager.track():this._popupManager.untrack()},_onButtonKeyDown:function _onButtonKeyDown(e){13===e.which&&(e.preventDefault(),this._listView.isVisible()?this._popupManager.untrack():(e.stopPropagation(),this._listView.toggle(),this._popupManager.track()))},_getSelectedValues:function _getSelectedValues(){var e;return s(e=this.collection.chain()).call(e,function(e){return e.get("selected")?e.get("val"):null}).compact().value()},getValue:function getValue(){var e=this._getSelectedValues();if(e.length>0)return e},setValue:function setValue(e){if(e){var t=this.collection.setSelected(e);t&&this._renderButton(t)}},_renderButton:function _renderButton(e){var t=this.$(".js-button"),i=r.extend({},e.attributes,{label:this._getLabel()}),s=this.options.selectedItemTemplate(i);return t.removeClass("is-empty").html(s),t},_onHide:function _onHide(){this._getSelectedValues().length>0&&this.trigger("change",this)},remove:function remove(){this._popupManager&&this._popupManager.destroy(),this._listView&&this._listView.clean(),o.Form.editors.Base.prototype.remove.call(this)}})},3038:function(e,t,i){var s=i(6);s.Form.editors.SelectPlaceholder=s.Form.editors.Select.extend({initialize:function initialize(e){s.Form.editors.Select.prototype.initialize.call(this,e)},_renderButton:function _renderButton(e){s.Form.editors.Select.prototype._renderButton.call(this,e),this.options.forcePlaceholder&&this._getButton().addClass("is-empty")},_getLabel:function _getLabel(){return this.options.forcePlaceholder?this.options.placeholder:s.Form.editors.Select.prototype._getLabel.call(this)},_hasValue:function _hasValue(){return!this.options.forcePlaceholder&&s.Form.editors.Select.prototype._hasValue.call(this)},_getButtonTemplateData:function _getButtonTemplateData(e){var t=s.Form.editors.Select.prototype._getButtonTemplateData.call(this,e);return this.options.forcePlaceholder&&(t.label=this.options.placeholder),t}})},3039:function(e,t,i){var s=i(4),n=i(811);e.exports=s.extend({className:"CDB-Text CDB-Size-small is-semibold u-upperCase u-actionTextColor u-lSpace--xl",tagName:"button",events:{click:"_onClick"},initialize:function initialize(e){this.options=e},render:function render(){return this.$el.empty(),this.clearSubViews(),this.$el.append(n({label:this.options.label})),this},_onClick:function _onClick(){this.options.action&&this.options.action()}})},3040:function(e,t,i){var s=i(4),n=i(817);e.exports=s.extend({className:"CustomList--full",tagName:"form",events:{"keyup .js-search":"_onSearchType","click .js-clear":"_onClickClear",submit:"_submit"},initialize:function initialize(){this.template=this.options.template||n,this.searchPlaceholder=this.options.searchPlaceholder||_t("components.custom-list.placeholder",{typeLabel:this.options.typeLabel}),this._initBinds()},render:function render(){return this.$el.empty().append(this.template({query:this.model.get("query"),searchPlaceholder:this.searchPlaceholder})),this},_initBinds:function _initBinds(){this.model.on("change:query",this._checkButtons,this)},_checkButtons:function _checkButtons(){var e=this.model.get("query");this.$(".js-clear").toggleClass("u-transparent",0===e.length)},_onSearchType:function _onSearchType(e){this._submit()},_onClickClear:function _onClickClear(e){e.stopPropagation(),this.model.set("query",""),this.render(),this.focus()},focus:function focus(){this.$(".js-search").focus()},_submit:function _submit(e){this.killEvent(e);var t=this.$(".js-search").val();this.model.set("query",t)}})},3041:function(e,t,i){var s=i(3),n=i(6),o=i(4),a=i(396),r=i(623),l=i(810),c=i(14),h=["collection","itemTemplate","itemView"];e.exports=o.extend({module:"components:form-components:editors:select:select-list-view",className:"CustomList",initialize:function initialize(e){c(e,h,this),this._selectModel=this.options.selectModel,this.model=new n.Model({visible:!1}),this.options.mouseOverAction&&(this._mouseOverAction=this.options.mouseOverAction),this.options.mouseOutAction&&(this._mouseOutAction=this.options.mouseOutAction),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this._renderListSection(),this},_initBinds:function _initBinds(){this.listenTo(this.model,"change:visible",function(e,t){t?this.render():this.clearSubViews(),this._toggleVisibility(),this.trigger("change:visible")}),this.collection.isAsync()&&this.listenTo(this.collection.stateModel,"change:state",this._renderListSection)},_createListView:function _createListView(){this._listView&&(this._listView.clean(),this.removeView(this._listView)),this._listView=new a({className:"CDB-Box-modal CustomList--inner",collection:this.collection,showSearch:this.options.showSearch,allowFreeTextInput:this.options.allowFreeTextInput,typeLabel:this.options.typeLabel,itemTemplate:this._itemTemplate,itemView:this._itemView,position:this.options.position,searchPlaceholder:this.options.searchPlaceholder,selectModel:this._selectModel,mouseOverAction:this._mouseOverAction,mouseOutAction:this._mouseOutAction}),this.addView(this._listView),this._listView.show(),this.el.appendChild(this._listView.render().el)},_createStatusView:function _createStatusView(e){var t=l({status:e,type:this.options.typeLabel});this.$el.html(t)},_renderListSection:function _renderListSection(){var e=this._getStatus();"fetched"===e?this._createListView():this._createStatusView(e)},show:function show(){this.model.set("visible",!0)},hide:function hide(){this.model.set("visible",!1)},toggle:function toggle(){this.model.set("visible",!this.model.get("visible"))},_renderOverlay:function _renderOverlay(){var e,t=this.$el.closest(".Dialog");this._dropdownOverlay=new r({container:t.length?t:void 0,onClickAction:s(e=this.hide).call(e,this),visible:!0}),this.addView(this._dropdownOverlay)},_destroyOverlay:function _destroyOverlay(){this._dropdownOverlay&&this._dropdownOverlay.clean()&&this.removeView(this._dropdownOverlay)},isVisible:function isVisible(){return this.model.get("visible")},_toggleVisibility:function _toggleVisibility(){this.$el.toggleClass("is-visible",!!this.isVisible()),this.isVisible()?this._renderOverlay():this._destroyOverlay()},_getStatus:function _getStatus(){return this.collection.isAsync()?this.collection.stateModel.get("state"):"fetched"},_destroyBinds:function _destroyBinds(){this.stopListening(this.collection)},_onMouseOver:function _onMouseOver(){this._mouseOverAction&&this._mouseOverAction()},_onMouseOut:function _onMouseOut(){this._mouseOutAction&&this._mouseOutAction()},remove:function remove(){this._listView&&this._listView.clean(),this._dropdownOverlay&&this._dropdownOverlay.clean(),this._destroyBinds()}})},3042:function(e,t,i){var s=i(3),n=i(18),o=i(6),a=i(186),r=i(1),l=i(198),c=i(624),h=i(453),d=i(452),u=i(559),p=i(451),g=i(71),m=i(3041),f=i(58);o.Form.editors.Select=o.Form.editors.Base.extend({tagName:"div",className:"u-ellipsis Editor-formSelect",events:{"click .js-button":"_onButtonClick","keydown .js-button":"_onButtonKeyDown","focus .js-button":function focusJsButton(){this.trigger("focus",this)},blur:function blur(){this.trigger("blur",this)}},options:{selectedItemTemplate:c,itemListTemplate:d,customListItemView:h},initialize:function initialize(e){if(o.Form.editors.Base.prototype.initialize.call(this,e),a.setOptions(this,e),this.template=e.template||u,this.dialogMode=this.options.dialogMode||g.Mode.DEFAULT,this.options.mouseOverAction&&(this._mouseOverAction=this.options.mouseOverAction),this.options.mouseOutAction&&(this._mouseOutAction=this.options.mouseOutAction),this.options.editorAttrs&&this.options.editorAttrs.help&&(this._help=this.options.editorAttrs.help),null!=this.options.options?this.collection=new l(this.options.options):this.collection=this.options.collection,void 0===this.collection.isAsync)throw new Error("collection must implement isAsync method.");this._initViews(),this.setValue(this.model.get(this.options.keyAttr)),this._initBinds()},render:function render(){var e=!this.collection.length,t=!this._hasValue();this._isDisabled=!!e||this.options.disabled;var i=this._getPlaceholder(this._isDisabled),s=t?i:this._getLabel(),n=this._isLoading();return this.$el.html(this.template({keyAttr:this.options.keyAttr,isEmpty:e,label:s,isDisabled:this._isDisabled,isNull:t,isLoading:n,help:this._help||""})),this.dialogMode===g.Mode.NESTED&&this._popupManager.append(this.dialogMode),n||this._renderSelected(),this},_initBinds:function _initBinds(){var e,t=s(e=function _context(){this._listView.hide(),this._popupManager.untrack(),this._onToggleSelected()}).call(e,this);this.applyESCBind(t),this.listenTo(this.collection,"change:selected",this._onItemSelected),this.listenTo(this._listView,"change:visible",this._onToggleSelected),this.collection.isAsync()&&this.listenTo(this.collection.stateModel,"change:state",this.render)},_initViews:function _initViews(){this._listView=new m({collection:this.collection,showSearch:this.options.showSearch,allowFreeTextInput:this.options.allowFreeTextInput,typeLabel:this.options.keyAttr,itemTemplate:this.options.itemListTemplate,itemView:this.options.customListItemView,position:this.options.position,searchPlaceholder:this.options.searchPlaceholder,selectModel:this.options.defaultValue&&this.model,mouseOverAction:this._mouseOverAction,mouseOutAction:this._mouseOutAction}),this._popupManager=new p(this.cid,this.$el,this._listView.$el),this._popupManager.append(this.dialogMode)},_getPlaceholder:function _getPlaceholder(e){var t=this.options.keyAttr;return e?this.options.disabledPlaceholder||_t("components.backbone-forms.select.disabled-placeholder",{keyAttr:t}):this.options.placeholder||_t("components.backbone-forms.select.placeholder",{keyAttr:t})},_hasValue:function _hasValue(){var e=this.model.get(this.options.keyAttr);return null!=e&&""!==e},_getLabel:function _getLabel(){var e=this.model.get(this.options.keyAttr),t=this.collection.findWhere({val:e});return t&&t.getName()||e||""},_isLoading:function _isLoading(){var e=this.options.loading;return this.collection.isAsync()&&(e="fetching"===this.collection.stateModel.get("state")),e},_destroyBinds:function _destroyBinds(){this.stopListening(this.collection),o.Form.editors.Base.prototype._destroyBinds.call(this)},_onItemSelected:function _onItemSelected(e){this._listView.hide(),this._popupManager.untrack(),this._renderButton(e),this.trigger("change",this)},_onButtonClick:function _onButtonClick(){this._isDisabled||(this._listView.toggle(),this._listView.isVisible()?this._popupManager.track():this._popupManager.untrack(),this._onToggleSelected())},_onButtonKeyDown:function _onButtonKeyDown(e){this._isDisabled||13===e.which&&(e.preventDefault(),this._listView.isVisible()?this._popupManager.track():(e.stopPropagation(),this._listView.toggle()))},getValue:function getValue(){var e=this.collection.getSelectedItem();return e?e.getValue():this.value},setValue:function setValue(e){var t=this.collection.setSelected(e);t?this._renderButton(t):this.render(),this.value=e},_renderSelected:function _renderSelected(){var e=this.collection.getSelectedItem();e&&this._renderButton(e)},_getButton:function _getButton(){return this.$(".js-button")},_getButtonTemplateData:function _getButtonTemplateData(e){return r.extend({isSourceType:!1},e.attributes,{label:e.getName()})},_renderButton:function _renderButton(e){var t=this._getButton(),i=this._getButtonTemplateData(e),s=this.options.selectedItemTemplate(i);return t.removeClass("is-empty").html(s),this._initButtonBinds(),this._help&&(this._removeTooltip(),this._helpTooltip=new f({el:this.$(".js-help"),gravity:"w",title:function title(){return n(this).data("tooltip")}})),t},_removeTooltip:function _removeTooltip(){this._helpTooltip&&this._helpTooltip.clean()},_initButtonBinds:function _initButtonBinds(){var e,t;this._getButton().on("mouseover",s(e=this._onMouseOver).call(e,this)).on("mouseout",s(t=this._onMouseOut).call(t,this))},_destroyButtonBinds:function _destroyButtonBinds(){var e,t;this._getButton().off("mouseover",s(e=this._onMouseOver).call(e,this)).off("mouseout",s(t=this._onMouseOut).call(t,this))},remove:function remove(){this._removeTooltip(),this._popupManager&&this._popupManager.destroy(),this._listView&&this._listView.clean(),this._destroyButtonBinds(),this._destroyBinds(),o.Form.editors.Base.prototype.remove.call(this)},_onToggleSelected:function _onToggleSelected(){var e=this._listView.isVisible();this.$el.toggleClass("is-active",e),e||this._getButton().blur()},_onMouseOver:function _onMouseOver(){this._mouseOverAction&&this._mouseOverAction()},_onMouseOut:function _onMouseOut(){this._mouseOutAction&&this._mouseOutAction()},clean:function clean(){this.$el.remove()}})},3043:function(e,t,i){var s=i(3),n=i(6),o=i(1),a=i(18),r=i(818),l=i(186);i(18),i(369);var c=i(58);n.Form.editors.Number=n.Form.editors.Base.extend({tagName:"ul",className:"CDB-OptionInput-container CDB-OptionInput-container--noMargin u-grow",options:{min:0,max:10,step:1,showSlider:!0,validators:[{type:"regexp",regexp:/^[+-]?((\.\d+)|(\d+(\.\d+)?))$/,message:_t("editor.edit-feature.valid")}]},events:{"keydown .js-input":"_onInputKeyDown","keyup .js-input":"_onInputKeyUp",focus:function focus(){this.trigger("focus",this)},blur:function blur(){this.trigger("blur",this)}},initialize:function initialize(e){var t;n.Form.editors.Base.prototype.initialize.call(this,e),l.setOptions(this,e),this._validators=e.validators||e.schema&&e.schema.validators,this._validators&&this._validators[1]&&(this.options.min=this._validators[1].min,this.options.max=this._validators[1].max,this.options.step=this._validators[1].step),this.options.editorAttrs&&this.options.editorAttrs.help&&(this._help=this.options.editorAttrs.help),this._debouncedTriggerChange=s(t=o.debounce(this._triggerChange,333)).call(t,this),this._initViews()},_initViews:function _initViews(){var e,t,i=null===this.value?"null":"";(this.$el.html(r({value:this.value,isDisabled:this.options.disabled,hasSlider:this.options.showSlider,isFormatted:this.options.isFormatted,placeholder:i,help:this._help||""})),this.options.showSlider)&&this.$(".js-slider").slider({range:"min",value:this.value,min:this.options.min,max:this.options.max,step:this.options.step,orientation:"horizontal",disabled:this.options.disabled,slide:s(e=this._onSlideChange).call(e,this),stop:s(t=this._onSlideStop).call(t,this)});this._help&&(this._removeTooltip(),this._helpTooltip=new c({el:this.$(".js-help"),gravity:"w",title:function title(){return a(this).data("tooltip")}})),this.$el.toggleClass("CDB-OptionInput-container--noSlider",!!this.options.showSlider)},_onSlideChange:function _onSlideChange(e,t){this.value=t.value,this.$(".js-input").val(this.value)},_onSlideStop:function _onSlideStop(e,t){this._debouncedTriggerChange()},_onInputKeyDown:function _onInputKeyDown(e){var t=this.$(".js-input"),i=+this.getValue(),s=!0===e.shiftKey?10:1;switch(e.which){case 32:case 13:return!1;case 38:i=this._nextValue(i,s),t.val(i);break;case 40:i=this._nextValue(i,-1*s),t.val(i)}},_nextValue:function _nextValue(e,t){var i=e+=t;return i<this.options.min?this.options.min:i>this.options.max?this.options.max:i},_hasSlider:function _hasSlider(){return this.options.showSlider&&this.$(".js-slider").data("ui-slider")},_onInputKeyUp:function _onInputKeyUp(){var e=this.$(".js-input").val();this._hasSlider()&&this.$(".js-slider").slider("value",e),this.value=e,this._debouncedTriggerChange()},_triggerChange:function _triggerChange(){this.trigger("change",this)},focus:function focus(){this.hasFocus||this.$(".js-input").focus()},blur:function blur(){this.hasFocus&&this.$(".js-input").blur()},getValue:function getValue(){var e=this.$(".js-input").val();return""===e?null:+e},setValue:function setValue(e){this._hasSlider()&&this.$(".js-slider").slider("value",e),this.$(".js-input").val(e),this.value=e},_destroySlider:function _destroySlider(){this._hasSlider()&&this.$(".js-slider").slider("destroy")},_removeTooltip:function _removeTooltip(){this._helpTooltip&&this._helpTooltip.clean()},remove:function remove(){this._destroySlider(),this._removeTooltip(),n.Form.editors.Base.prototype.remove.apply(this)},clean:function clean(){this.$el.remove()}})},3044:function(e,t,i){var s=i(6);s.Form.editors.TextArea=s.Form.editors.Text.extend({tagName:"textarea",className:"CDB-Textarea",render:function render(){return this.setValue(this.value),this._toggleDisableState(),this},getValue:function getValue(){var e=this.$el.val();return""===e?null:e},_toggleDisableState:function _toggleDisableState(){this.options.disabled?(this.$el.attr("readonly",""),this.$el.attr("placeholder","")):(this.$el.removeAttr("readonly"),this._togglePlaceholder()),this.$el.toggleClass("is-disabled",!!this.options.disabled)}})},3045:function(e,t,i){var s=i(3),n=i(1),o=i(6),a=i(186),r=i(58);o.Form.editors.Text=o.Form.editors.Text.extend({className:"CDB-InputText CDB-Text",initialize:function initialize(e){o.Form.editors.Base.prototype.initialize.call(this,e),a.setOptions(this,e);var t=this.schema,i="text";t&&t.editorAttrs&&t.editorAttrs.type&&(i=t.editorAttrs.type),t&&t.dataType&&(i=t.dataType),this.options.editorAttrs&&this.options.editorAttrs.help&&(this._help=this.options.editorAttrs.help),this.$el.attr("type",i),this.determineChange=n.debounce(this.determineChange,200)},render:function render(){var e;(this.setValue(this.value),this._toggleDisableState(),this._isCopyButtonEnabled()&&this._toggleClipboardState(),this._help)&&(this._removeTooltip(),this.options.disabled||(this._helpTooltip=new r({el:this.$el,gravity:"w",title:s(e=function _context(){return this._help}).call(e,this)})));return this},getValue:function getValue(){var e=this.$el.val();return""===e?null:e},_toggleClipboardState:function _toggleClipboardState(){this.$el.toggleClass("Share-input-field u-ellipsis",this._isCopyButtonEnabled())},_togglePlaceholder:function _togglePlaceholder(){if(this.options.placeholder)this.$el.attr("placeholder",this.options.placeholder);else{var e=null===this.value?"null":"";this.$el.attr("placeholder",e)}},_toggleDisableState:function _toggleDisableState(){this.options.disabled?(this.$el.attr("readonly",""),this.$el.attr("placeholder",""),this._isCopyButtonEnabled()&&this.$el.removeAttr("disabled")):(this.$el.removeAttr("readonly"),this._togglePlaceholder()),this.$el.toggleClass("is-disabled",!!this.options.disabled)},_isCopyButtonEnabled:function _isCopyButtonEnabled(){return!!this.options.hasCopyButton},_removeTooltip:function _removeTooltip(){this._helpTooltip&&this._helpTooltip.clean()},remove:function remove(){this._removeTooltip(),o.Form.editors.Base.prototype.remove.apply(this)},clean:function clean(){this.$el.remove()}})},3046:function(e,t,i){var s=i(3),n=i(6),o=i(18);n.Form.editors.Base=n.Form.editors.Base.extend({applyESCBind:function applyESCBind(e){var t;this._ESCBindCallback=e,this._onKeyDown=s(t=this._onKeyDown).call(t,this),document.addEventListener("keydown",this._onKeyDown)},_onKeyDown:function _onKeyDown(e){27===e.which&&!this._anyModalOpen()&&this._ESCBindCallback()},applyClickOutsideBind:function applyClickOutsideBind(e){var t;this._clickBindCallback=e,this._onDocumentClick=s(t=this._onDocumentClick).call(t,this),this.$el.attr("data-cid",this.cid),document.addEventListener("click",this._onDocumentClick)},_onDocumentClick:function _onDocumentClick(e){var t=o(e.target),i=this._anyModalOpen();0!==t.closest('[data-cid="'+this.cid+'"]').length||i||this._clickBindCallback()},_anyModalOpen:function _anyModalOpen(){var e=this.options.modals;return!!e&&e.isOpen()},_destroyBinds:function _destroyBinds(){this._removeESCandClickListeners()},_removeESCandClickListeners:function _removeESCandClickListeners(){this._ESCBindCallback&&document.removeEventListener("keydown",this._onKeyDown),this._clickBindCallback&&document.removeEventListener("click",this._onDocumentClick)},remove:function remove(){this._destroyBinds&&this._destroyBinds(),n.View.prototype.remove.call(this)}})},3054:function(e,t,i){var s=i(6),n=i(1),o=i(18),a=i(58),r=i(1058);s.Form.Field=s.Form.Field.extend({initialize:function initialize(e){this.trackingClass=e.trackingClass,this.constructor.__super__.initialize.apply(this,arguments)},render:function render(){return this.constructor.__super__.render.apply(this,arguments),this.schema.help&&this._setHelp(),this._isCopyButtonEnabled()&&this._initClipboard(),this},createSchema:function createSchema(e){var t=e.type;return(e=this.constructor.__super__.createSchema.apply(this,arguments)).editorType=t,e},createEditor:function createEditor(){var e=n.extend(n.pick(this,"schema","form","key","model","value","trackingClass"),{id:this.createEditorId()});return new(0,this.schema.type)(e)},_setHelp:function _setHelp(){this._helpTooltip=this._createTooltip({$el:this.$(".js-help")})},setError:function setError(e){this.editor.hasNestedForm||this.schema.hideValidationErrors||(this.$el.addClass(this.errorClassName),this._destroyErrorTooltip(),this._errorTooltip=this._createTooltip({gravity:"w",className:"is-error",msg:e,offset:5}),this._errorTooltip.showTipsy())},clearError:function clearError(){this.$el.removeClass(this.errorClassName),this._destroyErrorTooltip()},_initClipboard:function _initClipboard(){this._clipboard&&this._clipboard.destroy();var e=this.$(".js-copy");this._clipboard=new r(e.get(0))},_createTooltip:function _createTooltip(e){return new a({el:e.$el||this.$el,gravity:e.gravity||"s",className:e.className||"",offset:e.offset||0,title:function title(){return e.msg||o(this).data("tooltip")}})},_destroyErrorTooltip:function _destroyErrorTooltip(){this._errorTooltip&&(this._errorTooltip.hideTipsy(),this._errorTooltip.destroyTipsy())},_destroyHelpTooltip:function _destroyHelpTooltip(){this._helpTooltip&&this._helpTooltip.destroyTipsy()},_destroyClipboard:function _destroyClipboard(){this._clipboard&&this._clipboard.destroy()},templateData:function templateData(){var e,t=this.schema;try{e=this.form.schema[this.key].type}catch(t){e=void 0}return{help:t.help||"",isCopyButtonEnabled:this._isCopyButtonEnabled(),hasNestedForm:this.editor.hasNestedForm,title:t.title,fieldAttrs:t.fieldAttrs,editorAttrs:t.editorAttrs,key:this.key,type:e,editorId:this.editor.id,editorType:this.editor.el.type}},_isCopyButtonEnabled:function _isCopyButtonEnabled(){return!!this.schema.hasCopyButton},remove:function remove(){this._destroyErrorTooltip(),this._destroyHelpTooltip(),this._destroyClipboard(),this.editor.remove(),s.View.prototype.remove.call(this)}},{template:i(819),errorClassName:"CDB-FieldError"})},3055:function(e,t,i){var s=i(6),n=i(1);s.Form.Fieldset.template=n.template('  <div class="Editor-fieldset" data-fields>    <% if (legend) { %>      <legend><%= legend %></legend>    <% } %>  </div>')},3056:function(e,t,i){var s=i(6);s.Form=s.Form.extend({initialize:function initialize(e){this.options=e,s.Form.Original.prototype.initialize.call(this,e)},createField:function createField(e,t){var i={form:this,key:e,schema:t,idPrefix:this.idPrefix,trackingClass:this.options.trackingClass};this.model?i.model=this.model:this.data?i.value=this.data[e]:i.value=void 0;var s=new this.Field(i);return this.listenTo(s.editor,"all",this.handleEditorEvent),s}})},3057:function(e,t){e.exports=function(e){var t={type:"required",message:_t("components.backbone-forms.required-boolean-error")};return function required(e){if(void 0===e)return t}}},3058:function(e,t,i){var s=i(237);e.exports=function(e){var t=s(e.min)||0,i=s(e.max)||0,n={type:e.type,message:_t("components.backbone-forms.interval-error",{minValue:e.min,maxValue:e.max})};return function interval(e,o){var a=0;return null===e||void 0===e||""===e?n:(!isNaN(s(e))&&isFinite(e)&&(a=s(e)),t>a||i<a?n:void 0)}}},3059:function(e,t){e.exports=function(e){var t=e.columnType,i=e.columnsCollection,s={type:e.type,message:_t("components.backbone-forms.column-type-error",{columnType:t})};return function columnType(e){var n=i.findWhere({name:e});if(!(n&&n.get("type")===t))return s}}},3062:function(e,t,i){i(31);var s=i(89),n=i(3),o=i(76);i(31);var a=i(6),r=i(4),l=i(1),c=i(74),h=i(18),d=i(59);i(242),i(1550);var u=i(1549),p=i(1548),g={amount:4,unit:"hours"},m={amount:1,unit:"day"},f={amount:1,unit:"week"};e.exports=r.extend({className:"DatePicker",options:{flat:!0,date:["2008-07-31","2008-07-31"],current:"2008-07-31",calendars:2,mode:"range",starts:1},events:{"click .js-dates":"_toggleCalendar","click .js-fourHours":function clickJsFourHours(){this._setPreviousTime(g)},"click .js-oneDay":function clickJsOneDay(){this._setPreviousTime(m)},"click .js-oneWeek":function clickJsOneWeek(){this._setPreviousTime(f)}},initialize:function initialize(e){var t=!(!e||!e.disabled)&&e.disabled;this.model=new a.Model({fromDate:"",fromHour:0,fromMin:0,toDate:"",toHour:23,toMin:59,user_timezone:0,disabled:t}),this.template=e.template||p,this._initBinds(),this._setDefaultDate()},render:function render(){var e=this;return this.clearSubViews(),this.$el.empty(),this.$el.append(this.template(l.extend(this.model.attributes,{max_days:30,pad:d.pad}))),o(function(){e._initCalendar(),e._hideCalendar(),e._initTimers()},100),this},_initBinds:function _initBinds(){var e,t,i,s;n(e=this.model).call(e,"change",this._setValues,this),n(t=this.model).call(t,"change",this._onValuesChange,this),n(i=h(document)).call(i,"click",n(s=this._onDocumentClick).call(s,this))},_destroyBinds:function _destroyBinds(){var e;h(document).unbind("click",n(e=this._onDocumentClick).call(e,this))},_formattedDate:function _formattedDate(e){return _t("components.datepicker."+e)+" <strong>"+this.model.get(e+"Date")+" "+d.pad(this.model.get(e+"Hour"),2)+":"+d.pad(this.model.get(e+"Min"),2)+"</strong>"},_setValues:function _setValues(){var e=_t("components.datepicker.dates-placeholder"),t=this.model.attributes;if(t.fromDate&&t.toDate){e=this._formattedDate("from")+" "+this._formattedDate("to")+'<i class="CDB-IconFont CDB-IconFont-calendar DatePicker-datesIcon"></i>'}this.$(".DatePicker-dates").html(e)},_setDefaultDate:function _setDefaultDate(){var e=this.model.get("user_timezone"),t=c().utc(e),i=c().utc(e).subtract(29,"days");this.options.date=[i.format("YYYY-MM-DD"),t.format("YYYY-MM-DD")],this.options.current=t.format("YYYY-MM-DD"),this._setModelFromPrevious(i)},_initCalendar:function _initCalendar(){var e;document.body.contains(this.$(".DatePicker-calendar")[0])&&(this.calendar=this.$(".DatePicker-calendar").DatePicker(l.extend(this.options,{onChange:n(e=this._onDatesChange).call(e,this),onRender:function onRender(e){var t=e.valueOf(),i=new Date,s=new Date;return s.setDate(i.getDate()-30),t<s||t>i?{disabled:!0}:""}})))},_onDatesChange:function _onDatesChange(e,t){var i=c(e[0]),s=c(e[1]);Math.abs(i.diff(s,"days"))>30&&(e[1]=c(e[0]).add("days",30).format("YYYY-MM-DD"),this.$(".DatePicker-calendar").DatePickerSetDate([e[0],e[1]])),this.model.set({fromDate:e[0],toDate:e[1]})},_hideCalendar:function _hideCalendar(e){e&&this.killEvent(e),this.$(".DatePicker-dropdown").hide()},_toggleCalendar:function _toggleCalendar(e){e&&this.killEvent(e);var t=this.$(".DatePicker-dropdown");t.toggle();var i="none"!==t.css("display");this.trigger("visibilityChanged",i)},_setPreviousTime:function _setPreviousTime(e){var t=c().utc(0).subtract(e.amount,e.unit);this._setModelFromPrevious(t),this._setDatepickerFromPrevious(t),this.closeCalendar()},_setModelFromPrevious:function _setModelFromPrevious(e){var t=c().utc(0);this.model.set({fromDate:e.format("YYYY-MM-DD"),fromHour:s(e.format("H"),10),fromMin:s(e.format("m"),10),toDate:t.format("YYYY-MM-DD"),toHour:s(t.format("H"),10),toMin:s(t.format("m"),10)})},_setDatepickerFromPrevious:function _setDatepickerFromPrevious(e){var t=c().utc(0);this.$(".DatePicker-calendar").DatePickerSetDate([e.format("YYYY-MM-DD"),t.format("YYYY-MM-DD")])},_initTimers:function _initTimers(){var e,t=function generateNumberType(e,t){return{type:"Number",title:23===t?_t("components.datepicker.hour"):_t("components.datepicker.min"),validators:["required",{type:"interval",min:e,max:t}]}};this.model.schema={fromHour:t(0,23),fromMin:t(0,59),toHour:t(0,23),toMin:t(0,59)},this._datesForm=new a.Form({model:this.model,template:u}),n(e=this._datesForm).call(e,"change",function(){this.commit()}),this.$(".js-timers").append(this._datesForm.render().el)},_onValuesChange:function _onValuesChange(){this.trigger("changeDate",this.model.toJSON(),this)},getDates:function getDates(){return this.model.toJSON()},closeCalendar:function closeCalendar(){this.$(".DatePicker-dropdown").hide(),this.trigger("visibilityChanged",!1)},_onDocumentClick:function _onDocumentClick(e){0===h(e.target).closest(".DatePicker").length&&this.closeCalendar()},clean:function clean(){this._datesForm&&this._datesForm.remove(),this._destroyBinds(),this.closeCalendar(),this.$(".DatePicker-calendar").DatePickerHide(),r.prototype.clean.call(this)}})},3063:function(e,t,i){var s=i(25),n=i(3),o=i(1),a=i(74),r=i(1060),l=i(345),c=i(3062),h=i(2938),d=i(2935),u=i(1544),p=i(14),g=["configModel","userModel"];e.exports=r.extend({options:{acceptSync:!1,type:"service",service:"twitter_search"},className:"ImportPanel ImportTwitterPanel",initialize:function initialize(e){p(e,g,this),this.model=new l({type:this.options.type,service_name:this.options.service},{userModel:this._userModel,configModel:this._configModel}),this._initBinds()},_disabledDueLackOfCredentials:function _disabledDueLackOfCredentials(){return!this._userModel.hasOwnTwitterCredentials()},render:function render(){return this.clearSubViews(),this.$el.html(u({currentGMT:a().format("Z")})),this._initViews(),this},_initViews:function _initViews(){var e=this.categories=new h({disabled:this._disabledDueLackOfCredentials()});n(e).call(e,"changeCategory",this._setModel,this),this.$(".ImportTwitterPanel-categories").append(e.render().el),this.addView(e);var t=this.datepicker=new c({className:"DatePicker DatePicker--withBorder",disabled:this._disabledDueLackOfCredentials()});n(t).call(t,"changeDate",this._setModel,this),n(t).call(t,"visibilityChanged",this._adaptToCalendarVisibility,this),this.$(".js-picker").append(t.render().el),this.addView(t);var i=this.creditsUsage=new d({el:this.$(".CreditsUsage"),userModel:this._userModel,disabled:this._disabledDueLackOfCredentials()});n(i).call(i,"maxCreditsChange",this._setModel,this),i.render(),this.addView(i),this._setModel()},_initBinds:function _initBinds(){var e;n(e=this.model).call(e,"change",this._triggerChange,this)},_getCategories:function _getCategories(){var e=this.categories.getCategories();return s(o).call(o,e,function(e){return e.category&&e.terms.length>0})},_getDates:function _getDates(){return this.datepicker.getDates()},_getMaxCredits:function _getMaxCredits(){return this.creditsUsage.getMaxCredits()},_setModel:function _setModel(){var e=this._getCategories(),t=this._getDates(),i=this._getMaxCredits(),s={categories:e,dates:t};this.model.setUpload({value:s,service_item_id:s,user_defined_limits:{twitter_credits_limit:i}})},_adaptToCalendarVisibility:function _adaptToCalendarVisibility(e){this.$(".ImportPanel-body").toggleClass("bodyExpanded",e)}})},3064:function(e,t,i){i(23),i(40),i(326);var s=i(59),n=i(626),o=i(625);e.exports=n.extend({render:function render(){var e=this.options.fileAttrs.title&&this.model.get("value")[this.options.fileAttrs.title]||this.model.get("value"),t=this._genDescription(),i=this.options.fileAttrs.ext?s.getFileExtension(e):"";this.options.fileAttrs.ext&&(e=e&&e.replace("."+i,""));var n=window.upgrade_url,a=this._userModel.isActionEnabled("sync_tables"),r=this._configModel.get("cartodb_com_hosted");return this.$el.html(o({title:e,description:t,ext:i,interval:this.model.get("interval"),importCanSync:this.options.acceptSync&&this._isArcGISLayer(e),userCanSync:a,showTrial:this._userModel.canStartTrial(),showUpgrade:!a&&!r&&n&&!this._userModel.isInsideOrg(),upgradeUrl:n})),this},_isArcGISLayer:function _isArcGISLayer(e){return-1!==e.search(/([0-9]+\/|[0-9]+)/)}})},3065:function(e,t,i){var s=i(821),n=i(820),o=i(3064),a=i(627),r=i(1565),l=i(1564);e.exports=a.extend({options:{fileExtensions:[],type:"service",service:"arcgis",acceptSync:!0,fileEnabled:!1,fileAttrs:{ext:!1,title:"",description:""}},_initViews:function _initViews(){var e=new n({el:this.$(".ImportPanel-header"),model:this.model,userModel:this._userModel,collection:this.collection,fileEnabled:this.options.fileEnabled,acceptSync:this.options.acceptSync,template:r});e.render(),this.addView(e);var t=new o({el:this.$(".DatasetSelected"),userModel:this._userModel,model:this.model,acceptSync:this.options.acceptSync,fileAttrs:this.options.fileAttrs,configModel:this._configModel});t.render(),this.addView(t);var i=new s({el:this.$(".ImportPanel-form"),userModel:this._userModel,model:this.model,template:l,fileEnabled:this.options.fileEnabled});i.render(),this.addView(i)}})},3066:function(e,t,i){var s=i(6);e.exports=s.Model.extend({defaults:{id:"",filename:"",checksum:"",service:"",size:"",title:""}})},3067:function(e,t,i){var s=i(3066),n=i(6);e.exports=n.Collection.extend({_DATASOURCE_NAME:"dropbox",model:s,url:function url(e){var t=this._configModel.urlVersion("imports_service");return this._configModel.get("base_url")+"/api/"+t+"/imports/service/"+this._DATASOURCE_NAME+"/list_files"},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");if(!t.datasourceName)throw new Error("datasourceName is required");this._configModel=t.configModel,this._DATASOURCE_NAME=t.datasourceName},fetch:function fetch(){return this.trigger("fetch",this),n.Collection.prototype.fetch.apply(this,arguments)},parse:function parse(e){return e.files}})},3068:function(e,t,i){var s=i(59);e.exports={formatSize:function formatSize(e){return e&&e>0?s.readablizeBytes(e):"Unknown"}}},3069:function(e,t,i){i(269),i(268),i(35),i(23),i(40);var s=i(4),n=i(59),o=i(3068),a=i(1570),r=i(1);e.exports=s.extend({options:{title:"",fileAttrs:{ext:!1,title:"filename",description:"size",itemName:"file",formatDescription:""}},_FORMATTERS:{size:o.formatSize,number:n.formatNumber},className:"ServiceList-item",tagName:"li",events:{"click .js-choose":"_onSelectItem"},render:function render(){var e=this.model.get(this.options.fileAttrs.title),t=this._genDescription(),i=this.options.fileAttrs.ext?n.getFileExtension(e):"";return this.options.fileAttrs.ext&&(e=e&&e.replace("."+i,"")),this.$el.html(a({name:this.options.title,ext:i,title:e,description:t})),this},_genDescription:function _genDescription(){if(this.options.fileAttrs&&this.options.fileAttrs.description){var e=this.options.fileAttrs.description,t="",i="",s=this;return e.content&&e.content.length>0&&r.each(e.content,function(n,o){o>0&&e.separator&&(i+=" "+e.separator+" ");var a=s.model.get(n.name),r=n.format&&s._FORMATTERS[n.format];i+=r&&r(a)||a,n.key&&(t=n.name)}),e.itemName&&t&&(i+=" "+(e.itemName&&_t("components.modals.add-layer.imports."+e.itemName+"-pluralize",{smart_count:t})||"")),i}return""},_onSelectItem:function _onSelectItem(){this.trigger("selected",this.model,this)}})},3070:function(e,t,i){i(31);var s=i(3);i(31);var n=i(4),o=i(3069),a=i(1569);e.exports=n.extend({options:{title:"service",fileAttrs:{}},initialize:function initialize(){this._initBinds(),this._checkVisibility()},render:function render(){this.clearSubViews();var e=this.collection.size();return this.$el.html(a({size:e,title:this.options.title,pluralize:_t("components.modals.add-layer.imports.item-pluralize",{smart_count:e})})),this.collection.size()>0&&this.collection.each(this._addItem,this),this},_initBinds:function _initBinds(){var e,t;s(e=this.collection).call(e,"sync",this.render,this),s(t=this.model).call(t,"change:state",this._checkVisibility,this),this.add_related_model(this.collection)},_addItem:function _addItem(e){var t=new o({model:e,title:this.options.title,fileAttrs:this.options.fileAttrs});s(t).call(t,"selected",this._onSelectedItem,this),this.$(".ServiceList-items").append(t.render().el),this.addView(t)},_onSelectedItem:function _onSelectedItem(e){this.model.setUpload({state:"selected",value:e.toJSON(),service_item_id:e.get("id")})},_checkVisibility:function _checkVisibility(){"list"===this.model.get("state")?this.show():this.hide()}})},3071:function(e,t,i){var s=i(3),n=i(4),o=i(1573);e.exports=n.extend({events:{"click .js-back":"_goToList"},options:{title:"Service",showAvailableFormats:!1,acceptSync:!1,fileExtensions:[],template:""},initialize:function initialize(e){if(!e.userModel)throw new Error("userModel is required");this._userModel=e.userModel,this.template=e.template||o,this._initBinds()},render:function render(){return this.$el.html(this.template({items:this.collection.size(),service_name:this.model.get("service_name"),showAvailableFormats:this.options.showAvailableFormats,fileExtensions:this.options.fileExtensions,acceptSync:this.options.acceptSync&&this._userModel.isActionEnabled("sync_tables"),state:this.model.get("state"),title:this.options.title})),this._checkVisibility(),this},_initBinds:function _initBinds(){var e;s(e=this.model).call(e,"change:state",this.render,this)},_checkVisibility:function _checkVisibility(){this["list"!==this.model.get("state")?"show":"hide"]()},_goToList:function _goToList(){this.model.set("state","list")}})},3072:function(e,t,i){i(31);var s=i(3);i(31);var n=i(1060),o=i(345),a=i(3071),r=i(1572),l=i(3070),c=i(626),h=i(1568),d=i(1567),u=i(3067),p=i(1566);e.exports=n.extend({_DATASOURCE_NAME:"dropbox",className:"ImportPanel ImportPanelService",options:{service:"",showAvailableFormats:!1,fileExtensions:[],acceptSync:!1,fileAttrs:{ext:!1,title:"filename",description:"<%- size %>",formatDescription:"size",headerTemplate:""}},initialize:function initialize(e){if(!e.service)throw new Error("service prodiver is required");if(!e.userModel)throw new Error("userModel is required");if(!e.configModel)throw new Error("configModel is required");this._userModel=e.userModel,this._configModel=e.configModel,this._DATASOURCE_NAME=this.options.service,this.model=new o({type:"service",service_name:this._DATASOURCE_NAME},{userModel:this._userModel,configModel:this._configModel}),this._initModels(),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.html(p(this.options)),this._initViews(),this},_initModels:function _initModels(){this._serviceTokenModel=new h(null,{datasourceName:this._DATASOURCE_NAME,configModel:this._configModel}),this._serviceOauthModel=new d(null,{datasourceName:this._DATASOURCE_NAME,configModel:this._configModel}),this.collection=new u(null,{datasourceName:this._DATASOURCE_NAME,configModel:this._configModel})},_initBinds:function _initBinds(){var e,t,i,n;s(e=this.model).call(e,"change",this._triggerChange,this),s(t=this.model).call(t,"change:state",this._checkState,this),s(i=this._serviceTokenModel).call(i,"change:oauth_valid",this._onOauthChange,this),s(n=this._serviceOauthModel).call(n,"change:url",this._openWindow,this),this.add_related_model(this._serviceOauthModel),this.add_related_model(this._serviceTokenModel)},_initViews:function _initViews(){var e=new a({el:this.$(".ImportPanel-header"),userModel:this._userModel,model:this.model,collection:this.collection,title:this.options.title,showAvailableFormats:this.options.showAvailableFormats,fileExtensions:this.options.fileExtensions,acceptSync:this.options.acceptSync,template:this.options.headerTemplate});e.render(),this.addView(e);var t=new r({el:this.$(".ServiceLoader"),model:this.model,serviceTokenModel:this._serviceTokenModel,serviceOauthModel:this._serviceOauthModel});t.render(),this.addView(t);var i=new l({el:this.$(".ServiceList"),model:this.model,collection:this.collection,title:this.options.title,fileAttrs:this.options.fileAttrs});i.render(),this.addView(i);var s=new c({el:this.$(".ServiceSelected"),userModel:this._userModel,model:this.model,acceptSync:this.options.acceptSync,fileAttrs:this.options.fileAttrs,configModel:this._configModel});s.render(),this.addView(s)},_onOauthChange:function _onOauthChange(){this._serviceTokenModel.get("oauth_valid")&&this._getFiles()},_getFiles:function _getFiles(){var e=this;this.model.set("state","retrieving"),this.collection.fetch({error:function error(){e.model.set("state","error")},success:function success(){e.model.set("state","list")}})},_checkState:function _checkState(){if("list"===this.model.get("state")&&1===this.collection.size()){var e=this.collection.at(0);this.model.setUpload({state:"selected",value:e.toJSON(),service_item_id:e.get("id")})}"selected"!==this.model.get("state")&&this.model.set({value:"",service_item_id:"",interval:0})},_openWindow:function _openWindow(){var e=this._serviceOauthModel.get("url"),t=this,i=window.open(e,null,"menubar=no,toolbar=no,width=600,height=495"),s=window.setInterval(function(){i&&i.closed?(t._getFiles(),clearInterval(s)):i||(t.model.set("state","error"),clearInterval(s))},1e3)}})},3073:function(e,t,i){i(35),i(528);var s=i(25),n=i(56),o=i(65),a=i(13),r=i(3),l=i(1),c=i(18),h=i(4),d=i(14),u=i(911),p=u.IMPORT_OPTIONS,g=u.IMPORT_OPTIONS_ORDER,m=i(2922),f=i(2919),_=i(1528),v=i(2918),y=["createModel","userModel","configModel","privacyModel","guessingModel"],w="cloud",b="database",C="other",M="dataobservatory";e.exports=h.extend({className:"ImportOptions",initialize:function initialize(e){d(e,y,this),this._initModels(),this._orderedImports=this._orderImports(p,g);var t=this;this.model.fetch({complete:function complete(){t.model.set("loaded",!0)}})},render:function render(){return this._generateContent(),this},_initModels:function _initModels(){var e;this.model=new v({},{userModel:this._userModel,configModel:this._configModel}),r(e=this.model).call(e,"change:loaded",this._generateContent,this)},_orderImports:function _orderImports(e,t){return a(t).call(t,function(t){return e[t]})},_checkImports:function _checkImports(e){var t=this;return o(l).call(l,e,function(e){return!l.isEmpty(e)&&e.visible(t._configModel,t._userModel)})},_generateContent:function _generateContent(){this.clearSubViews(),this.$el.empty();var e=this._filterImportsByType(M);this._checkImports(e)&&this._generateImportButtons(e);var t=this._filterImportsByType(w);this._checkImports(t)&&(this.$el.append(_({title:"Cloud Storage"})),this._generateImportButtons(t));var i=this._filterImportsByType(b);this._checkImports(i)&&(this.$el.append(_({title:"Database"})),this._generateImportButtons(i));var s=this._filterImportsByType(C);this.$el.append(_({title:"Other"})),this._generateImportButtons(s,!0)},_generateRequestOtherButton:function _generateRequestOtherButton(){return new f(l.extend({userModel:this._userModel}))},_generateImportButtons:function _generateImportButtons(e,t){var i=c("<div/>").addClass("ImportOptions__row");if(n(e).call(e,function(e){var t,s={};!l.isEmpty(e)&&e.visible(this._configModel,this._userModel)&&(s={name:e.name,selected:"file"===e.name},t=new m(l.extend(e.options||{},{importView:e.view,name:e.name,title:e.title,enable:e.enable,userModel:this._userModel,configModel:this._configModel,createModel:this._createModel,privacyModel:this._privacyModel,guessingModel:this._guessingModel,loaded:this.model.get("loaded")})),this._addStatusCSSClasses(t,e),r(t).call(t,"importSelected",this._onImportSelected,this),s.createButtonView=function(){return t},i.append(s.createButtonView().render().el))},this),t){var s=this._generateRequestOtherButton();i.append(s.render().el)}this.$el.append(i)},_filterImportsByType:function _filterImportsByType(e){var t;return s(t=this._orderedImports).call(t,function(t){return t.type===e})},_addStatusCSSClasses:function _addStatusCSSClasses(e,t){var i=this.model._isImportEnabled(t);i||e.$el.addClass("is-disabled"),i||t.type!==b||this._userModel.isEnterprise()||e.$el.addClass("is-enterprise"),t.options&&t.options.beta&&e.$el.addClass("is-beta"),t.options&&t.options.soon&&e.$el.addClass("is-soon"),t.options&&t.options.new&&e.$el.addClass("is-new"),t.options&&t.options.highlighted&&e.$el.addClass("is-highlighted")},_onImportSelected:function _onImportSelected(e){var t,i=e.options,s=this.model._isImportEnabled(i);if(s||void 0===s)if(i.importView)t=new(0,i.importView)(l.extend(i,{userModel:this._userModel,configModel:this._configModel,createModel:this._createModel,privacyModel:this._privacyModel,guessingModel:this._guessingModel}));else if(i.link)return void(window.location=this._configModel.get("base_url")+i.link);this.trigger("selectImport",t,this)},clean:function clean(){h.prototype.clean.call(this)}})},3074:function(e,t,i){i(35);var s=i(3),n=i(4),o=i(14),a=i(3073),r=i(2917),l=i(2915),c=i(345),h=["createModel","userModel","configModel","privacyModel","guessingModel"];e.exports=n.extend({initialize:function initialize(e){o(e,h,this)},render:function render(){return this._initViews(),this},_initViews:function _initViews(){var e;this._importsSelector=new a({userModel:this._userModel,configModel:this._configModel,createModel:this._createModel,privacyModel:this._privacyModel,guessingModel:this._guessingModel}),s(e=this._importsSelector).call(e,"selectImport",this._selectImport,this),this.$el.append(this._importsSelector.render().el),this.addView(this._importsSelector)},_selectImport:function _selectImport(e){this.trigger("toggleNavigation",this),this._importsSelector.hide(),this._renderSelectedImportView(e)},_showImportsSelector:function _showImportsSelector(){this._resetUploadModel(),this.trigger("toggleNavigation",this),this._importsSelector.show(),this._selectedImport.remove()},_renderSelectedImportView:function _renderSelectedImportView(e){if(e){var t;s(e).call(e,"change",this._setUploadModel,this);var i=new l({title:e.options.title,name:e.options.name,status:e.options.status,beta:e.options.beta});this._selectedImport=new r({model:i,importView:e,userModel:this._userModel}),s(t=this._selectedImport).call(t,"showImportsSelector",this._showImportsSelector,this),this.$el.append(this._selectedImport.render().el),this.addView(this._selectedImport)}},_setUploadModel:function _setUploadModel(e){this._createModel.getUploadModel().setFresh(e)},_resetUploadModel:function _resetUploadModel(){this._setUploadModel(new c(null,{configModel:this._configModel,userModel:this._userModel}).attributes)}})},3075:function(e,t,i){var s=i(3),n=i(4),o=i(562),a=i(561);e.exports=n.extend({className:"DatasetsPaginator",initialize:function initialize(e){if(!e.routerModel)throw new TypeError("routerModel is required");if(!e.tablesCollection)throw new TypeError("tablesCollection is required");this._routerModel=e.routerModel,this._tablesCollection=e.tablesCollection,this.model=new o({current_page:this._routerModel.get("page")}),this._initBinds(),this._initViews()},render:function render(){return this.clearSubViews(),this.$el.html(""),this.model.shouldBeVisible()&&this.$el.append(this.paginationView.render().el),this},_initBinds:function _initBinds(){var e,t,i,n;s(e=this.model).call(e,"change",this.render,this),s(t=this.model).call(t,"change:current_page",function(){this._routerModel.set("page",this.model.get("current_page"))},this),s(i=this._tablesCollection).call(i,"sync",this._updatePaginationModelByCollection,this),s(n=this._routerModel).call(n,"change:page",this._updatePaginationModelByRouterModel,this),this.add_related_model(this._routerModel),this.add_related_model(this._tablesCollection),this.add_related_model(this.model)},_initViews:function _initViews(){this.paginationView=new a({model:this.model}),this.addView(this.paginationView)},_updatePaginationModelByCollection:function _updatePaginationModelByCollection(){this.model.set({per_page:this._tablesCollection.getDefaultParam("per_page"),total_count:this._tablesCollection.getTotalStat("total_entries")})},_updatePaginationModelByRouterModel:function _updatePaginationModelByRouterModel(){this.model.set("current_page",this._routerModel.get("page"))}})},3076:function(e,t,i){i(34),i(88);var s=i(84),n=i(18),o=i(1584),a=i(74),r=i(1582),l=i(59),c=i(58),h=i(822),d=i(1581);e.exports=o.extend({tagName:"li",className:"ModalBlockList-item ModalBlockList-item--full",events:{"click .js-tag-link":"_onTagClick",click:"_toggleSelected"},render:function render(){var e=this.model.getTableModel(),t=this.model.get("tags")||[],i=s.core.sanitize.html(this.model.get("description")||""),n=r.toHTML(this.model.get("source")||""),o=e.getGeometryType()||[],c={isRaster:this.model.isRaster(),geometryType:o.length>0?o[0]:"",title:this.model.get("display_name")||this.model.get("name"),source:n,description:i,timeDiff:a(this.model.get("updated_at")).fromNow(),tags:t,tagsCount:t.length,routerModel:this._routerModel,maxTagsToShow:3,canImportDataset:this._canImportDataset(),rowCount:void 0,datasetSize:void 0},h=e.get("row_count");h>=0&&(c.rowCount=h,c.rowCountFormatted=h<1e4?l.formatNumber(h):l.readizableNumber(h));var u=e.get("size");return u>=0&&(c.datasetSize=l.readablizeBytes(u,u.toString().length>9)),this.$el.html(d(c)),this._setItemClasses(),this._renderTooltips(),this},_setItemClasses:function _setItemClasses(){this.$el.toggleClass("is-selected",!!this.model.get("selected")),this.$el.toggleClass("is-selectable",!!this._canImportDataset()),this.$el.toggleClass("is-banned",!this._canImportDataset())},_renderTooltips:function _renderTooltips(){this.addView(new c({el:this.$(".DatasetsList-itemStatus"),title:function title(e){return n(this).attr("data-title")}}))},_onTagClick:function _onTagClick(e){e&&this.killEvent(e);var t=n(e.target).val();t&&this._routerModel.set({tag:t,library:!0})},_canImportDataset:function _canImportDataset(){var e=this.model.getTableModel().get("size")||0;return this._userModel.get("remaining_byte_quota")*h.fileTimesBigger>=e&&this._userModel.get("limits").import_file_size>e},_toggleSelected:function _toggleSelected(e){"A"!==e.target.tagName&&(this.killEvent(e),this._canImportDataset()&&this._createModel.canSelect(this.model)&&this.model.set("selected",!this.model.get("selected")))}})},3077:function(e,t,i){var s=i(3),n=i(4),o={datasets:i(1584),remotes:i(3076)};e.exports=n.extend({tagName:"ul",className:"DatasetsList fs-DatasetsList",initialize:function initialize(e){if(!e.createModel)throw new Error("createModel is required");if(!e.userModel)throw new Error("userModel is required");this._createModel=e.createModel,this._userModel=e.userModel,this._tablesCollection=this._createModel.getTablesCollection(),this._initBinds()},render:function render(){return this.clearSubViews(),this._tablesCollection.each(this._addItem,this),this},_initBinds:function _initBinds(){var e;s(e=this._tablesCollection).call(e,"sync",this.render,this),this.add_related_model(this._tablesCollection)},_addItem:function _addItem(e,t){var i="remote"===e.get("type")?"remotes":"datasets",s=new o[i]({model:e,createModel:this._createModel,userModel:this._userModel});this.addView(s),this.$el.append(s.render().el)},show:function show(){this.$el.removeClass("is-hidden")},hide:function hide(){this.$el.addClass("is-hidden")}})},3078:function(e,t,i){var s=i(3),n=i(4),o=i(370);e.exports=n.extend({events:{"click .js-connect":"_onConnectClick"},initialize:function initialize(e){if(!e.routerModel)throw new Error("routerModel is required");if(!e.tablesCollection)throw new Error("tablesCollection is required");if(!e.userModel)throw new Error("userModel is required");if(!e.template)throw new Error("template is required");this._userModel=e.userModel,this._routerModel=e.routerModel,this._tablesCollection=e.tablesCollection,this.template=e.template,this._initBinds()},render:function render(){var e=this._routerModel.get("content_type");return this.$el.html(this.template({page:this._routerModel.get("page"),tag:this._routerModel.get("tag"),q:this._routerModel.get("q"),shared:this._routerModel.get("shared"),locked:this._routerModel.get("locked"),library:this._routerModel.get("library"),quote:o(),type:e,totalItems:this._tablesCollection.size(),totalEntries:this._tablesCollection.getTotalStat("total_entries")})),this},_initBinds:function _initBinds(){var e,t;s(e=this._routerModel).call(e,"change",this.render,this),s(t=this._tablesCollection).call(t,"sync",this.render,this),this.add_related_model(this._routerModel),this.add_related_model(this._tablesCollection)},_onConnectClick:function _onConnectClick(){this.trigger("connectDataset",this)}})},3079:function(e,t,i){var s=i(3),n=i(4),o=i(1),a=i(3078),r=i(3077),l=i(3075),c=i(1580),h=i(1579),d=i(1578),u=i(1577);e.exports=n.extend({initialize:function initialize(e){if(!e.createModel)throw new Error("createModel is required");if(!e.userModel)throw new Error("userModel is required");this._createModel=e.createModel,this._userModel=e.userModel,this._routerModel=this._createModel.getVisualizationFetchModel(),this._tablesCollection=this._createModel.getTablesCollection(),this._initViews(),this._initBinds(),this._onDataLoading()},_initBinds:function _initBinds(){var e,t,i,n;s(e=this._routerModel).call(e,"change",this._onRouterChange,this),s(t=this._tablesCollection).call(t,"loading",this._onDataLoading,this),s(i=this._tablesCollection).call(i,"sync",this._onDataFetched,this),s(n=this._tablesCollection).call(n,"error",function(e){(!e||e&&"abort"!==e.statusText)&&this._onDataError()},this),this.add_related_model(this._routerModel),this.add_related_model(this._tablesCollection)},_initViews:function _initViews(){this.controlledViews={},this.enabledViews=[];var e=new a({className:"ContentResult no-datasets",userModel:this._userModel,routerModel:this._routerModel,tablesCollection:this._tablesCollection,template:c});s(e).call(e,"connectDataset",function(){this._userModel.canCreateDatasets()&&this._createModel.set("listing","import")},this),e.render().hide(),this.controlledViews.no_datasets=e,this.$el.append(e.el),this.addView(e);var t=new r({userModel:this._userModel,createModel:this._createModel});this.controlledViews.list=t,this.$el.append(t.render().el),this.addView(t);var i=new a({userModel:this._userModel,routerModel:this._routerModel,tablesCollection:this._tablesCollection,template:h});i.render().hide(),this.controlledViews.no_results=i,this.$el.append(i.el),this.addView(i);var n=new a({userModel:this._userModel,routerModel:this._routerModel,tablesCollection:this._tablesCollection,template:d});n.render().hide(),this.controlledViews.error=n,this.$el.append(n.el),this.addView(n);var o=new a({userModel:this._userModel,routerModel:this._routerModel,tablesCollection:this._tablesCollection,template:u});this.controlledViews.main_loader=o,this.$el.append(o.render().el),this.addView(o);var p=new l({routerModel:this._routerModel,tablesCollection:this._tablesCollection});this.controlledViews.content_footer=p,this.$el.append(p.render().el),this.addView(p)},_onRouterChange:function _onRouterChange(){this._hideBlocks(),this._showBlocks(["main_loader"])},_onDataFetched:function _onDataFetched(){var e=["content_footer"],t=this._routerModel.get("tag"),i=this._routerModel.get("q"),s=this._routerModel.get("shared"),n=this._routerModel.get("locked"),o=this._routerModel.get("library");if(o&&0===this._tablesCollection.getTotalStat("total_user_entries")&&e.push("no_datasets"),0===this._tablesCollection.size())if(t||i||"no"!==s||n)e.push("no_results");else{if(!o)return void this._goToLibrary();e.push("no_results")}else e.push("list");this._hideBlocks(),this._showBlocks(e)},_onDataLoading:function _onDataLoading(){this._hideBlocks(),this._showBlocks(["main_loader"])},_onDataError:function _onDataError(e){this._hideBlocks(),this._showBlocks(["error"])},_showBlocks:function _showBlocks(e){var t=this;e?o.each(e,function(e){t.controlledViews[e]&&(t.controlledViews[e].show(),t.enabledViews.push(e))}):(t.enabledViews=[],o.each(this.controlledViews,function(e){e.show(),t.enabledViews.push(e)}))},_goToLibrary:function _goToLibrary(){this._routerModel.set({shared:"no",library:!0,page:1})},_hideBlocks:function _hideBlocks(e){var t=this;e?o.each(e,function(e){t.controlledViews[e]&&(t.controlledViews[e].hide(),t.enabledViews=o.without(t.enabledViews,e))}):(o.each(this.controlledViews,function(e){e.hide()}),t.enabledViews=[])},_isBlockEnabled:function _isBlockEnabled(e){return!!e&&o.contains(this.enabledViews,e)}})},332:function(e,t,i){var s=i(195),n=i(1),o=i(6),a=i(619),r={public:"PUBLIC",link:"LINK",private:"PRIVATE",password:"PASSWORD"},l="derived",c="kuviz";e.exports=o.Model.extend({defaults:{visChanges:0},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");this._configModel=t.configModel,this.get("permission")&&(this._permissionModel=new a(this.get("permission"),{configModel:t.configModel}),this.unset("permission"))},urlRoot:function urlRoot(){return this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("visualization")+"/viz"},mapcapsURL:function mapcapsURL(){return this._configModel.get("base_url")+"/api/v3/viz/"+this.id+"/mapcaps"},embedURL:function embedURL(){return this.get("type")===c?this.get("url"):this._configModel.get("base_url")+"/builder/"+this.id+"/embed"},builderURL:function builderURL(){return this._configModel.get("base_url")+"/builder/"+this.id+"/"},vizjsonURL:function vizjsonURL(){return this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("vizjson","read","v3")+"/viz/"+this.id+"/viz.json"},stateURL:function stateURL(){return this._configModel.get("base_url")+"/api/v3/viz/"+this.id+"/state"},isVisualization:function isVisualization(){return this.get("type")===l},privacyOptions:function privacyOptions(){return s(n).call(n,r)},recordChange:function recordChange(){var e=this.get("visChanges");this.set("visChanges",e+1)},resetChanges:function resetChanges(){this.set("visChanges",0)},getPermissionModel:function getPermissionModel(){return this._permissionModel},isPublished:function isPublished(){return this.get("type")===c||this.mapcapsCollection.length>0}},{isPubliclyAvailable:function isPubliclyAvailable(e){return e===r.password||e===r.link||e===r.public}})},337:function(e,t,i){i(23),i(40);var s,n=i(7),o=i(539).default,a=/https?:\/\/([^.]+)/,r=(o(s={},"session_expired","/login?error=session_expired"),o(s,"mfa_required","/multifactor_authentication"),o(s,"maintenance_mode","/maintenance_mode"),o(s,"lockout","/lockout"),o(s,"unverified","/unverified"),s);e.exports=function(e){return function(t,i,s){if(403===t.status){var n=t.responseJSON&&t.responseJSON.error,o=r[n];o&&l.redirectTo(l.getRedirectURL(window.location.origin,o,e))}}};var l={getRedirectURL:function getRedirectURL(e,t,i){var s,o;if(!i)return e+t;var r=e.replace(a,function(){return i});return n(s=n(o="".concat(window.location.protocol,"//")).call(o,r)).call(s,t)},redirectTo:function redirectTo(e){window.location=e}};e.exports.URLFunctions=l},3400:function(e,t,i){(function(e){!function(e){function maybeCall(e,t,i){return"function"==typeof e?e.call(t,i):e}function Tipsy(t,i){this.$element=e(t),this.options=i,this.enabled=!0,this.fixTitle()}Tipsy.prototype={show:function(){var t=this.getTitle();if(t&&this.enabled){var i=this.tip();i.find(".tipsy-inner")[this.options.html?"html":"text"](t),i[0].className="tipsy",i.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).prependTo(document.body),this.options.className&&i.addClass(maybeCall(this.options.className,this.$element[0]));var s,n=e.extend({},this.$element.offset(),{width:this.$element[0].getBoundingClientRect().width,height:this.$element[0].getBoundingClientRect().height}),o=i[0].offsetWidth,a=i[0].offsetHeight,r=maybeCall(this.options.gravity,this.$element[0],i[0]);switch(r.charAt(0)){case"n":s={top:n.top+n.height+this.options.offset,left:n.left+n.width/2-o/2},mo={top:parseInt(n.top+n.height+this.options.offset+6),opacity:this.options.opacity};break;case"s":s={top:n.top-a-this.options.offset,left:n.left+n.width/2-o/2},mo={top:parseInt(n.top-a-this.options.offset-6),opacity:this.options.opacity};break;case"e":s={top:n.top+n.height/2-a/2,left:n.left-o-this.options.offset},mo={left:parseInt(n.left-o-this.options.offset-6),opacity:this.options.opacity};break;case"w":s={top:n.top+n.height/2-a/2,left:n.left+n.width+this.options.offset},mo={left:parseInt(n.left+n.width+this.options.offset+6),opacity:this.options.opacity}}2==r.length&&("w"==r.charAt(1)?s.left=n.left+n.width/2-15:s.left=n.left+n.width/2-o+15),i.css(s).addClass("tipsy-"+r),i.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+r.charAt(0),this.options.fade?i.stop().css({opacity:0,display:"block",visibility:"visible"}).animate(mo,200):i.css({visibility:"visible",opacity:this.options.opacity})}},hide:function(){switch(gravity=maybeCall(this.options.gravity,this.$element[0]),gravity.charAt(0)){case"n":mo={top:parseInt(this.tip().css("top"))+6,opacity:0};break;case"s":mo={top:parseInt(this.tip().css("top"))-6,opacity:0};break;case"e":mo={left:parseInt(this.tip().css("left"))-6,opacity:0};break;case"w":mo={left:parseInt(this.tip().css("left"))+6,opacity:0}}this.options.fade?this.tip().stop().animate(mo,200,function(){e(this).remove()}):this.tip().remove()},fixTitle:function(){var e=this.$element;(e.attr("title")||"string"!=typeof e.attr("original-title"))&&e.attr("original-title",e.attr("title")||"").removeAttr("title")},getTitle:function(){var e,t=this.$element,i=this.options;return this.fixTitle(),"string"==typeof(i=this.options).title?e=t.attr("title"==i.title?"original-title":i.title):"function"==typeof i.title&&(e=i.title.call(t[0])),(e=(""+e).replace(/(^\s*|\s*$)/,""))||i.fallback},tip:function(){return this.$tip||(this.$tip=e('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>'),this.$tip.data("tipsy-pointee",this.$element[0])),this.$tip},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},remove:function(){this.enabled=!1,this.$tip&&this.$tip.remove()},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled}},e.fn.tipsy=function(t){if(!0===t)return this.data("tipsy");if("string"==typeof t){var i=this.data("tipsy");return i&&i[t](),this}function get(i){var s=e.data(i,"tipsy");return s||(s=new Tipsy(i,e.fn.tipsy.elementOptions(i,t)),e.data(i,"tipsy",s)),s}if((t=e.extend({},e.fn.tipsy.defaults,t)).live||this.each(function(){get(this)}),"manual"!=t.trigger){var s=t.live?"live":"bind",n="hover"==t.trigger?"mouseenter":"focus",o="hover"==t.trigger?"mouseleave":"blur";this[s](n,function enter(){var e=get(this);e.hoverState="in",0==t.delayIn?e.show():(e.fixTitle(),setTimeout(function(){"in"==e.hoverState&&e.show()},t.delayIn))})[s](o,function leave(){var e=get(this);e.hoverState="out",0==t.delayOut?e.hide():setTimeout(function(){"out"==e.hoverState&&e.hide()},t.delayOut)})}return this},e.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:!1,fallback:"",gravity:"n",html:!1,live:!1,offset:0,opacity:.8,title:"title",trigger:"hover"},e.fn.tipsy.revalidate=function(){e(".tipsy").each(function(){var t=e.data(this,"tipsy-pointee");t&&function isElementInDOM(e){for(;e=e.parentNode;)if(e==document)return!0;return!1}(t)||e(this).remove()})},e.fn.tipsy.elementOptions=function(t,i){return e.metadata?e.extend({},i,e(t).metadata()):i},e.fn.tipsy.autoNS=function(){return e(this).offset().top>e(document).scrollTop()+e(window).height()/2?"s":"n"},e.fn.tipsy.autoWE=function(){return e(this).offset().left>e(document).scrollLeft()+e(window).width()/2?"e":"w"},e.fn.tipsy.autoBounds=function(t,i){return function(){var s={ns:i[0],ew:i.length>1&&i[1]},n=e(document).scrollTop()+t,o=e(document).scrollLeft()+t,a=e(this);return a.offset().top<n&&(s.ns="n"),a.offset().left<o&&(s.ew="w"),e(window).width()+e(document).scrollLeft()-a.offset().left<t&&(s.ew="e"),e(window).height()+e(document).scrollTop()-a.offset().top<t&&(s.ns="s"),s.ns+(s.ew?s.ew:"")}}}(e)}).call(this,i(18))},345:function(e,t,i){i(35);var s=i(430),n=i(3),o=i(1),a=i(6),r=i(822),l=i(59),c=i(74);i(1059),e.exports=a.Model.extend({url:function url(){return this._configModel.get("base_url")+"/api/v1/imports"},fileAttribute:"filename",defaults:{type:"",value:"",interval:0,privacy:"",progress:0,state:"idle",service_item_id:"",service_name:"",option:"",content_guessing:!0,type_guessing:!0,create_vis:!0},initialize:function initialize(e,t){if(!t.userModel)throw new Error("userModel is required");if(!t.configModel)throw new Error("configModel is required");this._userModel=t.userModel,this._configModel=t.configModel,this._initBinds(),this._validate(this.attributes,{validate:!0})},setUpload:function setUpload(e){this.set(e,{validate:!0})},isValidToUpload:function isValidToUpload(){return this.get("value")&&"error"!==this.get("state")},setFresh:function setFresh(e){e&&!o.isEmpty(e)?this.set(o.omit(e,"create_vis")):this.clear()},_initBinds:function _initBinds(){var e,t,i;n(e=this).call(e,"progress",function(e){this.set({progress:100*e,state:"uploading"})},this),n(t=this).call(t,"change:value",function(){"error"===this.get("state")&&(this.set({state:"idle"}),this.unset("get_error_text",{silent:!0}))},this),n(i=this).call(i,"error invalid",function(e,t){this.set({state:"error",error_code:t&&t.error_code||"",get_error_text:{title:_t("data.upload-model.invalid-import"),what_about:t&&t.msg||""}})},this)},validate:function validate(e){if(e){if("file"===e.type){if(e.value&&e.value.length)return{msg:_t("data.upload-model.one-file")};var t=e.value.name;if(!t)return{msg:_t("data.upload-model.file-defined")};var i=t.substr(s(t).call(t,".")+1);if(i&&(i=i.toLowerCase()),!o.contains(r.fileExtensions,i))return{msg:_t("data.upload-model.file-extension")};if(this._userModel.get("remaining_byte_quota")*r.fileTimesBigger<e.value.size)return{msg:_t("data.upload-model.file-size"),error_code:8001}}if("remote"===e.type){if(!e.remote_visualization_id)return{msg:_t("data.upload-model.visualization-id")};if(e.size&&this._userModel.get("remaining_byte_quota")*r.fileTimesBigger<e.size)return{msg:_t("data.upload-model.remote-file-size"),error_code:8001}}if("url"===e.type&&!l.isURL(e.value))return{msg:_t("data.upload-model.url-invalid")};if("sql"===e.type&&!e.value)return{msg:_t("data.upload-model.query-undefined")};if("duplication"===e.type&&!e.value)return{msg:_t("data.upload-model.dataset-copy-undefined")};if("service"===e.type&&"twitter_search"===e.service_name){var n=e.service_item_id;if(!n||o.isEmpty(n))return{msg:_t("data.upload-model.twitter-data")};if(o.isEmpty(n.categories))return{msg:_t("data.upload-model.twitter-categories-invalid")};var a=n.dates;if(!a||o.isEmpty(a))return{msg:_t("data.upload-model.twitter-dates-empty")};var h=c(a.fromDate)<=c(new Date);if(!a.fromDate||!a.toDate||!h)return{msg:_t("data.upload-model.twitter-dates-invalid")}}}},isValid:function isValid(){return this.get("value")&&"error"!==this.get("state")},upload:function upload(){if("file"===this.get("type")){var e=this;this.xhr=this.save({filename:this.get("value")},{success:function success(e){e.set("state","uploaded")},error:function error(t,i){var s=_t("data.upload-model.connection-error");i&&429===i.status&&(s=JSON.parse(i.responseText).errors.imports);e.set({state:"error",get_error_text:{title:_t("data.upload-model.error-happened"),what_about:s}})},complete:function complete(){delete e.xhr}})}},stopUpload:function stopUpload(){this.xhr&&this.xhr.abort()},setGuessing:function setGuessing(e){this.set({type_guessing:e,content_guessing:e})},setPrivacy:function setPrivacy(e){this.set("privacy",e)}})},3488:function(e,t,i){i(34),i(67),i(23),i(101);var s=i(15);i(77);var n=i(1671).default,o=i(7),a=i(44),r=i(1091).default,l=i(636).default,c=i(635).default,h=i(1670).default,d=i(1669).default,u=i(1676),p=function(e){"use strict";d(AuthenticatedClient,u);var t=h(AuthenticatedClient);function AuthenticatedClient(){return l(this,AuthenticatedClient),t.apply(this,arguments)}return c(AuthenticatedClient,[{key:"getConfig",value:function getConfig(e){return this.get(["api/v3/me"],e)}},{key:"getVisualization",value:function getVisualization(e,t,i){var s=this.paramsToURI(t);return this.get(["api/v1/viz",e,s],i)}},{key:"getDerivedVisualizations",value:function getDerivedVisualizations(e,t){var i=r({type:"derived",privacy:"public"},e),s=this.paramsToURI(i);return this.get(["api/v1/viz",s],t)}},{key:"getMap",value:function getMap(e,t){return this.get(["api/v1/maps",e],t)}},{key:"putConfig",value:function putConfig(e,t){var i={data:a(e),dataType:"json"};return this.put(["api/v3/me"],i,t)}},{key:"deleteUser",value:function deleteUser(e,t){var i={data:a(e),dataType:"json"};return this.delete(["api/v3/me"],i,t)}},{key:"like",value:function like(e,t){return this.post(["api/v1/viz",e,"like"],{dataType:"json"},t)}},{key:"deleteLike",value:function deleteLike(e,t){return this.delete(["api/v1/viz",e,"like"],{dataType:"json"},t)}},{key:"updateNotification",value:function updateNotification(e,t,i,s){var n,r,l=[o(n=o(r="/api/v3/users/".concat(e,"/notifications/")).call(r,i.id,"?api_key=")).call(n,t)],c={data:a({notification:i}),dataType:"json"};return this.put(l,c,s)}},{key:"getTags",value:function getTags(e,t){var i={data:{q:e.q,page:e.page||1,per_page:e.perPage||6,types:e.types||"derived,table",include_shared:e.include_shared||!1}};return this.get(["api/v3/tags"],i,t)}},{key:"previewSearch",value:function previewSearch(e,t){var i={data:{types:"derived,table,kuviz,tag",limit:4}};return this.get([["api/v3/search_preview"],encodeURIComponent(e)],i,t)}},{key:"getApiKeys",value:function getApiKeys(e,t){var i={data:{type:e}};return this.get(["api/v3/api_keys"],i,t)}},{key:"getOAuthApps",value:function getOAuthApps(e,t){var i=["api/v4/oauth_apps?api_key=".concat(e)];return this.get(i,t)}},{key:"createApp",value:function createApp(e,t,i){var s=["api/v4/oauth_apps?api_key=".concat(e)],n={data:a(t),dataType:"json"};return this.post(s,n,i)}},{key:"updateApp",value:function updateApp(e,t,i){var s,n=[o(s="api/v4/oauth_apps/".concat(t.id,"?api_key=")).call(s,e)],r={data:a(t),dataType:"json"};return this.put(n,r,i)}},{key:"deleteApp",value:function deleteApp(e,t,i){var s,n=[o(s="api/v4/oauth_apps/".concat(t.id,"?api_key=")).call(s,e)],r={data:a(t),dataType:"json"};return this.delete(n,r,i)}},{key:"regenerateClientSecret",value:function regenerateClientSecret(e,t,i){var s,n=[o(s="api/v4/oauth_apps/".concat(t.id,"/regenerate_secret?api_key=")).call(s,e)],r={data:a(t),dataType:"json"};return this.post(n,r,i)}},{key:"uploadLogo",value:function uploadLogo(e,t,i,s){var n,a=[o(n="api/v1/users/".concat(t,"/assets?api_key=")).call(n,e)],r=new FormData;r.append("kind","orgavatar"),r.append("filename",i);var l={data:r,doNoSetDefaultContentType:!0,processData:!1};return this.post(a,l,s)}},{key:"getConnectedApps",value:function getConnectedApps(e,t){var i=["api/v4/granted_oauth_apps?api_key=".concat(e)];return this.get(i,t)}},{key:"revokeOAuthApp",value:function revokeOAuthApp(e,t,i){var s,n=[o(s="api/v4/oauth_apps/".concat(t.id,"/revoke?api_key=")).call(s,e)],r={data:a(t),dataType:"json"};return this.post(n,r,i)}},{key:"dbConnectors",value:function dbConnectors(){var e=this;return{checkConnection:function checkConnection(t,i,s){var n=["api/v1/connectors/".concat(t,"/connect")],o=e.paramsToURI(i);return e.get([n,o],s)},dryRun:function dryRun(t,i,s){var n=["api/v1/connectors/".concat(t,"/dryrun")],o={data:a(i),dataType:"json"};return e.post(n,o,s)}}}},{key:"directDBConnection",value:function directDBConnection(){var e=this,t=["api/v3/dbdirect/ip"];return{getIPs:function getIPs(i){return e.get(t,i)},setIPs:function setIPs(i,s){var n={data:a({ips:i}),dataType:"json"};return e.put(t,n,s)},getCertificates:function getCertificates(t){return e.get(["api/v3/dbdirect/certificates"],t)},createCertificate:function(){var t=n(s.mark(function _callee(t){var i,n,r,l,c,h,d,u,p=arguments;return s.wrap(function _callee$(s){for(;;)switch(s.prev=s.next){case 0:return n=p.length>1&&void 0!==p[1]?p[1]:"json",r=["api/v3/dbdirect/certificates.".concat(n)],l=e.getAssetsBaseUrl(),c=0!==r.length?e.makeAbsoluteURI(e.makeRelativeURI(r)):"",s.next=6,fetch(o(i="".concat(l)).call(i,c),{method:"POST",headers:{"Content-Type":"application/json"},body:a(t)});case 6:return h=s.sent,d=h.headers.get("Content-Disposition"),s.next=10,h.blob();case 10:return u=s.sent,s.abrupt("return",{file:u,fileName:d.match(/filename=(.+)/)[1]});case 12:case"end":return s.stop()}},_callee)}));return function createCertificate(e){return t.apply(this,arguments)}}(),revokeCertificate:function revokeCertificate(t,i){var s=["api/v3/dbdirect/certificates/".concat(t)];return e.delete(s,i)}}}},{key:"emailNotifications",value:function emailNotifications(){var e=this,t=["api/v3/email_notifications"];return{get:function get(i){return e.get(t,i)},set:function set(i,s){var n={data:a({notifications:i}),dataType:"json"};return e.put(t,n,s)}}}}]),AuthenticatedClient}();e.exports=p},350:function(e,t,i){e.exports={en:i(285),sw:i(284),es:i(283)}},353:function(e,t,i){i(23),i(40);var s=i(32),n=i(6);e.exports=n.Model.extend({VERSION:2,initialize:function initialize(){this.modules=new n.Collection,this.modules.on("add",function(e){this.trigger("moduleLoaded"),this.trigger("moduleLoaded:"+e.get("name"))},this)},REPORT_ERROR_URL:"/api/v0/error",ERROR_TRACK_ENABLED:!1,getSqlApiBaseUrl:function getSqlApiBaseUrl(){return this.get("sql_api_template")?this.get("sql_api_template").replace("{user}",this.get("user_name")):this.get("sql_api_protocol")+"://"+this.get("user_name")+"."+this.get("sql_api_domain")+":"+this.get("sql_api_port")},getSqlApiUrl:function getSqlApiUrl(e){return e=e||"v2",this.getSqlApiBaseUrl()+"/api/"+e+"/sql"},getMapsApiHost:function getMapsApiHost(){var e,t=this.get("maps_api_template");return t&&(e=t.replace(/https?:\/\/{user}\./,"")),e},setUrlVersion:function setUrlVersion(e,t,i){this.set(e+"_"+t+"_url_version",i||"v1")},urlVersion:function urlVersion(e,t,i){return t=t||"",this.get(e+"_"+t+"_url_version")||i||"v1"},prefixUrl:function prefixUrl(){return this.get("url_prefix")||""},prefixUrlPathname:function prefixUrlPathname(){var e=this.prefixUrl();if(""!==e)try{if(e&&-1===s(e).call(e,"/"))throw new TypeError("invalid URL");var t=document.createElement("a");return t.href=e,t.pathname.replace(/\/$/,"")}catch(e){}return e},getMapsResourceName:function getMapsResourceName(e){var t,i=this.get("maps_api_template");return i&&(t=i.replace(/(http|https)?:\/\//,"").replace(/{user}/g,e)),t},dataLibraryEnabled:function dataLibraryEnabled(){return this.get("data_library_enabled")},isHosted:function isHosted(){return this.get("cartodb_com_hosted")}})},355:function(e,t,i){e.exports={PublicClient:i(1676),AuthenticatedClient:i(3488)}},356:function(e,t,i){"use strict";i.r(t);var s,n=i(79),o=i(585),a=i(3),r=i.n(a),l=i(7),c=i.n(l),h=i(91),d=i(52),u=i(43),p=i.n(u),g=i(75);function isObject(e){return e&&"object"===Object(g.a)(e)&&!p()(e)}var m=i(350),f=i(373),_=i(571);m.en=function deepObjectExtend(e){for(var t,i=arguments.length,s=new Array(i>1?i-1:0),n=1;n<i;n++)s[n-1]=arguments[n];if(!s.length)return e;var o=s.shift();if(isObject(e)&&isObject(o))for(var a in o)isObject(o[a])?(e[a]||Object(d.a)(e,Object(h.a)({},a,{})),deepObjectExtend(e[a],o[a])):Object(d.a)(e,Object(h.a)({},a,o[a]));return deepObjectExtend.apply(void 0,c()(t=[e]).call(t,s))}(m.en,_);var v=new f({locale:"en",phrases:m.en});window._t=r()(s=v.t).call(s,v);var y=i(377);n.default.use(o.a);var w=new o.a({locale:"en",messages:{en:y}});t.default=w},367:function(e,t,i){var s=i(3),n=i(4),o=i(18),a=i(1),r=i(86),l=["template","runAction","modalModel"];e.exports=n.extend({className:"Dialog-content",events:{"click .js-confirm":"_onConfirm","click .js-cancel":"_onCancel"},initialize:function initialize(e){var t;a.each(l,function(t){if(!e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this),e.loadingTitle&&(this._hasLoading=!0,this._loadingTitle=e.loadingTitle),e.renderOpts&&(this._hasRenderOpts=!0,this._renderOpts=e.renderOpts),this._onKeyDown=s(t=this._onKeyDown).call(t,this),this._initBinds()},render:function render(){this.clearSubViews();var e=this._hasRenderOpts?this._template(this._renderOpts):this._template();return this.$el.html(e),this},_initBinds:function _initBinds(){var e;s(e=o(document)).call(e,"keydown",this._onKeyDown)},_disableBinds:function _disableBinds(){o(document).unbind("keydown",this._onKeyDown)},_onKeyDown:function _onKeyDown(e){13===e.which&&this._onConfirm()},_renderLoadingView:function _renderLoadingView(){this.$el.html(r({title:this._loadingTitle}))},_$content:function _$content(){return this.$(".js-content")},_onConfirm:function _onConfirm(){this._hasLoading?this._renderLoadingView():this._modalModel.destroy(),this._runAction()},_onCancel:function _onCancel(){this._modalModel.destroy()},clean:function clean(){this._disableBinds(),n.prototype.clean.apply(this)}})},368:function(e,t,i){var s=i(7),n=i(3),o=i(4),a=i(3013),r=i(1);e.exports=o.extend({module:"components:stack-layout:stack-layout-view",initialize:function initialize(e){var t;if(!this.collection||!this.collection.size())throw new Error("A collection of stack views should be provided");this.model=new a({},{stackLayoutItems:this.collection}),n(t=this.model).call(t,"positionChanged",this._onPositionChange,this)},render:function render(){return this.clearSubViews(),this._genNewStackView(),this},_onPositionChange:function _onPositionChange(e,t){this._removeOldStackView(),this._genNewStackView(r.flatten(t)),this.trigger("positionChanged",this)},getCurrentPosition:function getCurrentPosition(){return this.model.get("position")},_removeOldStackView:function _removeOldStackView(){var e=this._getCurrentView();e&&(e.clean(),this.removeView(e))},_getCurrentView:function _getCurrentView(){for(var e in this._subviews)break;return this._subviews[e]},_genNewStackView:function _genNewStackView(){var e,t=s(e=[this.model]).call(e,[r.flatten(arguments)]),i=this.collection.at(this.model.get("position")).get("createStackView").apply(this,t);this.addView(i),this.$el.html(i.render().el)}})},369:function(e,t,i){var s,n,o;n=[i(18)],void 0===(o="function"==typeof(s=function(e){function focusable(t,i){var s,n,o,a=t.nodeName.toLowerCase();return"area"===a?(s=t.parentNode,n=s.name,!(!t.href||!n||"map"!==s.nodeName.toLowerCase())&&!!(o=e("img[usemap='#"+n+"']")[0])&&visible(o)):(/^(input|select|textarea|button|object)$/.test(a)?!t.disabled:"a"===a&&t.href||i)&&visible(t)}function visible(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var t,i,s,n;e.ui=e.ui||{},e.extend(e.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({scrollParent:function(t){var i=this.css("position"),s="absolute"===i,n=t?/(auto|scroll|hidden)/:/(auto|scroll)/,o=this.parents().filter(function(){var t=e(this);return(!s||"static"!==t.css("position"))&&n.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==i&&o.length?o:e(this[0].ownerDocument||document)},uniqueId:(t=0,function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++t)})}),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,s){return!!e.data(t,s[3])},focusable:function(t){return focusable(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var i=e.attr(t,"tabindex"),s=isNaN(i);return(s||i>=0)&&focusable(t,!s)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(t,i){var s="Width"===i?["Left","Right"]:["Top","Bottom"],n=i.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};function reduce(t,i,n,o){return e.each(s,function(){i-=parseFloat(e.css(t,"padding"+this))||0,n&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),o&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}e.fn["inner"+i]=function(t){return void 0===t?o["inner"+i].call(this):this.each(function(){e(this).css(n,reduce(this,t)+"px")})},e.fn["outer"+i]=function(t,s){return"number"!=typeof t?o["outer"+i].call(this,t):this.each(function(){e(this).css(n,reduce(this,t,!0,s)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=(i=e.fn.removeData,function(t){return arguments.length?i.call(this,e.camelCase(t)):i.call(this)})),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.fn.extend({focus:(n=e.fn.focus,function(t,i){return"number"==typeof t?this.each(function(){var s=this;setTimeout(function(){e(s).focus(),i&&i.call(s)},t)}):n.apply(this,arguments)}),disableSelection:(s="onselectstart"in document.createElement("div")?"selectstart":"mousedown",function(){return this.bind(s+".ui-disableSelection",function(e){e.preventDefault()})}),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(t){if(void 0!==t)return this.css("zIndex",t);if(this.length)for(var i,s,n=e(this[0]);n.length&&n[0]!==document;){if(("absolute"===(i=n.css("position"))||"relative"===i||"fixed"===i)&&(s=parseInt(n.css("zIndex"),10),!isNaN(s)&&0!==s))return s;n=n.parent()}return 0}}),e.ui.plugin={add:function(t,i,s){var n,o=e.ui[t].prototype;for(n in s)o.plugins[n]=o.plugins[n]||[],o.plugins[n].push([i,s[n]])},call:function(e,t,i,s){var n,o=e.plugins[t];if(o&&(s||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(n=0;n<o.length;n++)e.options[o[n][0]]&&o[n][1].apply(e.element,i)}};var o=0,a=Array.prototype.slice;e.cleanData=function(t){return function(i){var s,n,o;for(o=0;null!=(n=i[o]);o++)try{(s=e._data(n,"events"))&&s.remove&&e(n).triggerHandler("remove")}catch(e){}t(i)}}(e.cleanData),e.widget=function(t,i,s){var n,o,a,r,l={},c=t.split(".")[0];return t=t.split(".")[1],n=c+"-"+t,s||(s=i,i=e.Widget),e.expr[":"][n.toLowerCase()]=function(t){return!!e.data(t,n)},e[c]=e[c]||{},o=e[c][t],a=e[c][t]=function(e,t){if(!this._createWidget)return new a(e,t);arguments.length&&this._createWidget(e,t)},e.extend(a,o,{version:s.version,_proto:e.extend({},s),_childConstructors:[]}),(r=new i).options=e.widget.extend({},r.options),e.each(s,function(t,s){var n,o;e.isFunction(s)?l[t]=(n=function(){return i.prototype[t].apply(this,arguments)},o=function(e){return i.prototype[t].apply(this,e)},function(){var e,t=this._super,i=this._superApply;return this._super=n,this._superApply=o,e=s.apply(this,arguments),this._super=t,this._superApply=i,e}):l[t]=s}),a.prototype=e.widget.extend(r,{widgetEventPrefix:o&&r.widgetEventPrefix||t},l,{constructor:a,namespace:c,widgetName:t,widgetFullName:n}),o?(e.each(o._childConstructors,function(t,i){var s=i.prototype;e.widget(s.namespace+"."+s.widgetName,a,i._proto)}),delete o._childConstructors):i._childConstructors.push(a),e.widget.bridge(t,a),a},e.widget.extend=function(t){for(var i,s,n=a.call(arguments,1),o=0,r=n.length;o<r;o++)for(i in n[o])s=n[o][i],n[o].hasOwnProperty(i)&&void 0!==s&&(e.isPlainObject(s)?t[i]=e.isPlainObject(t[i])?e.widget.extend({},t[i],s):e.widget.extend({},s):t[i]=s);return t},e.widget.bridge=function(t,i){var s=i.prototype.widgetFullName||t;e.fn[t]=function(n){var o="string"==typeof n,r=a.call(arguments,1),l=this;return o?this.each(function(){var i,o=e.data(this,s);return"instance"===n?(l=o,!1):o?e.isFunction(o[n])&&"_"!==n.charAt(0)?(i=o[n].apply(o,r))!==o&&void 0!==i?(l=i&&i.jquery?l.pushStack(i.get()):i,!1):void 0:e.error("no such method '"+n+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; attempted to call method '"+n+"'")}):(r.length&&(n=e.widget.extend.apply(null,[n].concat(r))),this.each(function(){var t=e.data(this,s);t?(t.option(n||{}),t._init&&t._init()):e.data(this,s,new i(n,this))})),l}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=o++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var s,n,o,a=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(a={},s=t.split("."),t=s.shift(),s.length){for(n=a[t]=e.widget.extend({},this.options[t]),o=0;o<s.length-1;o++)n[s[o]]=n[s[o]]||{},n=n[s[o]];if(t=s.pop(),1===arguments.length)return void 0===n[t]?null:n[t];n[t]=i}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];a[t]=i}return this._setOptions(a),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,i,s){var n,o=this;"boolean"!=typeof t&&(s=i,i=t,t=!1),s?(i=n=e(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),e.each(s,function(s,a){function handlerProxy(){if(t||!0!==o.options.disabled&&!e(this).hasClass("ui-state-disabled"))return("string"==typeof a?o[a]:a).apply(o,arguments)}"string"!=typeof a&&(handlerProxy.guid=a.guid=a.guid||handlerProxy.guid||e.guid++);var r=s.match(/^([\w:-]*)\s*(.*)$/),l=r[1]+o.eventNamespace,c=r[2];c?n.delegate(c,l,handlerProxy):i.bind(l,handlerProxy)})},_off:function(t,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(i).undelegate(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){var i=this;return setTimeout(function handlerProxy(){return("string"==typeof e?i[e]:e).apply(i,arguments)},t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,s){var n,o,a=this.options[t];if(s=s||{},(i=e.Event(i)).type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(n in o)n in i||(i[n]=o[n]);return this.element.trigger(i,s),!(e.isFunction(a)&&!1===a.apply(this.element[0],[i].concat(s))||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(s,n,o){"string"==typeof n&&(n={effect:n});var a,r=n?!0===n||"number"==typeof n?i:n.effect||i:t;"number"==typeof(n=n||{})&&(n={duration:n}),a=!e.isEmptyObject(n),n.complete=o,n.delay&&s.delay(n.delay),a&&e.effects&&e.effects.effect[r]?s[t](n):r!==t&&s[r]?s[r](n.duration,n.easing,o):s.queue(function(i){e(this)[t](),o&&o.call(s[0]),i()})}}),e.widget;var r=!1;e(document).mouseup(function(){r=!1}),e.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){if(!0===e.data(i.target,t.widgetName+".preventClickEvent"))return e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!r){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var i=this,s=1===t.which,n=!("string"!=typeof this.options.cancel||!t.target.nodeName)&&e(t.target).closest(this.options.cancel).length;return!(s&&!n&&this._mouseCapture(t)&&(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=!1!==this._mouseStart(t),!this._mouseStarted)?(t.preventDefault(),0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),r=!0,0)))}},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button)return this._mouseUp(t);if(!t.which)return this._mouseUp(t)}return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,t),this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),r=!1,!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),function(){e.ui=e.ui||{};var t,i,s=Math.max,n=Math.abs,o=Math.round,a=/left|center|right/,r=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,h=/%$/,d=e.fn.position;function getOffsets(e,t,i){return[parseFloat(e[0])*(h.test(e[0])?t/100:1),parseFloat(e[1])*(h.test(e[1])?i/100:1)]}function parseCss(t,i){return parseInt(e.css(t,i),10)||0}e.position={scrollbarWidth:function(){if(void 0!==t)return t;var i,s,n=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=n.children()[0];return e("body").append(n),i=o.offsetWidth,n.css("overflow","scroll"),s=o.offsetWidth,i===s&&(s=n[0].clientWidth),n.remove(),t=i-s},getScrollInfo:function(t){var i=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),s=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),n="scroll"===i||"auto"===i&&t.width<t.element[0].scrollWidth,o="scroll"===s||"auto"===s&&t.height<t.element[0].scrollHeight;return{width:o?e.position.scrollbarWidth():0,height:n?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),s=e.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:s,isDocument:n,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:s||n?i.width():i.outerWidth(),height:s||n?i.height():i.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return d.apply(this,arguments);t=e.extend({},t);var h,u,p,g,m,f,_=e(t.of),v=e.position.getWithinInfo(t.within),y=e.position.getScrollInfo(v),w=(t.collision||"flip").split(" "),b={};return f=function getDimensions(t){var i=t[0];return 9===i.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}(_),_[0].preventDefault&&(t.at="left top"),u=f.width,p=f.height,g=f.offset,m=e.extend({},g),e.each(["my","at"],function(){var e,i,s=(t[this]||"").split(" ");1===s.length&&(s=a.test(s[0])?s.concat(["center"]):r.test(s[0])?["center"].concat(s):["center","center"]),s[0]=a.test(s[0])?s[0]:"center",s[1]=r.test(s[1])?s[1]:"center",e=l.exec(s[0]),i=l.exec(s[1]),b[this]=[e?e[0]:0,i?i[0]:0],t[this]=[c.exec(s[0])[0],c.exec(s[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===t.at[0]?m.left+=u:"center"===t.at[0]&&(m.left+=u/2),"bottom"===t.at[1]?m.top+=p:"center"===t.at[1]&&(m.top+=p/2),h=getOffsets(b.at,u,p),m.left+=h[0],m.top+=h[1],this.each(function(){var a,r,l=e(this),c=l.outerWidth(),d=l.outerHeight(),f=parseCss(this,"marginLeft"),C=parseCss(this,"marginTop"),M=c+f+parseCss(this,"marginRight")+y.width,k=d+C+parseCss(this,"marginBottom")+y.height,S=e.extend({},m),x=getOffsets(b.my,l.outerWidth(),l.outerHeight());"right"===t.my[0]?S.left-=c:"center"===t.my[0]&&(S.left-=c/2),"bottom"===t.my[1]?S.top-=d:"center"===t.my[1]&&(S.top-=d/2),S.left+=x[0],S.top+=x[1],i||(S.left=o(S.left),S.top=o(S.top)),a={marginLeft:f,marginTop:C},e.each(["left","top"],function(i,s){e.ui.position[w[i]]&&e.ui.position[w[i]][s](S,{targetWidth:u,targetHeight:p,elemWidth:c,elemHeight:d,collisionPosition:a,collisionWidth:M,collisionHeight:k,offset:[h[0]+x[0],h[1]+x[1]],my:t.my,at:t.at,within:v,elem:l})}),t.using&&(r=function(e){var i=g.left-S.left,o=i+u-c,a=g.top-S.top,r=a+p-d,h={target:{element:_,left:g.left,top:g.top,width:u,height:p},element:{element:l,left:S.left,top:S.top,width:c,height:d},horizontal:o<0?"left":i>0?"right":"center",vertical:r<0?"top":a>0?"bottom":"middle"};u<c&&n(i+o)<u&&(h.horizontal="center"),p<d&&n(a+r)<p&&(h.vertical="middle"),s(n(i),n(o))>s(n(a),n(r))?h.important="horizontal":h.important="vertical",t.using.call(this,e,h)}),l.offset(e.extend(S,{using:r}))})},e.ui.position={fit:{left:function(e,t){var i,n=t.within,o=n.isWindow?n.scrollLeft:n.offset.left,a=n.width,r=e.left-t.collisionPosition.marginLeft,l=o-r,c=r+t.collisionWidth-a-o;t.collisionWidth>a?l>0&&c<=0?(i=e.left+l+t.collisionWidth-a-o,e.left+=l-i):e.left=c>0&&l<=0?o:l>c?o+a-t.collisionWidth:o:l>0?e.left+=l:c>0?e.left-=c:e.left=s(e.left-r,e.left)},top:function(e,t){var i,n=t.within,o=n.isWindow?n.scrollTop:n.offset.top,a=t.within.height,r=e.top-t.collisionPosition.marginTop,l=o-r,c=r+t.collisionHeight-a-o;t.collisionHeight>a?l>0&&c<=0?(i=e.top+l+t.collisionHeight-a-o,e.top+=l-i):e.top=c>0&&l<=0?o:l>c?o+a-t.collisionHeight:o:l>0?e.top+=l:c>0?e.top-=c:e.top=s(e.top-r,e.top)}},flip:{left:function(e,t){var i,s,o=t.within,a=o.offset.left+o.scrollLeft,r=o.width,l=o.isWindow?o.scrollLeft:o.offset.left,c=e.left-t.collisionPosition.marginLeft,h=c-l,d=c+t.collisionWidth-r-l,u="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,g=-2*t.offset[0];h<0?((i=e.left+u+p+g+t.collisionWidth-r-a)<0||i<n(h))&&(e.left+=u+p+g):d>0&&((s=e.left-t.collisionPosition.marginLeft+u+p+g-l)>0||n(s)<d)&&(e.left+=u+p+g)},top:function(e,t){var i,s,o=t.within,a=o.offset.top+o.scrollTop,r=o.height,l=o.isWindow?o.scrollTop:o.offset.top,c=e.top-t.collisionPosition.marginTop,h=c-l,d=c+t.collisionHeight-r-l,u="top"===t.my[1],p=u?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,g="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,m=-2*t.offset[1];h<0?((s=e.top+p+g+m+t.collisionHeight-r-a)<0||s<n(h))&&(e.top+=p+g+m):d>0&&((i=e.top-t.collisionPosition.marginTop+p+g+m-l)>0||n(i)<d)&&(e.top+=p+g+m)}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,s,n,o,a,r=document.getElementsByTagName("body")[0],l=document.createElement("div");for(a in t=document.createElement(r?"div":"body"),n={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},r&&e.extend(n,{position:"absolute",left:"-1000px",top:"-1000px"}),n)t.style[a]=n[a];t.appendChild(l),(s=r||document.documentElement).insertBefore(t,s.firstChild),l.style.cssText="position: absolute; left: 10.7432222px;",o=e(l).offset().left,i=o>10&&o<11,t.innerHTML="",s.removeChild(t)}()}(),e.ui.position,e.widget("ui.accordion",{version:"1.11.4",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var t=this.options;this.prevShow=this.prevHide=e(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),t.collapsible||!1!==t.active&&null!=t.active||(t.active=0),this._processPanels(),t.active<0&&(t.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():e()}},_createIcons:function(){var t=this.options.icons;t&&(e("<span>").addClass("ui-accordion-header-icon ui-icon "+t.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(t.header).addClass(t.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var e;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").removeUniqueId(),this._destroyIcons(),e=this.headers.next().removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").css("display","").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&e.css("height","")},_setOption:function(e,t){"active"!==e?("event"===e&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(t)),this._super(e,t),"collapsible"!==e||t||!1!==this.options.active||this._activate(0),"icons"===e&&(this._destroyIcons(),t&&this._createIcons()),"disabled"===e&&(this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!t))):this._activate(t)},_keydown:function(t){if(!t.altKey&&!t.ctrlKey){var i=e.ui.keyCode,s=this.headers.length,n=this.headers.index(t.target),o=!1;switch(t.keyCode){case i.RIGHT:case i.DOWN:o=this.headers[(n+1)%s];break;case i.LEFT:case i.UP:o=this.headers[(n-1+s)%s];break;case i.SPACE:case i.ENTER:this._eventHandler(t);break;case i.HOME:o=this.headers[0];break;case i.END:o=this.headers[s-1]}o&&(e(t.target).attr("tabIndex",-1),e(o).attr("tabIndex",0),o.focus(),t.preventDefault())}},_panelKeyDown:function(t){t.keyCode===e.ui.keyCode.UP&&t.ctrlKey&&e(t.currentTarget).prev().focus()},refresh:function(){var t=this.options;this._processPanels(),!1===t.active&&!0===t.collapsible||!this.headers.length?(t.active=!1,this.active=e()):!1===t.active?this._activate(0):this.active.length&&!e.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(t.active=!1,this.active=e()):this._activate(Math.max(0,t.active-1)):t.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var e=this.headers,t=this.panels;this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-state-default ui-corner-all"),this.panels=this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide(),t&&(this._off(e.not(this.headers)),this._off(t.not(this.panels)))},_refresh:function(){var t,i=this.options,s=i.heightStyle,n=this.element.parent();this.active=this._findActive(i.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each(function(){var t=e(this),i=t.uniqueId().attr("id"),s=t.next(),n=s.uniqueId().attr("id");t.attr("aria-controls",n),s.attr("aria-labelledby",i)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(i.event),"fill"===s?(t=n.height(),this.element.siblings(":visible").each(function(){var i=e(this),s=i.css("position");"absolute"!==s&&"fixed"!==s&&(t-=i.outerHeight(!0))}),this.headers.each(function(){t-=e(this).outerHeight(!0)}),this.headers.next().each(function(){e(this).height(Math.max(0,t-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===s&&(t=0,this.headers.next().each(function(){t=Math.max(t,e(this).css("height","").height())}).height(t))},_activate:function(t){var i=this._findActive(t)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return"number"==typeof t?this.headers.eq(t):e()},_setupEvents:function(t){var i={keydown:"_keydown"};t&&e.each(t.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(t){var i=this.options,s=this.active,n=e(t.currentTarget),o=n[0]===s[0],a=o&&i.collapsible,r=a?e():n.next(),l=s.next(),c={oldHeader:s,oldPanel:l,newHeader:a?e():n,newPanel:r};t.preventDefault(),o&&!i.collapsible||!1===this._trigger("beforeActivate",t,c)||(i.active=!a&&this.headers.index(n),this.active=o?e():n,this._toggle(c),s.removeClass("ui-accordion-header-active ui-state-active"),i.icons&&s.children(".ui-accordion-header-icon").removeClass(i.icons.activeHeader).addClass(i.icons.header),o||(n.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),i.icons&&n.children(".ui-accordion-header-icon").removeClass(i.icons.header).addClass(i.icons.activeHeader),n.next().addClass("ui-accordion-content-active")))},_toggle:function(t){var i=t.newPanel,s=this.prevShow.length?this.prevShow:t.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=s,this.options.animate?this._animate(i,s,t):(s.hide(),i.show(),this._toggleComplete(t)),s.attr({"aria-hidden":"true"}),s.prev().attr({"aria-selected":"false","aria-expanded":"false"}),i.length&&s.length?s.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter(function(){return 0===parseInt(e(this).attr("tabIndex"),10)}).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_animate:function(e,t,i){var s,n,o,a=this,r=0,l=e.css("box-sizing"),c=e.length&&(!t.length||e.index()<t.index()),h=this.options.animate||{},d=c&&h.down||h,u=function(){a._toggleComplete(i)};return"number"==typeof d&&(o=d),"string"==typeof d&&(n=d),n=n||d.easing||h.easing,o=o||d.duration||h.duration,t.length?e.length?(s=e.show().outerHeight(),t.animate(this.hideProps,{duration:o,easing:n,step:function(e,t){t.now=Math.round(e)}}),void e.hide().animate(this.showProps,{duration:o,easing:n,complete:u,step:function(e,i){i.now=Math.round(e),"height"!==i.prop?"content-box"===l&&(r+=i.now):"content"!==a.options.heightStyle&&(i.now=Math.round(s-t.outerHeight()-r),r=0)}})):t.animate(this.hideProps,o,n,u):e.animate(this.showProps,o,n,u)},_toggleComplete:function(e){var t=e.oldPanel;t.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),t.length&&(t.parent()[0].className=t.parent()[0].className),this._trigger("activate",null,e)}}),e.widget("ui.menu",{version:"1.11.4",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},items:"> *",menus:"ul",position:{my:"left-1 top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item":function(e){e.preventDefault()},"click .ui-menu-item":function(t){var i=e(t.target);!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(t),t.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(t):!this.element.is(":focus")&&e(this.document[0].activeElement).closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){if(!this.previousFilter){var i=e(t.currentTarget);i.siblings(".ui-state-active").removeClass("ui-state-active"),this.focus(t,i)}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var i=this.active||this.element.find(this.options.items).eq(0);t||this.focus(e,i)},blur:function(t){this._delay(function(){e.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(e){this._closeOnDocumentClick(e)&&this.collapseAll(e),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-menu-icons ui-front").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").removeUniqueId().removeClass("ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var t=e(this);t.data("ui-menu-submenu-carat")&&t.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(t){var i,s,n,o,a=!0;switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:a=!1,s=this.previousFilter||"",n=String.fromCharCode(t.keyCode),o=!1,clearTimeout(this.filterTimer),n===s?o=!0:n=s+n,i=this._filterMenuItems(n),(i=o&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i).length||(n=String.fromCharCode(t.keyCode),i=this._filterMenuItems(n)),i.length?(this.focus(t,i),this.previousFilter=n,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}a&&t.preventDefault()},_activate:function(e){this.active.is(".ui-state-disabled")||(this.active.is("[aria-haspopup='true']")?this.expand(e):this.select(e))},refresh:function(){var t,i,s=this,n=this.options.icons.submenu,o=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length),o.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-front").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var t=e(this),i=t.parent(),s=e("<span>").addClass("ui-menu-icon ui-icon "+n).data("ui-menu-submenu-carat",!0);i.attr("aria-haspopup","true").prepend(s),t.attr("aria-labelledby",i.attr("id"))}),t=o.add(this.element),(i=t.find(this.options.items)).not(".ui-menu-item").each(function(){var t=e(this);s._isDivider(t)&&t.addClass("ui-widget-content ui-menu-divider")}),i.not(".ui-menu-item, .ui-menu-divider").addClass("ui-menu-item").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),i.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(e,t){"icons"===e&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(t.submenu),"disabled"===e&&this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this._super(e,t)},focus:function(e,t){var i,s;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),s=this.active.addClass("ui-state-focus").removeClass("ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",s.attr("id")),this.active.parent().closest(".ui-menu-item").addClass("ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),(i=t.children(".ui-menu")).length&&e&&/^mouse/.test(e.type)&&this._startOpening(i),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(t){var i,s,n,o,a,r;this._hasScroll()&&(i=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,s=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,n=t.offset().top-this.activeMenu.offset().top-i-s,o=this.activeMenu.scrollTop(),a=this.activeMenu.height(),r=t.outerHeight(),n<0?this.activeMenu.scrollTop(o+n):n+r>a&&this.activeMenu.scrollTop(o+n-a+r))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this.active.removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active}))},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(e)},this.delay))},_open:function(t){var i=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(t,i){clearTimeout(this.timer),this.timer=this._delay(function(){var s=i?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));s.length||(s=this.element),this._close(s),this.blur(t),this.activeMenu=s},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find(".ui-state-active").not(".ui-state-focus").removeClass("ui-state-active")},_closeOnDocumentClick:function(t){return!e(t.target).closest(".ui-menu").length},_isDivider:function(e){return!/[^\-\u2014\u2013\s]/.test(e.text())},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,i){var s;this.active&&(s="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[e+"All"](".ui-menu-item").eq(0)),s&&s.length&&this.active||(s=this.activeMenu.find(this.options.items)[t]()),this.focus(i,s)},nextPage:function(t){var i,s,n;this.active?this.isLastItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return(i=e(this)).offset().top-s-n<0}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items)[this.active?"last":"first"]())):this.next(t)},previousPage:function(t){var i,s,n;this.active?this.isFirstItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return(i=e(this)).offset().top-s+n>0}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items).first())):this.next(t)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,i)},_filterMenuItems:function(t){var i=t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),s=new RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return s.test(e.trim(e(this).text()))})}}),e.widget("ui.autocomplete",{version:"1.11.4",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var t,i,s,n=this.element[0].nodeName.toLowerCase(),o="textarea"===n,a="input"===n;this.isMultiLine=!!o||!a&&this.element.prop("isContentEditable"),this.valueMethod=this.element[o||a?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return t=!0,s=!0,void(i=!0);t=!1,s=!1,i=!1;var o=e.ui.keyCode;switch(n.keyCode){case o.PAGE_UP:t=!0,this._move("previousPage",n);break;case o.PAGE_DOWN:t=!0,this._move("nextPage",n);break;case o.UP:t=!0,this._keyEvent("previous",n);break;case o.DOWN:t=!0,this._keyEvent("next",n);break;case o.ENTER:this.menu.active&&(t=!0,n.preventDefault(),this.menu.select(n));break;case o.TAB:this.menu.active&&this.menu.select(n);break;case o.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(s){if(t)return t=!1,void(this.isMultiLine&&!this.menu.element.is(":visible")||s.preventDefault());if(!i){var n=e.ui.keyCode;switch(s.keyCode){case n.PAGE_UP:this._move("previousPage",s);break;case n.PAGE_DOWN:this._move("nextPage",s);break;case n.UP:this._keyEvent("previous",s);break;case n.DOWN:this._keyEvent("next",s)}}},input:function(e){if(s)return s=!1,void e.preventDefault();this._searchTimeout(e)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){this.cancelBlur?delete this.cancelBlur:(clearTimeout(this.searching),this.close(e),this._change(e))}}),this._initSource(),this.menu=e("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var i=this.menu.element[0];e(t.target).closest(".ui-menu-item").length||this._delay(function(){var t=this;this.document.one("mousedown",function(s){s.target===t.element[0]||s.target===i||e.contains(i,s.target)||t.close()})})},menufocus:function(t,i){var s,n;if(this.isNewMenu&&(this.isNewMenu=!1,t.originalEvent&&/^mouse/.test(t.originalEvent.type)))return this.menu.blur(),void this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent)});n=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",t,{item:n})&&t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(n.value),(s=i.item.attr("aria-label")||n.value)&&e.trim(s).length&&(this.liveRegion.children().hide(),e("<div>").text(s).appendTo(this.liveRegion))},menuselect:function(e,t){var i=t.item.data("ui-autocomplete-item"),s=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=s,this._delay(function(){this.previous=s,this.selectedItem=i})),!1!==this._trigger("select",e,{item:i})&&this._value(i.value),this.term=this._value(),this.close(e),this.selectedItem=i}}),this.liveRegion=e("<span>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this._appendTo()),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&&t[0]||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t},_initSource:function(){var t,i,s=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(i,s){s(e.ui.autocomplete.filter(t,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(t,n){s.xhr&&s.xhr.abort(),s.xhr=e.ajax({url:i,data:t,dataType:"json",success:function(e){n(e)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){var t=this.term===this._value(),i=this.menu.element.is(":visible"),s=e.altKey||e.ctrlKey||e.metaKey||e.shiftKey;t&&(!t||i||s)||(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):!1!==this._trigger("search",t)?this._search(e):void 0},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var t=++this.requestIndex;return e.proxy(function(e){t===this.requestIndex&&this.__response(e),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")},this)},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return"string"==typeof t?{label:t,value:t}:e.extend({},t,{label:t.label||t.value,value:t.value||t.label})})},_suggest:function(t){var i=this.menu.element.empty();this._renderMenu(i,t),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,i){var s=this;e.each(i,function(e,i){s._renderItemData(t,i)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,i){return e("<li>").text(i.label).appendTo(t)},_move:function(e,t){if(this.menu.element.is(":visible"))return this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this.isMultiLine||this._value(this.term),void this.menu.blur()):void this.menu[e](t);this.search(null,t)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){this.isMultiLine&&!this.menu.element.is(":visible")||(this._move(e,t),t.preventDefault())}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,i){var s=new RegExp(e.ui.autocomplete.escapeRegex(i),"i");return e.grep(t,function(e){return s.test(e.label||e.value||e)})}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(t){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=t&&t.length?this.options.messages.results(t.length):this.options.messages.noResults,this.liveRegion.children().hide(),e("<div>").text(i).appendTo(this.liveRegion))}}),e.ui.autocomplete;var l,c,h="ui-button ui-widget ui-state-default ui-corner-all",d="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",u=function(){var t=e(this);setTimeout(function(){t.find(":ui-button").button("refresh")},1)},p=function(t){var i=t.name,s=t.form,n=e([]);return i&&(i=i.replace(/'/g,"\\'"),n=s?e(s).find("[name='"+i+"'][type=radio]"):e("[name='"+i+"'][type=radio]",t.ownerDocument).filter(function(){return!this.form})),n};function Datepicker(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},e.extend(this._defaults,this.regional[""]),this.regional.en=e.extend(!0,{},this.regional[""]),this.regional["en-US"]=e.extend(!0,{},this.regional.en),this.dpDiv=datepicker_bindHover(e("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function datepicker_bindHover(t){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.delegate(i,"mouseout",function(){e(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).removeClass("ui-datepicker-next-hover")}).delegate(i,"mouseover",datepicker_handleMouseover)}function datepicker_handleMouseover(){e.datepicker._isDisabledDatepicker(c.inline?c.dpDiv.parent()[0]:c.input[0])||(e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),e(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).addClass("ui-datepicker-next-hover"))}function datepicker_extendRemove(t,i){for(var s in e.extend(t,i),i)null==i[s]&&(t[s]=i[s]);return t}e.widget("ui.button",{version:"1.11.4",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,u),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var t=this,i=this.options,s="checkbox"===this.type||"radio"===this.type,n=s?"":"ui-state-active";null===i.label&&(i.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(h).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){i.disabled||this===l&&e(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){i.disabled||e(this).removeClass(n)}).bind("click"+this.eventNamespace,function(e){i.disabled&&(e.preventDefault(),e.stopImmediatePropagation())}),this._on({focus:function(){this.buttonElement.addClass("ui-state-focus")},blur:function(){this.buttonElement.removeClass("ui-state-focus")}}),s&&this.element.bind("change"+this.eventNamespace,function(){t.refresh()}),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(i.disabled)return!1}):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(i.disabled)return!1;e(this).addClass("ui-state-active"),t.buttonElement.attr("aria-pressed","true");var s=t.element[0];p(s).not(s).map(function(){return e(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){if(i.disabled)return!1;e(this).addClass("ui-state-active"),l=this,t.document.one("mouseup",function(){l=null})}).bind("mouseup"+this.eventNamespace,function(){if(i.disabled)return!1;e(this).removeClass("ui-state-active")}).bind("keydown"+this.eventNamespace,function(t){if(i.disabled)return!1;t.keyCode!==e.ui.keyCode.SPACE&&t.keyCode!==e.ui.keyCode.ENTER||e(this).addClass("ui-state-active")}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){e(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(t){t.keyCode===e.ui.keyCode.SPACE&&e(this).click()})),this._setOption("disabled",i.disabled),this._resetButton()},_determineButtonType:function(){var e,t,i;this.element.is("[type=checkbox]")?this.type="checkbox":this.element.is("[type=radio]")?this.type="radio":this.element.is("input")?this.type="input":this.type="button","checkbox"===this.type||"radio"===this.type?(e=this.element.parents().last(),t="label[for='"+this.element.attr("id")+"']",this.buttonElement=e.find(t),this.buttonElement.length||(e=e.length?e.siblings():this.element.siblings(),this.buttonElement=e.filter(t),this.buttonElement.length||(this.buttonElement=e.find(t))),this.element.addClass("ui-helper-hidden-accessible"),(i=this.element.is(":checked"))&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",i)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(h+" ui-state-active "+d).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(e,t){if(this._super(e,t),"disabled"===e)return this.widget().toggleClass("ui-state-disabled",!!t),this.element.prop("disabled",!!t),void(t&&("checkbox"===this.type||"radio"===this.type?this.buttonElement.removeClass("ui-state-focus"):this.buttonElement.removeClass("ui-state-focus ui-state-active")));this._resetButton()},refresh:function(){var t=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOption("disabled",t),"radio"===this.type?p(this.element[0]).each(function(){e(this).is(":checked")?e(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):e(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"!==this.type){var t=this.buttonElement.removeClass(d),i=e("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(t.empty()).text(),s=this.options.icons,n=s.primary&&s.secondary,o=[];s.primary||s.secondary?(this.options.text&&o.push("ui-button-text-icon"+(n?"s":s.primary?"-primary":"-secondary")),s.primary&&t.prepend("<span class='ui-button-icon-primary ui-icon "+s.primary+"'></span>"),s.secondary&&t.append("<span class='ui-button-icon-secondary ui-icon "+s.secondary+"'></span>"),this.options.text||(o.push(n?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||t.attr("title",e.trim(i)))):o.push("ui-button-text-only"),t.addClass(o.join(" "))}else this.options.label&&this.element.val(this.options.label)}}),e.widget("ui.buttonset",{version:"1.11.4",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(e,t){"disabled"===e&&this.buttons.button("option",e,t),this._super(e,t)},refresh:function(){var t="rtl"===this.element.css("direction"),i=this.element.find(this.options.items),s=i.filter(":ui-button");i.not(":ui-button").button(),s.button("refresh"),this.buttons=i.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(t?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(t?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}}),e.ui.button,e.extend(e.ui,{datepicker:{version:"1.11.4"}}),e.extend(Datepicker.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return datepicker_extendRemove(this._defaults,e||{}),this},_attachDatepicker:function(t,i){var s,n,o;s=t.nodeName.toLowerCase(),n="div"===s||"span"===s,t.id||(this.uuid+=1,t.id="dp"+this.uuid),(o=this._newInst(e(t),n)).settings=e.extend({},i||{}),"input"===s?this._connectDatepicker(t,o):n&&this._inlineDatepicker(t,o)},_newInst:function(t,i){var s=t[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:s,input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?datepicker_bindHover(e("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(t,i){var s=e(t);i.append=e([]),i.trigger=e([]),s.hasClass(this.markerClassName)||(this._attachments(s,i),s.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(i),e.data(t,"datepicker",i),i.settings.disabled&&this._disableDatepicker(t))},_attachments:function(t,i){var s,n,o,a=this._get(i,"appendText"),r=this._get(i,"isRTL");i.append&&i.append.remove(),a&&(i.append=e("<span class='"+this._appendClass+"'>"+a+"</span>"),t[r?"before":"after"](i.append)),t.unbind("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),"focus"!==(s=this._get(i,"showOn"))&&"both"!==s||t.focus(this._showDatepicker),"button"!==s&&"both"!==s||(n=this._get(i,"buttonText"),o=this._get(i,"buttonImage"),i.trigger=e(this._get(i,"buttonImageOnly")?e("<img/>").addClass(this._triggerClass).attr({src:o,alt:n,title:n}):e("<button type='button'></button>").addClass(this._triggerClass).html(o?e("<img/>").attr({src:o,alt:n,title:n}):n)),t[r?"before":"after"](i.trigger),i.trigger.click(function(){return e.datepicker._datepickerShowing&&e.datepicker._lastInput===t[0]?e.datepicker._hideDatepicker():e.datepicker._datepickerShowing&&e.datepicker._lastInput!==t[0]?(e.datepicker._hideDatepicker(),e.datepicker._showDatepicker(t[0])):e.datepicker._showDatepicker(t[0]),!1}))},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t,i,s,n,o=new Date(2009,11,20),a=this._get(e,"dateFormat");a.match(/[DM]/)&&(t=function(e){for(i=0,s=0,n=0;n<e.length;n++)e[n].length>i&&(i=e[n].length,s=n);return s},o.setMonth(t(this._get(e,a.match(/MM/)?"monthNames":"monthNamesShort"))),o.setDate(t(this._get(e,a.match(/DD/)?"dayNames":"dayNamesShort"))+20-o.getDay())),e.input.attr("size",this._formatDate(e,o).length)}},_inlineDatepicker:function(t,i){var s=e(t);s.hasClass(this.markerClassName)||(s.addClass(this.markerClassName).append(i.dpDiv),e.data(t,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(t),i.dpDiv.css("display","block"))},_dialogDatepicker:function(t,i,s,n,o){var a,r,l,c,h,d=this._dialogInst;return d||(this.uuid+=1,a="dp"+this.uuid,this._dialogInput=e("<input type='text' id='"+a+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),e("body").append(this._dialogInput),(d=this._dialogInst=this._newInst(this._dialogInput,!1)).settings={},e.data(this._dialogInput[0],"datepicker",d)),datepicker_extendRemove(d.settings,n||{}),i=i&&i.constructor===Date?this._formatDate(d,i):i,this._dialogInput.val(i),this._pos=o?o.length?o:[o.pageX,o.pageY]:null,this._pos||(r=document.documentElement.clientWidth,l=document.documentElement.clientHeight,c=document.documentElement.scrollLeft||document.body.scrollLeft,h=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[r/2-100+c,l/2-150+h]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),d.settings.onSelect=s,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),e.blockUI&&e.blockUI(this.dpDiv),e.data(this._dialogInput[0],"datepicker",d),this},_destroyDatepicker:function(t){var i,s=e(t),n=e.data(t,"datepicker");s.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),e.removeData(t,"datepicker"),"input"===i?(n.append.remove(),n.trigger.remove(),s.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):"div"!==i&&"span"!==i||s.removeClass(this.markerClassName).empty(),c===n&&(c=null))},_enableDatepicker:function(t){var i,s,n=e(t),o=e.data(t,"datepicker");n.hasClass(this.markerClassName)&&("input"===(i=t.nodeName.toLowerCase())?(t.disabled=!1,o.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):"div"!==i&&"span"!==i||((s=n.children("."+this._inlineClass)).children().removeClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}))},_disableDatepicker:function(t){var i,s,n=e(t),o=e.data(t,"datepicker");n.hasClass(this.markerClassName)&&("input"===(i=t.nodeName.toLowerCase())?(t.disabled=!0,o.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):"div"!==i&&"span"!==i||((s=n.children("."+this._inlineClass)).children().addClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}),this._disabledInputs[this._disabledInputs.length]=t)},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;t<this._disabledInputs.length;t++)if(this._disabledInputs[t]===e)return!0;return!1},_getInst:function(t){try{return e.data(t,"datepicker")}catch(e){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(t,i,s){var n,o,a,r,l=this._getInst(t);if(2===arguments.length&&"string"==typeof i)return"defaults"===i?e.extend({},e.datepicker._defaults):l?"all"===i?e.extend({},l.settings):this._get(l,i):null;n=i||{},"string"==typeof i&&((n={})[i]=s),l&&(this._curInst===l&&this._hideDatepicker(),o=this._getDateDatepicker(t,!0),a=this._getMinMaxDate(l,"min"),r=this._getMinMaxDate(l,"max"),datepicker_extendRemove(l.settings,n),null!==a&&void 0!==n.dateFormat&&void 0===n.minDate&&(l.settings.minDate=this._formatDate(l,a)),null!==r&&void 0!==n.dateFormat&&void 0===n.maxDate&&(l.settings.maxDate=this._formatDate(l,r)),"disabled"in n&&(n.disabled?this._disableDatepicker(t):this._enableDatepicker(t)),this._attachments(e(t),l),this._autoSize(l),this._setDate(l,o),this._updateAlternate(l),this._updateDatepicker(l))},_changeDatepicker:function(e,t,i){this._optionDatepicker(e,t,i)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var i=this._getInst(e);i&&(this._setDate(i,t),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(e,t){var i=this._getInst(e);return i&&!i.inline&&this._setDateFromField(i,t),i?this._getDate(i):null},_doKeyDown:function(t){var i,s,n,o=e.datepicker._getInst(t.target),a=!0,r=o.dpDiv.is(".ui-datepicker-rtl");if(o._keyEvent=!0,e.datepicker._datepickerShowing)switch(t.keyCode){case 9:e.datepicker._hideDatepicker(),a=!1;break;case 13:return(n=e("td."+e.datepicker._dayOverClass+":not(."+e.datepicker._currentClass+")",o.dpDiv))[0]&&e.datepicker._selectDay(t.target,o.selectedMonth,o.selectedYear,n[0]),(i=e.datepicker._get(o,"onSelect"))?(s=e.datepicker._formatDate(o),i.apply(o.input?o.input[0]:null,[s,o])):e.datepicker._hideDatepicker(),!1;case 27:e.datepicker._hideDatepicker();break;case 33:e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(o,"stepBigMonths"):-e.datepicker._get(o,"stepMonths"),"M");break;case 34:e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(o,"stepBigMonths"):+e.datepicker._get(o,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&e.datepicker._clearDate(t.target),a=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&e.datepicker._gotoToday(t.target),a=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,r?1:-1,"D"),a=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(o,"stepBigMonths"):-e.datepicker._get(o,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,-7,"D"),a=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,r?-1:1,"D"),a=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(o,"stepBigMonths"):+e.datepicker._get(o,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,7,"D"),a=t.ctrlKey||t.metaKey;break;default:a=!1}else 36===t.keyCode&&t.ctrlKey?e.datepicker._showDatepicker(this):a=!1;a&&(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(t){var i,s,n=e.datepicker._getInst(t.target);if(e.datepicker._get(n,"constrainInput"))return i=e.datepicker._possibleChars(e.datepicker._get(n,"dateFormat")),s=String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),t.ctrlKey||t.metaKey||s<" "||!i||i.indexOf(s)>-1},_doKeyUp:function(t){var i=e.datepicker._getInst(t.target);if(i.input.val()!==i.lastVal)try{e.datepicker.parseDate(e.datepicker._get(i,"dateFormat"),i.input?i.input.val():null,e.datepicker._getFormatConfig(i))&&(e.datepicker._setDateFromField(i),e.datepicker._updateAlternate(i),e.datepicker._updateDatepicker(i))}catch(e){}return!0},_showDatepicker:function(t){var i,s,n,o,a,r,l;"input"!==(t=t.target||t).nodeName.toLowerCase()&&(t=e("input",t.parentNode)[0]),e.datepicker._isDisabledDatepicker(t)||e.datepicker._lastInput===t||(i=e.datepicker._getInst(t),e.datepicker._curInst&&e.datepicker._curInst!==i&&(e.datepicker._curInst.dpDiv.stop(!0,!0),i&&e.datepicker._datepickerShowing&&e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])),s=e.datepicker._get(i,"beforeShow"),!1!==(n=s?s.apply(t,[t,i]):{})&&(datepicker_extendRemove(i.settings,n),i.lastVal=null,e.datepicker._lastInput=t,e.datepicker._setDateFromField(i),e.datepicker._inDialog&&(t.value=""),e.datepicker._pos||(e.datepicker._pos=e.datepicker._findPos(t),e.datepicker._pos[1]+=t.offsetHeight),o=!1,e(t).parents().each(function(){return!(o|="fixed"===e(this).css("position"))}),a={left:e.datepicker._pos[0],top:e.datepicker._pos[1]},e.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),e.datepicker._updateDatepicker(i),a=e.datepicker._checkOffset(i,a,o),i.dpDiv.css({position:e.datepicker._inDialog&&e.blockUI?"static":o?"fixed":"absolute",display:"none",left:a.left+"px",top:a.top+"px"}),i.inline||(r=e.datepicker._get(i,"showAnim"),l=e.datepicker._get(i,"duration"),i.dpDiv.css("z-index",function datepicker_getZindex(e){for(var t,i;e.length&&e[0]!==document;){if(("absolute"===(t=e.css("position"))||"relative"===t||"fixed"===t)&&(i=parseInt(e.css("zIndex"),10),!isNaN(i)&&0!==i))return i;e=e.parent()}return 0}(e(t))+1),e.datepicker._datepickerShowing=!0,e.effects&&e.effects.effect[r]?i.dpDiv.show(r,e.datepicker._get(i,"showOptions"),l):i.dpDiv[r||"show"](r?l:null),e.datepicker._shouldFocusInput(i)&&i.input.focus(),e.datepicker._curInst=i)))},_updateDatepicker:function(t){this.maxRows=4,c=t,t.dpDiv.empty().append(this._generateHTML(t)),this._attachHandlers(t);var i,s=this._getNumberOfMonths(t),n=s[1],o=t.dpDiv.find("."+this._dayOverClass+" a");o.length>0&&datepicker_handleMouseover.apply(o.get(0)),t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&t.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",17*n+"em"),t.dpDiv[(1!==s[0]||1!==s[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),t.dpDiv[(this._get(t,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),t===e.datepicker._curInst&&e.datepicker._datepickerShowing&&e.datepicker._shouldFocusInput(t)&&t.input.focus(),t.yearshtml&&(i=t.yearshtml,setTimeout(function(){i===t.yearshtml&&t.yearshtml&&t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml),i=t.yearshtml=null},0))},_shouldFocusInput:function(e){return e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&!e.input.is(":focus")},_checkOffset:function(t,i,s){var n=t.dpDiv.outerWidth(),o=t.dpDiv.outerHeight(),a=t.input?t.input.outerWidth():0,r=t.input?t.input.outerHeight():0,l=document.documentElement.clientWidth+(s?0:e(document).scrollLeft()),c=document.documentElement.clientHeight+(s?0:e(document).scrollTop());return i.left-=this._get(t,"isRTL")?n-a:0,i.left-=s&&i.left===t.input.offset().left?e(document).scrollLeft():0,i.top-=s&&i.top===t.input.offset().top+r?e(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>l&&l>n?Math.abs(i.left+n-l):0),i.top-=Math.min(i.top,i.top+o>c&&c>o?Math.abs(o+r):0),i},_findPos:function(t){for(var i,s=this._getInst(t),n=this._get(s,"isRTL");t&&("hidden"===t.type||1!==t.nodeType||e.expr.filters.hidden(t));)t=t[n?"previousSibling":"nextSibling"];return[(i=e(t).offset()).left,i.top]},_hideDatepicker:function(t){var i,s,n,o,a=this._curInst;!a||t&&a!==e.data(t,"datepicker")||this._datepickerShowing&&(i=this._get(a,"showAnim"),s=this._get(a,"duration"),n=function(){e.datepicker._tidyDialog(a)},e.effects&&(e.effects.effect[i]||e.effects[i])?a.dpDiv.hide(i,e.datepicker._get(a,"showOptions"),s,n):a.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?s:null,n),i||n(),this._datepickerShowing=!1,(o=this._get(a,"onClose"))&&o.apply(a.input?a.input[0]:null,[a.input?a.input.val():"",a]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),e.blockUI&&(e.unblockUI(),e("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(t){if(e.datepicker._curInst){var i=e(t.target),s=e.datepicker._getInst(i[0]);(i[0].id===e.datepicker._mainDivId||0!==i.parents("#"+e.datepicker._mainDivId).length||i.hasClass(e.datepicker.markerClassName)||i.closest("."+e.datepicker._triggerClass).length||!e.datepicker._datepickerShowing||e.datepicker._inDialog&&e.blockUI)&&(!i.hasClass(e.datepicker.markerClassName)||e.datepicker._curInst===s)||e.datepicker._hideDatepicker()}},_adjustDate:function(t,i,s){var n=e(t),o=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(o,i+("M"===s?this._get(o,"showCurrentAtPos"):0),s),this._updateDatepicker(o))},_gotoToday:function(t){var i,s=e(t),n=this._getInst(s[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(s)},_selectMonthYear:function(t,i,s){var n=e(t),o=this._getInst(n[0]);o["selected"+("M"===s?"Month":"Year")]=o["draw"+("M"===s?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(o),this._adjustDate(n)},_selectDay:function(t,i,s,n){var o,a=e(t);e(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(a[0])||((o=this._getInst(a[0])).selectedDay=o.currentDay=e("a",n).html(),o.selectedMonth=o.currentMonth=i,o.selectedYear=o.currentYear=s,this._selectDate(t,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear)))},_clearDate:function(t){var i=e(t);this._selectDate(i,"")},_selectDate:function(t,i){var s,n=e(t),o=this._getInst(n[0]);i=null!=i?i:this._formatDate(o),o.input&&o.input.val(i),this._updateAlternate(o),(s=this._get(o,"onSelect"))?s.apply(o.input?o.input[0]:null,[i,o]):o.input&&o.input.trigger("change"),o.inline?this._updateDatepicker(o):(this._hideDatepicker(),this._lastInput=o.input[0],"object"!=typeof o.input[0]&&o.input.focus(),this._lastInput=null)},_updateAlternate:function(t){var i,s,n,o=this._get(t,"altField");o&&(i=this._get(t,"altFormat")||this._get(t,"dateFormat"),s=this._getDate(t),n=this.formatDate(i,s,this._getFormatConfig(t)),e(o).each(function(){e(this).val(n)}))},noWeekends:function(e){var t=e.getDay();return[t>0&&t<6,""]},iso8601Week:function(e){var t,i=new Date(e.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),t=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((t-i)/864e5)/7)+1},parseDate:function(t,i,s){if(null==t||null==i)throw"Invalid arguments";if(""===(i="object"==typeof i?i.toString():i+""))return null;var n,o,a,r,l=0,c=(s?s.shortYearCutoff:null)||this._defaults.shortYearCutoff,h="string"!=typeof c?c:(new Date).getFullYear()%100+parseInt(c,10),d=(s?s.dayNamesShort:null)||this._defaults.dayNamesShort,u=(s?s.dayNames:null)||this._defaults.dayNames,p=(s?s.monthNamesShort:null)||this._defaults.monthNamesShort,g=(s?s.monthNames:null)||this._defaults.monthNames,m=-1,f=-1,_=-1,v=-1,y=!1,w=function(e){var i=n+1<t.length&&t.charAt(n+1)===e;return i&&n++,i},b=function(e){var t=w(e),s="@"===e?14:"!"===e?20:"y"===e&&t?4:"o"===e?3:2,n="y"===e?s:1,o=new RegExp("^\\d{"+n+","+s+"}"),a=i.substring(l).match(o);if(!a)throw"Missing number at position "+l;return l+=a[0].length,parseInt(a[0],10)},C=function(t,s,n){var o=-1,a=e.map(w(t)?n:s,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)});if(e.each(a,function(e,t){var s=t[1];if(i.substr(l,s.length).toLowerCase()===s.toLowerCase())return o=t[0],l+=s.length,!1}),-1!==o)return o+1;throw"Unknown name at position "+l},M=function(){if(i.charAt(l)!==t.charAt(n))throw"Unexpected literal at position "+l;l++};for(n=0;n<t.length;n++)if(y)"'"!==t.charAt(n)||w("'")?M():y=!1;else switch(t.charAt(n)){case"d":_=b("d");break;case"D":C("D",d,u);break;case"o":v=b("o");break;case"m":f=b("m");break;case"M":f=C("M",p,g);break;case"y":m=b("y");break;case"@":r=new Date(b("@")),m=r.getFullYear(),f=r.getMonth()+1,_=r.getDate();break;case"!":r=new Date((b("!")-this._ticksTo1970)/1e4),m=r.getFullYear(),f=r.getMonth()+1,_=r.getDate();break;case"'":w("'")?M():y=!0;break;default:M()}if(l<i.length&&(a=i.substr(l),!/^\s+/.test(a)))throw"Extra/unparsed characters found in date: "+a;if(-1===m?m=(new Date).getFullYear():m<100&&(m+=(new Date).getFullYear()-(new Date).getFullYear()%100+(m<=h?0:-100)),v>-1)for(f=1,_=v;o=this._getDaysInMonth(m,f-1),!(_<=o);)f++,_-=o;if((r=this._daylightSavingAdjust(new Date(m,f-1,_))).getFullYear()!==m||r.getMonth()+1!==f||r.getDate()!==_)throw"Invalid date";return r},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*60*60*1e7,formatDate:function(e,t,i){if(!t)return"";var s,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,o=(i?i.dayNames:null)||this._defaults.dayNames,a=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,r=(i?i.monthNames:null)||this._defaults.monthNames,l=function(t){var i=s+1<e.length&&e.charAt(s+1)===t;return i&&s++,i},c=function(e,t,i){var s=""+t;if(l(e))for(;s.length<i;)s="0"+s;return s},h=function(e,t,i,s){return l(e)?s[t]:i[t]},d="",u=!1;if(t)for(s=0;s<e.length;s++)if(u)"'"!==e.charAt(s)||l("'")?d+=e.charAt(s):u=!1;else switch(e.charAt(s)){case"d":d+=c("d",t.getDate(),2);break;case"D":d+=h("D",t.getDay(),n,o);break;case"o":d+=c("o",Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case"m":d+=c("m",t.getMonth()+1,2);break;case"M":d+=h("M",t.getMonth(),a,r);break;case"y":d+=l("y")?t.getFullYear():(t.getYear()%100<10?"0":"")+t.getYear()%100;break;case"@":d+=t.getTime();break;case"!":d+=1e4*t.getTime()+this._ticksTo1970;break;case"'":l("'")?d+="'":u=!0;break;default:d+=e.charAt(s)}return d},_possibleChars:function(e){var t,i="",s=!1,n=function(i){var s=t+1<e.length&&e.charAt(t+1)===i;return s&&t++,s};for(t=0;t<e.length;t++)if(s)"'"!==e.charAt(t)||n("'")?i+=e.charAt(t):s=!1;else switch(e.charAt(t)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":s=!0;break;default:i+=e.charAt(t)}return i},_get:function(e,t){return void 0!==e.settings[t]?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()!==e.lastVal){var i=this._get(e,"dateFormat"),s=e.lastVal=e.input?e.input.val():null,n=this._getDefaultDate(e),o=n,a=this._getFormatConfig(e);try{o=this.parseDate(i,s,a)||n}catch(e){s=t?"":s}e.selectedDay=o.getDate(),e.drawMonth=e.selectedMonth=o.getMonth(),e.drawYear=e.selectedYear=o.getFullYear(),e.currentDay=s?o.getDate():0,e.currentMonth=s?o.getMonth():0,e.currentYear=s?o.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(t,i,s){var n=null==i||""===i?s:"string"==typeof i?function(i){try{return e.datepicker.parseDate(e.datepicker._get(t,"dateFormat"),i,e.datepicker._getFormatConfig(t))}catch(e){}for(var s=(i.toLowerCase().match(/^c/)?e.datepicker._getDate(t):null)||new Date,n=s.getFullYear(),o=s.getMonth(),a=s.getDate(),r=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=r.exec(i);l;){switch(l[2]||"d"){case"d":case"D":a+=parseInt(l[1],10);break;case"w":case"W":a+=7*parseInt(l[1],10);break;case"m":case"M":o+=parseInt(l[1],10),a=Math.min(a,e.datepicker._getDaysInMonth(n,o));break;case"y":case"Y":n+=parseInt(l[1],10),a=Math.min(a,e.datepicker._getDaysInMonth(n,o))}l=r.exec(i)}return new Date(n,o,a)}(i):"number"==typeof i?isNaN(i)?s:function(e){var t=new Date;return t.setDate(t.getDate()+e),t}(i):new Date(i.getTime());return(n=n&&"Invalid Date"===n.toString()?s:n)&&(n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0)),this._daylightSavingAdjust(n)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,i){var s=!t,n=e.selectedMonth,o=e.selectedYear,a=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=a.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=a.getMonth(),e.drawYear=e.selectedYear=e.currentYear=a.getFullYear(),n===e.selectedMonth&&o===e.selectedYear||i||this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(s?"":this._formatDate(e))},_getDate:function(e){var t=!e.currentYear||e.input&&""===e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return t},_attachHandlers:function(t){var i=this._get(t,"stepMonths"),s="#"+t.id.replace(/\\\\/g,"\\");t.dpDiv.find("[data-handler]").map(function(){var t={prev:function(){e.datepicker._adjustDate(s,-i,"M")},next:function(){e.datepicker._adjustDate(s,+i,"M")},hide:function(){e.datepicker._hideDatepicker()},today:function(){e.datepicker._gotoToday(s)},selectDay:function(){return e.datepicker._selectDay(s,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return e.datepicker._selectMonthYear(s,this,"M"),!1},selectYear:function(){return e.datepicker._selectMonthYear(s,this,"Y"),!1}};e(this).bind(this.getAttribute("data-event"),t[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t,i,s,n,o,a,r,l,c,h,d,u,p,g,m,f,_,v,y,w,b,C,M,k,S,x,T,D,E,V,A,I,B,z,F,P,N,O,L,R=new Date,q=this._daylightSavingAdjust(new Date(R.getFullYear(),R.getMonth(),R.getDate())),$=this._get(e,"isRTL"),j=this._get(e,"showButtonPanel"),U=this._get(e,"hideIfNoPrevNext"),H=this._get(e,"navigationAsDateFormat"),W=this._getNumberOfMonths(e),Q=this._get(e,"showCurrentAtPos"),G=this._get(e,"stepMonths"),Y=1!==W[0]||1!==W[1],K=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),J=this._getMinMaxDate(e,"min"),X=this._getMinMaxDate(e,"max"),Z=e.drawMonth-Q,ee=e.drawYear;if(Z<0&&(Z+=12,ee--),X)for(t=this._daylightSavingAdjust(new Date(X.getFullYear(),X.getMonth()-W[0]*W[1]+1,X.getDate())),t=J&&t<J?J:t;this._daylightSavingAdjust(new Date(ee,Z,1))>t;)--Z<0&&(Z=11,ee--);for(e.drawMonth=Z,e.drawYear=ee,i=this._get(e,"prevText"),i=H?this.formatDate(i,this._daylightSavingAdjust(new Date(ee,Z-G,1)),this._getFormatConfig(e)):i,s=this._canAdjustMonth(e,-1,ee,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+($?"e":"w")+"'>"+i+"</span></a>":U?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+($?"e":"w")+"'>"+i+"</span></a>",n=this._get(e,"nextText"),n=H?this.formatDate(n,this._daylightSavingAdjust(new Date(ee,Z+G,1)),this._getFormatConfig(e)):n,o=this._canAdjustMonth(e,1,ee,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+($?"w":"e")+"'>"+n+"</span></a>":U?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+($?"w":"e")+"'>"+n+"</span></a>",a=this._get(e,"currentText"),r=this._get(e,"gotoCurrent")&&e.currentDay?K:q,a=H?this.formatDate(a,r,this._getFormatConfig(e)):a,l=e.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(e,"closeText")+"</button>",c=j?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+($?l:"")+(this._isInRange(e,r)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+a+"</button>":"")+($?"":l)+"</div>":"",h=parseInt(this._get(e,"firstDay"),10),h=isNaN(h)?0:h,d=this._get(e,"showWeek"),u=this._get(e,"dayNames"),p=this._get(e,"dayNamesMin"),g=this._get(e,"monthNames"),m=this._get(e,"monthNamesShort"),f=this._get(e,"beforeShowDay"),_=this._get(e,"showOtherMonths"),v=this._get(e,"selectOtherMonths"),y=this._getDefaultDate(e),w="",C=0;C<W[0];C++){for(M="",this.maxRows=4,k=0;k<W[1];k++){if(S=this._daylightSavingAdjust(new Date(ee,Z,e.selectedDay)),x=" ui-corner-all",T="",Y){if(T+="<div class='ui-datepicker-group",W[1]>1)switch(k){case 0:T+=" ui-datepicker-group-first",x=" ui-corner-"+($?"right":"left");break;case W[1]-1:T+=" ui-datepicker-group-last",x=" ui-corner-"+($?"left":"right");break;default:T+=" ui-datepicker-group-middle",x=""}T+="'>"}for(T+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+x+"'>"+(/all|left/.test(x)&&0===C?$?o:s:"")+(/all|right/.test(x)&&0===C?$?s:o:"")+this._generateMonthYearHeader(e,Z,ee,J,X,C>0||k>0,g,m)+"</div><table class='ui-datepicker-calendar'><thead><tr>",D=d?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"",b=0;b<7;b++)E=(b+h)%7,D+="<th scope='col'"+((b+h+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+u[E]+"'>"+p[E]+"</span></th>";for(T+=D+"</tr></thead><tbody>",V=this._getDaysInMonth(ee,Z),ee===e.selectedYear&&Z===e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,V)),A=(this._getFirstDayOfMonth(ee,Z)-h+7)%7,I=Math.ceil((A+V)/7),B=Y&&this.maxRows>I?this.maxRows:I,this.maxRows=B,z=this._daylightSavingAdjust(new Date(ee,Z,1-A)),F=0;F<B;F++){for(T+="<tr>",P=d?"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(z)+"</td>":"",b=0;b<7;b++)N=f?f.apply(e.input?e.input[0]:null,[z]):[!0,""],O=z.getMonth()!==Z,L=O&&!v||!N[0]||J&&z<J||X&&z>X,P+="<td class='"+((b+h+6)%7>=5?" ui-datepicker-week-end":"")+(O?" ui-datepicker-other-month":"")+(z.getTime()===S.getTime()&&Z===e.selectedMonth&&e._keyEvent||y.getTime()===z.getTime()&&y.getTime()===S.getTime()?" "+this._dayOverClass:"")+(L?" "+this._unselectableClass+" ui-state-disabled":"")+(O&&!_?"":" "+N[1]+(z.getTime()===K.getTime()?" "+this._currentClass:"")+(z.getTime()===q.getTime()?" ui-datepicker-today":""))+"'"+(O&&!_||!N[2]?"":" title='"+N[2].replace(/'/g,"&#39;")+"'")+(L?"":" data-handler='selectDay' data-event='click' data-month='"+z.getMonth()+"' data-year='"+z.getFullYear()+"'")+">"+(O&&!_?"&#xa0;":L?"<span class='ui-state-default'>"+z.getDate()+"</span>":"<a class='ui-state-default"+(z.getTime()===q.getTime()?" ui-state-highlight":"")+(z.getTime()===K.getTime()?" ui-state-active":"")+(O?" ui-priority-secondary":"")+"' href='#'>"+z.getDate()+"</a>")+"</td>",z.setDate(z.getDate()+1),z=this._daylightSavingAdjust(z);T+=P+"</tr>"}++Z>11&&(Z=0,ee++),T+="</tbody></table>"+(Y?"</div>"+(W[0]>0&&k===W[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),M+=T}w+=M}return w+=c,e._keyEvent=!1,w},_generateMonthYearHeader:function(e,t,i,s,n,o,a,r){var l,c,h,d,u,p,g,m,f=this._get(e,"changeMonth"),_=this._get(e,"changeYear"),v=this._get(e,"showMonthAfterYear"),y="<div class='ui-datepicker-title'>",w="";if(o||!f)w+="<span class='ui-datepicker-month'>"+a[t]+"</span>";else{for(l=s&&s.getFullYear()===i,c=n&&n.getFullYear()===i,w+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",h=0;h<12;h++)(!l||h>=s.getMonth())&&(!c||h<=n.getMonth())&&(w+="<option value='"+h+"'"+(h===t?" selected='selected'":"")+">"+r[h]+"</option>");w+="</select>"}if(v||(y+=w+(!o&&f&&_?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",o||!_)y+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(d=this._get(e,"yearRange").split(":"),u=(new Date).getFullYear(),g=(p=function(e){var t=e.match(/c[+\-].*/)?i+parseInt(e.substring(1),10):e.match(/[+\-].*/)?u+parseInt(e,10):parseInt(e,10);return isNaN(t)?u:t})(d[0]),m=Math.max(g,p(d[1]||"")),g=s?Math.max(g,s.getFullYear()):g,m=n?Math.min(m,n.getFullYear()):m,e.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";g<=m;g++)e.yearshtml+="<option value='"+g+"'"+(g===i?" selected='selected'":"")+">"+g+"</option>";e.yearshtml+="</select>",y+=e.yearshtml,e.yearshtml=null}return y+=this._get(e,"yearSuffix"),v&&(y+=(!o&&f&&_?"":"&#xa0;")+w),y+="</div>"},_adjustInstDate:function(e,t,i){var s=e.drawYear+("Y"===i?t:0),n=e.drawMonth+("M"===i?t:0),o=Math.min(e.selectedDay,this._getDaysInMonth(s,n))+("D"===i?t:0),a=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(s,n,o)));e.selectedDay=a.getDate(),e.drawMonth=e.selectedMonth=a.getMonth(),e.drawYear=e.selectedYear=a.getFullYear(),"M"!==i&&"Y"!==i||this._notifyChange(e)},_restrictMinMax:function(e,t){var i=this._getMinMaxDate(e,"min"),s=this._getMinMaxDate(e,"max"),n=i&&t<i?i:t;return s&&n>s?s:n},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,i,s){var n=this._getNumberOfMonths(e),o=this._daylightSavingAdjust(new Date(i,s+(t<0?t:n[0]*n[1]),1));return t<0&&o.setDate(this._getDaysInMonth(o.getFullYear(),o.getMonth())),this._isInRange(e,o)},_isInRange:function(e,t){var i,s,n=this._getMinMaxDate(e,"min"),o=this._getMinMaxDate(e,"max"),a=null,r=null,l=this._get(e,"yearRange");return l&&(i=l.split(":"),s=(new Date).getFullYear(),a=parseInt(i[0],10),r=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(a+=s),i[1].match(/[+\-].*/)&&(r+=s)),(!n||t.getTime()>=n.getTime())&&(!o||t.getTime()<=o.getTime())&&(!a||t.getFullYear()>=a)&&(!r||t.getFullYear()<=r)},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return{shortYearCutoff:t="string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,i,s){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var n=t?"object"==typeof t?t:this._daylightSavingAdjust(new Date(s,i,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),n,this._getFormatConfig(e))}}),e.fn.datepicker=function(t){if(!this.length)return this;e.datepicker.initialized||(e(document).mousedown(e.datepicker._checkExternalClick),e.datepicker.initialized=!0),0===e("#"+e.datepicker._mainDivId).length&&e("body").append(e.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof t||"isDisabled"!==t&&"getDate"!==t&&"widget"!==t?"option"===t&&2===arguments.length&&"string"==typeof arguments[1]?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof t?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this].concat(i)):e.datepicker._attachDatepicker(this,t)}):e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i))},e.datepicker=new Datepicker,e.datepicker.initialized=!1,e.datepicker.uuid=(new Date).getTime(),e.datepicker.version="1.11.4",e.datepicker,e.widget("ui.draggable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit()},_setOption:function(e,t){this._super(e,t),"handle"===e&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){(this.helper||this.element).is(".ui-draggable-dragging")?this.destroyOnClear=!0:(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),this._mouseDestroy())},_mouseCapture:function(t){var i=this.options;return this._blurActiveElement(t),!(this.helper||i.disabled||e(t.target).closest(".ui-resizable-handle").length>0||(this.handle=this._getHandle(t),!this.handle||(this._blockFrames(!0===i.iframeFix?"iframe":i.iframeFix),0)))},_blockFrames:function(t){this.iframeBlocks=this.document.find(t).map(function(){var t=e(this);return e("<div>").css("position","absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(t){var i=this.document[0];if(this.handleElement.is(t.target))try{i.activeElement&&"body"!==i.activeElement.nodeName.toLowerCase()&&e(i.activeElement).blur()}catch(e){}},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===e(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(t),this.originalPosition=this.position=this._generatePosition(t,!1),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),!1===this._trigger("start",t)?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._normalizeRightBottom(),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top}},_mouseDrag:function(t,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(!1===this._trigger("drag",t,s))return this._mouseUp({}),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=this,s=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(s=e.ui.ddmanager.drop(this,t)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||!0===this.options.revert||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){!1!==i._trigger("stop",t)&&i._clear()}):!1!==this._trigger("stop",t)&&this._clear(),!1},_mouseUp:function(t){return this._unblockFrames(),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),this.handleElement.is(t.target)&&this.element.focus(),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return!this.options.handle||!!e(t.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper),n=s?e(i.helper.apply(this.element[0],[t])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var t=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(t?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options,o=this.document[0];this.relativeContainer=null,n.containment?"window"!==n.containment?"document"!==n.containment?n.containment.constructor!==Array?("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=e(n.containment),(s=i[0])&&(t=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(t?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i)):this.containment=n.containment:this.containment=[0,0,e(o).width()-this.helperProportions.width-this.margins.left,(e(o).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]:this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]:this.containment=null},_convertPositionTo:function(e,t){t||(t=this.position);var i="absolute"===e?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(e,t){var i,s,n,o,a=this.options,r=this._isRootNode(this.scrollParent[0]),l=e.pageX,c=e.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,e.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),e.pageY-this.offset.click.top<i[1]&&(c=i[1]+this.offset.click.top),e.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),e.pageY-this.offset.click.top>i[3]&&(c=i[3]+this.offset.click.top)),a.grid&&(n=a.grid[1]?this.originalPageY+Math.round((c-this.originalPageY)/a.grid[1])*a.grid[1]:this.originalPageY,c=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-a.grid[1]:n+a.grid[1]:n,o=a.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/a.grid[0])*a.grid[0]:this.originalPageX,l=i?o-this.offset.click.left>=i[0]||o-this.offset.click.left>i[2]?o:o-this.offset.click.left>=i[0]?o-a.grid[0]:o+a.grid[0]:o),"y"===a.axis&&(l=this.originalPageX),"x"===a.axis&&(c=this.originalPageY)),{top:c-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_normalizeRightBottom:function(){"y"!==this.options.axis&&"auto"!==this.helper.css("right")&&(this.helper.width(this.helper.width()),this.helper.css("right","auto")),"x"!==this.options.axis&&"auto"!==this.helper.css("bottom")&&(this.helper.height(this.helper.height()),this.helper.css("bottom","auto"))},_trigger:function(t,i,s){return s=s||this._uiHash(),e.ui.plugin.call(this,t,[i,s,this],!0),/^(drag|start|stop)/.test(t)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,t,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i,s){var n=e.extend({},i,{item:s.element});s.sortables=[],e(s.options.connectToSortable).each(function(){var i=e(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",t,n))})},stop:function(t,i,s){var n=e.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,e.each(s.sortables,function(){this.isOver?(this.isOver=0,s.cancelHelperRemoval=!0,this.cancelHelperRemoval=!1,this._storedCSS={position:this.placeholder.css("position"),top:this.placeholder.css("top"),left:this.placeholder.css("left")},this._mouseStop(t),this.options.helper=this.options._helper):(this.cancelHelperRemoval=!0,this._trigger("deactivate",t,n))})},drag:function(t,i,s){e.each(s.sortables,function(){var n=!1,o=this;o.positionAbs=s.positionAbs,o.helperProportions=s.helperProportions,o.offset.click=s.offset.click,o._intersectsWith(o.containerCache)&&(n=!0,e.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==o&&this._intersectsWith(this.containerCache)&&e.contains(o.element[0],this.element[0])&&(n=!1),n})),n?(o.isOver||(o.isOver=1,s._parent=i.helper.parent(),o.currentItem=i.helper.appendTo(o.element).data("ui-sortable-item",!0),o.options._helper=o.options.helper,o.options.helper=function(){return i.helper[0]},t.target=o.currentItem[0],o._mouseCapture(t,!0),o._mouseStart(t,!0,!0),o.offset.click.top=s.offset.click.top,o.offset.click.left=s.offset.click.left,o.offset.parent.left-=s.offset.parent.left-o.offset.parent.left,o.offset.parent.top-=s.offset.parent.top-o.offset.parent.top,s._trigger("toSortable",t),s.dropped=o.element,e.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,o.fromOutside=s),o.currentItem&&(o._mouseDrag(t),i.position=o.position)):o.isOver&&(o.isOver=0,o.cancelHelperRemoval=!0,o.options._revert=o.options.revert,o.options.revert=!1,o._trigger("out",t,o._uiHash(o)),o._mouseStop(t,!0),o.options.revert=o.options._revert,o.options.helper=o.options._helper,o.placeholder&&o.placeholder.remove(),i.helper.appendTo(s._parent),s._refreshOffsets(t),i.position=s._generatePosition(t,!0),s._trigger("fromSortable",t),s.dropped=!1,e.each(s.sortables,function(){this.refreshPositions()}))})}}),e.ui.plugin.add("draggable","cursor",{start:function(t,i,s){var n=e("body"),o=s.options;n.css("cursor")&&(o._cursor=n.css("cursor")),n.css("cursor",o.cursor)},stop:function(t,i,s){var n=s.options;n._cursor&&e("body").css("cursor",n._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i,s){var n=e(i.helper),o=s.options;n.css("opacity")&&(o._opacity=n.css("opacity")),n.css("opacity",o.opacity)},stop:function(t,i,s){var n=s.options;n._opacity&&e(i.helper).css("opacity",n._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(e,t,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(t,i,s){var n=s.options,o=!1,a=s.scrollParentNotHidden[0],r=s.document[0];a!==r&&"HTML"!==a.tagName?(n.axis&&"x"===n.axis||(s.overflowOffset.top+a.offsetHeight-t.pageY<n.scrollSensitivity?a.scrollTop=o=a.scrollTop+n.scrollSpeed:t.pageY-s.overflowOffset.top<n.scrollSensitivity&&(a.scrollTop=o=a.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(s.overflowOffset.left+a.offsetWidth-t.pageX<n.scrollSensitivity?a.scrollLeft=o=a.scrollLeft+n.scrollSpeed:t.pageX-s.overflowOffset.left<n.scrollSensitivity&&(a.scrollLeft=o=a.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(t.pageY-e(r).scrollTop()<n.scrollSensitivity?o=e(r).scrollTop(e(r).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(r).scrollTop())<n.scrollSensitivity&&(o=e(r).scrollTop(e(r).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(t.pageX-e(r).scrollLeft()<n.scrollSensitivity?o=e(r).scrollLeft(e(r).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(r).scrollLeft())<n.scrollSensitivity&&(o=e(r).scrollLeft(e(r).scrollLeft()+n.scrollSpeed)))),!1!==o&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(s,t)}}),e.ui.plugin.add("draggable","snap",{start:function(t,i,s){var n=s.options;s.snapElements=[],e(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var t=e(this),i=t.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:i.top,left:i.left})})},drag:function(t,i,s){var n,o,a,r,l,c,h,d,u,p,g=s.options,m=g.snapTolerance,f=i.offset.left,_=f+s.helperProportions.width,v=i.offset.top,y=v+s.helperProportions.height;for(u=s.snapElements.length-1;u>=0;u--)l=s.snapElements[u].left-s.margins.left,c=l+s.snapElements[u].width,h=s.snapElements[u].top-s.margins.top,d=h+s.snapElements[u].height,_<l-m||f>c+m||y<h-m||v>d+m||!e.contains(s.snapElements[u].item.ownerDocument,s.snapElements[u].item)?(s.snapElements[u].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[u].item})),s.snapElements[u].snapping=!1):("inner"!==g.snapMode&&(n=Math.abs(h-y)<=m,o=Math.abs(d-v)<=m,a=Math.abs(l-_)<=m,r=Math.abs(c-f)<=m,n&&(i.position.top=s._convertPositionTo("relative",{top:h-s.helperProportions.height,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:d,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:c}).left)),p=n||o||a||r,"outer"!==g.snapMode&&(n=Math.abs(h-v)<=m,o=Math.abs(d-y)<=m,a=Math.abs(l-f)<=m,r=Math.abs(c-_)<=m,n&&(i.position.top=s._convertPositionTo("relative",{top:h,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:d-s.helperProportions.height,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:c-s.helperProportions.width}).left)),!s.snapElements[u].snapping&&(n||o||a||r||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[u].item})),s.snapElements[u].snapping=n||o||a||r||p)}}),e.ui.plugin.add("draggable","stack",{start:function(t,i,s){var n,o=s.options,a=e.makeArray(e(o.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});a.length&&(n=parseInt(e(a[0]).css("zIndex"),10)||0,e(a).each(function(t){e(this).css("zIndex",n+t)}),this.css("zIndex",n+a.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i,s){var n=e(i.helper),o=s.options;n.css("zIndex")&&(o._zIndex=n.css("zIndex")),n.css("zIndex",o.zIndex)},stop:function(t,i,s){var n=s.options;n._zIndex&&e(i.helper).css("zIndex",n._zIndex)}}),e.ui.draggable,e.widget("ui.resizable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(e){return parseInt(e,10)||0},_isNumber:function(e){return!isNaN(parseInt(e,10))},_hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return t[s]>0||(t[s]=1,n=t[s]>0,t[s]=0,n)},_create:function(){var t,i,s,n,o=this,a=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!a.aspectRatio,aspectRatio:a.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:a.helper||a.ghost||a.animate?a.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=a.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=e(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={},i=0;i<t.length;i++)s=e.trim(t[i]),(n=e("<div class='ui-resizable-handle ui-resizable-"+s+"'></div>")).css({zIndex:a.zIndex}),"se"===s&&n.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[s]=".ui-resizable-"+s,this.element.append(n);this._renderAxis=function(t){var i,s,n,a;for(i in t=t||this.element,this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=e(this.handles[i]),this._on(this.handles[i],{mousedown:o._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(s=e(this.handles[i],this.element),a=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),t.css(n,a),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.mouseover(function(){o.resizing||(this.className&&(n=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),o.axis=n&&n[1]?n[1]:"se")}),a.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){a.disabled||(e(this).removeClass("ui-resizable-autohide"),o._handles.show())}).mouseleave(function(){a.disabled||o.resizing||(e(this).addClass("ui-resizable-autohide"),o._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,i=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(t){var i,s,n=!1;for(i in this.handles)((s=e(this.handles[i])[0])===t.target||e.contains(s,t.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(t){var i,s,n,o=this.options,a=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),o.containment&&(i+=e(o.containment).scrollLeft()||0,s+=e(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===n?this.axis+"-resize":n),a.addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var i,s,n=this.originalMousePosition,o=this.axis,a=t.pageX-n.left||0,r=t.pageY-n.top||0,l=this._change[o];return this._updatePrevProperties(),!!l&&(i=l.apply(this,[t,a,r]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(i=this._updateRatio(i,t)),i=this._respectSize(i,t),this._updateCache(i),this._propagate("resize",t),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",t,this.ui()),this._applyChanges()),!1)},_mouseStop:function(t){this.resizing=!1;var i,s,n,o,a,r,l,c=this.options;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),n=s&&this._hasScroll(i[0],"left")?0:this.sizeDiff.height,o=s?0:this.sizeDiff.width,a={width:this.helper.width()-o,height:this.helper.height()-n},r=parseInt(this.element.css("left"),10)+(this.position.left-this.originalPosition.left)||null,l=parseInt(this.element.css("top"),10)+(this.position.top-this.originalPosition.top)||null,c.animate||this.element.css(e.extend(a,{top:l,left:r})),this.helper.height(this.size.height),this.helper.width(this.size.width),this._helper&&!c.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var e={};return this.position.top!==this.prevPosition.top&&(e.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(e.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(e.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(e.height=this.size.height+"px"),this.helper.css(e),e},_updateVirtualBoundaries:function(e){var t,i,s,n,o,a=this.options;o={minWidth:this._isNumber(a.minWidth)?a.minWidth:0,maxWidth:this._isNumber(a.maxWidth)?a.maxWidth:1/0,minHeight:this._isNumber(a.minHeight)?a.minHeight:0,maxHeight:this._isNumber(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||e)&&(t=o.minHeight*this.aspectRatio,s=o.minWidth/this.aspectRatio,i=o.maxHeight*this.aspectRatio,n=o.maxWidth/this.aspectRatio,t>o.minWidth&&(o.minWidth=t),s>o.minHeight&&(o.minHeight=s),i<o.maxWidth&&(o.maxWidth=i),n<o.maxHeight&&(o.maxHeight=n)),this._vBoundaries=o},_updateCache:function(e){this.offset=this.helper.offset(),this._isNumber(e.left)&&(this.position.left=e.left),this._isNumber(e.top)&&(this.position.top=e.top),this._isNumber(e.height)&&(this.size.height=e.height),this._isNumber(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,i=this.size,s=this.axis;return this._isNumber(e.height)?e.width=e.height*this.aspectRatio:this._isNumber(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===s&&(e.left=t.left+(i.width-e.width),e.top=null),"nw"===s&&(e.top=t.top+(i.height-e.height),e.left=t.left+(i.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,i=this.axis,s=this._isNumber(e.width)&&t.maxWidth&&t.maxWidth<e.width,n=this._isNumber(e.height)&&t.maxHeight&&t.maxHeight<e.height,o=this._isNumber(e.width)&&t.minWidth&&t.minWidth>e.width,a=this._isNumber(e.height)&&t.minHeight&&t.minHeight>e.height,r=this.originalPosition.left+this.originalSize.width,l=this.position.top+this.size.height,c=/sw|nw|w/.test(i),h=/nw|ne|n/.test(i);return o&&(e.width=t.minWidth),a&&(e.height=t.minHeight),s&&(e.width=t.maxWidth),n&&(e.height=t.maxHeight),o&&c&&(e.left=r-t.minWidth),s&&c&&(e.left=r-t.maxWidth),a&&h&&(e.top=l-t.minHeight),n&&h&&(e.top=l-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_getPaddingPlusBorderDimensions:function(e){for(var t=0,i=[],s=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],n=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")];t<4;t++)i[t]=parseInt(s[t],10)||0,i[t]+=parseInt(n[t],10)||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e,t=0,i=this.helper||this.element;t<this._proportionallyResizeElements.length;t++)e=this._proportionallyResizeElements[t],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(e)),e.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var t=this.element,i=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=this.originalSize,s=this.originalPosition;return{left:s.left+t,width:i.width-t}},n:function(e,t,i){var s=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:s.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},sw:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,s]))},ne:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},nw:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,s]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!==t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).resizable("instance"),s=i.options,n=i._proportionallyResizeElements,o=n.length&&/textarea/i.test(n[0].nodeName),a=o&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,r=o?0:i.sizeDiff.width,l={width:i.size.width-r,height:i.size.height-a},c=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,h=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(l,h&&c?{top:h,left:c}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};n&&n.length&&e(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,i,s,n,o,a,r,l=e(this).resizable("instance"),c=l.options,h=l.element,d=c.containment,u=d instanceof e?d.get(0):/parent/.test(d)?h.parent().get(0):d;u&&(l.containerElement=e(u),/document/.test(d)||d===document?(l.containerOffset={left:0,top:0},l.containerPosition={left:0,top:0},l.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(u),i=[],e(["Top","Right","Left","Bottom"]).each(function(e,s){i[e]=l._num(t.css("padding"+s))}),l.containerOffset=t.offset(),l.containerPosition=t.position(),l.containerSize={height:t.innerHeight()-i[3],width:t.innerWidth()-i[1]},s=l.containerOffset,n=l.containerSize.height,o=l.containerSize.width,a=l._hasScroll(u,"left")?u.scrollWidth:o,r=l._hasScroll(u)?u.scrollHeight:n,l.parentData={element:u,left:s.left,top:s.top,width:a,height:r}))},resize:function(t){var i,s,n,o,a=e(this).resizable("instance"),r=a.options,l=a.containerOffset,c=a.position,h=a._aspectRatio||t.shiftKey,d={top:0,left:0},u=a.containerElement,p=!0;u[0]!==document&&/static/.test(u.css("position"))&&(d=l),c.left<(a._helper?l.left:0)&&(a.size.width=a.size.width+(a._helper?a.position.left-l.left:a.position.left-d.left),h&&(a.size.height=a.size.width/a.aspectRatio,p=!1),a.position.left=r.helper?l.left:0),c.top<(a._helper?l.top:0)&&(a.size.height=a.size.height+(a._helper?a.position.top-l.top:a.position.top),h&&(a.size.width=a.size.height*a.aspectRatio,p=!1),a.position.top=a._helper?l.top:0),n=a.containerElement.get(0)===a.element.parent().get(0),o=/relative|absolute/.test(a.containerElement.css("position")),n&&o?(a.offset.left=a.parentData.left+a.position.left,a.offset.top=a.parentData.top+a.position.top):(a.offset.left=a.element.offset().left,a.offset.top=a.element.offset().top),i=Math.abs(a.sizeDiff.width+(a._helper?a.offset.left-d.left:a.offset.left-l.left)),s=Math.abs(a.sizeDiff.height+(a._helper?a.offset.top-d.top:a.offset.top-l.top)),i+a.size.width>=a.parentData.width&&(a.size.width=a.parentData.width-i,h&&(a.size.height=a.size.width/a.aspectRatio,p=!1)),s+a.size.height>=a.parentData.height&&(a.size.height=a.parentData.height-s,h&&(a.size.width=a.size.height*a.aspectRatio,p=!1)),p||(a.position.left=a.prevPosition.left,a.position.top=a.prevPosition.top,a.size.width=a.prevSize.width,a.size.height=a.prevSize.height)},stop:function(){var t=e(this).resizable("instance"),i=t.options,s=t.containerOffset,n=t.containerPosition,o=t.containerElement,a=e(t.helper),r=a.offset(),l=a.outerWidth()-t.sizeDiff.width,c=a.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(o.css("position"))&&e(this).css({left:r.left-n.left-s.left,width:l,height:c}),t._helper&&!i.animate&&/static/.test(o.css("position"))&&e(this).css({left:r.left-n.left-s.left,width:l,height:c})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).resizable("instance"),i=t.options;e(i.alsoResize).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})},resize:function(t,i){var s=e(this).resizable("instance"),n=s.options,o=s.originalSize,a=s.originalPosition,r={height:s.size.height-o.height||0,width:s.size.width-o.width||0,top:s.position.top-a.top||0,left:s.position.left-a.left||0};e(n.alsoResize).each(function(){var t=e(this),s=e(this).data("ui-resizable-alsoresize"),n={},o=t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(o,function(e,t){var i=(s[t]||0)+(r[t]||0);i&&i>=0&&(n[t]=i||null)}),t.css(n)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).resizable("instance"),i=t.options,s=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:s.height,width:s.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).resizable("instance");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).resizable("instance");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t,i=e(this).resizable("instance"),s=i.options,n=i.size,o=i.originalSize,a=i.originalPosition,r=i.axis,l="number"==typeof s.grid?[s.grid,s.grid]:s.grid,c=l[0]||1,h=l[1]||1,d=Math.round((n.width-o.width)/c)*c,u=Math.round((n.height-o.height)/h)*h,p=o.width+d,g=o.height+u,m=s.maxWidth&&s.maxWidth<p,f=s.maxHeight&&s.maxHeight<g,_=s.minWidth&&s.minWidth>p,v=s.minHeight&&s.minHeight>g;s.grid=l,_&&(p+=c),v&&(g+=h),m&&(p-=c),f&&(g-=h),/^(se|s|e)$/.test(r)?(i.size.width=p,i.size.height=g):/^(ne)$/.test(r)?(i.size.width=p,i.size.height=g,i.position.top=a.top-u):/^(sw)$/.test(r)?(i.size.width=p,i.size.height=g,i.position.left=a.left-d):((g-h<=0||p-c<=0)&&(t=i._getPaddingPlusBorderDimensions(this)),g-h>0?(i.size.height=g,i.position.top=a.top-u):(g=h-t.height,i.size.height=g,i.position.top=a.top+o.height-g),p-c>0?(i.size.width=p,i.position.left=a.left-d):(p=c-t.width,i.size.width=p,i.position.left=a.left+o.width-p))}}),e.ui.resizable,e.widget("ui.dialog",{version:"1.11.4",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"Close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(t){var i=e(this).css(t).offset().top;i<0&&e(this).css("top",t.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&e.fn.draggable&&this._makeDraggable(),this.options.resizable&&e.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var t=this.options.appendTo;return t&&(t.jquery||t.nodeType)?e(t):this.document.find(t||"body").eq(0)},_destroy:function(){var e,t=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),(e=t.parent.children().eq(t.index)).length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},disable:e.noop,enable:e.noop,close:function(t){var i,s=this;if(this._isOpen&&!1!==this._trigger("beforeClose",t)){if(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),!this.opener.filter(":focusable").focus().length)try{(i=this.document[0].activeElement)&&"body"!==i.nodeName.toLowerCase()&&e(i).blur()}catch(e){}this._hide(this.uiDialog,this.options.hide,function(){s._trigger("close",t)})}},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(t,i){var s=!1,n=this.uiDialog.siblings(".ui-front:visible").map(function(){return+e(this).css("z-index")}).get(),o=Math.max.apply(null,n);return o>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",o+1),s=!0),s&&!i&&this._trigger("focus",t),s},open:function(){var t=this;this._isOpen?this._moveToTop()&&this._focusTabbable():(this._isOpen=!0,this.opener=e(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){t._focusTabbable(),t._trigger("focus")}),this._makeFocusTarget(),this._trigger("open"))},_focusTabbable:function(){var e=this._focusedElement;e||(e=this.element.find("[autofocus]")),e.length||(e=this.element.find(":tabbable")),e.length||(e=this.uiDialogButtonPane.find(":tabbable")),e.length||(e=this.uiDialogTitlebarClose.filter(":tabbable")),e.length||(e=this.uiDialog),e.eq(0).focus()},_keepFocus:function(t){function checkFocus(){var t=this.document[0].activeElement,i=this.uiDialog[0]===t||e.contains(this.uiDialog[0],t);i||this._focusTabbable()}t.preventDefault(),checkFocus.call(this),this._delay(checkFocus)},_createWrapper:function(){this.uiDialog=e("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(t){if(this.options.closeOnEscape&&!t.isDefaultPrevented()&&t.keyCode&&t.keyCode===e.ui.keyCode.ESCAPE)return t.preventDefault(),void this.close(t);if(t.keyCode===e.ui.keyCode.TAB&&!t.isDefaultPrevented()){var i=this.uiDialog.find(":tabbable"),s=i.filter(":first"),n=i.filter(":last");t.target!==n[0]&&t.target!==this.uiDialog[0]||t.shiftKey?t.target!==s[0]&&t.target!==this.uiDialog[0]||!t.shiftKey||(this._delay(function(){n.focus()}),t.preventDefault()):(this._delay(function(){s.focus()}),t.preventDefault())}},mousedown:function(e){this._moveToTop(e)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var t;this.uiDialogTitlebar=e("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(t){e(t.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=e("<button type='button'></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(e){e.preventDefault(),this.close(e)}}),t=e("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(t),this.uiDialog.attr({"aria-labelledby":t.attr("id")})},_title:function(e){this.options.title||e.html("&#160;"),e.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=e("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=e("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var t=this,i=this.options.buttons;this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),e.isEmptyObject(i)||e.isArray(i)&&!i.length?this.uiDialog.removeClass("ui-dialog-buttons"):(e.each(i,function(i,s){var n,o;s=e.isFunction(s)?{click:s,text:i}:s,s=e.extend({type:"button"},s),n=s.click,s.click=function(){n.apply(t.element[0],arguments)},o={icons:s.icons,text:s.showText},delete s.icons,delete s.showText,e("<button></button>",s).button(o).appendTo(t.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){var t=this,i=this.options;function filteredUi(e){return{position:e.position,offset:e.offset}}this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(i,s){e(this).addClass("ui-dialog-dragging"),t._blockFrames(),t._trigger("dragStart",i,filteredUi(s))},drag:function(e,i){t._trigger("drag",e,filteredUi(i))},stop:function(s,n){var o=n.offset.left-t.document.scrollLeft(),a=n.offset.top-t.document.scrollTop();i.position={my:"left top",at:"left"+(o>=0?"+":"")+o+" top"+(a>=0?"+":"")+a,of:t.window},e(this).removeClass("ui-dialog-dragging"),t._unblockFrames(),t._trigger("dragStop",s,filteredUi(n))}})},_makeResizable:function(){var t=this,i=this.options,s=i.resizable,n=this.uiDialog.css("position"),o="string"==typeof s?s:"n,e,s,w,se,sw,ne,nw";function filteredUi(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:i.maxWidth,maxHeight:i.maxHeight,minWidth:i.minWidth,minHeight:this._minHeight(),handles:o,start:function(i,s){e(this).addClass("ui-dialog-resizing"),t._blockFrames(),t._trigger("resizeStart",i,filteredUi(s))},resize:function(e,i){t._trigger("resize",e,filteredUi(i))},stop:function(s,n){var o=t.uiDialog.offset(),a=o.left-t.document.scrollLeft(),r=o.top-t.document.scrollTop();i.height=t.uiDialog.height(),i.width=t.uiDialog.width(),i.position={my:"left top",at:"left"+(a>=0?"+":"")+a+" top"+(r>=0?"+":"")+r,of:t.window},e(this).removeClass("ui-dialog-resizing"),t._unblockFrames(),t._trigger("resizeStop",s,filteredUi(n))}}).css("position",n)},_trackFocus:function(){this._on(this.widget(),{focusin:function(t){this._makeFocusTarget(),this._focusedElement=e(t.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var t=this._trackingInstances(),i=e.inArray(this,t);-1!==i&&t.splice(i,1)},_trackingInstances:function(){var e=this.document.data("ui-dialog-instances");return e||(e=[],this.document.data("ui-dialog-instances",e)),e},_minHeight:function(){var e=this.options;return"auto"===e.height?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(){var e=this.uiDialog.is(":visible");e||this.uiDialog.show(),this.uiDialog.position(this.options.position),e||this.uiDialog.hide()},_setOptions:function(t){var i=this,s=!1,n={};e.each(t,function(e,t){i._setOption(e,t),e in i.sizeRelatedOptions&&(s=!0),e in i.resizableRelatedOptions&&(n[e]=t)}),s&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",n)},_setOption:function(e,t){var i,s,n=this.uiDialog;"dialogClass"===e&&n.removeClass(this.options.dialogClass).addClass(t),"disabled"!==e&&(this._super(e,t),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:""+t}),"draggable"===e&&((i=n.is(":data(ui-draggable)"))&&!t&&n.draggable("destroy"),!i&&t&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&((s=n.is(":data(ui-resizable)"))&&!t&&n.resizable("destroy"),s&&"string"==typeof t&&n.resizable("option","handles",t),s||!1===t||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var e,t,i,s=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),s.minWidth>s.width&&(s.width=s.minWidth),e=this.uiDialog.css({height:"auto",width:s.width}).outerHeight(),t=Math.max(0,s.minHeight-e),i="number"==typeof s.maxHeight?Math.max(0,s.maxHeight-e):"none","auto"===s.height?this.element.css({minHeight:t,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,s.height-e)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var t=e(this);return e("<div>").css({position:"absolute",width:t.outerWidth(),height:t.outerHeight()}).appendTo(t.parent()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(t){return!!e(t.target).closest(".ui-dialog").length||!!e(t.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var t=!0;this._delay(function(){t=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(e){t||this._allowInteraction(e)||(e.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=e("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var e=this.document.data("ui-dialog-overlays")-1;e?this.document.data("ui-dialog-overlays",e):this.document.unbind("focusin").removeData("ui-dialog-overlays"),this.overlay.remove(),this.overlay=null}}}),e.widget("ui.droppable",{version:"1.11.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(s)?s:function(e){return e.is(s)},this.proportions=function(){if(!arguments.length)return t||(t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight});t=arguments[0]},this._addToManager(i.scope),i.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(t){e.ui.ddmanager.droppables[t]=e.ui.ddmanager.droppables[t]||[],e.ui.ddmanager.droppables[t].push(this)},_splice:function(e){for(var t=0;t<e.length;t++)e[t]===this&&e.splice(t,1)},_destroy:function(){var t=e.ui.ddmanager.droppables[this.options.scope];this._splice(t),this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,i){if("accept"===t)this.accept=e.isFunction(i)?i:function(e){return e.is(i)};else if("scope"===t){var s=e.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(i)}this._super(t,i)},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(i)))},_drop:function(t,i){var s=i||e.ui.ddmanager.current,n=!1;return!(!s||(s.currentItem||s.element)[0]===this.element[0])&&(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=e(this).droppable("instance");if(i.options.greedy&&!i.options.disabled&&i.options.scope===s.options.scope&&i.accept.call(i.element[0],s.currentItem||s.element)&&e.ui.intersect(s,e.extend(i,{offset:i.element.offset()}),i.options.tolerance,t))return n=!0,!1}),!n&&!!this.accept.call(this.element[0],s.currentItem||s.element)&&(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(s)),this.element))},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(){function isOverAxis(e,t,i){return e>=t&&e<t+i}return function(e,t,i,s){if(!t.offset)return!1;var n=(e.positionAbs||e.position.absolute).left+e.margins.left,o=(e.positionAbs||e.position.absolute).top+e.margins.top,a=n+e.helperProportions.width,r=o+e.helperProportions.height,l=t.offset.left,c=t.offset.top,h=l+t.proportions().width,d=c+t.proportions().height;switch(i){case"fit":return l<=n&&a<=h&&c<=o&&r<=d;case"intersect":return l<n+e.helperProportions.width/2&&a-e.helperProportions.width/2<h&&c<o+e.helperProportions.height/2&&r-e.helperProportions.height/2<d;case"pointer":return isOverAxis(s.pageY,c,t.proportions().height)&&isOverAxis(s.pageX,l,t.proportions().width);case"touch":return(o>=c&&o<=d||r>=c&&r<=d||o<c&&r>d)&&(n>=l&&n<=h||a>=l&&a<=h||n<l&&a>h);default:return!1}}}(),e.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(t,i){var s,n,o=e.ui.ddmanager.droppables[t.options.scope]||[],a=i?i.type:null,r=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(s=0;s<o.length;s++)if(!(o[s].options.disabled||t&&!o[s].accept.call(o[s].element[0],t.currentItem||t.element))){for(n=0;n<r.length;n++)if(r[n]===o[s].element[0]){o[s].proportions().height=0;continue e}o[s].visible="none"!==o[s].element.css("display"),o[s].visible&&("mousedown"===a&&o[s]._activate.call(o[s],i),o[s].offset=o[s].element.offset(),o[s].proportions({width:o[s].element[0].offsetWidth,height:o[s].element[0].offsetHeight}))}},drop:function(t,i){var s=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance,i)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(t,i){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,n,o,a=e.ui.intersect(t,this,this.options.tolerance,i),r=!a&&this.isover?"isout":a&&!this.isover?"isover":null;r&&(this.options.greedy&&(n=this.options.scope,(o=this.element.parents(":data(ui-droppable)").filter(function(){return e(this).droppable("instance").options.scope===n})).length&&((s=e(o[0]).droppable("instance")).greedyChild="isover"===r)),s&&"isover"===r&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,i),s&&"isout"===r&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function(t,i){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}},e.ui.droppable;var g,m,f=e;function spinner_modifier(e){return function(){var t=this.element.val();e.apply(this,arguments),this._refresh(),t!==this.element.val()&&this._trigger("change")}}e.effects={effect:{}},function(e,t){var i,s=/^([\-+])=\s*(\d+\.?\d*)/,n=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],o=e.Color=function(t,i,s,n){return new e.Color.fn.parse(t,i,s,n)},a={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},r={byte:{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},l=o.support={},c=e("<p>")[0],h=e.each;function clamp(e,t,i){var s=r[t.type]||{};return null==e?i||!t.def?null:t.def:(e=s.floor?~~e:parseFloat(e),isNaN(e)?t.def:s.mod?(e+s.mod)%s.mod:0>e?0:s.max<e?s.max:e)}function stringParse(t){var s=o(),r=s._rgba=[];return t=t.toLowerCase(),h(n,function(e,i){var n,o=i.re.exec(t),l=o&&i.parse(o),c=i.space||"rgba";if(l)return n=s[c](l),s[a[c].cache]=n[a[c].cache],r=s._rgba=n._rgba,!1}),r.length?("0,0,0,0"===r.join()&&e.extend(r,i.transparent),s):i[t]}function hue2rgb(e,t,i){return 6*(i=(i+1)%1)<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}c.style.cssText="background-color:rgba(1,1,1,.5)",l.rgba=c.style.backgroundColor.indexOf("rgba")>-1,h(a,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),o.fn=e.extend(o.prototype,{parse:function(t,s,n,r){if(void 0===t)return this._rgba=[null,null,null,null],this;(t.jquery||t.nodeType)&&(t=e(t).css(s),s=void 0);var l=this,c=e.type(t),d=this._rgba=[];return void 0!==s&&(t=[t,s,n,r],c="array"),"string"===c?this.parse(stringParse(t)||i._default):"array"===c?(h(a.rgba.props,function(e,i){d[i.idx]=clamp(t[i.idx],i)}),this):"object"===c?(h(a,t instanceof o?function(e,i){t[i.cache]&&(l[i.cache]=t[i.cache].slice())}:function(i,s){var n=s.cache;h(s.props,function(e,i){if(!l[n]&&s.to){if("alpha"===e||null==t[e])return;l[n]=s.to(l._rgba)}l[n][i.idx]=clamp(t[e],i,!0)}),l[n]&&e.inArray(null,l[n].slice(0,3))<0&&(l[n][3]=1,s.from&&(l._rgba=s.from(l[n])))}),this):void 0},is:function(e){var t=o(e),i=!0,s=this;return h(a,function(e,n){var o,a=t[n.cache];return a&&(o=s[n.cache]||n.to&&n.to(s._rgba)||[],h(n.props,function(e,t){if(null!=a[t.idx])return i=a[t.idx]===o[t.idx]})),i}),i},_space:function(){var e=[],t=this;return h(a,function(i,s){t[s.cache]&&e.push(i)}),e.pop()},transition:function(e,t){var i=o(e),s=i._space(),n=a[s],l=0===this.alpha()?o("transparent"):this,c=l[n.cache]||n.to(l._rgba),d=c.slice();return i=i[n.cache],h(n.props,function(e,s){var n=s.idx,o=c[n],a=i[n],l=r[s.type]||{};null!==a&&(null===o?d[n]=a:(l.mod&&(a-o>l.mod/2?o+=l.mod:o-a>l.mod/2&&(o-=l.mod)),d[n]=clamp((a-o)*t+o,s)))}),this[s](d)},blend:function(t){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=o(t)._rgba;return o(e.map(i,function(e,t){return(1-s)*n[t]+s*e}))},toRgbaString:function(){var t="rgba(",i=e.map(this._rgba,function(e,t){return null==e?t>2?1:0:e});return 1===i[3]&&(i.pop(),t="rgb("),t+i.join()+")"},toHslaString:function(){var t="hsla(",i=e.map(this.hsla(),function(e,t){return null==e&&(e=t>2?1:0),t&&t<3&&(e=Math.round(100*e)+"%"),e});return 1===i[3]&&(i.pop(),t="hsl("),t+i.join()+")"},toHexString:function(t){var i=this._rgba.slice(),s=i.pop();return t&&i.push(~~(255*s)),"#"+e.map(i,function(e){return 1===(e=(e||0).toString(16)).length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),o.fn.parse.prototype=o.fn,a.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,i,s=e[0]/255,n=e[1]/255,o=e[2]/255,a=e[3],r=Math.max(s,n,o),l=Math.min(s,n,o),c=r-l,h=r+l,d=.5*h;return t=l===r?0:s===r?60*(n-o)/c+360:n===r?60*(o-s)/c+120:60*(s-n)/c+240,i=0===c?0:d<=.5?c/h:c/(2-h),[Math.round(t)%360,i,d,null==a?1:a]},a.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,i=e[1],s=e[2],n=e[3],o=s<=.5?s*(1+i):s+i-s*i,a=2*s-o;return[Math.round(255*hue2rgb(a,o,t+1/3)),Math.round(255*hue2rgb(a,o,t)),Math.round(255*hue2rgb(a,o,t-1/3)),n]},h(a,function(t,i){var n=i.props,a=i.cache,r=i.to,l=i.from;o.fn[t]=function(t){if(r&&!this[a]&&(this[a]=r(this._rgba)),void 0===t)return this[a].slice();var i,s=e.type(t),c="array"===s||"object"===s?t:arguments,d=this[a].slice();return h(n,function(e,t){var i=c["object"===s?e:t.idx];null==i&&(i=d[t.idx]),d[t.idx]=clamp(i,t)}),l?((i=o(l(d)))[a]=d,i):o(d)},h(n,function(i,n){o.fn[i]||(o.fn[i]=function(o){var a,r=e.type(o),l="alpha"===i?this._hsla?"hsla":"rgba":t,c=this[l](),h=c[n.idx];return"undefined"===r?h:("function"===r&&(o=o.call(this,h),r=e.type(o)),null==o&&n.empty?this:("string"===r&&(a=s.exec(o))&&(o=h+parseFloat(a[2])*("+"===a[1]?1:-1)),c[n.idx]=o,this[l](c)))})})}),o.hook=function(t){var i=t.split(" ");h(i,function(t,i){e.cssHooks[i]={set:function(t,s){var n,a,r="";if("transparent"!==s&&("string"!==e.type(s)||(n=stringParse(s)))){if(s=o(n||s),!l.rgba&&1!==s._rgba[3]){for(a="backgroundColor"===i?t.parentNode:t;(""===r||"transparent"===r)&&a&&a.style;)try{r=e.css(a,"backgroundColor"),a=a.parentNode}catch(e){}s=s.blend(r&&"transparent"!==r?r:"_default")}s=s.toRgbaString()}try{t.style[i]=s}catch(e){}}},e.fx.step[i]=function(t){t.colorInit||(t.start=o(t.elem,i),t.end=o(t.end),t.colorInit=!0),e.cssHooks[i].set(t.elem,t.start.transition(t.end,t.pos))}})},o.hook("backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor"),e.cssHooks.borderColor={expand:function(e){var t={};return h(["Top","Right","Bottom","Left"],function(i,s){t["border"+s+"Color"]=e}),t}},i=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(f),function(){var t,i=["add","remove","toggle"],s={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};function getElementStyles(t){var i,s,n=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,o={};if(n&&n.length&&n[0]&&n[n[0]])for(s=n.length;s--;)i=n[s],"string"==typeof n[i]&&(o[e.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(o[i]=n[i]);return o}e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,i){e.fx.step[i]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(f.style(e.elem,i,e.end),e.setAttr=!0)}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(t,n,o,a){var r=e.speed(n,o,a);return this.queue(function(){var n,o=e(this),a=o.attr("class")||"",l=r.children?o.find("*").addBack():o;l=l.map(function(){var t=e(this);return{el:t,start:getElementStyles(this)}}),(n=function(){e.each(i,function(e,i){t[i]&&o[i+"Class"](t[i])})})(),l=l.map(function(){return this.end=getElementStyles(this.el[0]),this.diff=function styleDifference(t,i){var n,o,a={};for(n in i)o=i[n],t[n]!==o&&(s[n]||!e.fx.step[n]&&isNaN(parseFloat(o))||(a[n]=o));return a}(this.start,this.end),this}),o.attr("class",a),l=l.map(function(){var t=this,i=e.Deferred(),s=e.extend({},r,{queue:!1,complete:function(){i.resolve(t)}});return this.el.animate(this.diff,s),i.promise()}),e.when.apply(e,l.get()).done(function(){n(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,"")})}),r.complete.call(o[0])})})},e.fn.extend({addClass:(t=e.fn.addClass,function(i,s,n,o){return s?e.effects.animateClass.call(this,{add:i},s,n,o):t.apply(this,arguments)}),removeClass:function(t){return function(i,s,n,o){return arguments.length>1?e.effects.animateClass.call(this,{remove:i},s,n,o):t.apply(this,arguments)}}(e.fn.removeClass),toggleClass:function(t){return function(i,s,n,o,a){return"boolean"==typeof s||void 0===s?n?e.effects.animateClass.call(this,s?{add:i}:{remove:i},n,o,a):t.apply(this,arguments):e.effects.animateClass.call(this,{toggle:i},s,n,o)}}(e.fn.toggleClass),switchClass:function(t,i,s,n,o){return e.effects.animateClass.call(this,{add:i,remove:t},s,n,o)}})}(),function(){function _normalizeArguments(t,i,s,n){return e.isPlainObject(t)&&(i=t,t=t.effect),t={effect:t},null==i&&(i={}),e.isFunction(i)&&(n=i,s=null,i={}),("number"==typeof i||e.fx.speeds[i])&&(n=s,s=i,i={}),e.isFunction(s)&&(n=s,s=null),i&&e.extend(t,i),s=s||i.duration,t.duration=e.fx.off?0:"number"==typeof s?s:s in e.fx.speeds?e.fx.speeds[s]:e.fx.speeds._default,t.complete=n||i.complete,t}function standardAnimationOption(t){return!(t&&"number"!=typeof t&&!e.fx.speeds[t])||"string"==typeof t&&!e.effects.effect[t]||!!e.isFunction(t)||"object"==typeof t&&!t.effect}var t;e.extend(e.effects,{version:"1.11.4",save:function(e,t){for(var i=0;i<t.length;i++)null!==t[i]&&e.data("ui-effects-"+t[i],e[0].style[t[i]])},restore:function(e,t){var i,s;for(s=0;s<t.length;s++)null!==t[s]&&(void 0===(i=e.data("ui-effects-"+t[s]))&&(i=""),e.css(t[s],i))},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var i,s;switch(e[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=e[0]/t.height}switch(e[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=e[1]/t.width}return{x:s,y:i}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var i={width:t.outerWidth(!0),height:t.outerHeight(!0),float:t.css("float")},s=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:t.width(),height:t.height()},o=document.activeElement;try{o.id}catch(e){o=document.body}return t.wrap(s),(t[0]===o||e.contains(t[0],o))&&e(o).focus(),s=t.parent(),"static"===t.css("position")?(s.css({position:"relative"}),t.css({position:"relative"})):(e.extend(i,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,s){i[s]=t.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(n),s.css(i).show()},removeWrapper:function(t){var i=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===i||e.contains(t[0],i))&&e(i).focus()),t},setTransition:function(t,i,s,n){return n=n||{},e.each(i,function(e,i){var o=t.cssUnit(i);o[0]>0&&(n[i]=o[0]*s+o[1])}),n}}),e.fn.extend({effect:function(){var t=_normalizeArguments.apply(this,arguments),i=t.mode,s=t.queue,n=e.effects.effect[t.effect];if(e.fx.off||!n)return i?this[i](t.duration,t.complete):this.each(function(){t.complete&&t.complete.call(this)});function run(i){var s=e(this),o=t.complete,a=t.mode;function done(){e.isFunction(o)&&o.call(s[0]),e.isFunction(i)&&i()}(s.is(":hidden")?"hide"===a:"show"===a)?(s[a](),done()):n.call(s[0],t,done)}return!1===s?this.each(run):this.queue(s||"fx",run)},show:(t=e.fn.show,function(e){if(standardAnimationOption(e))return t.apply(this,arguments);var i=_normalizeArguments.apply(this,arguments);return i.mode="show",this.effect.call(this,i)}),hide:function(e){return function(t){if(standardAnimationOption(t))return e.apply(this,arguments);var i=_normalizeArguments.apply(this,arguments);return i.mode="hide",this.effect.call(this,i)}}(e.fn.hide),toggle:function(e){return function(t){if(standardAnimationOption(t)||"boolean"==typeof t)return e.apply(this,arguments);var i=_normalizeArguments.apply(this,arguments);return i.mode="toggle",this.effect.call(this,i)}}(e.fn.toggle),cssUnit:function(t){var i=this.css(t),s=[];return e.each(["em","px","%","pt"],function(e,t){i.indexOf(t)>0&&(s=[parseFloat(i),t])}),s}})}(),g={},e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,t){g[t]=function(t){return Math.pow(t,e+2)}}),e.extend(g,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,i=4;e<((t=Math.pow(2,--i))-1)/11;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(g,function(t,i){e.easing["easeIn"+t]=i,e.easing["easeOut"+t]=function(e){return 1-i(1-e)},e.easing["easeInOut"+t]=function(e){return e<.5?i(2*e)/2:1-i(-2*e+2)/2}}),e.effects,e.effects.effect.blind=function(t,i){var s,n,o,a=e(this),r=["position","top","bottom","left","right","height","width"],l=e.effects.setMode(a,t.mode||"hide"),c=t.direction||"up",h=/up|down|vertical/.test(c),d=h?"height":"width",u=h?"top":"left",p=/up|left|vertical|horizontal/.test(c),g={},m="show"===l;a.parent().is(".ui-effects-wrapper")?e.effects.save(a.parent(),r):e.effects.save(a,r),a.show(),s=e.effects.createWrapper(a).css({overflow:"hidden"}),n=s[d](),o=parseFloat(s.css(u))||0,g[d]=m?n:0,p||(a.css(h?"bottom":"right",0).css(h?"top":"left","auto").css({position:"absolute"}),g[u]=m?o:n+o),m&&(s.css(d,0),p||s.css(u,o+n)),s.animate(g,{duration:t.duration,easing:t.easing,queue:!1,complete:function(){"hide"===l&&a.hide(),e.effects.restore(a,r),e.effects.removeWrapper(a),i()}})},e.effects.effect.bounce=function(t,i){var s,n,o,a=e(this),r=["position","top","bottom","left","right","height","width"],l=e.effects.setMode(a,t.mode||"effect"),c="hide"===l,h="show"===l,d=t.direction||"up",u=t.distance,p=t.times||5,g=2*p+(h||c?1:0),m=t.duration/g,f=t.easing,_="up"===d||"down"===d?"top":"left",v="up"===d||"left"===d,y=a.queue(),w=y.length;for((h||c)&&r.push("opacity"),e.effects.save(a,r),a.show(),e.effects.createWrapper(a),u||(u=a["top"===_?"outerHeight":"outerWidth"]()/3),h&&((o={opacity:1})[_]=0,a.css("opacity",0).css(_,v?2*-u:2*u).animate(o,m,f)),c&&(u/=Math.pow(2,p-1)),(o={})[_]=0,s=0;s<p;s++)(n={})[_]=(v?"-=":"+=")+u,a.animate(n,m,f).animate(o,m,f),u=c?2*u:u/2;c&&((n={opacity:0})[_]=(v?"-=":"+=")+u,a.animate(n,m,f)),a.queue(function(){c&&a.hide(),e.effects.restore(a,r),e.effects.removeWrapper(a),i()}),w>1&&y.splice.apply(y,[1,0].concat(y.splice(w,g+1))),a.dequeue()},e.effects.effect.clip=function(t,i){var s,n,o,a=e(this),r=["position","top","bottom","left","right","height","width"],l=e.effects.setMode(a,t.mode||"hide"),c="show"===l,h=t.direction||"vertical",d="vertical"===h,u=d?"height":"width",p=d?"top":"left",g={};e.effects.save(a,r),a.show(),s=e.effects.createWrapper(a).css({overflow:"hidden"}),n="IMG"===a[0].tagName?s:a,o=n[u](),c&&(n.css(u,0),n.css(p,o/2)),g[u]=c?o:0,g[p]=c?0:o/2,n.animate(g,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){c||a.hide(),e.effects.restore(a,r),e.effects.removeWrapper(a),i()}})},e.effects.effect.drop=function(t,i){var s,n=e(this),o=["position","top","bottom","left","right","opacity","height","width"],a=e.effects.setMode(n,t.mode||"hide"),r="show"===a,l=t.direction||"left",c="up"===l||"down"===l?"top":"left",h="up"===l||"left"===l?"pos":"neg",d={opacity:r?1:0};e.effects.save(n,o),n.show(),e.effects.createWrapper(n),s=t.distance||n["top"===c?"outerHeight":"outerWidth"](!0)/2,r&&n.css("opacity",0).css(c,"pos"===h?-s:s),d[c]=(r?"pos"===h?"+=":"-=":"pos"===h?"-=":"+=")+s,n.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===a&&n.hide(),e.effects.restore(n,o),e.effects.removeWrapper(n),i()}})},e.effects.effect.explode=function(t,i){var s,n,o,a,r,l,c=t.pieces?Math.round(Math.sqrt(t.pieces)):3,h=c,d=e(this),u=e.effects.setMode(d,t.mode||"hide"),p="show"===u,g=d.show().css("visibility","hidden").offset(),m=Math.ceil(d.outerWidth()/h),f=Math.ceil(d.outerHeight()/c),_=[];function childComplete(){_.push(this),_.length===c*h&&function animComplete(){d.css({visibility:"visible"}),e(_).remove(),p||d.hide(),i()}()}for(s=0;s<c;s++)for(a=g.top+s*f,l=s-(c-1)/2,n=0;n<h;n++)o=g.left+n*m,r=n-(h-1)/2,d.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-n*m,top:-s*f}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:m,height:f,left:o+(p?r*m:0),top:a+(p?l*f:0),opacity:p?0:1}).animate({left:o+(p?0:r*m),top:a+(p?0:l*f),opacity:p?1:0},t.duration||500,t.easing,childComplete)},e.effects.effect.fade=function(t,i){var s=e(this),n=e.effects.setMode(s,t.mode||"toggle");s.animate({opacity:n},{queue:!1,duration:t.duration,easing:t.easing,complete:i})},e.effects.effect.fold=function(t,i){var s,n,o=e(this),a=["position","top","bottom","left","right","height","width"],r=e.effects.setMode(o,t.mode||"hide"),l="show"===r,c="hide"===r,h=t.size||15,d=/([0-9]+)%/.exec(h),u=!!t.horizFirst,p=l!==u,g=p?["width","height"]:["height","width"],m=t.duration/2,f={},_={};e.effects.save(o,a),o.show(),s=e.effects.createWrapper(o).css({overflow:"hidden"}),n=p?[s.width(),s.height()]:[s.height(),s.width()],d&&(h=parseInt(d[1],10)/100*n[c?0:1]),l&&s.css(u?{height:0,width:h}:{height:h,width:0}),f[g[0]]=l?n[0]:h,_[g[1]]=l?n[1]:0,s.animate(f,m,t.easing).animate(_,m,t.easing,function(){c&&o.hide(),e.effects.restore(o,a),e.effects.removeWrapper(o),i()})},e.effects.effect.highlight=function(t,i){var s=e(this),n=["backgroundImage","backgroundColor","opacity"],o=e.effects.setMode(s,t.mode||"show"),a={backgroundColor:s.css("backgroundColor")};"hide"===o&&(a.opacity=0),e.effects.save(s,n),s.show().css({backgroundImage:"none",backgroundColor:t.color||"#ffff99"}).animate(a,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===o&&s.hide(),e.effects.restore(s,n),i()}})},e.effects.effect.size=function(t,i){var s,n,o,a=e(this),r=["position","top","bottom","left","right","width","height","overflow","opacity"],l=["width","height","overflow"],c=["fontSize"],h=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],d=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],u=e.effects.setMode(a,t.mode||"effect"),p=t.restore||"effect"!==u,g=t.scale||"both",m=t.origin||["middle","center"],f=a.css("position"),_=p?r:["position","top","bottom","left","right","overflow","opacity"],v={height:0,width:0,outerHeight:0,outerWidth:0};"show"===u&&a.show(),s={height:a.height(),width:a.width(),outerHeight:a.outerHeight(),outerWidth:a.outerWidth()},"toggle"===t.mode&&"show"===u?(a.from=t.to||v,a.to=t.from||s):(a.from=t.from||("show"===u?v:s),a.to=t.to||("hide"===u?v:s)),o={from:{y:a.from.height/s.height,x:a.from.width/s.width},to:{y:a.to.height/s.height,x:a.to.width/s.width}},"box"!==g&&"both"!==g||(o.from.y!==o.to.y&&(_=_.concat(h),a.from=e.effects.setTransition(a,h,o.from.y,a.from),a.to=e.effects.setTransition(a,h,o.to.y,a.to)),o.from.x!==o.to.x&&(_=_.concat(d),a.from=e.effects.setTransition(a,d,o.from.x,a.from),a.to=e.effects.setTransition(a,d,o.to.x,a.to))),"content"!==g&&"both"!==g||o.from.y!==o.to.y&&(_=_.concat(c).concat(l),a.from=e.effects.setTransition(a,c,o.from.y,a.from),a.to=e.effects.setTransition(a,c,o.to.y,a.to)),e.effects.save(a,_),a.show(),e.effects.createWrapper(a),a.css("overflow","hidden").css(a.from),m&&(n=e.effects.getBaseline(m,s),a.from.top=(s.outerHeight-a.outerHeight())*n.y,a.from.left=(s.outerWidth-a.outerWidth())*n.x,a.to.top=(s.outerHeight-a.to.outerHeight)*n.y,a.to.left=(s.outerWidth-a.to.outerWidth)*n.x),a.css(a.from),"content"!==g&&"both"!==g||(h=h.concat(["marginTop","marginBottom"]).concat(c),d=d.concat(["marginLeft","marginRight"]),l=r.concat(h).concat(d),a.find("*[width]").each(function(){var i=e(this),s={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()};p&&e.effects.save(i,l),i.from={height:s.height*o.from.y,width:s.width*o.from.x,outerHeight:s.outerHeight*o.from.y,outerWidth:s.outerWidth*o.from.x},i.to={height:s.height*o.to.y,width:s.width*o.to.x,outerHeight:s.height*o.to.y,outerWidth:s.width*o.to.x},o.from.y!==o.to.y&&(i.from=e.effects.setTransition(i,h,o.from.y,i.from),i.to=e.effects.setTransition(i,h,o.to.y,i.to)),o.from.x!==o.to.x&&(i.from=e.effects.setTransition(i,d,o.from.x,i.from),i.to=e.effects.setTransition(i,d,o.to.x,i.to)),i.css(i.from),i.animate(i.to,t.duration,t.easing,function(){p&&e.effects.restore(i,l)})})),a.animate(a.to,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){0===a.to.opacity&&a.css("opacity",a.from.opacity),"hide"===u&&a.hide(),e.effects.restore(a,_),p||("static"===f?a.css({position:"relative",top:a.to.top,left:a.to.left}):e.each(["top","left"],function(e,t){a.css(t,function(t,i){var s=parseInt(i,10),n=e?a.to.left:a.to.top;return"auto"===i?n+"px":s+n+"px"})})),e.effects.removeWrapper(a),i()}})},e.effects.effect.scale=function(t,i){var s=e(this),n=e.extend(!0,{},t),o=e.effects.setMode(s,t.mode||"effect"),a=parseInt(t.percent,10)||(0===parseInt(t.percent,10)?0:"hide"===o?0:100),r=t.direction||"both",l=t.origin,c={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()},h={y:"horizontal"!==r?a/100:1,x:"vertical"!==r?a/100:1};n.effect="size",n.queue=!1,n.complete=i,"effect"!==o&&(n.origin=l||["middle","center"],n.restore=!0),n.from=t.from||("show"===o?{height:0,width:0,outerHeight:0,outerWidth:0}:c),n.to={height:c.height*h.y,width:c.width*h.x,outerHeight:c.outerHeight*h.y,outerWidth:c.outerWidth*h.x},n.fade&&("show"===o&&(n.from.opacity=0,n.to.opacity=1),"hide"===o&&(n.from.opacity=1,n.to.opacity=0)),s.effect(n)},e.effects.effect.puff=function(t,i){var s=e(this),n=e.effects.setMode(s,t.mode||"hide"),o="hide"===n,a=parseInt(t.percent,10)||150,r=a/100,l={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()};e.extend(t,{effect:"scale",queue:!1,fade:!0,mode:n,complete:i,percent:o?a:100,from:o?l:{height:l.height*r,width:l.width*r,outerHeight:l.outerHeight*r,outerWidth:l.outerWidth*r}}),s.effect(t)},e.effects.effect.pulsate=function(t,i){var s,n=e(this),o=e.effects.setMode(n,t.mode||"show"),a="show"===o,r="hide"===o,l=a||"hide"===o,c=2*(t.times||5)+(l?1:0),h=t.duration/c,d=0,u=n.queue(),p=u.length;for(!a&&n.is(":visible")||(n.css("opacity",0).show(),d=1),s=1;s<c;s++)n.animate({opacity:d},h,t.easing),d=1-d;n.animate({opacity:d},h,t.easing),n.queue(function(){r&&n.hide(),i()}),p>1&&u.splice.apply(u,[1,0].concat(u.splice(p,c+1))),n.dequeue()},e.effects.effect.shake=function(t,i){var s,n=e(this),o=["position","top","bottom","left","right","height","width"],a=e.effects.setMode(n,t.mode||"effect"),r=t.direction||"left",l=t.distance||20,c=t.times||3,h=2*c+1,d=Math.round(t.duration/h),u="up"===r||"down"===r?"top":"left",p="up"===r||"left"===r,g={},m={},f={},_=n.queue(),v=_.length;for(e.effects.save(n,o),n.show(),e.effects.createWrapper(n),g[u]=(p?"-=":"+=")+l,m[u]=(p?"+=":"-=")+2*l,f[u]=(p?"-=":"+=")+2*l,n.animate(g,d,t.easing),s=1;s<c;s++)n.animate(m,d,t.easing).animate(f,d,t.easing);n.animate(m,d,t.easing).animate(g,d/2,t.easing).queue(function(){"hide"===a&&n.hide(),e.effects.restore(n,o),e.effects.removeWrapper(n),i()}),v>1&&_.splice.apply(_,[1,0].concat(_.splice(v,h+1))),n.dequeue()},e.effects.effect.slide=function(t,i){var s,n=e(this),o=["position","top","bottom","left","right","width","height"],a=e.effects.setMode(n,t.mode||"show"),r="show"===a,l=t.direction||"left",c="up"===l||"down"===l?"top":"left",h="up"===l||"left"===l,d={};e.effects.save(n,o),n.show(),s=t.distance||n["top"===c?"outerHeight":"outerWidth"](!0),e.effects.createWrapper(n).css({overflow:"hidden"}),r&&n.css(c,h?isNaN(s)?"-"+s:-s:s),d[c]=(r?h?"+=":"-=":h?"-=":"+=")+s,n.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===a&&n.hide(),e.effects.restore(n,o),e.effects.removeWrapper(n),i()}})},e.effects.effect.transfer=function(t,i){var s=e(this),n=e(t.to),o="fixed"===n.css("position"),a=e("body"),r=o?a.scrollTop():0,l=o?a.scrollLeft():0,c=n.offset(),h={top:c.top-r,left:c.left-l,height:n.innerHeight(),width:n.innerWidth()},d=s.offset(),u=e("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(t.className).css({top:d.top-r,left:d.left-l,height:s.innerHeight(),width:s.innerWidth(),position:o?"fixed":"absolute"}).animate(h,t.duration,t.easing,function(){u.remove(),i()})},e.widget("ui.progressbar",{version:"1.11.4",options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=e("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(e){if(void 0===e)return this.options.value;this.options.value=this._constrainedValue(e),this._refreshValue()},_constrainedValue:function(e){return void 0===e&&(e=this.options.value),this.indeterminate=!1===e,"number"!=typeof e&&(e=0),!this.indeterminate&&Math.min(this.options.max,Math.max(this.min,e))},_setOptions:function(e){var t=e.value;delete e.value,this._super(e),this.options.value=this._constrainedValue(t),this._refreshValue()},_setOption:function(e,t){"max"===e&&(t=Math.max(this.min,t)),"disabled"===e&&this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this._super(e,t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var t=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||t>this.min).toggleClass("ui-corner-right",t===this.options.max).width(i.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=e("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":t}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==t&&(this.oldValue=t,this._trigger("change")),t===this.options.max&&this._trigger("complete")}}),e.widget("ui.selectable",e.ui.mouse,{version:"1.11.4",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var t,i=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){(t=e(i.options.filter,i.element[0])).addClass("ui-selectee"),t.each(function(){var t=e(this),i=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:i.left,top:i.top,right:i.left+t.outerWidth(),bottom:i.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=t.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(t){var i=this,s=this.options;this.opos=[t.pageX,t.pageY],this.options.disabled||(this.selectees=e(s.filter,this.element[0]),this._trigger("start",t),e(s.appendTo).append(this.helper),this.helper.css({left:t.pageX,top:t.pageY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=e.data(this,"selectable-item");s.startselected=!0,t.metaKey||t.ctrlKey||(s.$element.removeClass("ui-selected"),s.selected=!1,s.$element.addClass("ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",t,{unselecting:s.element}))}),e(t.target).parents().addBack().each(function(){var s,n=e.data(this,"selectable-item");if(n)return s=!t.metaKey&&!t.ctrlKey||!n.$element.hasClass("ui-selected"),n.$element.removeClass(s?"ui-unselecting":"ui-selected").addClass(s?"ui-selecting":"ui-unselecting"),n.unselecting=!s,n.selecting=s,n.selected=s,s?i._trigger("selecting",t,{selecting:n.element}):i._trigger("unselecting",t,{unselecting:n.element}),!1}))},_mouseDrag:function(t){if(this.dragged=!0,!this.options.disabled){var i,s=this,n=this.options,o=this.opos[0],a=this.opos[1],r=t.pageX,l=t.pageY;return o>r&&(i=r,r=o,o=i),a>l&&(i=l,l=a,a=i),this.helper.css({left:o,top:a,width:r-o,height:l-a}),this.selectees.each(function(){var i=e.data(this,"selectable-item"),c=!1;i&&i.element!==s.element[0]&&("touch"===n.tolerance?c=!(i.left>r||i.right<o||i.top>l||i.bottom<a):"fit"===n.tolerance&&(c=i.left>o&&i.right<r&&i.top>a&&i.bottom<l),c?(i.selected&&(i.$element.removeClass("ui-selected"),i.selected=!1),i.unselecting&&(i.$element.removeClass("ui-unselecting"),i.unselecting=!1),i.selecting||(i.$element.addClass("ui-selecting"),i.selecting=!0,s._trigger("selecting",t,{selecting:i.element}))):(i.selecting&&((t.metaKey||t.ctrlKey)&&i.startselected?(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.$element.addClass("ui-selected"),i.selected=!0):(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.startselected&&(i.$element.addClass("ui-unselecting"),i.unselecting=!0),s._trigger("unselecting",t,{unselecting:i.element}))),i.selected&&(t.metaKey||t.ctrlKey||i.startselected||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,s._trigger("unselecting",t,{unselecting:i.element})))))}),!1}},_mouseStop:function(t){var i=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");s.$element.removeClass("ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",t,{unselected:s.element})}),e(".ui-selecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");s.$element.removeClass("ui-selecting").addClass("ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",t,{selected:s.element})}),this._trigger("stop",t),this.helper.remove(),!1}}),e.widget("ui.selectmenu",{version:"1.11.4",defaultElement:"<select>",options:{appendTo:null,disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:null,change:null,close:null,focus:null,open:null,select:null},_create:function(){var e=this.element.uniqueId().attr("id");this.ids={element:e,button:e+"-button",menu:e+"-menu"},this._drawButton(),this._drawMenu(),this.options.disabled&&this.disable()},_drawButton:function(){var t=this;this.label=e("label[for='"+this.ids.element+"']").attr("for",this.ids.button),this._on(this.label,{click:function(e){this.button.focus(),e.preventDefault()}}),this.element.hide(),this.button=e("<span>",{class:"ui-selectmenu-button ui-widget ui-state-default ui-corner-all",tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true"}).insertAfter(this.element),e("<span>",{class:"ui-icon "+this.options.icons.button}).prependTo(this.button),this.buttonText=e("<span>",{class:"ui-selectmenu-text"}).appendTo(this.button),this._setText(this.buttonText,this.element.find("option:selected").text()),this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){t.menuItems||t._refreshMenu()}),this._hoverable(this.button),this._focusable(this.button)},_drawMenu:function(){var t=this;this.menu=e("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=e("<div>",{class:"ui-selectmenu-menu ui-front"}).append(this.menu).appendTo(this._appendTo()),this.menuInstance=this.menu.menu({role:"listbox",select:function(e,i){e.preventDefault(),t._setSelection(),t._select(i.item.data("ui-selectmenu-item"),e)},focus:function(e,i){var s=i.item.data("ui-selectmenu-item");null!=t.focusIndex&&s.index!==t.focusIndex&&(t._trigger("focus",e,{item:s}),t.isOpen||t._select(s,e)),t.focusIndex=s.index,t.button.attr("aria-activedescendant",t.menuItems.eq(s.index).attr("id"))}}).menu("instance"),this.menu.addClass("ui-corner-bottom").removeClass("ui-corner-all"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this._setText(this.buttonText,this._getSelectedItem().text()),this.options.width||this._resizeButton()},_refreshMenu:function(){this.menu.empty();var e,t=this.element.find("option");t.length&&(this._parseOptions(t),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup"),e=this._getSelectedItem(),this.menuInstance.focus(null,e),this._setAria(e.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(e){this.options.disabled||(this.menuItems?(this.menu.find(".ui-state-focus").removeClass("ui-state-focus"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",e))},_position:function(){this.menuWrap.position(e.extend({of:this.button},this.options.position))},close:function(e){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",e))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderMenu:function(t,i){var s=this,n="";e.each(i,function(i,o){o.optgroup!==n&&(e("<li>",{class:"ui-selectmenu-optgroup ui-menu-divider"+(o.element.parent("optgroup").prop("disabled")?" ui-state-disabled":""),text:o.optgroup}).appendTo(t),n=o.optgroup),s._renderItemData(t,o)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-selectmenu-item",t)},_renderItem:function(t,i){var s=e("<li>");return i.disabled&&s.addClass("ui-state-disabled"),this._setText(s,i.label),s.appendTo(t)},_setText:function(e,t){t?e.text(t):e.html("&#160;")},_move:function(e,t){var i,s,n=".ui-menu-item";this.isOpen?i=this.menuItems.eq(this.focusIndex):(i=this.menuItems.eq(this.element[0].selectedIndex),n+=":not(.ui-state-disabled)"),(s="first"===e||"last"===e?i["first"===e?"prevAll":"nextAll"](n).eq(-1):i[e+"All"](n).eq(0)).length&&this.menuInstance.focus(t,s)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex)},_toggle:function(e){this[this.isOpen?"close":"open"](e)},_setSelection:function(){var e;this.range&&(window.getSelection?((e=window.getSelection()).removeAllRanges(),e.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(t){this.isOpen&&(e(t.target).closest(".ui-selectmenu-menu, #"+this.ids.button).length||this.close(t))}},_buttonEvents:{mousedown:function(){var e;window.getSelection?(e=window.getSelection()).rangeCount&&(this.range=e.getRangeAt(0)):this.range=document.selection.createRange()},click:function(e){this._setSelection(),this._toggle(e)},keydown:function(t){var i=!0;switch(t.keyCode){case e.ui.keyCode.TAB:case e.ui.keyCode.ESCAPE:this.close(t),i=!1;break;case e.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(t);break;case e.ui.keyCode.UP:t.altKey?this._toggle(t):this._move("prev",t);break;case e.ui.keyCode.DOWN:t.altKey?this._toggle(t):this._move("next",t);break;case e.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(t):this._toggle(t);break;case e.ui.keyCode.LEFT:this._move("prev",t);break;case e.ui.keyCode.RIGHT:this._move("next",t);break;case e.ui.keyCode.HOME:case e.ui.keyCode.PAGE_UP:this._move("first",t);break;case e.ui.keyCode.END:case e.ui.keyCode.PAGE_DOWN:this._move("last",t);break;default:this.menu.trigger(t),i=!1}i&&t.preventDefault()}},_selectFocusedItem:function(e){var t=this.menuItems.eq(this.focusIndex);t.hasClass("ui-state-disabled")||this._select(t.data("ui-selectmenu-item"),e)},_select:function(e,t){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=e.index,this._setText(this.buttonText,e.label),this._setAria(e),this._trigger("select",t,{item:e}),e.index!==i&&this._trigger("change",t,{item:e}),this.close(t)},_setAria:function(e){var t=this.menuItems.eq(e.index).attr("id");this.button.attr({"aria-labelledby":t,"aria-activedescendant":t}),this.menu.attr("aria-activedescendant",t)},_setOption:function(e,t){"icons"===e&&this.button.find("span.ui-icon").removeClass(this.options.icons.button).addClass(t.button),this._super(e,t),"appendTo"===e&&this.menuWrap.appendTo(this._appendTo()),"disabled"===e&&(this.menuInstance.option("disabled",t),this.button.toggleClass("ui-state-disabled",t).attr("aria-disabled",t),this.element.prop("disabled",t),t?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)),"width"===e&&this._resizeButton()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&&t[0]||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t},_toggleAttr:function(){this.button.toggleClass("ui-corner-top",this.isOpen).toggleClass("ui-corner-all",!this.isOpen).attr("aria-expanded",this.isOpen),this.menuWrap.toggleClass("ui-selectmenu-open",this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var e=this.options.width;e||(e=this.element.show().outerWidth(),this.element.hide()),this.button.outerWidth(e)},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){return{disabled:this.element.prop("disabled")}},_parseOptions:function(t){var i=[];t.each(function(t,s){var n=e(s),o=n.parent("optgroup");i.push({element:n,index:t,value:n.val(),label:n.text(),optgroup:o.attr("label")||"",disabled:o.prop("disabled")||n.prop("disabled")})}),this.items=i},_destroy:function(){this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.label.attr("for",this.ids.element)}}),e.widget("ui.slider",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var t,i,s=this.options,n=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),o=[];for(i=s.values&&s.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),t=n.length;t<i;t++)o.push("<span class='ui-slider-handle ui-state-default ui-corner-all' tabindex='0'></span>");this.handles=n.add(e(o.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)})},_createRange:function(){var t=this.options,i="";t.range?(!0===t.range&&(t.values?t.values.length&&2!==t.values.length?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=e("<div></div>").appendTo(this.element),i="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(i+("min"===t.range||"max"===t.range?" ui-slider-range-"+t.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var i,s,n,o,a,r,l,c=this,h=this.options;return!h.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:t.pageX,y:t.pageY},s=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var i=Math.abs(s-c.values(t));(n>i||n===i&&(t===c._lastChangedValue||c.values(t)===h.min))&&(n=i,o=e(this),a=t)}),!1!==this._start(t,a)&&(this._mouseSliding=!0,this._handleIndex=a,o.addClass("ui-state-active").focus(),r=o.offset(),l=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:t.pageX-r.left-o.width()/2,top:t.pageY-r.top-o.height()/2-(parseInt(o.css("borderTopWidth"),10)||0)-(parseInt(o.css("borderBottomWidth"),10)||0)+(parseInt(o.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,a,s),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,i),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,i,s,n,o;return"horizontal"===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),(s=i/t)>1&&(s=1),s<0&&(s=0),"vertical"===this.orientation&&(s=1-s),n=this._valueMax()-this._valueMin(),o=this._valueMin()+s*n,this._trimAlignValue(o)},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("start",e,i)},_slide:function(e,t,i){var s,n,o;this.options.values&&this.options.values.length?(s=this.values(t?0:1),2===this.options.values.length&&!0===this.options.range&&(0===t&&i>s||1===t&&i<s)&&(i=s),i!==this.values(t)&&((n=this.values())[t]=i,o=this._trigger("slide",e,{handle:this.handles[t],value:i,values:n}),s=this.values(t?0:1),!1!==o&&this.values(t,i))):i!==this.value()&&!1!==(o=this._trigger("slide",e,{handle:this.handles[t],value:i}))&&this.value(i)},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("stop",e,i)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._lastChangedValue=t,this._trigger("change",e,i)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),void this._change(null,0)):this._value()},values:function(t,i){var s,n,o;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),void this._change(null,t);if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(s=this.options.values,n=arguments[0],o=0;o<s.length;o+=1)s[o]=this._trimAlignValue(n[o]),this._change(null,o);this._refreshValue()},_setOption:function(t,i){var s,n=0;switch("range"===t&&!0===this.options.range&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(n=this.options.values.length),"disabled"===t&&this.element.toggleClass("ui-state-disabled",!!i),this._super(t,i),t){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue(),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),s=0;s<n;s+=1)this._change(null,s);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,i,s;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);if(this.options.values&&this.options.values.length){for(i=this.options.values.slice(),s=0;s<i.length;s+=1)i[s]=this._trimAlignValue(i[s]);return i}return[]},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,s=e-i;return 2*Math.abs(i)>=t&&(s+=i>0?t:-t),parseFloat(s.toFixed(5))},_calculateNewMax:function(){var e=this.options.max,t=this._valueMin(),i=this.options.step,s=Math.floor(+(e-t).toFixed(this._precision())/i)*i;e=s+t,this.max=parseFloat(e.toFixed(this._precision()))},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=e.toString(),i=t.indexOf(".");return-1===i?0:t.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshValue:function(){var t,i,s,n,o,a=this.options.range,r=this.options,l=this,c=!this._animateOff&&r.animate,h={};this.options.values&&this.options.values.length?this.handles.each(function(s){i=(l.values(s)-l._valueMin())/(l._valueMax()-l._valueMin())*100,h["horizontal"===l.orientation?"left":"bottom"]=i+"%",e(this).stop(1,1)[c?"animate":"css"](h,r.animate),!0===l.options.range&&("horizontal"===l.orientation?(0===s&&l.range.stop(1,1)[c?"animate":"css"]({left:i+"%"},r.animate),1===s&&l.range[c?"animate":"css"]({width:i-t+"%"},{queue:!1,duration:r.animate})):(0===s&&l.range.stop(1,1)[c?"animate":"css"]({bottom:i+"%"},r.animate),1===s&&l.range[c?"animate":"css"]({height:i-t+"%"},{queue:!1,duration:r.animate}))),t=i}):(s=this.value(),n=this._valueMin(),o=this._valueMax(),i=o!==n?(s-n)/(o-n)*100:0,h["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[c?"animate":"css"](h,r.animate),"min"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({width:i+"%"},r.animate),"max"===a&&"horizontal"===this.orientation&&this.range[c?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:r.animate}),"min"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({height:i+"%"},r.animate),"max"===a&&"vertical"===this.orientation&&this.range[c?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:r.animate}))},_handleEvents:{keydown:function(t){var i,s,n,o=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(t.preventDefault(),!this._keySliding&&(this._keySliding=!0,e(t.target).addClass("ui-state-active"),!1===this._start(t,o)))return}switch(n=this.options.step,i=s=this.options.values&&this.options.values.length?this.values(o):this.value(),t.keyCode){case e.ui.keyCode.HOME:s=this._valueMin();break;case e.ui.keyCode.END:s=this._valueMax();break;case e.ui.keyCode.PAGE_UP:s=this._trimAlignValue(i+(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.PAGE_DOWN:s=this._trimAlignValue(i-(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(i===this._valueMax())return;s=this._trimAlignValue(i+n);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i===this._valueMin())return;s=this._trimAlignValue(i-n)}this._slide(t,o,s)},keyup:function(t){var i=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,i),this._change(t,i),e(t.target).removeClass("ui-state-active"))}}}),e.widget("ui.sortable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(e,t,i){return e>=t&&e<t+i},_isFloating:function(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))},_create:function(){this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(e,t){this._super(e,t),"handle"===e&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),e.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(t,i){var s=null,n=!1,o=this;return!(this.reverting||this.options.disabled||"static"===this.options.type||(this._refreshItems(t),e(t.target).parents().each(function(){if(e.data(this,o.widgetName+"-item")===o)return s=e(this),!1}),e.data(t.target,o.widgetName+"-item")===o&&(s=e(t.target)),!s||this.options.handle&&!i&&(e(this.options.handle,s).find("*").addBack().each(function(){this===t.target&&(n=!0)}),!n)||(this.currentItem=s,this._removeCurrentsFromItems(),0)))},_mouseStart:function(t,i,s){var n,o,a=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),a.containment&&this._setContainment(),a.cursor&&"auto"!==a.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",a.cursor),this.storedStylesheet=e("<style>*{ cursor: "+a.cursor+" !important; }</style>").appendTo(o)),a.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",a.opacity)),a.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",a.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!a.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var i,s,n,o,a=this.options,r=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<a.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+a.scrollSpeed:t.pageY-this.overflowOffset.top<a.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-a.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<a.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+a.scrollSpeed:t.pageX-this.overflowOffset.left<a.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-a.scrollSpeed)):(t.pageY-this.document.scrollTop()<a.scrollSensitivity?r=this.document.scrollTop(this.document.scrollTop()-a.scrollSpeed):this.window.height()-(t.pageY-this.document.scrollTop())<a.scrollSensitivity&&(r=this.document.scrollTop(this.document.scrollTop()+a.scrollSpeed)),t.pageX-this.document.scrollLeft()<a.scrollSensitivity?r=this.document.scrollLeft(this.document.scrollLeft()-a.scrollSpeed):this.window.width()-(t.pageX-this.document.scrollLeft())<a.scrollSensitivity&&(r=this.document.scrollLeft(this.document.scrollLeft()+a.scrollSpeed))),!1!==r&&e.ui.ddmanager&&!a.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],n=s.item[0],(o=this._intersectsWithPointer(s))&&s.instance===this.currentContainer&&!(n===this.currentItem[0]||this.placeholder[1===o?"next":"prev"]()[0]===n||e.contains(this.placeholder[0],n)||"semi-dynamic"===this.options.type&&e.contains(this.element[0],n))){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(t,s),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var s=this,n=this.placeholder.offset(),o=this.options.axis,a={};o&&"x"!==o||(a.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(a.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(a,parseInt(this.options.revert,10)||500,function(){s._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);i&&s.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!s.length&&t.key&&s.push(t.key+"="),s.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},i.each(function(){s.push(e(t.item||this).attr(t.attribute||"id")||"")}),s},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,o=e.left,a=o+e.width,r=e.top,l=r+e.height,c=this.offset.click.top,h=this.offset.click.left,d="x"===this.options.axis||s+c>r&&s+c<l,u="y"===this.options.axis||t+h>o&&t+h<a,p=d&&u;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:o<t+this.helperProportions.width/2&&i-this.helperProportions.width/2<a&&r<s+this.helperProportions.height/2&&n-this.helperProportions.height/2<l},_intersectsWithPointer:function(e){var t="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),i="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),s=t&&i,n=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return!!s&&(this.floating?o&&"right"===o||"down"===n?2:1:n&&("down"===n?2:1))},_intersectsWithSides:function(e){var t=this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&t||"up"===s&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var i,s,n,o,a=[],r=[],l=this._connectWith();if(l&&t)for(i=l.length-1;i>=0;i--)for(n=e(l[i],this.document[0]),s=n.length-1;s>=0;s--)(o=e.data(n[s],this.widgetFullName))&&o!==this&&!o.options.disabled&&r.push([e.isFunction(o.options.items)?o.options.items.call(o.element):e(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o]);function addItems(){a.push(this)}for(r.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),i=r.length-1;i>=0;i--)r[i][0].each(addItems);return e(a)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;i<t.length;i++)if(t[i]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i,s,n,o,a,r,l,c,h=this.items,d=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],u=this._connectWith();if(u&&this.ready)for(i=u.length-1;i>=0;i--)for(n=e(u[i],this.document[0]),s=n.length-1;s>=0;s--)(o=e.data(n[s],this.widgetFullName))&&o!==this&&!o.options.disabled&&(d.push([e.isFunction(o.options.items)?o.options.items.call(o.element[0],t,{item:this.currentItem}):e(o.options.items,o.element),o]),this.containers.push(o));for(i=d.length-1;i>=0;i--)for(a=d[i][1],r=d[i][0],s=0,c=r.length;s<c;s++)(l=e(r[s])).data(this.widgetName+"-item",a),h.push({item:l,instance:a,width:0,height:0,left:0,top:0})},refreshPositions:function(t){var i,s,n,o;for(this.floating=!!this.items.length&&("x"===this.options.axis||this._isFloating(this.items[0].item)),this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset()),i=this.items.length-1;i>=0;i--)(s=this.items[i]).instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?e(this.options.toleranceElement,s.item):s.item,t||(s.width=n.outerWidth(),s.height=n.outerHeight()),o=n.offset(),s.left=o.left,s.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(t){var i,s=(t=t||this).options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=t.currentItem[0].nodeName.toLowerCase(),n=e("<"+s+">",t.document[0]).addClass(i||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tbody"===s?t._createTrPlaceholder(t.currentItem.find("tr").eq(0),e("<tr>",t.document[0]).appendTo(n)):"tr"===s?t._createTrPlaceholder(t.currentItem,n):"img"===s&&n.attr("src",t.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(e,n){i&&!s.forcePlaceholderSize||(n.height()||n.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(s.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),s.placeholder.update(t,t.placeholder)},_createTrPlaceholder:function(t,i){var s=this;t.children().each(function(){e("<td>&#160;</td>",s.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(t){var i,s,n,o,a,r,l,c,h,d,u=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!e.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(u&&e.contains(this.containers[i].element[0],u.element[0]))continue;u=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",t,this._uiHash(this)),this.containers[i].containerCache.over=0);if(u)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,o=null,h=u.floating||this._isFloating(this.currentItem),a=h?"left":"top",r=h?"width":"height",d=h?"clientX":"clientY",s=this.items.length-1;s>=0;s--)e.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(l=this.items[s].item.offset()[a],c=!1,t[d]-l>this.items[s][r]/2&&(c=!0),Math.abs(t[d]-l)<n&&(n=Math.abs(t[d]-l),o=this.items[s],this.direction=c?"up":"down"));if(!o&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return void(this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash()),this.currentContainer.containerCache.over=1));o?this._rearrange(t,o,null,!0):this._rearrange(t,null,this.containers[p].element,!0),this._trigger("change",t,this._uiHash()),this.containers[p]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||e("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),s[0].style.width&&!i.forceHelperSize||s.width(this.currentItem.width()),s[0].style.height&&!i.forceHelperSize||s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),"document"!==n.containment&&"window"!==n.containment||(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.width():this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(t=e(n.containment)[0],i=e(n.containment).offset(),s="hidden"!==e(t).css("overflow"),this.containment=[i.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,i){i||(i=this.position);var s="absolute"===t?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())*s}},_generatePosition:function(t){var i,s,n=this.options,o=t.pageX,a=t.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((a-this.originalPageY)/n.grid[1])*n.grid[1],a=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0],o=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:r.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:r.scrollLeft())}},_rearrange:function(e,t,i,s){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(e,t){this.reverting=!1;var i,s=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(i in this._storedCSS)"auto"!==this._storedCSS[i]&&"static"!==this._storedCSS[i]||(this._storedCSS[i]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();function delayEvent(e,t,i){return function(s){i._trigger(e,s,t._uiHash(t))}}for(this.fromOutside&&!t&&s.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||s.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(s.push(function(e){this._trigger("remove",e,this._uiHash())}),s.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),s.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),i=this.containers.length-1;i>=0;i--)t||s.push(delayEvent("deactivate",this,this.containers[i])),this.containers[i].containerCache.over&&(s.push(delayEvent("out",this,this.containers[i])),this.containers[i].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!t){for(i=0;i<s.length;i++)s[i].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){!1===e.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}}),e.widget("ui.spinner",{version:"1.11.4",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var t={},i=this.element;return e.each(["min","max","step"],function(e,s){var n=i.attr(s);void 0!==n&&n.length&&(t[s]=n)}),t},_events:{keydown:function(e){this._start(e)&&this._keydown(e)&&e.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(e){this.cancelBlur?delete this.cancelBlur:(this._stop(),this._refresh(),this.previous!==this.element.val()&&this._trigger("change",e))},mousewheel:function(e,t){if(t){if(!this.spinning&&!this._start(e))return!1;this._spin((t>0?1:-1)*this.options.step,e),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(e)},100),e.preventDefault()}},"mousedown .ui-spinner-button":function(t){var i;function checkFocus(){var e=this.element[0]===this.document[0].activeElement;e||(this.element.focus(),this.previous=i,this._delay(function(){this.previous=i}))}i=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),t.preventDefault(),checkFocus.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,checkFocus.call(this)}),!1!==this._start(t)&&this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(t){if(e(t.currentTarget).hasClass("ui-state-active"))return!1!==this._start(t)&&void this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var e=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=e.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(.5*e.height())&&e.height()>0&&e.height(e.height()),this.options.disabled&&this.disable()},_keydown:function(t){var i=this.options,s=e.ui.keyCode;switch(t.keyCode){case s.UP:return this._repeat(null,1,t),!0;case s.DOWN:return this._repeat(null,-1,t),!0;case s.PAGE_UP:return this._repeat(null,i.page,t),!0;case s.PAGE_DOWN:return this._repeat(null,-i.page,t),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span></a><a class='ui-spinner-button ui-spinner-down ui-corner-br'><span class='ui-icon "+this.options.icons.down+"'>&#9660;</span></a>"},_start:function(e){return!(!this.spinning&&!1===this._trigger("start",e)||(this.counter||(this.counter=1),this.spinning=!0,0))},_repeat:function(e,t,i){e=e||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,t,i)},e),this._spin(t*this.options.step,i)},_spin:function(e,t){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+e*this._increment(this.counter)),this.spinning&&!1===this._trigger("spin",t,{value:i})||(this._value(i),this.counter++)},_increment:function(t){var i=this.options.incremental;return i?e.isFunction(i)?i(t):Math.floor(t*t*t/5e4-t*t/500+17*t/200+1):1},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=e.toString(),i=t.indexOf(".");return-1===i?0:t.length-i-1},_adjustValue:function(e){var t,i,s=this.options;return t=null!==s.min?s.min:0,i=e-t,i=Math.round(i/s.step)*s.step,e=t+i,e=parseFloat(e.toFixed(this._precision())),null!==s.max&&e>s.max?s.max:null!==s.min&&e<s.min?s.min:e},_stop:function(e){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",e))},_setOption:function(e,t){if("culture"===e||"numberFormat"===e){var i=this._parse(this.element.val());return this.options[e]=t,void this.element.val(this._format(i))}"max"!==e&&"min"!==e&&"step"!==e||"string"==typeof t&&(t=this._parse(t)),"icons"===e&&(this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(t.up),this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(t.down)),this._super(e,t),"disabled"===e&&(this.widget().toggleClass("ui-state-disabled",!!t),this.element.prop("disabled",!!t),this.buttons.button(t?"disable":"enable"))},_setOptions:spinner_modifier(function(e){this._super(e)}),_parse:function(e){return"string"==typeof e&&""!==e&&(e=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(e,10,this.options.culture):+e),""===e||isNaN(e)?null:e},_format:function(e){return""===e?"":window.Globalize&&this.options.numberFormat?Globalize.format(e,this.options.numberFormat,this.options.culture):e},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var e=this.value();return null!==e&&e===this._adjustValue(e)},_value:function(e,t){var i;""!==e&&null!==(i=this._parse(e))&&(t||(i=this._adjustValue(i)),e=this._format(i)),this.element.val(e),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:spinner_modifier(function(e){this._stepUp(e)}),_stepUp:function(e){this._start()&&(this._spin((e||1)*this.options.step),this._stop())},stepDown:spinner_modifier(function(e){this._stepDown(e)}),_stepDown:function(e){this._start()&&(this._spin((e||1)*-this.options.step),this._stop())},pageUp:spinner_modifier(function(e){this._stepUp((e||1)*this.options.page)}),pageDown:spinner_modifier(function(e){this._stepDown((e||1)*this.options.page)}),value:function(e){if(!arguments.length)return this._parse(this.element.val());spinner_modifier(this._value).call(this,e)},widget:function(){return this.uiSpinner}}),e.widget("ui.tabs",{version:"1.11.4",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:(m=/#.*$/,function(e){var t,i;e=e.cloneNode(!1),t=e.href.replace(m,""),i=location.href.replace(m,"");try{t=decodeURIComponent(t)}catch(e){}try{i=decodeURIComponent(i)}catch(e){}return e.hash.length>1&&t===i}),_create:function(){var t=this,i=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",i.collapsible),this._processTabs(),i.active=this._initialActive(),e.isArray(i.disabled)&&(i.disabled=e.unique(i.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"),function(e){return t.tabs.index(e)}))).sort()),!1!==this.options.active&&this.anchors.length?this.active=this._findActive(i.active):this.active=e(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var t=this.options.active,i=this.options.collapsible,s=location.hash.substring(1);return null===t&&(s&&this.tabs.each(function(i,n){if(e(n).attr("aria-controls")===s)return t=i,!1}),null===t&&(t=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),null!==t&&-1!==t||(t=!!this.tabs.length&&0)),!1!==t&&-1===(t=this.tabs.index(this.tabs.eq(t)))&&(t=!i&&0),!i&&!1===t&&this.anchors.length&&(t=0),t},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()}},_tabKeydown:function(t){var i=e(this.document[0].activeElement).closest("li"),s=this.tabs.index(i),n=!0;if(!this._handlePageNav(t)){switch(t.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:s++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:n=!1,s--;break;case e.ui.keyCode.END:s=this.anchors.length-1;break;case e.ui.keyCode.HOME:s=0;break;case e.ui.keyCode.SPACE:return t.preventDefault(),clearTimeout(this.activating),void this._activate(s);case e.ui.keyCode.ENTER:return t.preventDefault(),clearTimeout(this.activating),void this._activate(s!==this.options.active&&s);default:return}t.preventDefault(),clearTimeout(this.activating),s=this._focusNextTab(s,n),t.ctrlKey||t.metaKey||(i.attr("aria-selected","false"),this.tabs.eq(s).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",s)},this.delay))}},_panelKeydown:function(t){this._handlePageNav(t)||t.ctrlKey&&t.keyCode===e.ui.keyCode.UP&&(t.preventDefault(),this.active.focus())},_handlePageNav:function(t){return t.altKey&&t.keyCode===e.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):t.altKey&&t.keyCode===e.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(t,i){var s=this.tabs.length-1;for(;-1!==e.inArray((t>s&&(t=0),t<0&&(t=s),t),this.options.disabled);)t=i?t+1:t-1;return t},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).focus(),e},_setOption:function(e,t){"active"!==e?"disabled"!==e?(this._super(e,t),"collapsible"===e&&(this.element.toggleClass("ui-tabs-collapsible",t),t||!1!==this.options.active||this._activate(0)),"event"===e&&this._setupEvents(t),"heightStyle"===e&&this._setupHeightStyle(t)):this._setupDisabled(t):this._activate(t)},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var t=this.options,i=this.tablist.children(":has(a[href])");t.disabled=e.map(i.filter(".ui-state-disabled"),function(e){return i.index(e)}),this._processTabs(),!1!==t.active&&this.anchors.length?this.active.length&&!e.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active):(t.active=!1,this.active=e()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var t=this,i=this.tabs,s=this.anchors,n=this.panels;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist").delegate("> li","mousedown"+this.eventNamespace,function(t){e(this).is(".ui-state-disabled")&&t.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){e(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return e("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=e(),this.anchors.each(function(i,s){var n,o,a,r=e(s).uniqueId().attr("id"),l=e(s).closest("li"),c=l.attr("aria-controls");t._isLocal(s)?(n=s.hash,a=n.substring(1),o=t.element.find(t._sanitizeSelector(n))):(a=l.attr("aria-controls")||e({}).uniqueId()[0].id,n="#"+a,(o=t.element.find(n)).length||(o=t._createPanel(a)).insertAfter(t.panels[i-1]||t.tablist),o.attr("aria-live","polite")),o.length&&(t.panels=t.panels.add(o)),c&&l.data("ui-tabs-aria-controls",c),l.attr({"aria-controls":a,"aria-labelledby":r}),o.attr("aria-labelledby",r)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel"),i&&(this._off(i.not(this.tabs)),this._off(s.not(this.anchors)),this._off(n.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol,ul").eq(0)},_createPanel:function(t){return e("<div>").attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(t){e.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1);for(var i,s=0;i=this.tabs[s];s++)!0===t||-1!==e.inArray(s,t)?e(i).addClass("ui-state-disabled").attr("aria-disabled","true"):e(i).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=t},_setupEvents:function(t){var i={};t&&e.each(t.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(e){e.preventDefault()}}),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(t){var i,s=this.element.parent();"fill"===t?(i=s.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var t=e(this),s=t.css("position");"absolute"!==s&&"fixed"!==s&&(i-=t.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=e(this).outerHeight(!0)}),this.panels.each(function(){e(this).height(Math.max(0,i-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===t&&(i=0,this.panels.each(function(){i=Math.max(i,e(this).height("").height())}).height(i))},_eventHandler:function(t){var i=this.options,s=this.active,n=e(t.currentTarget),o=n.closest("li"),a=o[0]===s[0],r=a&&i.collapsible,l=r?e():this._getPanelForTab(o),c=s.length?this._getPanelForTab(s):e(),h={oldTab:s,oldPanel:c,newTab:r?e():o,newPanel:l};t.preventDefault(),o.hasClass("ui-state-disabled")||o.hasClass("ui-tabs-loading")||this.running||a&&!i.collapsible||!1===this._trigger("beforeActivate",t,h)||(i.active=!r&&this.tabs.index(o),this.active=a?e():o,this.xhr&&this.xhr.abort(),c.length||l.length||e.error("jQuery UI Tabs: Mismatching fragment identifier."),l.length&&this.load(this.tabs.index(o),t),this._toggle(t,h))},_toggle:function(t,i){var s=this,n=i.newPanel,o=i.oldPanel;function complete(){s.running=!1,s._trigger("activate",t,i)}function show(){i.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),n.length&&s.options.show?s._show(n,s.options.show,complete):(n.show(),complete())}this.running=!0,o.length&&this.options.hide?this._hide(o,this.options.hide,function(){i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),show()}):(i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),o.hide(),show()),o.attr("aria-hidden","true"),i.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),n.length&&o.length?i.oldTab.attr("tabIndex",-1):n.length&&this.tabs.filter(function(){return 0===e(this).attr("tabIndex")}).attr("tabIndex",-1),n.attr("aria-hidden","false"),i.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(t){var i,s=this._findActive(t);s[0]!==this.active[0]&&(s.length||(s=this.active),i=s.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return!1===t?e():this.tabs.eq(t)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+e+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tablist.unbind(this.eventNamespace),this.tabs.add(this.panels).each(function(){e.data(this,"ui-tabs-destroy")?e(this).remove():e(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var t=e(this),i=t.data("ui-tabs-aria-controls");i?t.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):t.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(t){var i=this.options.disabled;!1!==i&&(void 0===t?i=!1:(t=this._getIndex(t),i=e.isArray(i)?e.map(i,function(e){return e!==t?e:null}):e.map(this.tabs,function(e,i){return i!==t?i:null})),this._setupDisabled(i))},disable:function(t){var i=this.options.disabled;if(!0!==i){if(void 0===t)i=!0;else{if(t=this._getIndex(t),-1!==e.inArray(t,i))return;i=e.isArray(i)?e.merge([t],i).sort():[t]}this._setupDisabled(i)}},load:function(t,i){t=this._getIndex(t);var s=this,n=this.tabs.eq(t),o=n.find(".ui-tabs-anchor"),a=this._getPanelForTab(n),r={tab:n,panel:a},l=function(e,t){"abort"===t&&s.panels.stop(!1,!0),n.removeClass("ui-tabs-loading"),a.removeAttr("aria-busy"),e===s.xhr&&delete s.xhr};this._isLocal(o[0])||(this.xhr=e.ajax(this._ajaxSettings(o,i,r)),this.xhr&&"canceled"!==this.xhr.statusText&&(n.addClass("ui-tabs-loading"),a.attr("aria-busy","true"),this.xhr.done(function(e,t,n){setTimeout(function(){a.html(e),s._trigger("load",i,r),l(n,t)},1)}).fail(function(e,t){setTimeout(function(){l(e,t)},1)})))},_ajaxSettings:function(t,i,s){var n=this;return{url:t.attr("href"),beforeSend:function(t,o){return n._trigger("beforeLoad",i,e.extend({jqXHR:t,ajaxSettings:o},s))}}},_getPanelForTab:function(t){var i=e(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}}),e.widget("ui.tooltip",{version:"1.11.4",options:{content:function(){var t=e(this).attr("title")||"";return e("<a>").text(t).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_addDescribedBy:function(t,i){var s=(t.attr("aria-describedby")||"").split(/\s+/);s.push(i),t.data("ui-tooltip-id",i).attr("aria-describedby",e.trim(s.join(" ")))},_removeDescribedBy:function(t){var i=t.data("ui-tooltip-id"),s=(t.attr("aria-describedby")||"").split(/\s+/),n=e.inArray(i,s);-1!==n&&s.splice(n,1),t.removeData("ui-tooltip-id"),(s=e.trim(s.join(" ")))?t.attr("aria-describedby",s):t.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable(),this.liveRegion=e("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body)},_setOption:function(t,i){var s=this;if("disabled"===t)return this[i?"_disable":"_enable"](),void(this.options[t]=i);this._super(t,i),"content"===t&&e.each(this.tooltips,function(e,t){s._updateContent(t.element)})},_disable:function(){var t=this;e.each(this.tooltips,function(i,s){var n=e.Event("blur");n.target=n.currentTarget=s.element[0],t.close(n,!0)}),this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.is("[title]")&&t.data("ui-tooltip-title",t.attr("title")).removeAttr("title")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"))})},open:function(t){var i=this,s=e(t?t.target:this.element).closest(this.options.items);s.length&&!s.data("ui-tooltip-id")&&(s.attr("title")&&s.data("ui-tooltip-title",s.attr("title")),s.data("ui-tooltip-open",!0),t&&"mouseover"===t.type&&s.parents().each(function(){var t,s=e(this);s.data("ui-tooltip-open")&&((t=e.Event("blur")).target=t.currentTarget=this,i.close(t,!0)),s.attr("title")&&(s.uniqueId(),i.parents[this.id]={element:this,title:s.attr("title")},s.attr("title",""))}),this._registerCloseHandlers(t,s),this._updateContent(s,t))},_updateContent:function(e,t){var i,s=this.options.content,n=this,o=t?t.type:null;if("string"==typeof s)return this._open(t,e,s);(i=s.call(e[0],function(i){n._delay(function(){e.data("ui-tooltip-open")&&(t&&(t.type=o),this._open(t,e,i))})}))&&this._open(t,e,i)},_open:function(t,i,s){var n,o,a,r,l=e.extend({},this.options.position);function position(e){l.of=e,o.is(":hidden")||o.position(l)}s&&((n=this._find(i))?n.tooltip.find(".ui-tooltip-content").html(s):(i.is("[title]")&&(t&&"mouseover"===t.type?i.attr("title",""):i.removeAttr("title")),n=this._tooltip(i),o=n.tooltip,this._addDescribedBy(i,o.attr("id")),o.find(".ui-tooltip-content").html(s),this.liveRegion.children().hide(),s.clone?(r=s.clone()).removeAttr("id").find("[id]").removeAttr("id"):r=s,e("<div>").html(r).appendTo(this.liveRegion),this.options.track&&t&&/^mouse/.test(t.type)?(this._on(this.document,{mousemove:position}),position(t)):o.position(e.extend({of:i},this.options.position)),o.hide(),this._show(o,this.options.show),this.options.show&&this.options.show.delay&&(a=this.delayedShow=setInterval(function(){o.is(":visible")&&(position(l.of),clearInterval(a))},e.fx.interval)),this._trigger("open",t,{tooltip:o})))},_registerCloseHandlers:function(t,i){var s={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var s=e.Event(t);s.currentTarget=i[0],this.close(s,!0)}}};i[0]!==this.element[0]&&(s.remove=function(){this._removeTooltip(this._find(i).tooltip)}),t&&"mouseover"!==t.type||(s.mouseleave="close"),t&&"focusin"!==t.type||(s.focusout="close"),this._on(!0,i,s)},close:function(t){var i,s=this,n=e(t?t.currentTarget:this.element),o=this._find(n);o?(i=o.tooltip,o.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&!n.attr("title")&&n.attr("title",n.data("ui-tooltip-title")),this._removeDescribedBy(n),o.hiding=!0,i.stop(!0),this._hide(i,this.options.hide,function(){s._removeTooltip(e(this))}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),t&&"mouseleave"===t.type&&e.each(this.parents,function(t,i){e(i.element).attr("title",i.title),delete s.parents[t]}),o.closing=!0,this._trigger("close",t,{tooltip:i}),o.hiding||(o.closing=!1))):n.removeData("ui-tooltip-open")},_tooltip:function(t){var i=e("<div>").attr("role","tooltip").addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||"")),s=i.uniqueId().attr("id");return e("<div>").addClass("ui-tooltip-content").appendTo(i),i.appendTo(this.document[0].body),this.tooltips[s]={element:t,tooltip:i}},_find:function(e){var t=e.data("ui-tooltip-id");return t?this.tooltips[t]:null},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr("id")]},_destroy:function(){var t=this;e.each(this.tooltips,function(i,s){var n=e.Event("blur"),o=s.element;n.target=n.currentTarget=o[0],t.close(n,!0),e("#"+i).remove(),o.data("ui-tooltip-title")&&(o.attr("title")||o.attr("title",o.data("ui-tooltip-title")),o.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}})})?s.apply(t,n):s)||(e.exports=o)},370:function(e,t,i){var s=i(397),n=[{quote:"Geographers never get lost. They just do accidental field work.",author:"Nicholas Chrisman"},{quote:"Geography is just physics slowed down, with a couple of trees stuck in it.",author:"Terry Pratchett"},{quote:"Not all those who wander are lost.",author:"J. R. R. Tolkien"},{quote:"In that Empire, the Art of Cartography attained such Perfection that the map of a single Province occupied the entirety of a City.",author:"Jorge Luis Borges"},{quote:"X marks the spot",author:"Indiana Jones"},{quote:"It's turtles all the way down.",author:null},{quote:"Remember: no matter where you go, there you are.",author:null},{quote:"Without geography, you're nowhere!",author:"Jimmy Buffett"},{quote:"our earth is a globe / whose surface we probe /<br />no map can replace her / but just try to trace her",author:"Steve Waterman"},{quote:"Everything happens somewhere.",author:"Doctor Who"},{quote:"A map is the greatest of all epic poems. Its lines and colors show the realization of great dreams.",author:"Gilbert H. Grosvenor"},{quote:"Everything is related to everything else,<br />but near things are more related than distant things.",author:"Tobler's first law of geography"},{quote:"Hic Sunt Dracones",author:null},{quote:"Here be dragons",author:null},{quote:"Stand in the place where you live / Now face North /<br/>Think about direction / Wonder why you haven't before",author:"R.E.M"},{quote:"The virtue of maps, they show what can be done with limited space, they foresee that everything can happen therein.",author:"Jos\xe9 Saramago"}];e.exports=function(){var e=Math.round(Math.random()*(n.length-1));return s(n[e])}},378:function(e,t,i){"use strict";i.d(t,"b",function(){return hasFeatureEnabled}),i.d(t,"a",function(){return hasDOEnabled});var s=i(32),n=i.n(s);function hasFeatureEnabled(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;return!!t.feature_flags&&n()(e=t.feature_flags).call(e,i)>-1}function hasDOEnabled(){return!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).do_enabled}},390:function(e,t,i){var s=i(4),n=i(1361),o=i(954);e.exports=s.extend({initialize:function initialize(e){if(!e.createContentView)throw new Error("createContentView factory function is mandatory");if(!e.editorModel)throw new Error("editorModel is required");this.template=this.options.template||n,this._createContentView=e.createContentView,this._editorModel=e.editorModel,this._createControlView=e.createControlView,this._createActionView=e.createActionView,this._infoboxModel=e.infoboxModel,this._infoboxCollection=e.infoboxCollection,this._editorModel.on("change:edition",this._setStyleMenu,this),this.add_related_model(this._editorModel)},render:function render(){var e,t,i,s;return this.clearSubViews(),this.$el.empty(),this.$el.html(this.template()),e=this._createContentView(),this._content().html(e.render().el),this.addView(e),this._infoboxModel&&(s=new o({infoboxModel:this._infoboxModel,infoboxCollection:this._infoboxCollection}),this._info().html(s.render().el),this.addView(s)),this._createControlView&&(t=this._createControlView(),this._controls().html(t.render().el),this.addView(t)),this._createActionView&&(i=this._createActionView(),this._actions().html(i.render().el),this.addView(i)),this._setStyleMenu(),this},_content:function _content(){return this.$(".js-content")},_controls:function _controls(){return this.$(".js-controls")},_actions:function _actions(){return this.$(".js-actions")},_info:function _info(){return this.$(".js-info")},_setStyleMenu:function _setStyleMenu(){this.$(".js-theme").toggleClass("is-dark",this._editorModel.isEditing())}})},392:function(e,t,i){var s=i(1),n=i(454),o=i(74),a={second:{display:"HH:mm:ss",unit:"s"},minute:{display:"HH:mm - MMM Do, YYYY",unit:"m"},hour:{display:"HH:00 - MMM Do, YYYY",unit:"h"},day:{display:"MMM Do, YYYY",unit:"d"},week:{display:"MMM Do, YYYY",unit:"w"},month:{display:"MMM YYYY",unit:"M"},quarter:{display:"[Q]Q YYYY",unit:"Q"},year:{display:"YYYY",unit:"y"},decade:{display:"YYYY",unit:"y"}},r={formatNumber:function(e,t){if(!s.isNumber(e)||0===e)return e;var i=n.format(".2s"),o=0,a=Math.abs(e);if(e>1e3)return e=i(e)+(t?" "+t:"");a>100?o=0:a>10?o=1:a>1?o=2:a>0&&(o=Math.max(Math.ceil(Math.abs(Math.log(a)/Math.log(10)))+2,3));var r=(e=e.toFixed(o)).match(/(\.0+)$/);return r&&(e=e.replace(r[0],"")),e},formatDate:function(e){return n.time.format("%Y-%m-%d")(e)},formatTime:function(e){return n.time.format("%H:%M:%S %d/%m/%Y")(e)},timeFactory:function(e){return n.time.format(e)},formatValue:function(e){return s.isNumber(e)?r.formatNumber(e):s.isDate(e)?r.formatDate(e):e},timestampFactory:function(e,t){return function(i){if(!s.has(a,e))return"-";var n=a[e],r=o.unix(i).utc();return s.isFinite(t)&&r.utcOffset(t/60),r.format(n.display)}}};e.exports=r},394:function(e,t,i){var s=i(6);e.exports=function(e,t,i){this._xhr&&this._xhr.abort();var n=this._xhr=s.Model.prototype.sync.apply(this,arguments);return n.always(function(){t._xhr=null}),n}},395:function(e,t,i){i(23),i(40),i(64),e.exports={getUnqualifiedName:function getUnqualifiedName(e){if(!e)return null;var t=e.split(".");return 2===t.length?this._getUnquotedName(t[1]):this._getUnquotedName(e)},getUsername:function getUsername(e){if(!e)return null;var t=e.split(".");return 2===t.length?this._getUnquotedName(t[0]):""},_getUnquotedName:function _getUnquotedName(e){return e&&e.replace(/"/g,"")},_quoteIfNeeded:function _quoteIfNeeded(e){return e=this._getUnquotedName(e),/^[a-zA-Z_][a-zA-Z0-9_$]*$/.test(e)||(e='"'+e+'"'),e},getQualifiedTableName:function getQualifiedTableName(e,t,i){return(t?i?this._quoteIfNeeded(t)+".":"public.":"")+this._quoteIfNeeded(this.getUnqualifiedName(e))},isSameTableName:function isSameTableName(e,t,i){var s=this._getTableNameParts(e,i),n=this._getTableNameParts(t,i);return s[0]===n[0]&&s[1]===n[1]},_getTableNameParts:function _getTableNameParts(e,t){var i=this.getUnqualifiedName(e);return[this.getUsername(e)||t,i]}}},396:function(e,t,i){var s=i(76),n=i(3),o=i(1),a=i(6),r=i(4),l=i(198),c=i(3040),h=i(816),d=i(812),u=i(3039),p=i(452),g=i(453);e.exports=r.extend({module:"components:custom-list:custom-view",options:{showSearch:!0,allowFreeTextInput:!1,typeLabel:"column",itemTemplate:p,itemView:g},className:"CDB-Box-modal CustomList",tagName:"div",events:{mouseover:"_onMouseOver",mouseout:"_onMouseOut"},initialize:function initialize(e){if(!e.collection){if(!e.options)throw new Error("options array {value, label} is required");this.collection=new l(e.options)}e.position&&this.$el.css(e.position),this.options=o.extend({},this.options,e),this._selectModel=this.options.selectModel,this.options.mouseOverAction&&(this._mouseOverAction=this.options.mouseOverAction),this.options.mouseOutAction&&(this._mouseOutAction=this.options.mouseOutAction),this.model=new a.Model({query:"",visible:!1}),this._initBinds()},render:function render(){return this.$el.empty(),this.clearSubViews(),(this.options.showSearch||this.options.actions)&&this._renderHeader(),this.options.showSearch&&this._renderSearch(),this.options.actions&&this._renderActions(),this._renderList(),this.options.showSearch&&this._focusSearch(),this},_initBinds:function _initBinds(){var e,t;n(e=this.model).call(e,"change:visible",this._onVisibleChanged,this),n(t=this.model).call(t,"change:query",this._setActionsVisibility,this)},_renderHeader:function _renderHeader(){this.$el.prepend(d())},_renderSearch:function _renderSearch(){this._searchView=new c({template:this.options.searchTemplate,typeLabel:this.options.typeLabel,searchPlaceholder:this.options.searchPlaceholder,model:this.model}),this.$(".js-header").prepend(this._searchView.render().el),this.addView(this._searchView)},_renderActions:function _renderActions(){o.each(this.options.actions,function(e){var t=new u(e);this.$(".js-actions").append(t.render().el),this.addView(t)},this)},_setActionsVisibility:function _setActionsVisibility(){this.$(".js-actions").toggleClass("u-hide",""!==this.model.get("query"))},_focusSearch:function _focusSearch(){var e;s(n(e=function _context3(){if(this._searchView){this._searchView.focus();var e=this._searchView.$("input"),t=e.val();e.val(t+" "),e.val(t)}}).call(e,this),0)},_renderList:function _renderList(){var e;this._listView=new h({model:this.model,allowFreeTextInput:this.options.allowFreeTextInput,collection:this.collection,typeLabel:this.options.typeLabel,itemView:this.options.itemView,itemTemplate:this.options.itemTemplate,size:this.options.size,mouseOverAction:this._mouseOverAction,mouseOutAction:this._mouseOutAction}),this.$el.append(this._listView.render().el),this._listView.highlight(),this.addView(this._listView),n(e=this._listView).call(e,"customEvent",function(e,t){this.trigger(e,t,this)},this)},highlight:function highlight(){this._listView.highlight()},_onVisibleChanged:function _onVisibleChanged(e,t){this._resetQuery(),this._toggleVisibility(),t?this.render():this.clearSubViews()},_resetQuery:function _resetQuery(){var e=this._selectModel&&this._selectModel.get(this.options.typeLabel)||"";this.model.set("query",e);var t=this.collection.findWhere({val:e});e&&!t&&this.collection.add({label:e,val:e})},show:function show(){this.model.set("visible",!0)},hide:function hide(){this.trigger("hidden",this),this.model.set("visible",!1)},toggle:function toggle(){this.model.set("visible",!this.model.get("visible"))},_toggleVisibility:function _toggleVisibility(){this.$el.toggleClass("is-visible",!!this.model.get("visible"))},isVisible:function isVisible(){return this.model.get("visible")},_onMouseOver:function _onMouseOver(){this._mouseOverAction&&this._mouseOverAction()},_onMouseOut:function _onMouseOut(){this._mouseOutAction&&this._mouseOutAction()},remove:function remove(){this._listView&&this._listView.clean(),r.prototype.remove.call(this)}})},4:function(e,t,i){var s=i(1),n=i(6),o=n.View.extend({classLabel:"cdb.core.View",constructor:function(e){this.options=s.defaults(e,this.options),this._models=[],this._subviews={},n.View.call(this,e),o.viewCount++,o.views[this.cid]=this,this._created_at=new Date},add_related_model:function(e){if(!e)throw new Error("added non valid model");this._models.push(e)},addView:function(e){this._subviews[e.cid]=e,e._parent=this},removeView:function(e){delete this._subviews[e.cid]},clearSubViews:function(){s(this._subviews).each(function(e){e.clean()}),this._subviews={}},clean:function(){return this.trigger("clean"),this.clearSubViews(),this._parent&&(this._parent.removeView(this),this._parent=null),this.remove(),this.allOff(),o.viewCount--,delete o.views[this.cid],this},allOff:function(){this.off(),this.model&&this.model.off&&this.model.off(null,null,this);var e=this;s(this._models).each(function(t){t.off(null,null,e)}),this._models=[]},show:function(){this.$el.show()},hide:function(){this.$el.hide()},retrigger:function(e,t,i){i||(i=e);var s=this;t.bind&&t.bind(e,function(){s.trigger(i)},s),this.add_related_model(t)},killEvent:function(e){e&&e.preventDefault&&e.preventDefault(),e&&e.stopPropagation&&e.stopPropagation()},cleanTooltips:function(){this.$(".tipsy").remove()}},{viewCount:0,views:{},extendEvents:function(e){return function(){return s.extend(e,this.constructor.__super__.events)}},runChecker:function(){s.each(o.views,function(e){s.each(e,function(t,i){"_parent"!==i&&e.hasOwnProperty(i)&&t instanceof o&&void 0===e._subviews[t.cid]&&(console.log("========="),console.log("untracked view: "),console.log(t.el),console.log("parent"),console.log(e.el),console.log(" "))})})}});e.exports=o},444:function(e,t,i){i(23),i(101);var s=i(89),n=i(1),o=/^([a-z]+)(\d*)$/,a=function newId(e,t){if(!e||!e.match)throw new Error("invalid id");var i=e.match(o);if(i[2]=i[2]||-1,i&&3===i.length){var n=i[1],a=s(i[2],10)+t;return n+Math.max(a,0)}throw new Error("invalid id")};e.exports={next:function next(e){return a(e,1)},prev:function prev(e){return a(e,-1)},letter:function letter(e){if(!e||!n.isString(e))return"";var t=e.match(/^([a-z]+)/);return n.isArray(t)&&t[0]||""},sequence:function sequence(e){if(e&&n.isString(e)){var t=e.match(/(\d+$)/);return n.isArray(t)&&t[0]||void 0}},changeLetter:function changeLetter(e,t){return t+e.match(/(\d+)$/)[0]}}},445:function(e,t,i){i(37);var s=i(237),n=i(199),o=i(44),a=i(195),r=i(1),l=i(1079).getVersion("latest"),c=i(612),h={},d=[void 0,null,"",NaN];e.exports={hasType:function hasType(e){return!!l.analyses[e]},paramsForType:function paramsForType(e){if(!this.hasType(e))throw new Error("no analysis params found for type: "+e);return r.clone(l.analyses[e].params)},validate:function validate(e){var t={},i=this.parse(e),s=this.paramsForType(e.type);for(var n in s){var l=s[n],c=i[n];if(!l.optional||void 0!==c)switch(l.type){case"node":c||(t[n]=_t("data.analysis-definition-node-model.validation.invalid-source"));break;case"number":isNaN(c)&&(t[n]=_t("data.analysis-definition-node-model.validation.invalid-value"));break;case"enum":r.contains(a(l),c)||(t[n]=_t("data.analysis-definition-node-model.validation.invalid-enum",{expectedValues:o(a(l))}));break;default:null===c&&(t[n]=_t("data.analysis-definition-node-model.validation.missing-required"))}}if(!r.isEmpty(t))return t},parse:function parse(e){var t,i=r.extend({},e),o=this.paramsForType(e.type);for(var a in o){var l=o[a],c=i[a];if(l.optional&&r.contains(d,c))delete i[a];else switch(l.type){case"node":i[a]=n(t=c||"").call(t);break;case"number":i[a]=s(c,10);break;case"boolean":i[a]="true"===c||!0===c;break;default:r.contains(d,c)?i[a]=null:r.isString(c)&&(i[a]=n(c).call(c))}}return i},getSourceNamesForAnalysisType:function getSourceNamesForAnalysisType(e){if(!h[e]){var t=[],i=this.paramsForType(e);for(var s in i){"node"===i[s].type&&t.push(s)}h[e]=t}return h[e]},getDefaultCartoCSSForType:function getDefaultCartoCSSForType(){return r.template(["#layer['mapnik::geometry_type'=1] {","  marker-width: <%= point.fill.size.fixed %>;","  marker-fill: <%= point.fill.color.fixed %>;","  marker-fill-opacity: <%= point.fill.color.opacity %>;","  marker-line-color: <%= point.stroke.color.fixed %>;","  marker-line-width: <%= point.stroke.size.fixed %>;","  marker-line-opacity: <%= point.stroke.color.opacity %>;","  marker-type: ellipse;","  marker-allow-overlap: true;","}","#layer['mapnik::geometry_type'=2] {","  line-color: <%= line.stroke.color.fixed %>;","  line-width: <%= line.stroke.size.fixed %>;","  line-opacity: 1;","}","#layer['mapnik::geometry_type'=3] {","  polygon-fill: <%= polygon.fill.color.fixed %>;","  polygon-opacity: <%= polygon.fill.color.opacity %>;","  ::outline {","    line-color: <%= polygon.stroke.color.fixed%>;","    line-width: <%= polygon.stroke.size.fixed %>;","    line-opacity: <%= polygon.stroke.color.opacity %>;","  }","}"].join("\n"))(c.simple)},isValidInputGeometryForType:function isValidInputGeometryForType(e,t){var i=this.getValidInputGeometriesForType(t);return r.contains(i,e)||r.contains(i,"*")},getValidInputGeometriesForType:function getValidInputGeometriesForType(e){var t=this.paramsForType(e),i=[];for(var s in t){var n=t[s];"node"===n.type&&(i=r.union(i,n.geometry))}return i}}},446:function(e,t,i){var s=i(3),n=i(28),o=i(636).default,a=i(635).default,r=i(18),l=i(2704),c=function(){"use strict";function PasswordValidatedForm(){o(this,PasswordValidatedForm)}return a(PasswordValidatedForm,null,[{key:"bindEventTo",value:function bindEventTo(e,t){var i=this,o=r(e),a=n(o).call(o,".js-save");s(a).call(a,"click",function(e){var n;if(e.preventDefault(),e.stopPropagation(),!t.passwordConfirmationNeeded)return t.onPasswordTyped?t.onPasswordTyped():i.addPasswordToForm(o);i.showPasswordModal({modalService:t.modals,onPasswordTyped:t.onPasswordTyped||s(n=i.addPasswordToForm).call(n,i,o)})})}},{key:"showPasswordModal",value:function showPasswordModal(e){e.modalService.create(function(t){return new l({modalModel:t,onPasswordTyped:e.onPasswordTyped,updatePassword:e.updatePassword})})}},{key:"addPasswordToForm",value:function addPasswordToForm(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=document.createElement("input");s.setAttribute("type","hidden"),s.setAttribute("name","password_confirmation"),s.setAttribute("value",t),e.prepend(s),i.doNotSubmit||e.submit()}}]),PasswordValidatedForm}();e.exports=c},447:function(e,t,i){var s=i(18),n=i(2823);e.exports=n.extend({show:function show(){var e=s.Deferred();return this.delegateEvents(),this.$el.css({marginTop:"down"===this.options.verticalPosition?"-10px":"10px",opacity:0,display:"block"}).animate({margin:"0",opacity:1},{duration:this.options.speedIn,complete:function complete(){e.resolve()}}),this.trigger("onDropdownShown",this.el),e.promise()},openAt:function openAt(e,t){var i=s.Deferred();return this.$el.css({top:t,left:e,width:this.options.width}).addClass(("up"===this.options.verticalPosition?"vertical_top":"vertical_bottom")+" "+("right"===this.options.horizontalPosition?"horizontal_right":"horizontal_left")+" tick_"+this.options.tick),this.modelView.set({open:!0}),s.when(this.show()).done(function(){i.resolve()}),i.promise()},hide:function hide(e){if(this.isOpen){var t=this;this.$el.animate({marginTop:"down"===t.options.verticalPosition?"10px":"-10px",opacity:0},this.options.speedOut,function(){s(t.options.target).removeClass("selected"),t.$el.hide(),e&&e(),t.trigger("onDropdownHidden",t.el)})}else e&&e()}})},451:function(e,t,i){var s=i(3),n=i(1),o=i(18),a=window.MutationObserver,r=8,l=8,c=function Manager(e,t,i){this.id=e,this.reference=t,this.popup=i,this.state={position:"bottom",scroll:0},i.attr("data-cid",e),i.attr("data-dialog",e)};c.prototype={append:function append(e){this.mode=e;var t=this.popup.get(0),i=this.reference.get(0);"float"===e?document.body.appendChild(t):i.appendChild(t)},track:function track(){var e,t;"float"===this.mode&&(this.observer=function initObserver(e,t){if(a){var i=new a(t);return i.observe(e.get?e.get(0):e,{childList:!0,subtree:!0}),i}}(this.popup,s(e=this.onChangeMutation).call(e,this)),this.emitter=function initScroll(e){return e.closest(".js-perfect-scroll")}(this.reference),this.repositionBinded=n.throttle(s(t=this.reposition).call(t,this),15),this.emitter&&this.emitter.on("ps-scroll-x",this.repositionBinded).on("ps-scroll-y",this.repositionBinded),this.reposition())},onChangeMutation:function onChangeMutation(e){n.each(e,function(e){var t=o(e.target),i=t.attr("data-cid");i||(i=t.closest("[data-cid]").attr("data-cid")),i===this.id&&this.repositionBinded()},this)},reposition:function reposition(){if("float"===this.mode&&this.emitter){var e,t=this.emitter.get(0).scrollTop,i=o(window).height(),s=this.reference,n=this.popup,a=this.state,c=s.offset(),h=n.outerHeight(),d=c.top+s.outerHeight()+r,u=c.top-h-l;a.scroll===t?"top"===a.position?u<=0?(e=d,a.position="bottom"):e=u:d+h+l>=i?(e=u,a.position="top"):e=d:d+h+l>=i?(e=u,a.position="top"):(e=d,a.position="bottom"),e=e<0?r:Math.min(e,i-h-l),n.css({top:e,left:c.left}),a.scroll=t}},untrack:function untrack(){this.observer&&this.observer.disconnect(),this.emitter&&this.emitter.off("ps-scroll-x",this.repositionBinded).off("ps-scroll-y",this.repositionBinded)},destroy:function destroy(){this.untrack();var e=document.querySelector("[data-dialog="+this.id+"]");e&&e.parentNode.removeChild(e),this.emitter=null,this.reference=null,this.popup=null}},e.exports=c},453:function(e,t,i){var s=i(1),n=i(4);e.exports=n.extend({options:{template:i(452)},className:"CDB-ListDecoration-item CustomList-item js-listItem",tagName:"li",events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave",click:"_onClick"},initialize:function initialize(e){this.options=s.extend({},this.options,e),this.model.on("change",this.render,this)},render:function render(){this.$el.empty(),this.clearSubViews();var e=null==this.model.getName()?"null":this.model.getName();return this.$el.append(this.options.template(s.extend({typeLabel:this.options.typeLabel,isSelected:this.model.get("selected"),isDisabled:this.model.get("disabled"),isDestructive:this.model.get("destructive"),name:e,val:this.model.getValue(),options:this.model.get("renderOptions")}))),this.$el.attr("data-val",this.model.getValue()).toggleClass("is-disabled",!!this.model.get("disabled")),this},_onMouseLeave:function _onMouseLeave(){this.$el.removeClass("is-highlighted")},_onMouseEnter:function _onMouseEnter(){this.$el.addClass("is-highlighted")},_onClick:function _onClick(e){this.killEvent(e),this.model.set({selectedClass:e.target.classList,selected:!0})}})},468:function(e,t,i){"use strict";i.r(t),i.d(t,"routesToAddDatasets",function(){return routesToAddDatasets}),i.d(t,"routesToAddMaps",function(){return routesToAddMaps}),i.d(t,"routesToAddLayers",function(){return routesToAddLayers});i(34),i(67);var s,n=i(12),o=i(7),a=i.n(o),r=i(53),l=i(579),c=i(70),h=function EditConnectionPage(){return i.e(17).then(i.bind(null,3644))},d=function DatasetsConnectionPage(){return Promise.all([i.e(4),i.e(15)]).then(i.bind(null,3631))},u=function NewDatasetPage(){return Promise.all([i.e(0),i.e(7),i.e(14)]).then(i.bind(null,3640))},p=function AddLocalFile(){return i.e(13).then(i.bind(null,3630))},g=function ArcgisConnector(){return i.e(12).then(i.bind(null,3629))},m=function TwitterConnector(){return Promise.all([i.e(0),i.e(1),i.e(11)]).then(i.bind(null,3628))},f=[{path:"/datasets/:filter?",component:function Data(){return i.e(28).then(i.bind(null,3637))},meta:{title:function title(){return"Data | CARTO"}},children:[{path:"connections",name:"your-connections",component:function ConnectionsPage(){return Promise.all([i.e(8),i.e(42)]).then(i.bind(null,940))},meta:{title:function title(){return"Your Connections | CARTO"}},children:a()(s=[{path:"new-connection",name:"new-connection",component:function NewConnectionPage(){return Promise.all([i.e(7),i.e(18)]).then(i.bind(null,3633))},meta:{title:function title(){return"Your connections | CARTO"}}},{path:"edit/:id",component:h,name:"edit-connection",meta:{title:function title(){return"Your connections | CARTO"}}},{path:"delete/:id",component:function DeleteConnectionPage(){return i.e(16).then(i.bind(null,3632))},name:"delete-connection",meta:{title:function title(){return"Your connections | CARTO"}}}]).call(s,Object(r.a)(getCommonConnectionsRoutes("new-connection")))},{path:"tilesets",name:"tilesets",component:function Tilesets(){return Promise.all([i.e(0),i.e(25)]).then(i.bind(null,3641))},meta:{title:function title(){return"Your tilesets | CARTO"}},children:[{path:"/tilesets/:id",name:"tileset-viewer",component:function TilesetsViewerPage(){return Promise.all([i.e(2),i.e(5),i.e(10),i.e(24)]).then(i.bind(null,3635))},meta:{title:function title(){return"Tilesets viewer | CARTO"}}}]},{path:"",component:function Datasets(){return Promise.all([i.e(0),i.e(8),i.e(27)]).then(i.bind(null,3636))},name:"datasets",props:function props(e){return{datasetId:e.query.id,createVis:/^true$/i.test(e.query.create)}},meta:{title:function title(){return"Data | CARTO"}},beforeEnter:l.b,children:Object(r.a)(routesToAddDatasets("datasets"))}]}];function getCommonConnectionsRoutes(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{mode:"dataset"},i="".concat(e,"-"),s=t.mode?"".concat(t.mode,"-"):"";return[{path:"".concat(s,"connection/:id/dataset"),name:"".concat(i,"connection-dataset"),component:d,props:Object(n.a)({backNamedRoute:e},t),meta:{title:function title(){return"Your connections | CARTO"}}},{path:"".concat(s,"new-connection/:connector"),component:h,props:Object(n.a)({backNamedRoute:e},t),name:"".concat(i,"connector-selected"),meta:{title:function title(){return"Your connections | CARTO"}}}]}function getNewDatasetRoutes(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{mode:"dataset"},s="".concat(e,"-"),n="".concat(s,"new-dataset");return a()(t=[{path:"new-".concat(i.mode),name:n,component:u,meta:{title:function title(){return"Data | CARTO"}},props:i}]).call(t,Object(r.a)(getCommonConnectionsRoutes(n,i)),[{path:"".concat(i.mode,"-add-local-file/:extension"),name:"".concat(s,"add-local-file"),component:p,meta:{title:function title(){return"Data | CARTO"}},props:i},{path:"".concat(i.mode,"-import-arcgis"),name:"".concat(s,"import-arcgis"),component:g,meta:{title:function title(){return"Data | CARTO"}},props:i},{path:"".concat(i.mode,"-import-twitter"),name:"".concat(s,"import-twitter"),component:m,meta:{title:function title(){return"Data | CARTO"}},props:i}])}function routesToAddDatasets(e){return getNewDatasetRoutes(e,{mode:"dataset"})}function routesToAddMaps(e){return getNewDatasetRoutes(e,{mode:"map"})}function routesToAddLayers(e){return getNewDatasetRoutes(e,{mode:"layer"})}c.default.state.config.cartodb_com_hosted||(f[0].children.unshift({path:"spatial-data-catalog",name:"spatial-data-catalog",component:function Catalog(){return Promise.all([i.e(0),i.e(1),i.e(3),i.e(23)]).then(i.bind(null,3643))},meta:{title:function title(){return"Spatial Data Catalog | CARTO"}}}),f.push({path:"/datasets/spatial-data-catalog/:entity_type/:entity_id",component:function CatalogDataset(){return Promise.all([i.e(0),i.e(1),i.e(4),i.e(3),i.e(22)]).then(i.bind(null,3642))},meta:{title:function title(){return"Spatial Data Catalog | CARTO"}},children:[{path:"map",name:"catalog-dataset-map",component:function CatalogDatasetMap(){return Promise.all([i.e(2),i.e(5),i.e(6),i.e(21)]).then(i.bind(null,3634))},meta:{title:function title(){return"Spatial Data Catalog | CARTO"}}},{path:"data",name:"catalog-dataset-data",component:function CatalogDatasetData(){return i.e(20).then(i.bind(null,3638))},meta:{title:function title(){return"Spatial Data Catalog | CARTO"}}},{path:"",name:"catalog-dataset-summary",component:function CatalogDatasetSummary(){return Promise.all([i.e(2),i.e(5),i.e(6),i.e(19)]).then(i.bind(null,3639))},meta:{title:function title(){return"Spatial Data Catalog | CARTO"}}}]})),c.default.state.user.do_enabled&&f[0].children.unshift({path:"subscriptions",name:"subscriptions",component:function Subscriptions(){return Promise.all([i.e(0),i.e(1),i.e(4),i.e(3),i.e(26)]).then(i.bind(null,3627))},meta:{title:function title(){return"Subscriptions | CARTO"}}}),t.default=f},469:function(e,t,i){"use strict";i.d(t,"a",function(){return setUrlParameters});i(37);var s=i(13),n=i.n(s),o=i(7),a=i.n(o),r=i(25),l=i.n(r);function setUrlParameters(e){var t,i=window.location.protocol+"//"+window.location.host+window.location.pathname,s=[],o=l()(e).categories;for(var r in o){var c,h;if(o[r].length)s.push(a()(c="".concat(r,"=")).call(c,n()(h=o[r]).call(h,function(e){return e.id}).join()))}l()(e).searchText&&s.push("search=".concat(encodeURIComponent(l()(e).searchText))),l()(e).page&&s.push("page=".concat(l()(e).page+1)),s=s.join("&");var d=a()(t="".concat(i)).call(t,s?"?".concat(s):"");window.history.pushState(null,null,d)}},470:function(e,t,i){i(37),i(34),i(23),i(88),i(101);var s=i(38),n=i(1),o=i(6).Model.extend({initialize:function initialize(e){if(!e.base_url)throw new Error("base_url is required")},urlToPath:function urlToPath(){return o.byBaseUrl(this.toString.apply(this,arguments))},pathname:function pathname(){return this.toString().match(/^.+\/\/[^\/]+(.*)$/)[1]},toString:function toString(){return this._joinArgumentsWithSlashes(this.get("base_url"),s(Array.prototype).call(arguments,0))},_joinArgumentsWithSlashes:function _joinArgumentsWithSlashes(){return n.chain(arguments).flatten().compact().value().join("/")}},{byBaseUrl:function byBaseUrl(e){return new o({base_url:e})}});e.exports=o},474:function(e,t,i){var s=i(7),n=function pluralize(e,t,i){return 2===arguments.length?pluralize.call(this,arguments[0],arguments[0]+"s",arguments[1]):1===i?e:t};n.prefixWithCount=function(e,t,i){var o;return n("1 ".concat(e),s(o="".concat(i," ")).call(o,t),i)},e.exports=n},476:function(e,t,i){var s=i(1),n=i(4),o=i(1048),a=i(706),r=[8001,8002,8005,8007];e.exports=n.extend({initialize:function initialize(e){if(!e.userModel)throw new Error("userModel is required");if(!e.configModel)throw new Error("configModel is required");if(!e.error)throw new Error("error is required");this._userModel=e.userModel,this._configModel=e.configModel,this._error=e.error},render:function render(){var e=s.contains(r,this._error.errorCode),t=this._configModel.get("upgrade_url"),i=t&&!this._configModel.get("cartodb_com_hosted")&&(!this._userModel.isInsideOrg()||this._userModel.isOrgOwner()),n=this._getTemplate(e)({errorCode:this._error.errorCode,title:this._error.title,text:this._error.what_about,itemQueueId:this._error.item_queue_id,originalUrl:this._error.originalUrl,httpResponseCode:this._error.httpResponseCode,httpResponseCodeMessage:this._error.httpRresponseCodeMessage,userCanUpgrade:i,showTrial:this._userModel.canStartTrial(),upgradeUrl:t});return this.$el.html(n),this},_getTemplate:function _getTemplate(e){var t=o;return e&&(t=a),t}})},483:function(e,t,i){var s=i(28),n=i(1),o=i(6),a=i(1878),r=i(1877),l=i(1227),c=i(1213),h=i(193),d=i(14),u=["configModel"];e.exports=o.Model.extend({url:"/api/v1/org/",initialize:function initialize(e,t){d(t,u,this),e=e||{},this.owner=new h(this.get("owner")),this.display_email=void 0!==e.admin_email&&null!=e.admin_email&&(""==e.admin_email?this.owner.email:e.admin_email);var i={organization:this,currentUserId:t&&t.currentUserId,configModel:this._configModel};this.users=new a(e.users,i),this.groups=new l(e.groups,i),this.grantables=new r(void 0,i),this.users.each(this._setOrganizationOnModel,this),this.groups.each(this._setOrganizationOnModel,this)},_setOrganizationOnModel:function _setOrganizationOnModel(e){e.organization=this},fetch:function fetch(){throw new Error("organization should not be fetch, should be static")},containsUser:function containsUser(e){var t;return!!s(t=this.users).call(t,function(t){return t.id===e.id})},isOrgAdmin:function isOrgAdmin(e){return this.owner.id===e.id||!!s(n).call(n,this.get("admins"),function(t){return t.id===e.id})},viewUrl:function viewUrl(){return new c({base_url:this.get("base_url")})},getModelType:function getModelType(){return"org"}})},489:function(e,t,i){var s=i(3),n=i(18),o=i(6),a=i(4),r=i(816),l=i(453),c=i(452),h=i(1384),d=i(623);e.exports=a.extend({options:{position:{x:0,y:0},offset:{x:0,y:15},itemTemplate:c,itemView:l},className:"CDB-Box-modal CDB-SelectItem CustomList CustomList--small",tagName:"div",initialize:function initialize(e){var t;if(!(e=e||{}).collection)throw new Error("collection option is required");if(!e.triggerElementID)throw new Error("element id is required");this._triggerElementID=e.triggerElementID,this.model=new o.Model({visible:!1}),this._onEscapePressed=s(t=this._onEscapePressed).call(t,this),this._initBinds()},_initBinds:function _initBinds(){this.model.on("change:visible",function(e,t){this.render(),t?this._initDocumentBinds():this._destroyDocumentBinds()},this),this.collection.on("change:selected",this.hide,this),this.add_related_model(this.collection)},_initDocumentBinds:function _initDocumentBinds(){n(document).on("keydown",this._onEscapePressed)},_destroyDocumentBinds:function _destroyDocumentBinds(){n(document).off("keydown",this._onEscapePressed)},render:function render(){var e,t=n("body"),i=(this.options.position.x||0)+this.options.offset.x,o=(this.options.position.y||0)+this.options.offset.y;return this.clearSubViews(),this.$el.empty(),this._renderList(),this.$el.toggle(this.isVisible()),t.append(this.el),this.$el.css(h({parentView:t,posX:i,posY:o})),this.dropdownOverlay=new d({visible:this.isVisible(),onClickAction:s(e=this.hide).call(e,this)}),this.addView(this.dropdownOverlay),this},_onEscapePressed:function _onEscapePressed(e){27===e.which&&this.hide()},_renderList:function _renderList(){this._listView=new r({model:this.model,collection:this.collection,typeLabel:"",itemView:this.options.itemView,itemTemplate:this.options.itemTemplate,size:5}),this.$el.append(this._listView.render().el),this.addView(this._listView)},show:function show(){this.model.set("visible",!0)},hide:function hide(){this.model.set("visible",!1)},toggle:function toggle(){this.model.set("visible",!this.model.get("visible"))},isVisible:function isVisible(){return this.model.get("visible")},clean:function clean(){this._destroyDocumentBinds(),a.prototype.clean.apply(this)}})},490:function(e,t){var i={background:"Plain",carto:"CartoDB",gmapsbase:"GMapsBase",tiled:"Tiled",torque:"torque",wms:"WMS"};e.exports={getType:function getType(e){var t=i[e];if(!t)throw new Error("no type found for given kind "+e);return t},getKind:function getKind(e){if(!e)throw new Error("no kind found for given type "+e);var t;for(t in i)if(i[t]===e)break;return t},isKindDataLayer:function isKindDataLayer(e){var t=i[e];return this.isTypeDataLayer(t)},isTypeDataLayer:function isTypeDataLayer(e){return this.isCartoDBType(e)||this.isTorqueType(e)},isCartoDBType:function isCartoDBType(e){return"CartoDB"===e},isTorqueType:function isTorqueType(e){return"torque"===e},isTiledType:function isTiledType(e){return"Tiled"===e},isPlainType:function isPlainType(e){return"Plain"===e},isGMapsBase:function isGMapsBase(e){return"GMapsBase"===e}}},491:function(e,t,i){i(255),e.exports={COLORS:["#11A579","#E83f74","#9F5DC8","#EF8205","#29B3B2","#E54F3B","#59BB12","#EF57BA","#E2AF00","#12AADE"],getColorForLetter:function getColorForLetter(e){if(!e)return this.COLORS[0];var t=((e.charCodeAt(0)-97)/this.COLORS.length%1*10).toFixed();return this.COLORS[t]||this.COLORS[0]}}},492:function(e,t,i){i(23),i(40),i(326);var s=i(199),n=i(395);e.exports={isSameQuery:function isSameQuery(e,t){if(null==e||null==t)throw new Error("Needed parameters not provided");var i=function parseQuery(e){return e.toLowerCase().replace(/\"/g,"").replace(/;/g,"")};return i(e)===i(t)},altersSchema:function altersSchema(e){return!!e&&(-1!==(e=this._removeLineBreaks(s(e).call(e))).search(/alter\s+[\w\."]+\s+/i)||-1!==e.search(/drop\s+[\w\.\"]+/i)||-1!==e.search(/^vacuum\s+[\w\.\"]+/i)||-1!==e.search(/^create\s+[\w\.\"]+/i)||-1!==e.search(/^reindex\s+[\w\.\"]+/i)||-1!==e.search(/^grant\s+[\w\.\"]+/i)||-1!==e.search(/^revoke\s+[\w\.\"]+/i)||-1!==e.search(/^cluster\s+[\w\.\"]+/i)||-1!==e.search(/^comment\s+on\s+[\w\.\"]+/i)||-1!==e.search(/^explain\s+[\w\.\"]+/i))},altersData:function altersData(e){return!!e&&(e=this._removeLineBreaks(s(e).call(e)),this.altersSchema(e)||-1!==e.search(/^refresh\s+materialized\s+view\s+[\w\.\"]+/i)||-1!==e.search(/^truncate\s+[\w\.\"]+/i)||-1!==e.search(/insert\s+into/i)||-1!==e.search(/update\s+[\w\.\-"]+\s+.*set/i)||-1!==e.search(/delete\s+from/i))},_removeLineBreaks:function _removeLineBreaks(e){return e.replace(/\r?\n|\r/g," ")},getDefaultSQL:function getDefaultSQL(e,t,i){return this.getDefaultSQLFromTableName(n.getQualifiedTableName(e,t,i))},getDefaultSQLFromTableName:function getDefaultSQLFromTableName(e){return"SELECT * FROM "+e}}},493:function(e,t){e.exports={initial:"initial",unavailable:"unavailable",unfetched:"unfetched",fetching:"fetching",fetched:"fetched",errored:"errored"}},495:function(e,t,i){var s,n,o=i(44),a=i(32),r=i(1),l=i(6);s=function getValue(e,t,i){return e&&e[t]?r.isFunction(e[t])?e[t](i):e[t]:null},n=function urlError(){throw new Error('A "url" property or function must be specified')},l.originalSync=l.sync,l.sync=function(e,t,i){var o=i.url||s(t,"url",e)||n(),r=0===a(o).call(o,"http")||0===a(o).call(o,"//");return i.url=r?o:(t._configModel||t._config||t).get("base_url")+o,"read"!==e&&t.surrogateKeys&&l.cachedSync.invalidateSurrogateKeys(s(t,"surrogateKeys")),l.originalSync(e,t,i)},l.currentSync=l.sync,l.withCORS=function(e,t,i){return i||(i={}),i.crossDomain||(i.crossDomain=!0),i.xhrFields||(i.xhrFields={withCredentials:!0}),l.currentSync(e,t,i)},l.cachedSync=function(e,t){if(!e)throw new Error("cachedSync needs a namespace as argument");var i=e,a=window.user_data&&window.user_data.username;if(!a)return l.sync;var c="cdb-cache/"+(e+="-"+a),h={_keys:function _keys(){return JSON.parse(localStorage.getItem(c)||"{}")},add:function add(e){var t=this._keys();t[e]=+new Date,localStorage.setItem(c,o(t))},invalidate:function invalidate(){var e=this._keys();r.each(e,function(e,t){localStorage.removeItem(t)}),localStorage.removeItem(c)}},d={setItem:function setItem(e,t){return localStorage.setItem(e,t),h.add(e),this},getItem:function getItem(e,t){var i=localStorage.getItem(e);r.defer(function(){t(i)})},removeItem:function removeItem(e){localStorage.removeItem(e),h.invalidate()}},u=function cached(e,i,o){var a=o.url||s(i,"url")||n(),r=c+"/"+a;if("read"===e){var h=o.success,u=null;o.success=function(e,t,i){u&&i.responseText===u||(d.setItem(r,i.responseText),h(e,t,i))},d.getItem(r,function(e){u=e,e&&h(JSON.parse(e),"success")})}else d.removeItem(r);return(t||l.sync)(e,i,o)};return u.invalidate=function(){h.invalidate()},u.cache=d,l.cachedSync.surrogateKeys[i]=u,u},l.cachedSync.surrogateKeys={},l.cachedSync.invalidateSurrogateKeys=function(e){r.each(e,function(e){var t=l.cachedSync.surrogateKeys[e];t?t.invalidate():console.error("Backbone sync options: surrogate key not found: "+e)})},l.syncAbort=function(){var e=arguments[1];return e._xhr&&e._xhr.abort(),e._xhr=l.sync.apply(this,arguments),e._xhr.always(function(){e._xhr=null}),e._xhr},l.delayedSaveSync=function(e,t){var i=r.debounce(e,t);return function(t,s,n){return"create"===t||"update"===t?i(t,s,n):e(t,s,n)}},l.saveAbort=function(){var e=this;this._saving&&this._xhr&&this._xhr.abort(),this._saving=!0;var t=l.Model.prototype.save.apply(this,arguments);return this._xhr=t,t.always(function(){e._saving=!1}),t}},502:function(e,t,i){var s=i(171),n=i(56),o=i(18),a=i(4),r={};!function importAllIconTemplates(){var e,t=i(741);n(e=s(t).call(t)).call(e,function(e){r[e]=t(e)})}(),e.exports=a.extend({constructor:function constructor(e){this.placeholder=this._preinitializeWithPlaceholder(e&&e.placeholder),a.prototype.constructor.call(this,e)},initialize:function initialize(e){if(!e||!e.icon)throw new Error("An icon is required to render IconView");if(this.icon=e.icon,this.iconTemplate=this._getIconTemplate(this.icon),!this.iconTemplate)throw new Error("The selected icon does not have any available template")},render:function render(){return this.$el.html(this.iconTemplate),this.placeholder&&this.placeholder.replaceWith(this.$el),this},_getIconTemplate:function _getIconTemplate(e){var t="./"+this.icon+".tpl";return r[t]},_preinitializeWithPlaceholder:function _preinitializeWithPlaceholder(e){if(e){var t=o(e);return this.tagName=t.prop("tagName"),this.className=t.attr("class"),t}}})},503:function(e,t,i){var s=i(6),n=i(1),o=i(550),a=i(619),r=i(743),l=["PUBLIC","LINK","PRIVATE"];e.exports=s.Model.extend({urlRoot:function urlRoot(){return this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("visualization")+"/viz"},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");this._configModel=t.configModel,this._initModels()},_initModels:function _initModels(){var e=this.get("table");n.isEmpty(this.get("external_source"))||(e=this.get("external_source")),this._tableModel=new o(e,{configModel:this._configModel,parse:!0}),this.get("permission")&&(this._permissionModel=new a(this.get("permission"),{configModel:this._configModel}),this.unset("permission")),this.get("synchronization")&&(this._synchronizationModel=new r(this.get("synchronization"),{configModel:this._configModel}),this._synchronizationModel.linkToTable(this._tableModel))},isVisualization:function isVisualization(){return!1},getTableModel:function getTableModel(){return this._tableModel},getPermissionModel:function getPermissionModel(){return this._permissionModel},getSynchronizationModel:function getSynchronizationModel(){return this._synchronizationModel},vizjsonURL:function vizjsonURL(){return this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("vizjson","read","v3")+"/viz/"+this.id+"/viz.json"},isRaster:function isRaster(){return"raster"===this.get("kind")},datasetURL:function datasetURL(){return this._configModel.get("base_url")+"/dataset/"+this.getTableModel().getUnquotedName()},privacyOptions:function privacyOptions(){return l},toJSON:function toJSON(){return n.omit(this.attributes,"synchronization","stats","table")}})},504:function(e,t,i){var s=i(3),n=i(6),o=i(2994);e.exports=n.Collection.extend({model:function model(e,t){var i={};return"string"==typeof e?i.val=e:i=e,new o(i)},initialize:function initialize(){this._initBinds()},_initBinds:function _initBinds(){var e;s(e=this).call(e,"change:selected",this._onSelectedChange,this)},_onSelectedChange:function _onSelectedChange(e,t){t&&this.each(function(t){t.cid!==e.cid&&t.get("selected")&&t.set("selected",!1)})},getSelected:function getSelected(){return this.findWhere({selected:!0})},getSelectedValue:function getSelectedValue(){var e=this.getSelected();return e&&e.get("val")},getHighlighted:function getHighlighted(){return this.findWhere({highlighted:!0})}})},525:function(e,t,i){i(35),i(31);var s=i(28),n=i(25),o=i(13),a=i(3);i(31);var r=i(1),l=i(59).result,c=i(6),h=i(193),d=i(483),u=i(667),p=i(14),g=c.Model.extend({defaults:{access:"r"},isOwn:function isOwn(e){return e.id===this.get("entity").id},validate:function validate(e,t){var i=f;if(e.access!==i.READ_ONLY&&e.access!==i.READ_WRITE)return"access can't take 'r' or 'rw' values"},toJSON:function toJSON(){var e=r.pick(this.get("entity").toJSON(),"id","username","avatar_url","name");return e.username||(e.username=e.name,delete e.name),{type:this.get("type")||"user",entity:e,access:this.get("access")}}}),m=["configModel"],f=c.Model.extend({urlRoot:"/api/v1/perm",initialize:function initialize(e,t){var i,s;p(t,m,this),this.acl=new c.Collection,this.owner=null,this._generateOwner(),this._generateAcl(),a(i=this).call(i,"change:owner",this._generateOwner,this),a(s=this).call(s,"change:acl",this._generateAcl,this)},_generateOwner:function _generateOwner(){this.owner||(this.owner=new h(void 0,{configModel:this._configModel})),this.owner.set(this.get("owner"))},_generateAcl:function _generateAcl(){this.acl.reset([],{silent:!0}),r.each(this.get("acl"),function(e){var t;switch(e.type){case"user":t=new h(e.entity,{configModel:this._configModel});break;case"org":t=new d(e.entity,{configModel:this._configModel});break;case"group":t=new u(e.entity,{configModel:this._configModel});break;default:throw new Error("Unknown ACL item type: "+e.type)}this._grantAccess(t,e.access)},this)},cleanPermissions:function cleanPermissions(){this.acl.reset()},hasAccess:function hasAccess(e){return this.hasReadAccess(e)},hasReadAccess:function hasReadAccess(e){return!!this.findRepresentableAclItem(e)},hasWriteAccess:function hasWriteAccess(e){return l(this.findRepresentableAclItem(e),"get","access")===f.READ_WRITE},canChangeReadAccess:function canChangeReadAccess(e){return this._canChangeAccess(e)},canChangeWriteAccess:function canChangeWriteAccess(e){return(!e.isBuilder||e.isBuilder())&&this._canChangeAccess(e,function(e){return l(e,"get","access")!==f.READ_WRITE})},_canChangeAccess:function _canChangeAccess(e){var t=this.findRepresentableAclItem(e);return this.isOwner(e)||!t||t===this._ownAclItem(e)||l(arguments,1,t)||!1},grantWriteAccess:function grantWriteAccess(e){this._grantAccess(e,this.constructor.READ_WRITE)},grantReadAccess:function grantReadAccess(e){this._grantAccess(e,this.constructor.READ_ONLY)},revokeWriteAccess:function revokeWriteAccess(e){this.grantReadAccess(e)},revokeAccess:function revokeAccess(e){var t=this._ownAclItem(e);t&&this.acl.remove(t)},getOwner:function getOwner(){return this.owner},isOwner:function isOwner(e){return r.result(this.owner,"id")===r.result(e,"id")},toJSON:function toJSON(){return{entity:this.get("entity"),acl:this.acl.toJSON()}},getUsersWithAnyPermission:function getUsersWithAnyPermission(){var e,t;return o(e=n(t=this.acl.chain()).call(t,this._hasTypeUser)).call(e,this._getEntity).value()},isSharedWithOrganization:function isSharedWithOrganization(){return this.acl.any(this._hasTypeOrg)},clone:function clone(){var e=r.clone(this.attributes);return delete e.id,new f(e,{configModel:this._configModel})},overwriteAcl:function overwriteAcl(e){this.acl.reset(e.acl.models)},findRepresentableAclItem:function findRepresentableAclItem(e){if(this.isOwner(e))return this._newAclItem(e,this.constructor.READ_WRITE);return this._findMostPrivilegedAclItem(["_ownAclItem","_organizationAclItem","_mostPrivilegedGroupAclItem"],function(t){return this[t](e)})},_hasTypeUser:function _hasTypeUser(e){return"user"===e.get("type")},_getEntity:function _getEntity(e){return e.get("entity")},_hasTypeOrg:function _hasTypeOrg(e){return"org"===e.get("type")},_isOrganization:function _isOrganization(e){return e instanceof d},_ownAclItem:function _ownAclItem(e){var t;if(e&&r.isFunction(e.isNew)||console.error("model is required to find an ACL item"),!e.isNew())return s(t=this.acl).call(t,function(t){return t.get("entity").id===e.id})},_organizationAclItem:function _organizationAclItem(e){var t=r.result(e.collection,"organization")||e.organization;if(t)return this._ownAclItem(t)},_mostPrivilegedGroupAclItem:function _mostPrivilegedGroupAclItem(e){var t=r.result(e.groups,"models");if(t)return this._findMostPrivilegedAclItem(t,this._ownAclItem)},_findMostPrivilegedAclItem:function _findMostPrivilegedAclItem(e,t){for(var i,s=0,n=e[s];n&&l(i,"get","access")!==f.READ_WRITE;n=e[++s])i=t.call(this,n)||i;return i},_grantAccess:function _grantAccess(e,t){var i=this._ownAclItem(e);if(i)i.set("access",t);else{if(!(i=this._newAclItem(e,t)).isValid())throw new Error(t+" is not a valid ACL access");this.acl.add(i)}},_newAclItem:function _newAclItem(e,t){var i=e.get("type")||e.getModelType();return new g({type:i,entity:e,access:t})}},{READ_ONLY:"r",READ_WRITE:"rw"});e.exports=f},546:function(e,t,i){var s=i(3),n=i(4),o=i(1360),a=i(58);e.exports=n.extend({className:"Toggle",events:{"click .js-input":"_onClick"},initialize:function initialize(e){if(!e.model)throw new Error("togglerModel should be provided");this.model=e.model,this._onChange=this.model.get("onChange"),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.empty(),this.$el.append(o({labels:this.model.get("labels"),checked:this.model.get("active"),disabled:this.model.get("disabled")&&this.model.get("isDisableable")})),this._initViews(),this},_initViews:function _initViews(){if(this.model.get("tooltip")){var e,t=new a({el:this.$(".js-input"),gravity:"s",offset:0,title:s(e=function _context(){return this.model.get("tooltip")}).call(e,this)});this.addView(t)}},_initBinds:function _initBinds(){this.listenTo(this.model,"change:active",this.render),this.listenTo(this.model,"change:disabled",this.render)},_onClick:function _onClick(){this.model.set("active",!this.model.get("active"))}})},547:function(e,t,i){var s=i(76),n=i(3),o=i(4),a=i(1),r=["template","onEdit","renderOptions"],l=0;e.exports=o.extend({events:{"blur .js-input":"blur","keyup .js-input":"_onKeyUpInput"},initialize:function initialize(e){var t,i;a.each(r,function(t){if(!e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this),this._onClickHandler=n(t=this._onClickHandler).call(t,this),this.edit=n(i=this.edit).call(i,this),this.save=a.debounce(this.save,200,!0),this._timeout=e.timeout||200},render:function render(){return this._unbindEvents(),this.clearSubViews(),this.$el.empty(),this._initViews(),this._initBinds(),this},_initBinds:function _initBinds(){this.options.onClick?(this._onClick=this.options.onClick,this._title().on("click",this._onClickHandler)):this._title().on("dblclick",this.edit)},_unbindEvents:function _unbindEvents(){var e=this._title();e&&e.off("click dblclick")},_onClickHandler:function _onClickHandler(e){var t=this;1===++l&&s(function(){1===l?t._onClick&&t._onClick(e):t.edit(),l=0},this._timeout)},_initViews:function _initViews(){this.$el.append(this._template(this._renderOptions)),this.setElement(this.$(".Inline-editor"))},_backupText:function _backupText(){this._oldText=this.$(".js-title").text()},_restoreText:function _restoreText(){this.$(".js-input").val(this._oldText)},edit:function edit(){this._backupText(),this.$(".js-input").val(this._oldText),this.$(".js-input").prop("readonly",!1).show().focus(),this.$(".js-input").get(0).setSelectionRange(0,this.$(".js-input").val().length)},getValue:function getValue(){return this.$(".js-input").val()},_title:function _title(){return this.$(".js-title")},hide:function hide(){this.$(".js-input").prop("readonly",!0).hide()},blur:function blur(){this.save(),this.hide()},save:function save(){var e=this.getValue();e===this._oldText||a.isEmpty(e)||this._onEdit&&this._onEdit(e)},clean:function clean(){this._unbindEvents(),o.prototype.clean.call(this)},_onKeyUpInput:function _onKeyUpInput(e){27===e.which&&(this._restoreText(),this.hide()),13===e.which&&(this.$(".js-input").blur(),this.save())}})},548:function(e,t,i){var s=i(244),n=i(1),o=i(1419),a=i(612),r=i(962),l=i(59);e.exports=n.defaults({generateAttributes:function generateAttributes(e){return n.extend({},this._getFillAttrs(e),this._getStrokeAttrs(e),{blending:r.blending},this._getAggrAttrs(e),this._getLabelsAttrs())},_getFillAttrs:function _getFillAttrs(e){var t=s(a.simple[e]);return{fill:l.cloneObject(t)}},_getStrokeAttrs:function _getStrokeAttrs(e){var t=a.simple[e].stroke;return{stroke:l.cloneObject(t)}},_getAggrAttrs:function _getAggrAttrs(){var e=r.aggregation;return{aggregation:l.cloneObject(e)}},_getLabelsAttrs:function _getLabelsAttrs(){var e=r.labels;return{labels:l.cloneObject(e)}}},o)},550:function(e,t,i){i(23),i(40),i(64);var s=i(13),n=i(1),o=i(6),a=i(2908),r=i(1276),l=i(619),c=i(743),h=i(395);e.exports=o.Model.extend({idAttribute:"name",defaults:{fetched:!1,schema:[]},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");this._configModel=t.configModel},urlRoot:function urlRoot(){return this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("table")+"/tables"},parse:function parse(e,t){var i=t&&t.configModel||this._configModel;e.table_visualization&&!n.isEmpty(e.table_visualization)&&(e=n.extend({},e.table_visualization,{geometry_types:e.geometry_types})),e.synchronization&&(this._syncModel?this._syncModel.set(e.synchronization):this._syncModel=new c(e.synchronization,{configModel:i})),e.permission&&(this._permissionModel?this._permissionModel.set(e.permission):this._permissionModel=new l(e.permission,{configModel:i}));var o=n.defaults({fetched:!0},e),r=s(n).call(n,e.schema,function(e){return{name:e[0],type:e[1]}},this);return this.columnsCollection?this.columnsCollection.reset(r):this.columnsCollection=new a(r,{configModel:i,tableModel:this}),o},isOwner:function isOwner(e){return!(!e||!this._permissionModel)&&this._permissionModel.isOwner(e)},getUnqualifiedName:function getUnqualifiedName(){return h.getUnqualifiedName(this.get("name"))},getOwnerName:function getOwnerName(){var e=this.get("name");if(!e)return null;var t=e.split(".");return 2===t.length?t[0].replace(/"/g,""):this._permissionModel?this._permissionModel.getOwner().get("username"):""},getUnquotedName:function getUnquotedName(){var e=this.get("name");return e&&e.replace(/"/g,"")},getGeometryType:function getGeometryType(){var e=this.get("geometry_types"),t=[];if(!n.isArray(e))return[];for(var i in e){var s=e[i];if(s){var o=r(s.toLowerCase());o&&t.push(o)}}return n.uniq(t)},getPermissionModel:function getPermissionModel(){return this._permissionModel},isReadOnly:function isReadOnly(e){return this.isSync()||!this.hasWriteAccess(e)},isSync:function isSync(){var e=this.getSyncModel(),isSync=e&&e.get("id");return!!isSync},hasWriteAccess:function hasWriteAccess(e){return!(!e||!this._permissionModel)&&this._permissionModel.hasWriteAccess(e)},getSyncModel:function getSyncModel(){return this._syncModel}})},551:function(e,t,i){i(23),i(40);var s=i(44),n=i(6),o=i(1);e.exports=n.Model.extend({getAttributes:function getAttributes(){return JSON.parse(s(this.attributes))},_generateClassName:function _generateClassName(e){return e?e.replace(/\s+/g,"").replace(/[^a-zA-Z_0-9 ]/g,"").toLowerCase():""},parse:function parse(e){var t={};return o.extend(t,e.options,{id:e.id,className:this._generateClassName(e.options.urlTemplate),type:"Tiled",order:e.order,parent_id:e.parent_id}),t},toJSON:function toJSON(){return{kind:"tiled",options:o.clone(o.omit(this.attributes,["order","id"])),order:this.get("order"),id:this.id}},getValue:function getValue(){return this.get("val")},validateTemplateURL:function validateTemplateURL(e){var t=["a","b","c"],i=new Image;i.onload=e.success,i.onerror=e.error,i.src=this.get("urlTemplate").replace(/\{s\}/g,function(){return t[Math.floor(3*Math.random())]}).replace(/\{x\}/g,"0").replace(/\{y\}/g,"0").replace(/\{z\}/g,"0")}})},552:function(e,t,i){i(37),i(31);var s=i(28),n=i(25),o=i(32),a=i(76),r=i(3);i(31);var l=i(4),c=i(1),h=i(908),d=i(2953),u=i(752),p=i(751),g=i(750),m=i(749),f=i(2952);i(2951)(h),i(2950)(h),i(2949)(h),i(2948)(h),i(2947)(h),i(2945)(h),i(2944)(h),i(2943)(h);var _=[27,13],v={"color-picker":d};e.exports=l.extend({module:"components:code-mirror:code-mirror-view",className:"Editor-content",options:{readonly:!1,lineNumbers:!0,autocompleteChars:3},initialize:function initialize(e){if(!e)throw new Error("options for codemirror are required.");if(!e.model)throw new Error("Model for codemirror is required.");if(void 0===e.model.get("content")&&void 0===e.placeholder)throw new Error("Content property or placeholder for codemirror is required.");if(!e.tips)throw new Error("tip messages are required");this._autocompleteChars=e.autocompleteChars||this.options.autocompleteChars,this._mode=e.mode||"cartocss",this._addons=e.addons,this._hints=e.hints,this._autocompletePrefix=e.autocompletePrefix,this._autocompleteTriggers=e.autocompleteTriggers,this._autocompleteSuffix=e.autocompleteSuffix,this._errorTemplate=e.errorTemplate||g,this._warningTemplate=e.warningTemplate||m,this._warnings=null,this._tips=e.tips,this._lineWithErrors=[],this._onInputRead=r(c).call(c,this._onKeyUpEditor,this),this._placeholder=e.placeholder},render:function render(){return this.$el.html(u({content:this.model.get("content"),tips:this._tips.join(" "),warnings:this._warnings})),this._initViews(),this._bindEvents(),this._showErrors(),this},_initViews:function _initViews(){var e,t,i,s,n,o=c.defaults(c.extend({},this.model.toJSON()),this.options),l=o.readonly,d=o.lineNumbers,u={"Ctrl-S":r(e=this.triggerApplyEvent).call(e,this),"Cmd-S":r(t=this.triggerApplyEvent).call(t,this),"Ctrl-Space":r(i=this._completeIfAfterCtrlSpace).call(i,this)};this.editor=h.fromTextArea(this.$(".js-editor").get(0),{lineNumbers:d,theme:"material",mode:this._mode,scrollbarStyle:"simple",lineWrapping:!0,readOnly:l,extraKeys:u,placeholder:this._placeholder}),this.editor.on("change",c.debounce(r(s=this._onCodeMirrorChange).call(s,this),150),this),c.isEmpty(this._addons)||c.each(this._addons,function(e){var t=new(0,v[e])({editor:this.editor});r(t).call(t,"codeSaved",this.triggerApplyEvent,this),this.$el.append(t.el),this.addView(t)},this),this._hints&&this.editor.on("keyup",this._onInputRead),this._toggleReadOnly(),a(r(n=function _context5(){this.editor&&this.editor.refresh()}).call(n,this),0)},_completeIfAfterCtrlSpace:function _completeIfAfterCtrlSpace(e){var t=this._autocompletePrefix,i={},s=e.getCursor();return t&&e.getRange(h.Pos(s.line,s.ch-t.length),s)!==t&&(i={autocompletePrefix:t}),this._completeAfter(e,i)},updateHints:function updateHints(e){this._hints=e},_onKeyUpEditor:function _onKeyUpEditor(e,t){var i=t.keyCode,s=this._hints,r=this._autocompleteChars-1,l=this._autocompletePrefix;if(-1===o(_).call(_,i)){var d=this;this._autocompleteTimeout&&clearTimeout(this._autocompleteTimeout),this._autocompleteTimeout=a(function(){var t={},i=e.getCursor(),a=e.getTokenAt(i).string;return a=a.toLowerCase(),l&&e.getRange(h.Pos(i.line,i.ch-l.length),i)!==l&&(t={autocompletePrefix:l}),d._completeAfter(e,t,function(){if(a.length>r)return n(c).call(c,s,function autocompleteHandler(e){var t=c.isObject(e)?e.text:e;return t=t.toLowerCase(),-1!==o(t).call(t,a)}).length>0||l&&l===a})},150)}},_onCodeMirrorChange:function _onCodeMirrorChange(){this.trigger("codeChanged")},_completeAfter:function _completeAfter(e,t,i){return i&&!i()||e.state.completionActive||this._showAutocomplete(e,c.extend({},t)),h.Pass},_showAutocomplete:function _showAutocomplete(e,t){var i=t&&t.autocompletePrefix;h.showHint(e,h.hint["custom-list"],{completeSingle:!1,list:this._hints,autocompletePrefix:i,autocompleteSuffix:this._autocompleteSuffix})},_showWarning:function _showWarning(e){var t=this._getWarning(),i=t.children().length;e&&!i&&t.append(this._warningTemplate(e))},_hideWarning:function _hideWarning(){var e=this._getWarning();e.children().length&&e.children()[0].remove()},_bindEvents:function _bindEvents(){var e=this;this.editor.on("change",function(t,i){var s=e.getContent(),n=e._containsDataService(s);n?e._showWarning("Quota error "+n):e._hideWarning(),e.model.set("content",s,{silent:!0})}),this.model.on("change:content",function(){this.setContent(this.model.get("content"))},this),this.model.on("change:readonly",this._toggleReadOnly,this),this.model.on("change:errors",function(){this._showErrors()},this),this.model.on("undo redo",function(){this.setContent(this.model.get("content"))},this)},_toggleReadOnly:function _toggleReadOnly(){var e=!!this.model.get("readonly");this.editor.setOption("readOnly",e),e?(this.editor.setOption("theme",""),this._getInfo().hide()):(this.editor.setOption("theme","material"),this._getInfo().show())},search:function search(e,t){var i=this.editor.getSearchCursor(e,null,!0);return s(i).call(i),i.pos},markReadOnly:function markReadOnly(e,t){this.editor.markText(e,t,{readOnly:!0,inclusiveLeft:!0});for(var i=e.line;i<=t.line;i++)this.editor.addLineClass(i,"background","CodeMirror-readonlyLine")},setContent:function setContent(e){this.editor.setValue(e)},getContent:function getContent(){return this.editor.getValue()},triggerApplyEvent:function triggerApplyEvent(){this.trigger("codeSaved",this.getContent(),this)},destroyEditor:function destroyEditor(){this.editor.off("change");var e=this.editor.getWrapperElement(),t=e.parentNode;t&&t.removeChild(e),this.editor=null},_getInfo:function _getInfo(){return this.$(".js-console")},_getConsole:function _getConsole(){return this.$(".js-console-error")},_getWarning:function _getWarning(){return this.$(".js-warning")},_getCode:function _getCode(){return this.$(".CodeMirror-code")},_containsDataService:function _containsDataService(e){return s(c).call(c,f,function(t){return-1!==o(e).call(e,t)})},_removeErrors:function _removeErrors(){this._getConsole().empty(),c.each(this._lineWithErrors,function(e){s(e).call(e,".CodeMirror-bullet").remove(),s(e).call(e,".CodeMirror-linenumber").removeClass("has-error")}),this._lineWithErrors=[]},_showErrors:function _showErrors(){var e=this.model.get("errors");this._removeErrors(),e&&e.length>0&&c.each(e,function(e){this._renderError(e),this._renderBullet(e)},this)},_renderBullet:function _renderBullet(e){var t,i=e.line;i&&((t=this._getCode().children().eq(+i-1)).append(p),s(t).call(t,".CodeMirror-linenumber").addClass("has-error"),this._lineWithErrors.push(t))},_renderError:function _renderError(e){this._getConsole().append(this._errorTemplate(e))},clean:function clean(){this.destroyEditor(),l.prototype.clean.apply(this)}})},553:function(e,t,i){var s=i(3),n=i(1),o=i(4),a=i(2995);e.exports=o.extend({module:"components:carousel-form-view",className:"js-aggregationTypes",initialize:function initialize(e){if(!e.collection)throw new Error("Carousel collection is required");if(!e.template)throw new Error("template is required");this.template=e.template,this._initBinds()},render:function render(){var e=this.collection.getSelected(),t=e&&e.getName();return this.$el.html(this.template({name:t})),this._initViews(),this},_initBinds:function _initBinds(){var e;s(e=this.collection).call(e,"change:highlighted",this._onChangeHighlighted,this)},_initViews:function _initViews(){var e=new a(n.extend(this.options,{collection:this.collection}));if(!this.$(".js-selector").length)throw new Error("HTML element with js-selector class is required");this.$(".js-selector").append(e.render().el),e.initScroll(),this.addView(e)},_onChangeHighlighted:function _onChangeHighlighted(){var e=this.collection.getHighlighted()||this.collection.getSelected();if(e){var t=this.$(".js-highlight");t&&t.text(e.getName())}}})},555:function(e,t,i){i(23),i(64);var s=i(570),n=i(28),o=i(18),a=i(4),r=i(59),l={width:"18px",height:"18px"},c=i(1).template("0 0 <%- w %> <%- h %>");e.exports=a.extend({initialize:function initialize(e){if(!e.imageClass)throw new Error("Image class is mandatory.");this._imageClass=e.imageClass,this._imageURL=e.imageUrl,this._color=e.color,this._lastImage={url:null,content:null}},render:function render(){return this.$el.empty(),this._loadImage(),this},_loadImage:function _loadImage(){if(this._imageURL){if(this._isSVG(this._imageURL))this._loadSVG();else{var e=o('<img crossorigin="anonymous"/>');for(var t in e.attr("class",this._imageClass+" js-image"),e.attr("src",this._imageURL+"?req=markup"),l)e.attr(t,l[t]);this.$el.append(e)}}},_loadSVG:function _loadSVG(){var e=this;this._requestImageURL(this._imageURL,function(t){var i=t.cloneNode(!0),s=o(i);(s=s.removeAttr("xmlns:a")).attr("class",e._imageClass+" js-image");var a={w:18,h:18};for(var r in s.attr("viewBox")||(s.attr("height")&&s.attr("width")&&(a={w:i.width.baseVal.value,h:i.height.baseVal.value}),s.attr("viewBox",c(a))),l)s.attr(r,l[r]);e.$el.append(s),s.css("fill",e._color),n(s).call(s,"g").css("fill","inherit"),n(s).call(s,"path").css("fill","inherit"),n(s).call(s,"rect").each(function(e,t){var i=o(t);"none"!==i.css("fill")&&i.css("fill","inherit")})})},_requestImageURL:function _requestImageURL(e,t){var i=this,s=e+"?req=ajax";this._lastImage.url===s?t&&t(this._lastImage.content):o.ajax(s).done(function(e){i._lastImage.url=s;var n=i._lastImage.content=e.getElementsByTagName("svg")[0];t&&t(n)}).fail(function(){throw new Error("Couldn't get "+s+" file.")})},updateImageColor:function updateImageColor(e){this.$(".js-image").css("fill",e)},_isSVG:function _isSVG(e){if(!e)return!1;var t=e.split("?")[0];return t&&s(r).call(r,t.toUpperCase(),"SVG")}})},557:function(e,t,i){i(35);var s=i(56),n=i(13),o=i(1),a=i(4),r=i(259),l=i(241),c=i(1561);e.exports=function(e,t){var i=(t=t||{}).tabPaneItemLabelOptions,h=n(e).call(e,function(e){var t;return s(t=["label","createContentView"]).call(t,function(t){if(!e[t])throw new Error(t+" should be provided")}),{name:e.name,selected:e.selected,disabled:e.disabled,tooltip:e.tooltip,label:e.label,selectedChild:e.selectedChild,createButtonView:function createButtonView(){return new c(o.extend({model:this},i))},createContentView:function createContentView(){return e.createContentView&&e.createContentView()||new a}}}),d=new l(h),u=t.tabPaneOptions;return new r(o.extend({collection:d},u))}},561:function(e,t,i){var s=i(3),n=i(4),o=i(18),a=i(1063),r=i(560);e.exports=n.extend({className:"Pagination",events:{"click .js-listItem":"_paginate"},initialize:function initialize(e){var t;if(this._routerModel=e.routerModel,this.router&&!this.model.hasUrl())throw new Error("since router is set the model must have a url method set too");this.template=e.template||r,s(t=this.model).call(t,"change",this.render,this)},render:function render(){return this.model.shouldBeVisible()?(this.$el.html(this.template({m:this.model,pagesCount:this.model.pagesCount(),currentPage:this.model.get("current_page")})),this.$el.addClass(this.className),this.delegateEvents()):this.$el.html(""),this},_paginate:function _paginate(e){this._routerModel?a.apply(this,arguments):this.model.hasUrl()||this.killEvent(e);var t=o(e.target).data("page");this.model.set("current_page",t)}})},562:function(e,t,i){var s=i(38),n=i(6),o=i(1);e.exports=n.Model.extend({defaults:{total_count:0,per_page:10,current_page:1,display_count:5,extras_display_count:1,url_to:void 0},pagesCount:function pagesCount(){return Math.max(Math.ceil(this.get("total_count")/this.get("per_page")),1)},isCurrentPage:function isCurrentPage(e){return this.get("current_page")===e},shouldBeVisible:function shouldBeVisible(){var e=this.pagesCount();return this.get("total_count")>0&&e>1&&this.get("current_page")<=e},urlTo:function urlTo(e){if(this.hasUrl())return this.get("url_to")(e)},hasUrl:function hasUrl(){return"function"==typeof this.get("url_to")},pagesToDisplay:function pagesToDisplay(){var e;return e=this._inLowRange()?1:this._inHighRange()?this.get("current_page")-this._startOffset():this.pagesCount()-this.get("display_count")+1,e=Math.max(e,1),this._withExtraPages(o.range(e,this._rangeEnd(e)))},_withExtraPages:function _withExtraPages(e){var t=this.pagesCount(),i=this.get("extras_display_count"),n=o.range(1,i+1),a=o.range(t-i+1,t+1),r=e[0]-s(n).call(n,-1)[0];2===r?n.push(e[0]-1):r>2&&n.push(-1);var l=a[0]-s(e).call(e,-1);return 2===l&&a.unshift(a[0]-1),l>2&&a.unshift(-2),o.union(n,e,a)},_inLowRange:function _inLowRange(){return this.get("current_page")<this._startOffset()},_inHighRange:function _inHighRange(){return this.get("current_page")<this._highBoundary()},_highBoundary:function _highBoundary(){return this.pagesCount()-this._startOffset()},_startOffset:function _startOffset(){return Math.floor(this.get("display_count")/2)},_rangeEnd:function _rangeEnd(e){return Math.min(e+this.get("display_count"),this.pagesCount()+1)}})},579:function(e,t,i){"use strict";i.d(t,"a",function(){return checkFilters}),i.d(t,"d",function(){return mapsBeforeEnter}),i.d(t,"c",function(){return externalMapsBeforeEnter}),i.d(t,"b",function(){return datasetsBeforeEnter});var s=i(25),n=i.n(s),o=i(12),a=(i(3),i(70)),r=i(289);function checkFilters(e,t,i,s,l){var c=Object(o.a)({},i.params,{},i.query);if(n()(c)&&!Object(r.c)(n()(c)))return l({name:e});a.default.dispatch("".concat(t,"/setURLOptions"),c),l()}function mapsBeforeEnter(e,t,i){a.default.dispatch("maps/resetFilters"),checkFilters("maps","maps",e,0,i)}function externalMapsBeforeEnter(e,t,i){a.default.dispatch("externalMaps/init").then(function(){a.default.dispatch("externalMaps/resetFilters"),checkFilters("externalMaps","externalMaps",e,0,i)})}function datasetsBeforeEnter(e,t,i){a.default.dispatch("datasets/resetFilters"),checkFilters("datasets","datasets",e,0,i)}},58:function(e,t,i){var s=i(25),n=i(28),o=i(1),a=i(4);i(3400),e.exports=a.extend({options:{gravity:"s",opacity:1,fade:!0},events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave"},initialize:function initialize(e){if(!e.el)throw new Error("Element is needed to have tipsy tooltip working");this._mouseEnterAction=e.mouseEnterAction,this._mouseLeaveAction=e.mouseLeaveAction,this._tipsyOpenedManually="manual"===e.trigger,this._initTipsy()},_initTipsy:function _initTipsy(){var e=o.clone(this.options);"auto"===e.gravity&&(e.gravity=this.getOptimalGravity(e.gravityConfiguration&&e.gravityConfiguration.preferredGravities||["s","n","e","w"],e.gravityConfiguration&&e.gravityConfiguration.margin||0,window)),e.title||(e.title=this.getTitleFromDataAttribute),this.$el.tipsy(e),this.tipsy=this.$el.data("tipsy")},_onMouseEnter:function _onMouseEnter(){this._mouseEnterAction&&this._mouseEnterAction()},_onMouseLeave:function _onMouseLeave(){this._mouseLeaveAction&&this._mouseLeaveAction()},setOffset:function setOffset(e){this.tipsy.options.offset=e},showTipsy:function showTipsy(){this.$el.tipsy("show")},hideTipsy:function hideTipsy(){this.$el.tipsy("hide")},getElement:function getElement(){return this.el},getOptimalGravity:function getOptimalGravity(e,t,i){return function(s){if(!s)return e[0]||"n";var a=this.getBoundingClientRect(),c={n:"bottom",s:"top",w:"right",e:"left"},h={top:i.pageYOffset+t,right:i.innerWidth+i.pageXOffset-t,bottom:i.innerHeight+i.pageYOffset-t,left:i.pageXOffset+t},d={top:a.top-s.offsetHeight,right:a.left+a.width+s.offsetWidth,bottom:a.top+a.height+s.offsetHeight,left:a.left-s.offsetWidth},u="",p=n(o).call(o,e,function(e){var t=c[e],i=r(t,h[t],d[t]);return!i||"top"!==t&&"bottom"!==t||(u=l(c,h,d)),i});return p?p+u:e[0]}},getTitleFromDataAttribute:function getTitleFromDataAttribute(){return this.getAttribute("data-tooltip")},destroyTipsy:function destroyTipsy(){this.tipsy&&(this.tipsy.hide(),this.$el.unbind("mouseleave mouseenter")),this._tipsyOpenedManually&&this.hideTipsy(),this.$el.removeData("tipsy"),delete this.tipsy},clean:function clean(){this.destroyTipsy()}});var r=function isTooltipInsideViewport(e,t,i){return"top"===e||"left"===e?t<=i:"right"===e||"bottom"===e?t>=i:void 0},l=function getTooltipBodyGravity(e,t,i){var n=s(o).call(o,["e","w"],function(s){var n=e[s];return r(n,t[n],i[n])});return 1===n.length?n[0]:""}},584:function(e,t,i){"use strict";i.d(t,"a",function(){return storageAvailable});i(35);function storageAvailable(e){try{var t=window[e],i="__storage_test__";return t.setItem(i,i),t.removeItem(i),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==t.length}}},59:function(e,t,i){i(37),i(255),i(34),i(23),i(88),i(101),i(40),i(64);var s=i(44),n=i(237),o=i(32),a=i(430),r=i(38),l=i(89),c=i(1),h=i(84);e.exports={isURL:function isURL(e){return!!e&&/^((http|https|ftp)\:\/\/)/g.test(e)},isBlank:function isBlank(e){return!e||/^\s*$/.test(e)},readablizeBytes:function readablizeBytes(e,t){if(!e||isNaN(e))return 0;var i=Math.floor(Math.log(e)/Math.log(1024)),s=(e/Math.pow(1024,Math.floor(i))).toFixed(2);return t&&(s=l(s,10)),s+" "+["bytes","kB","MB","GB","TB","PB"][i]},readizableNumber:function readizableNumber(e){return e>=1e9?(e/1e9).toFixed(1)+"G":e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e},formatNumber:function formatNumber(e){if(!e)return"0";var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")},result:function result(e,t){if(null==e)return null;var i=e[t];return c.isFunction(i)?i.apply(e,r(Array.prototype).call(arguments,2)):i},getFileExtension:function getFileExtension(e){return e?e.substr(a(e).call(e,".")+1):""},pad:function pad(e,t){for(var i=e+"";i.length<t;)i="0"+i;return i},formatDate:function formatDate(e){if(!e.time)throw new Error;if(void 0===e.month)throw new Error;if(void 0===e.year)throw new Error;if(!e.day)throw new Error;var t=l(e.month+1,10),i=function padZero(e){return(e=String(e))<10&&1===e.length?"0"+e:e};return e.year+"-"+i(t)+"-"+i(e.day)+"T"+e.time+"Z"},rgbToHex:function rgbToHex(e,t,i){function componentToHex(e){var t=e.toString(16);return 1===t.length?"0"+t:t}return"#"+componentToHex(e)+componentToHex(t)+componentToHex(i)},isValidHex:function isValidHex(e){return!!e.match(/(^#?[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i)},sanitizeHex:function sanitizeHex(e){return this.isValidHex(e)?e:"#FFFFFF"},hexToRGB:function hexToRGB(e){e||(e="#FFFFFF");e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,i,s){return t+t+i+i+s+s});var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:l(t[1],16),g:l(t[2],16),b:l(t[3],16)}:null},hexToRGBA:function hexToRGBA(e,t){var i=this.hexToRGB(e);return t=null!=t?function roundToTwo(e){return+(Math.round(e+"e+2")+"e-2")}(t):1,i?"rgba("+[i.r,i.g,i.b,t].join(", ")+")":e},stripHTML:function stripHTML(e,t){t=(((t||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return e&&"string"==typeof e?e.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(e,i){return o(t).call(t,"<"+i.toLowerCase()+">")>-1?e:""}):""},escapeHTML:function escapeHTML(e){return c.escape(e)},sanitizeString:function sanitizeString(e){return e.replace(/[^a-z0-9\s]/gi,"").replace(/[_\s]/g,"_")},isNumeric:function isNumeric(e){return!isNaN(n(e))&&isFinite(e)},formatDecimalPositions:function formatDecimalPositions(e){var t,i=+e,s=0;if(isNaN(i)||0===i)return e;(t=Math.abs(i))>10?s=1:t>.01&&(s=Math.min(Math.ceil(Math.abs(Math.log(t)/Math.log(10)))+2,2));var n=(e=e.toFixed(s)).match(/(\.0+)$/);return n&&(e=e.replace(n[0],"")),e},removeNewLines:function removeNewLines(e){return e.replace(/(\r\n|\n|\r)/gm,"")},replaceLastSpaceWithNbsp:function replaceLastSpaceWithNbsp(e){var t=a(e).call(e," ");return e.substr(0,t)+"\xa0"+e.substr(t+1)},endsWith:function endsWith(e,t){return-1!==o(e).call(e,t,e.length-t.length)},cloneObject:function cloneObject(e){return e?JSON.parse(s(e)):e},capitalize:function capitalize(e){return e?e.charAt(0).toUpperCase()+r(e).call(e,1):e},sanitizeHtml:function sanitizeHtml(e){return h.core.sanitize.sanitize(e||"")},hasValue:function hasValue(e){return null!==e&&void 0!==e&&""!==e&&!("number"==typeof e&&isNaN(e))},isValidEmail:function isValidEmail(e){return/^([^@]+)@([^@]+)\.([^@\.]+)$/i.test(e)}}},594:function(e,t,i){var s=i(171),n=i(32),o=i(1),a=i(4);e.exports=a.extend({initialize:function initialize(){this.tabs={},this.activeTab=null,this.activePane=null},addTab:function addTab(e,t,i){if(i=i||{active:!0},void 0!==this.tabs[e])console.debug(e+"already added");else{if(this.tabs[e]=t.cid,this.addView(t),void 0!==i.after){var s=this.$el.children()[i.after];t.$el.insertAfter(s)}else i.prepend?this.$el.prepend(t.el):this.$el.append(t.el);this.trigger("tabAdded",e,t),i.active?this.active(e):t.hide()}},getPreviousPane:function getPreviousPane(){var e=o.toArray(this.tabs),t=o.toArray(this._subviews),i=n(o).call(o,e,this.activePane.cid)-1;return i<0&&(i=t.length-1),t[i]},getNextPane:function getNextPane(){var e=o.toArray(this.tabs),t=o.toArray(this._subviews),i=1+n(o).call(o,e,this.activePane.cid);return i>t.length-1&&(i=0),t[i]},getPane:function getPane(e){var t=this.tabs[e];return this._subviews[t]},getActivePane:function getActivePane(){return this.activePane},size:function size(){return o.size(this.tabs)},clean:function clean(){this.removeTabs(),a.prototype.clean.call(this)},removeTab:function removeTab(e){if(void 0!==this.tabs[e]){var t=this.tabs[e];this._subviews[t].clean(),delete this.tabs[e],this.activeTab==e&&(this.activeTab=null),o.size(this.tabs)&&this.active(s(o).call(o,this.tabs)[0])}},removeTabs:function removeTabs(){for(var e in this.tabs){var t=this.tabs[e];this._subviews[t].clean(),delete this.tabs[e]}this.activeTab=null},active:function active(e){var t=this.tabs[e];if(void 0!==t){if(this.activeTab!==e){var i=this._subviews[t];if(this.activeTab){var s=this._subviews[this.tabs[this.activeTab]];s.hide(),this.trigger("tabDisabled",this.activeTab,s),this.trigger("tabDisabled:"+this.activeTab,s),s.deactivated&&s.deactivated()}i.show(),i.activated&&i.activated(),this.activeTab=e,this.activePane=i,this.trigger("tabEnabled",e,i),this.trigger("tabEnabled:"+e,i)}return this.activePane}},render:function render(){return this},each:function each(e){var t=this;o.each(this.tabs,function(i,s){e(s,t.getPane(s))})}})},607:function(e,t,i){var s=i(3),n=i(4),o=i(1),a=i(86),r=i(264),l=["errorTitle","loadingTitle","runAction","modalModel"];e.exports=n.extend({className:"Dialog-content",initialize:function initialize(e){o.each(l,function(t){if(!e[t])throw new Error(t+" is required");this["_"+t]=e[t]},this)},render:function render(){var e;return this.clearSubViews(),this.$el.html(a({title:this._loadingTitle})),this._runAction({error:s(e=this._renderErrorView).call(e,this)}),this},_renderErrorView:function _renderErrorView(e){var t=new r({title:this._errorTitle,desc:e});this.$el.html(t.render().el),this.addView(t)}})},608:function(e,t,i){var s=i(1);e.exports=function escapeHTML(e){return s.escape(e)}},609:function(e,t,i){var s=i(350),n=new(i(373))({locale:"en",phrases:s.en}),o=n.t.bind(n),a={"aggregate-intersection":{title:o("analyses.aggregate-intersection.short-title")},"bounding-box":{title:o("analyses.bounding-box.short-title")},"bounding-circle":{title:o("analyses.bounding-circle.short-title")},buffer:{title:o("analyses.area-of-influence.short-title")},centroid:{title:o("analyses.centroid.short-title")},"convex-hull":{title:o("analyses.convex-hull.short-title")},"concave-hull":{title:o("analyses.concave-hull.short-title")},"filter-by-node-column":{title:o("analyses.filter-by-node-column.short-title")},"filter-category":{title:o("analyses.filter.short-title")},"filter-range":{title:o("analyses.filter.short-title")},"georeference-city":{title:o("analyses.georeference.short-title")},"georeference-ip-address":{title:o("analyses.georeference.short-title")},"georeference-country":{title:o("analyses.georeference.short-title")},"georeference-long-lat":{title:o("analyses.georeference.short-title")},"georeference-postal-code":{title:o("analyses.georeference.short-title")},"georeference-street-address":{title:o("analyses.georeference.short-title")},"georeference-admin-region":{title:o("analyses.georeference.short-title")},intersection:{title:o("analyses.filter-intersection.short-title")},kmeans:{title:o("analyses.kmeans.short-title")},"line-to-single-point":{title:o("analyses.connect-with-lines.short-title")},"line-source-to-target":{title:o("analyses.connect-with-lines.short-title")},"line-sequential":{title:o("analyses.connect-with-lines.short-title")},merge:{title:o("analyses.merge.short-title")},moran:{title:o("analyses.moran-cluster.short-title")},"routing-sequential":{title:o("analyses.routing.short-title")},"routing-to-layer-all-to-all":{title:o("analyses.routing.short-title")},"routing-to-single-point":{title:o("analyses.routing.short-title")},sampling:{title:o("analyses.sampling.short-title")},"spatial-markov-trend":{title:o("analyses.spatial-markov-trend.short-title")},"trade-area":{title:o("analyses.area-of-influence.short-title")},"weighted-centroid":{title:o("analyses.centroid.short-title")},closest:{title:o("analyses.find-nearest.short-title")},"deprecated-sql-function":{title:o("analyses.deprecated-sql-function.short-title")}};e.exports={MAP:a,title:function(e){return function(e){var t=""===e?"unknown":e;return a[t]||{title:o("analyses."+t)}}(e).title}}},610:function(e,t,i){var s=i(1);e.exports={COLORS:["#11A579","#E83f74","#9F5DC8","#EF8205","#29B3B2","#E54F3B","#59BB12","#EF57BA","#E2AF00","#12AADE"],letter:function(e){if(!e||!s.isString(e))return"";var t=e.match(/^([a-z]+)/);return s.isArray(t)&&t[0]||""},getColorForLetter:function(e){if(!e)return this.COLORS[0];var t=((e.charCodeAt(0)-97)/this.COLORS.length%1*10).toFixed();return this.COLORS[t]||this.COLORS[0]}}},611:function(e,t,i){var s=i(18),n=i(1),o=i(4),a=i(1465),r=i(623);e.exports=o.extend({className:"CDB-Dropdown",events:{"click .js-toggleLocalTimezone":"_toggleLocalTimezone","click .js-toggleNormalized":"_toggleNormalized","click .js-toggleCollapsed":"_toggleCollapsed","click .js-removeWidget":"_removeWidget","click .js-editWidget":"_editWidget"},initialize:function(e){if(!e.target)throw new Error("target is not defined");this._target=this.options.target,this._$container=this.options.container,this._initBinds()},render:function(){var e=n.defaults(this.options.flags||{},{canCollapse:!0}),t=n.defaults({},this.model.attributes,{flags:e},{local_timezone:!1,normalized:!1,collapsed:!1,show_options:!1});return this.$el.html(a(t)),this._dropdownOverlay=new r({visible:!0,onClickAction:this._onGlobalClick.bind(this)}),this.addView(this._dropdownOverlay),this},_initBinds:function(){this.add_related_model(this.model),this.model.bind("change:widget_dropdown_open",this._onChangeOpen,this),this._$container.delegate(this._target,"click",n.bind(this._toggle,this))},_removeWidget:function(){this.model.trigger("removeWidget",this.model),this._toggle()},_editWidget:function(){this.model.trigger("editWidget",this.model),this._toggle()},_bindESC:function(){s(document).bind("keyup."+this.cid,n.bind(this._onKeyUp,this))},_unbindESC:function(){s(document).unbind("keyup."+this.cid)},_onGlobalClick:function(e){this.model.set("widget_dropdown_open",!1)},_onKeyUp:function(e){if(27===e.keyCode)return this.model.set("widget_dropdown_open",!1),!1},_onChangeOpen:function(){this.model.get("widget_dropdown_open")?this._open():this._close()},_toggleCollapsed:function(){var e=!this.model.get("collapsed");this.model.set("collapsed",e),this._toggle()},_toggleNormalized:function(){var e=!this.model.get("normalized");this.model.set("normalized",e),this._toggle()},_toggleLocalTimezone:function(){var e=!this.model.get("local_timezone");this.model.set("local_timezone",e),this._toggle()},_open:function(){this._bindESC(),this.render(),this._$container.append(this.$el),this.$el.show(),this._adjustVerticalPosition()},_adjustVerticalPosition:function(){this._getDropdownBottom()>this._getBodyHeight()&&this.$el.addClass("has-top-position")},_getDropdownBottom:function(){return this.$el.offset().top+this.$el.height()},_getBodyHeight:function(){return s("body").height()},_close:function(){this._unbindESC(),this._dropdownOverlay&&this._dropdownOverlay.clean(),this.$el.hide(),this.$el.removeClass("has-top-position")},_toggle:function(){this.model.set("widget_dropdown_open",!this.model.get("widget_dropdown_open"))},clean:function(){this.model.set("widget_dropdown_open",!1),this._unbindESC(),this._dropdownOverlay&&this._dropdownOverlay.clean(),this._$container.undelegate(this._target,"click"),o.prototype.clean.call(this)}})},619:function(e,t,i){i(31);var s=i(28),n=i(25),o=i(13),a=i(3);i(31);var r=i(6),l=i(1),c=i(59),h=i(742),d=i(1526),u=i(1046),p=i(2909),g=e.exports=r.Model.extend({urlRoot:function urlRoot(){return this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("perm")+"/perm"},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");this._configModel=t.configModel,this.acl=new r.Collection,this.owner=t._userModel,this._generateOwner(),this._generateAcl(),this._initBinds()},_initBinds:function _initBinds(){var e,t;a(e=this).call(e,"change:owner",this._generateOwner,this),a(t=this).call(t,"change:acl",this._generateAcl,this)},_generateOwner:function _generateOwner(){this.owner||(this.owner=new h(null,{configModel:this._configModel})),this.owner.set(this.get("owner"))},getOwner:function getOwner(){return this.owner},_generateAcl:function _generateAcl(){var e=this;this.acl.reset([],{silent:!0}),l.each(this.get("acl"),function(t){var i;switch(t.type){case"user":i=new h(t.entity,{configModel:e._configModel});break;case"org":i=new d(t.entity,{configModel:e._configModel});break;case"group":i=new u(t.entity,{configModel:e._configModel});break;default:throw new Error("Unknown ACL item type: "+t.type)}this._grantAccess(i,t.access)},this)},cleanPermissions:function cleanPermissions(){this.acl.reset()},hasAccess:function hasAccess(e){return this.hasReadAccess(e)},hasReadAccess:function hasReadAccess(e){return!!this.findRepresentableAclItem(e)},hasWriteAccess:function hasWriteAccess(e){return"rw"===c.result(this.findRepresentableAclItem(e),"get","access")},canChangeReadAccess:function canChangeReadAccess(e){return this._canChangeAccess(e)},canChangeWriteAccess:function canChangeWriteAccess(e){return(!e.isBuilder||e.isBuilder())&&this._canChangeAccess(e,function(e){return"rw"!==c.result(e,"get","access")})},_canChangeAccess:function _canChangeAccess(e){var t=this.findRepresentableAclItem(e);return this.isOwner(e)||!t||t===this._ownAclItem(e)||c.result(arguments,1,t)||!1},grantWriteAccess:function grantWriteAccess(e){this._grantAccess(e,"rw")},grantReadAccess:function grantReadAccess(e){this._grantAccess(e,"r")},revokeWriteAccess:function revokeWriteAccess(e){this.grantReadAccess(e)},revokeAccess:function revokeAccess(e){var t=this._ownAclItem(e);t&&this.acl.remove(t)},isOwner:function isOwner(e){return l.result(this.owner,"id")===l.result(e,"id")},toJSON:function toJSON(){return{entity:this.get("entity"),acl:this.acl.toJSON()}},getUsersWithAnyPermission:function getUsersWithAnyPermission(){var e,t;return o(e=n(t=this.acl.chain()).call(t,this._hasTypeUser)).call(e,this._getEntity).value()},isSharedWithOrganization:function isSharedWithOrganization(){return this.acl.any(this._hasTypeOrg)},clone:function clone(){var e=l.clone(this.attributes);return delete e.id,new g(e,{configModel:this._configModel})},overwriteAcl:function overwriteAcl(e){this.acl.reset(e.acl.models)},findRepresentableAclItem:function findRepresentableAclItem(e){if(this.isOwner(e))return this._newAclItem(e,"rw");return this._findMostPrivilegedAclItem(["_ownAclItem","_organizationAclItem","_mostPrivilegedGroupAclItem"],function(t){return this[t](e)})},_hasTypeUser:function _hasTypeUser(e){return"user"===e.get("type")},_getEntity:function _getEntity(e){return e.get("entity")},_hasTypeOrg:function _hasTypeOrg(e){return"org"===e.get("type")},_isOrganization:function _isOrganization(e){return e instanceof d},_ownAclItem:function _ownAclItem(e){var t;if(e&&l.isFunction(e.isNew)||console.log("model is required to find an ACL item"),!e.isNew())return s(t=this.acl).call(t,function(t){return t.get("entity").id===e.id})},_organizationAclItem:function _organizationAclItem(e){var t=l.result(e.collection,"organization")||e.organization||e._organizationModel;if(t)return this._ownAclItem(t)},_mostPrivilegedGroupAclItem:function _mostPrivilegedGroupAclItem(e){var t=l.result(e.groups,"models");if(t)return this._findMostPrivilegedAclItem(t,this._ownAclItem)},_findMostPrivilegedAclItem:function _findMostPrivilegedAclItem(e,t){for(var i,s=0,n=e[s];n&&"rw"!==c.result(i,"get","access");n=e[++s])i=t.call(this,n)||i;return i},_grantAccess:function _grantAccess(e,t){var i=this._ownAclItem(e);if(i)i.set("access",t);else{if(!(i=this._newAclItem(e,t)).isValid())throw new Error(t+" is not a valid ACL access");this.acl.add(i)}},_newAclItem:function _newAclItem(e,t){var i;if(e instanceof h)i="user";else if(e instanceof u)i="group";else{if(!this._isOrganization(e))throw new Error("model not recognized as a valid ACL entity "+e);i="org"}return new p({type:i,entity:e,access:t})}});t.READ_ONLY="r",t.READ_WRITE="rw"},623:function(e,t,i){var s=i(1),n=i(18),o=i(6),a=i(4);e.exports=a.extend({className:"CDB-Box-modalOverlay",events:{click:"_onOverlayClicked"},initialize:function initialize(e){this.container=e&&e.container,this.onClickAction=e&&e.onClickAction,this.model=new o.Model({visible:!s.isUndefined(e&&e.visible)&&e.visible}),this._initBinds(),this.render()},_initBinds:function _initBinds(){this.listenTo(this.model,"change:visible",this._onVisibilityChange)},render:function render(){return(this.container||n(document.body)).append(this.$el),this.$el.toggle(this.isVisible()),this},_onOverlayClicked:function _onOverlayClicked(){this.onClickAction&&this.onClickAction(),this.hide()},show:function show(){this.model.set("visible",!0)},hide:function hide(){this.model.set("visible",!1)},toggle:function toggle(){this.model.set("visible",!this.model.get("visible"))},isVisible:function isVisible(){return this.model.get("visible")},_onVisibilityChange:function _onVisibilityChange(){this.$el.toggle(this.isVisible())}})},626:function(e,t,i){i(269),i(268),i(35),i(23),i(40);var s=i(3),n=i(4),o=i(1),a=i(59),r=i(625);e.exports=n.extend({className:"DatasetSelected",_FORMATTERS:{size:a.readablizeBytes,number:a.formatNumber},options:{acceptSync:!1,fileAttrs:{ext:!1,title:"",description:{content:[{name:"id",format:""}],itemName:"",separator:""}}},events:{"click .js-interval-0":"_onIntervalZero","click .js-interval-1":"_onIntervalHour","click .js-interval-2":"_onIntervalDay","click .js-interval-3":"_onIntervalWeek","click .js-interval-4":"_onIntervalMonth"},initialize:function initialize(e){if(!e.userModel)throw new TypeError("userModel is required");if(!e.configModel)throw new TypeError("configModel is required");this._configModel=e.configModel,this._userModel=e.userModel,this._initBinds(),this._checkVisibility()},render:function render(){var e=this.options.fileAttrs.title&&this.model.get("value")[this.options.fileAttrs.title]||this.model.get("value"),t=this._genDescription(),i=this.options.fileAttrs.ext?a.getFileExtension(e):"";this.options.fileAttrs.ext&&(e=e&&e.replace("."+i,""));var s=window.upgrade_url,n=this._userModel.isActionEnabled("sync_tables"),o=this._configModel.get("cartodb_com_hosted");return this.$el.html(r({title:e,description:t,ext:i,interval:this.model.get("interval"),importCanSync:this.options.acceptSync,userCanSync:n,showTrial:this._userModel.canStartTrial(),showUpgrade:!n&&!o&&s&&!this._userModel.isInsideOrg(),upgradeUrl:s})),this},_initBinds:function _initBinds(){var e,t,i;s(e=this.model).call(e,"change:value",this.render,this),s(t=this.model).call(t,"change:interval",this.render,this),s(i=this.model).call(i,"change:state",this._checkVisibility,this)},_genDescription:function _genDescription(){if(this.options.fileAttrs&&this.options.fileAttrs.description){var e=this.options.fileAttrs.description,t="",i="",s=this;return e.content&&e.content.length>0&&o.each(e.content,function(n,o){o>0&&e.separator&&(i+=" "+e.separator+" ");var a=s.model.get("value")[n.name],r=n.format&&s._FORMATTERS[n.format];i+=r&&r(a)||a,n.key&&(t=n.name)}),e.itemName&&t&&(i+=" "+(e.itemName&&_t("components.modals.add-layer.imports."+e.itemName+"-pluralize",{smart_count:t})||"")),i}return""},_onIntervalZero:function _onIntervalZero(){this.model.set("interval",0)},_onIntervalHour:function _onIntervalHour(){this.options.acceptSync&&this._userModel.isActionEnabled("sync_tables")&&this.model.set("interval",3600)},_onIntervalDay:function _onIntervalDay(){this.options.acceptSync&&this._userModel.isActionEnabled("sync_tables")&&this.model.set("interval",86400)},_onIntervalWeek:function _onIntervalWeek(){this.options.acceptSync&&this._userModel.isActionEnabled("sync_tables")&&this.model.set("interval",604800)},_onIntervalMonth:function _onIntervalMonth(){this.options.acceptSync&&this._userModel.isActionEnabled("sync_tables")&&this.model.set("interval",2592e3)},setOptions:function setOptions(e){e&&!o.isEmpty(e)&&o.extend(this.options,e)},_checkVisibility:function _checkVisibility(){"selected"===this.model.get("state")?this.show():this.hide()}})},627:function(e,t,i){var s=i(3),n=i(1),o=i(1060),a=i(345),r=i(821),l=i(820),c=i(626),h=i(1574),d=i(14),u=["userModel","configModel","createModel","privacyModel","guessingModel"];e.exports=o.extend({options:{fileExtensions:[],type:"url",service:"",acceptSync:!1,fileEnabled:!1,formTemplate:"",headerTemplate:"",fileAttrs:{}},className:"ImportPanel ImportDataPanel",initialize:function initialize(e){d(e,u,this),this._initModels(),this._initBinds()},render:function render(){return this.clearSubViews(),this.$el.html(h()),this._initViews(),this._initBinds(),this},_initModels:function _initModels(){this.model=new a({type:this.options.type,service_name:this.options.service},{userModel:this._userModel,configModel:this._configModel})},_initViews:function _initViews(){var e;this.model.setFresh();var t=new l({el:this.$(".ImportPanel-header"),model:this.model,userModel:this._userModel,fileEnabled:this.options.fileEnabled,acceptSync:this.options.acceptSync,template:this.options.headerTemplate});t.render(),this.addView(t);var i=new c({el:this.$(".DatasetSelected"),userModel:this._userModel,model:this.model,acceptSync:this.options.acceptSync,fileAttrs:this.options.fileAttrs,configModel:this._configModel});i.render(),this.addView(i);var n=new r({el:this.$(".ImportPanel-form"),userModel:this._userModel,model:this.model,template:this.options.formTemplate,fileEnabled:this.options.fileEnabled});s(n).call(n,"fileSelected",function(){i.setOptions({acceptSync:!1,fileAttrs:{ext:!0,title:"name",description:{content:[{name:"size",format:"size"}]}}})}),s(n).call(n,"urlSelected",function(){i.setOptions({acceptSync:!0,fileAttrs:{ext:!1,title:"",description:""}})}),s(n).call(n,"urlSubmitted",s(e=function _context(){this._finish()}).call(e,this)),n.render(),this.addView(n)},_finish:function _finish(){this._createModel.canFinish()&&(this.model.setPrivacy(this._privacyModel.get("privacy")),this.model.setGuessing(this._guessingModel.get("guessing")),this._createModel.finish())},_initBinds:function _initBinds(){var e,t,i;this.model.unbind("change:state",this._checkState,this),this.model.unbind("change",this._triggerChange,this),this.model.unbind("change",this._setUploadModel,this),s(e=this.model).call(e,"change:state",this._checkState,this),s(t=this.model).call(t,"change",this._triggerChange,this),s(i=this.model).call(i,"change",this._setUploadModel,this)},_setUploadModel:function _setUploadModel(e){n.isEmpty(e.attributes)||this._createModel.getUploadModel().setFresh(e.attributes)},_checkState:function _checkState(){"selected"===this.model.previous("state")&&this.model.set({type:void 0,value:"",service_name:"",service_item_id:"",interval:0})}})},666:function(e,t,i){i(37),i(35),i(23),i(40),i(64);var s=i(290).default,n=i(235),o=i(7),a=i(25),r=i(3),l=i(13),c=i(1),h=i(18),d=i(6),u=i(84).SQL,p=i(1211),g=i(1210),m=i(14),f=i(920),_=i(1866),v=i(916),y=i(525),w=i(1865),b=i(1864),C=i(1276),M=i(1863),k=["configModel"],S=d.Model.extend({columnNames:function columnNames(){return l(c).call(c,this.get("schema"),function(e){return e[0]})},columnName:function columnName(e){return this.columnNames()[e]}}),x=S.extend({currentLoading:0,_TEXTS:{columnDeleted:"Your column has been deleted",columnDeleting:"Deleting your column",columnAdded:"Your column has been added",columnAdding:"Adding new column"},hiddenColumns:["the_geom","the_geom_webmercator","cartodb_georef_status","created_at","updated_at","cartodb_id"],initialize:function initialize(e,t){var i,s,n,o,a,l;m(t,k,this),c.bindAll(this,"notice"),this.readOnly=!1,r(i=this).call(i,"change:schema",this._prepareSchema,this),this._prepareSchema(),this.sqlView=null,this.synchronization=new b({configModel:t.configModel}),this.synchronization.linkToTable(this),r(s=this.synchronization).call(s,"change:id",function isSyncChanged(){this.trigger("change:isSync",this,this.synchronization.isSync())},this),this.get("no_data_fetch")&&(this.no_data_fetch=!0,delete this.attributes.no_data_fetch),this.data(),r(n=this).call(n,"error",function(e,t){this.error("",t)},this),r(o=this._data).call(o,"error",function(e,t){this.notice("error loading rows, check your SQL query","error",5e3)},this),r(a=this._data).call(a,"reset",function(){var e=this._data;this.set({schema:e.schemaFromData(this.get("schema")),geometry_types:e.getGeometryTypes()})},this),M.call(this,"change",this._data,"data:changed"),M.call(this,"saved",this._data,"data:saved"),r(l=this).call(l,"change:table_visualization",function(){this.permission=new y(this.get("table_visualization").permission,{configModel:this._configModel}),this.trigger("change:permission",this,this.permission)},this),this.permission=new y(this.get("permission"),{configModel:this._configModel})},url:function url(e){var t="/api/"+this._configModel.urlVersion("table",e)+"/tables";return this.isNew()?t:t+"/"+this.id},parse:function parse(e,t){return e.name&&(e.id=e.name),e.stats_geometry_types=e.geometry_types,delete e.geometry_types,delete e.schema,e},notice:function notice(e,t,i){this.trigger("notice",e,t,i)},setReadOnly:function setReadOnly(e){var t=!1;this.readOnly!==e&&(t=!0),this.readOnly=e,t&&this.trigger("change:readOnly",this,e)},isReadOnly:function isReadOnly(){return this.readOnly||this.data().isReadOnly()||this.synchronization.isSync()},isSync:function isSync(){return this.synchronization.isSync()},getUnqualifiedName:function getUnqualifiedName(){var e=this.get("name");if(!e)return null;var t=e.split(".");return 2==t.length?t[1]:e},getUnquotedName:function getUnquotedName(){var e=this.get("name");return e&&e.replace(/"/g,"")},sortSchema:function sortSchema(){this.set("schema",x.sortSchema(this.get("schema")))},error:function error(e,t){var i="";try{i=t&&t.responseText&&JSON.parse(t.responseText).errors[0]}catch(e){}finally{this.trigger("notice",e+": "+i,"error")}},_prepareSchema:function _prepareSchema(){var e=this;this._columnType={},c(this.get("schema")).each(function(t){e._columnType[t[0]]=t[1]}),this.isInSQLView()||this.set("original_schema",this.get("schema"))},columnNames:function columnNames(e){return e=e||"schema",c(this.get(e)).pluck(0)},containsColumn:function containsColumn(e){return c.contains(this.columnNames(),e)},columnNamesByType:function columnNamesByType(e,t){var i;t=t||"schema";var s=a(i=c(this.get(t))).call(i,function(t){return t[1]==e});return c(s).pluck(0)},statsGeomColumnTypes:function statsGeomColumnTypes(e){return this.geomColumnTypes(this.get("stats_geometry_types"))},geomColumnTypes:function geomColumnTypes(e){var t=e||this.get("geometry_types"),i=[];if(!c.isArray(t))return[];var s={st_multipolygon:"polygon",st_polygon:"polygon",st_multilinestring:"line",st_linestring:"line",st_multipoint:"point",st_point:"point"};for(var n in t){var o=t[n];if(o){var a=s[o.toLowerCase()];a&&i.push(a)}}return c.uniq(i)},addGeomColumnType:function addGeomColumnType(e,t){if(e){var i=c.clone(this.get("geometry_types"))||[];c.contains(i,e)||(i.push(e),this.set({geometry_types:i},t))}},nonReservedColumnNames:function nonReservedColumnNames(){var e=this;return a(c).call(c,this.columnNames(),function(t){return!e.isReservedColumn(t)})},columnTypes:function columnTypes(){return c.clone(this._columnType)},_getColumn:function _getColumn(e){if(void 0!==this._columnType[e])return new _({table:this,name:e,type:this._columnType[e],configModel:this._configModel},{configModel:this._configModel})},getColumnType:function getColumnType(e,t){var i;t=t||"schema";var s=a(i=c(this.get(t))).call(i,function(t){return t[0]==e});if(s.length>0)return s[0][1]},addColumn:function addColumn(e,t,i){var s=this,n=new _({table:this,_name:e,type:t||"string",configModel:this._configModel},{configModel:this._configModel});this.notice(this._TEXTS.columnAdding,"load",0),n.save(null,{success:function success(t,n){s.notice(s._TEXTS.columnAdded,"info"),s.trigger("columnAdd",e),s.data().fetch(),i&&i.success&&i.success(t,n)},error:function error(e,t){s.error("error adding column",t),i&&i.error&&i.error(e)},wait:!0})},deleteColumn:function deleteColumn(e,t){var i=this,s=this._getColumn(e);void 0!==s&&(this.notice(this._TEXTS.columnDeleting,"load",0),s.destroy({success:function success(){i.trigger("columnDelete",e),i.notice(i._TEXTS.columnDeleted,"info"),i.data().fetch(),t&&t.success&&t.success()},error:function error(e,s){i.error("error deleting column",s),t&&t.error&&t.error()},wait:!0}))},renameColumn:function renameColumn(e,t,i){var s=this;if(e!=t){var n=this._getColumn(e),o=n.get("name");n.set({new_name:t,old_name:n.get("name")}),this.notice("renaming column","load",0),n.save(null,{success:function success(e,n){s.notice("Column has been renamed","info"),s.trigger("columnRename",t,o),s.data().fetch(),i&&i.success&&i.success(e,n)},error:function error(e,t){console.error("can't rename column"),s.error("error renaming column",t),i&&i.error&&i.error(e,t)},wait:!0})}},isTypeChangeAllowed:function isTypeChangeAllowed(e,t){var i=this._getColumn(e);if(!i)return!0;var s=i.get("type"),n={number:["date"],boolean:["date"],date:["boolean"]}[s]||[];return n=o(n).call(n,[s]),!c.contains(n,t)},isTypeChangeDestructive:function isTypeChangeDestructive(e,t){return{string:{string:!1,number:!0,date:!0,boolean:!0},number:{string:!1,number:!1,date:!0,boolean:!0},date:{string:!1,number:!0,date:!1,boolean:!0},boolean:{string:!1,number:!1,date:!0,boolean:!1}}[this.getColumnType(e)][t]},changeColumnType:function changeColumnType(e,t,i){var s=this._getColumn(e);this.getColumnType(e)!=t?this.saveNewColumnType(s,t,i):i&&i.success&&i.success()},saveNewColumnType:function saveNewColumnType(e,t,i){var s=this;e.set({type:t}),this.notice("Changing column type","load",0),e.save(null,{success:function success(){s.notice("Column type has been changed","info"),s.trigger("typeChanged",t),s.data().fetch(),i&&i.success&&i.success()},error:function error(e,n){s.trigger("typeChangeFailed",t,e),s.error("error changing column type",n),i&&i.error&&i.error(e,n)},wait:!0})},originalData:function originalData(){return this._data},data:function data(){return void 0===this._data&&(this._data=new f(null,{table:this,configModel:this._configModel}),this.bindData()),this.sqlView?this.sqlView:this._data},bindData:function bindData(e){this._data&&!this._data.bindedReset&&(M.call(this,"sync",this._data,"dataLoaded"),M.call(this,"add",this._data,"dataAdded"),this._data.bindedReset=!0),this.sqlView&&!this.sqlView.bindedReset&&(M.call(this,"sync",this.sqlView,"dataLoaded"),M.call(this,"add",this.sqlView,"dataAdded"),this.sqlView.bindedReset=!0)},useSQLView:function useSQLView(e,t){(e||this.sqlView)&&(t=t||{},this.sqlView&&(this.sqlView.unbind(null,null,this),this.sqlView.unbind(null,null,this._data)),!e&&this.sqlView&&(this.sqlView.table=null),this.sqlView=e,this.bindData(),e?(r(e).call(e,"sync reset",function(){e.modify_rows||this.set({schema:e.schemaFromData(this.get("schema")),geometry_types:e.getGeometryTypes()})},this),r(e).call(e,"error",function(e,t){this.notice("error loading rows, check your SQL query","error",5e3)},this),r(e).call(e,"loading",function(){},this),r(e).call(e,"reset loaded",function(){e.modify_rows?(this.notice(e.affected_rows+" rows affected"),this.useSQLView(null)):this.notice(_t("loaded"))},this),this.dataModel=this.sqlView,e.table=this):(this.dataModel=this._data,this.set({schema:this.get("original_schema")}),this.data().fetch()),this.trigger("change:dataSource",this.dataModel,this))},isInSQLView:function isInSQLView(){return!!this.sqlView},fetch:function fetch(e){var t=this,i=!!e&&e.silent;i||this.notice("loading table","load",this,0,0);var s=S.prototype.fetch.call(this,e);return h.when(s).done(function(){e&&e.success&&e.success.old_success&&e.success.old_success(),i||t.notice("loaded")}).fail(function(){i||t.notice("error loading the table")}),s},isReservedColumn:function isReservedColumn(e){return v.isReservedColumn(e)},linkToInfowindow:function linkToInfowindow(e){var t,i,s;r(t=this).call(t,"columnRename",function(t,i){e.containsField(i)&&(e.removeField(i),e.addField(t))},e),r(i=this).call(i,"columnDelete",function(t,i){e.removeField(t)},e),r(s=this).call(s,"change:schema",function(){var t,i=a(t=c(this.columnNames())).call(t,function(t){return!c.contains(e.SYSTEM_COLUMNS,t)});function _hash(e){var t,i=0;for(t=0;t<e.length;t++)i=e.charCodeAt(t)+(i<<6)+(i<<16)-i;return i}if(this.isInSQLView()){var s,o;e.has("defaul_schema_fields")||e.saveFields("defaul_schema_fields");var r="schema_"+_hash(n(s=this.columnNames()).call(s).join("")),l="schema_"+_hash(n(o=c(this.previous("schema")).pluck(0)).call(o).join(""));e.has(l)||e.saveFields(l),e.has(r)&&e.restoreFields(null,r)}else e.restoreFields(null,"defaul_schema_fields");e.get("template")?e.mergeFields(i):e.removeMissingFields(i)},this)},embedURL:function embedURL(){return"/tables/"+this.get("name")+"/embed_map"},viewUrl:function viewUrl(){return this._configModel.prefixUrl()+"/tables/"+this.getUnqualifiedName()},hasTheGeom:function hasTheGeom(){var e=this.get("schema");for(var t in e)if("the_geom"===e[t][0])return!0;return!1},fetchGeoreferenceStatus:function fetchGeoreferenceStatus(){var e=h.Deferred(),t=this.options&&this.options.user_data?this.options.user_data.username:window.user_data?window.user_data.username:window.user_name,i=this.options&&this.options.user_data?this.options.user_data.api_key:window.user_data?window.user_data.api_key:window.api_key;this.sqlApi=new u({user:t,version:"v1",api_key:i,sql_api_template:this._configModel.getSqlApiBaseUrl()});var s="SELECT the_geom FROM "+this.get("name")+" WHERE the_geom is not null";return this.sqlApi.execute(s).done(function(t){t.rows.length>0?e.resolve(!0):e.resolve(!1)}),e.promise()},isGeoreferenced:function isGeoreferenced(){var e=this.geomColumnTypes();return!!(e&&e.length>0)||!this.isInSQLView()&&this._data.any(function(e){return e.hasGeometry()})},geometryTypeChanged:function geometryTypeChanged(){if(!("geometry_types"in this.changed))return!1;var e=this.get("geometry_types"),t=this.previousAttributes().geometry_types;function normalize(e){return"st_multipolygon"===(e=e.toLowerCase())?"st_polygon":"st_multilinestring"===e?"st_linestring":"st_multipoint"===e?"st_point":e}return!e||0===e.length||!t||0===t.length||normalize(e[0])!==normalize(t[0])},duplicate:function duplicate(e,t){var i=this;t=t||{};var s={table_name:e};if(this.isInSQLView()){var n=this.data().getSQL();s.sql=n&&""!=n?n:"SELECT * FROM "+p(this.get("name"))}else s.table_copy=this.get("name");(new w).save(s,{error:t.error,success:function success(e,s){var n=new w({item_queue_id:s.item_queue_id});r(n).call(n,"importComplete",function(){n.unbind();var e=new x({id:n.get("table_id")},{configModel:i._configModel});e.fetch({success:function success(){t.success(e)},error:t.error})}),r(n).call(n,"importError",function(){n.unbind(),t.error.apply(this,arguments)}),n.pollCheck()}})},dependentVisualizations:function dependentVisualizations(){return c.chain(this.get("dependent_visualizations")).union(this.get("non_dependent_visualizations")).compact().value()||[]},getGeometryType:function getGeometryType(){var e=this.get("geometry_types"),t=[];if(!c.isArray(e))return[];for(var i in e){var s=e[i];if(s){var n=C(s.toLowerCase());n&&t.push(n)}}return c.uniq(t)}},s({createFromQuery:function createFromQuery(e,t,i){return new x({sql:t,name:e},{configModel:i})}},g));e.exports=x},667:function(e,t,i){var s=i(6),n=i(1876),o=i(14),a=["configModel"];e.exports=s.Model.extend({defaults:{display_name:""},initialize:function initialize(e,t){o(t,a,this),this.parse(e||{})},parse:function parse(e,t){return this.users=new n(e.users,{group:this,configModel:this._configModel}),e},getModelType:function getModelType(){return"group"}})},688:function(e,t,i){i(37),i(23),i(40);var s=i(32),n=i(13),o=i(18),a=i(1),r=i(4),l=i(14),c="<%- protocol %>://<%= mapsApiResource %>/api/v1/map/static/named/<%- tpl %>/<%- width %>/<%- height %>.png<%= authTokens %>",h="<%- protocol %>://<%- cdn %>/<%- username %>/api/v1/map/static/named/<%- tpl %>/<%- width %>/<%- height %>.png<%= authTokens %>",d=["config","visId","mapsApiResource","username"];e.exports=r.extend({options:{width:300,height:170,privacy:"PUBLIC",className:"",authTokens:[]},initialize:function initialize(e){l(e,d,this)},load:function load(){return this._startLoader(),this._loadFromVisId(),this},_generateImageTemplate:function _generateImageTemplate(){return"tpl_"+this._visId.replace(/-/g,"_")},_loadFromVisId:function _loadFromVisId(){var e=this._isHTTPS()?"https":"http",t=this._config.get("cdn_url"),i=a.template(t?h:c),s={protocol:e,username:this._username,mapsApiResource:this._mapsApiResource,tpl:this._generateImageTemplate(),width:this.options.width,height:this.options.height,authTokens:this._generateAuthTokensParams()};t&&(s=a.extend(s,{cdn:t[e]}));var n=i(s);this._loadImage({},n)},_generateAuthTokensParams:function _generateAuthTokensParams(){var e=this.options.authTokens;return e&&e.length>0?"?"+n(a).call(a,e,function(e){return"auth_token="+e}).join("&"):""},_isHTTPS:function _isHTTPS(){var e;return 0===s(e=location.protocol).call(e,"https")},loadURL:function loadURL(e){var t=o('<img class="MapCard-preview" src="'+e+'" />');this.$el.append(t),this.options.className&&t.addClass(this.options.className),t.fadeIn(250)},showError:function showError(){this._onError()},_startLoader:function _startLoader(){this.$el.addClass("is-loading")},_stopLoader:function _stopLoader(){this.$el.removeClass("is-loading")},_onSuccess:function _onSuccess(e){this._stopLoader(),this.loadURL(e),this.trigger("loaded",e)},_onError:function _onError(){this._stopLoader(),this.$el.addClass("has-error");var e=o('<div class="MapCard-error" />');this.$el.append(e),e.fadeIn(250),this.trigger("error")},_loadImage:function _loadImage(e,t){var i=this,s=new Image;s.onerror=function(){i._onError(e)},s.onload=function(){i._onSuccess(t)};try{s.src=t}catch(e){this._onError(e)}}})},70:function(e,t,i){"use strict";i.r(t);i(23),i(40);var s=i(79),n=i(66),o=i(355),a=i.n(o),r=i(1175),l=i(1702),c=i(52),h=i(12),d=i(201);function isBuilder(e){return!isViewer(e)}function isViewer(e){return!0===e.viewer}function getPublicMapsCount(e){return e.link_privacy_map_count+e.password_privacy_map_count+e.public_privacy_map_count||0}function getPublicMapsQuota(e){return e.public_map_quota}function getPrivateMapsCount(e){return e.private_privacy_map_count||0}function getPrivateMapsQuota(e){return e.private_map_quota}function isOutOfPrivateMapsQuota(e){return getPrivateMapsQuota(e)&&getPrivateMapsCount(e)>=getPrivateMapsQuota(e)}function getDatasetsCount(e){return e.table_count}function getDatasetsQuota(e){return e.table_quota}function isOutOfDatasetsQuota(e){return getDatasetsQuota(e)&&getDatasetsCount(e)>=getDatasetsQuota(e)}var u=Object(d.a)(),p={namespaced:!0,state:Object(h.a)({},u.user_data,{organizationNotifications:u.organization_notifications||[],showNotification:!0}),getters:{canCreateDatasets:function canCreateDatasets(e){return!(!e.remaining_byte_quota||e.remaining_byte_quota<=0||isOutOfDatasetsQuota(e))&&function hasCreateDatasetsFeature(e){return isBuilder(e)}(e)},canCreateMaps:function canCreateMaps(e){return!isOutOfPrivateMapsQuota(e)&&isBuilder(e)},isViewer:isViewer,hasEngine:function hasEngine(e){return!0===e.actions.engine_enabled},userNotification:function userNotification(e){return e.notification?e.notification:null},isNotificationVisible:function isNotificationVisible(e){return e.notification&&e.showNotification},publicMapsCount:getPublicMapsCount,publicMapsQuota:getPublicMapsQuota,isOutOfPublicMapsQuota:function isOutOfPublicMapsQuota(e){return getPublicMapsQuota(e)&&getPublicMapsCount(e)>=getPublicMapsQuota(e)},privateMapsCount:getPrivateMapsCount,privateMapsQuota:getPrivateMapsQuota,isOutOfPrivateMapsQuota:isOutOfPrivateMapsQuota,datasetsCount:getDatasetsCount,datasetsQuota:getDatasetsQuota,isOutOfDatasetsQuota:isOutOfDatasetsQuota,isOrganizationUser:function isOrganizationUser(e){return Boolean(e.organization)},isMobileSDKEnabled:function isMobileSDKEnabled(e){return e.actions.mobile_sdk_enabled}},mutations:{setUserData:function setUserData(e,t){Object(c.a)(e,t)},setOrganizationNotifications:function setOrganizationNotifications(e,t){e.organizationNotifications=t},setShowNotification:function setShowNotification(e,t){e.showNotification=t},updateTableCount:function updateTableCount(e,t){e.table_count=t}},actions:{updateData:function updateData(e){e.rootState.client.getConfig(function(t,i,s){t||e.commit("setUserData",s.user_data)})},resetOrganizationNotifications:function resetOrganizationNotifications(e){e.commit("setOrganizationNotifications",[])},hideUserNotification:function hideUserNotification(e){e.commit("setShowNotification",!1)},updateTableCount:function updateTableCount(e,t){e.commit("updateTableCount",t)}}},g=Object(d.a)(),m=g.user_data,f={namespaced:!0,state:Object(h.a)({},g.config,{base_url:m.base_url,default_fallback_basemap:g.default_fallback_basemap,isFirstTimeViewingDashboard:g.is_first_time_viewing_dashboard,url_prefix:m.base_url,plan_url:g.plan_url}),getters:{isOnPremise:function isOnPremise(e){return e.cartodb_com_hosted}},mutations:{},actions:{}},_=i(25),v=i.n(_),y=i(41),w=i.n(y),b=function toObject(e,t){return w()(e).call(e,function(e,i){return e[i[t]]=i,e},{})},C=i(289),M={namespaced:!0,state:{isFetching:!1,isFiltered:!1,isErrored:!1,error:{},list:{},metadata:{},order:"updated_at",params:{per_page:2,only_liked:!0}},getters:{},mutations:{setRequestError:function setRequestError(e,t){e.isFetching=!1,e.isErrored=!0,e.error=t},setFeaturedFavoritedMaps:function setFeaturedFavoritedMaps(e,t){e.list=b(t.visualizations,"id"),e.metadata={total_entries:t.total_entries,total_likes:t.total_likes,total_shared:t.total_shared,total_user_entries:t.total_user_entries},e.isFetching=!1},setFetchingState:function setFetchingState(e){e.isFetching=!0,e.isErrored=!1,e.error={}}},actions:{fetchMaps:function fetchMaps(e){var t=Object(h.a)({},C.b,{},e.state.params,{order:e.state.order});e.commit("setFetchingState"),e.rootState.client.getVisualization("",t,function(t,i,s){t?e.commit("setRequestError",t):e.commit("setFeaturedFavoritedMaps",s)})}}},k=i(44),S=i.n(k),x=i(89),T=i.n(x),D=i(49),E=i.n(D);function deleteLike(e,t){var i=t.liked;e.dispatch("updateVisualization",{visualizationId:t.id,visualizationAttributes:{liked:!1}}),e.rootState.client.deleteLike(t.id,function(s,n,o){s?e.dispatch("updateVisualization",{visualizationId:t.id,visualizationAttributes:{liked:i}}):e.commit("updateNumberLikes",{visualizationId:t.id,visualizationAttributes:{liked:o.liked}})})}function fetchVisualizations(e,t){e.commit("setFetchingState"),e.rootState.client.getVisualization("",t,function(t,i,s){t?e.commit("setRequestError",t):(e.commit("setVisualizations",s),e.commit("setPagination",e.state.page))})}function visualizations_filter(e,t){e.commit("setPagination",1),e.commit("setFilterType",t),e.dispatch("fetch")}function like(e,t){var i=t.liked;e.dispatch("updateVisualization",{visualizationId:t.id,visualizationAttributes:{liked:!0}}),e.rootState.client.like(t.id,function(s,n,o){s?e.dispatch("updateVisualization",{visualizationId:t.id,visualizationAttributes:{liked:i}}):e.commit("updateNumberLikes",{visualizationId:t.id,visualizationAttributes:{liked:o.liked}})})}function visualizations_order(e,t){e.commit("setPagination",1),e.commit("setOrder",t),e.dispatch("fetch")}function resetFilters(e){return function(t){t.commit("setPagination",1),t.commit("setFilterType","mine"),t.commit("setResultsPerPage",12),t.commit("setOrder",{order:e.order,direction:e.orderDirection})}}function setResultsPerPage(e,t){e.commit("setResultsPerPage",t)}function setURLOptions(e,t){e.commit("setPagination",T()(t.page||1)),e.commit("setFilterType",v()(t)),e.commit("setOrder",{order:t.order,direction:t.order_direction}),e.commit("setResultsPerPage",t.per_page),e.commit("setQueryFilter",t.q),e.dispatch("fetch")}function visualizations_updateVisualization(e,t){e.commit("maps/updateVisualization",t,{root:!0}),e.commit("datasets/updateVisualization",t,{root:!0}),e.commit("recentContent/updateVisualization",t,{root:!0}),e.commit("search/updateVisualization",t,{root:!0})}function setFetchingState(e){e.isFetching=!0,e.isErrored=!1,e.error={}}function setFilterType(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"mine";e.filterType=t}function setPagination(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;e.page=t,e.numPages=Math.ceil(e.metadata.total_entries/e.resultsPerPage)||1}function setOrder(e){return function(t,i){t.order=i.order||e.order,t.orderDirection=i.direction||e.orderDirection}}function visualizations_setResultsPerPage(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;e.resultsPerPage=t}function setRequestError(e,t){e.isFetching=!1,e.isErrored=!0,e.error=t}function setVisualizations(e,t){e.list=b(t.visualizations,"id"),e.metadata={total_entries:t.total_entries,total_likes:t.total_likes,total_shared:t.total_shared,total_locked:t.total_locked,total_user_entries:t.total_user_entries,total_subscriptions:t.total_subscriptions,total_samples:t.total_samples},e.isFetching=!1}function updateNumberLikes(e,t){var i=t.visualizationAttributes;e.metadata.total_likes+=i.liked?1:-1}function mutations_visualizations_updateVisualization(e,t){var i=t.visualizationId,s=t.visualizationAttributes;e.list.hasOwnProperty(i)&&Object(c.a)(e.list[i],s)}var V={filter:"mine",order:"favorited,updated_at",orderDirection:"desc,desc"},A={namespaced:!0,modules:{featuredFavoritedMaps:M},state:{isFetching:!1,isFiltered:!1,isErrored:!1,error:{},filterType:v()(V),order:V.order,orderDirection:V.orderDirection,list:{},metadata:{},page:1,numPages:1,resultsPerPage:12},getters:{},mutations:{setFetchingState:setFetchingState,setFilterType:setFilterType,setOrder:setOrder(V),setPagination:setPagination,setResultsPerPage:visualizations_setResultsPerPage,setRequestError:setRequestError,setVisualizations:setVisualizations,updateNumberLikes:updateNumberLikes,updateVisualization:mutations_visualizations_updateVisualization},actions:{deleteLike:deleteLike,filter:visualizations_filter,like:like,order:visualizations_order,resetFilters:resetFilters(V),setResultsPerPage:setResultsPerPage,setURLOptions:setURLOptions,updateVisualization:visualizations_updateVisualization,createVisualizationFromDataset:function createVisualizationFromDataset(e,t){var i=["api/v1/viz"],s={dataType:"json",data:S()({name:"Untitled Map",type:"derived",tables:t,transition_options:{time:0}})};return new E.a(function(t,n){e.rootState.client.post([i],s,function(e,i,s){t(!e&&s.id)})})},fetch:function fetch(e){fetchVisualizations(e,Object(h.a)({},C.a[e.state.filterType],{page:e.state.page,order:e.state.order,order_direction:e.state.orderDirection,per_page:e.state.resultsPerPage}))}}},I=(i(269),i(268),i(92),i(35),i(34),i(67),i(236),i(257),i(13)),B=i.n(I),z=i(374),F=i.n(z),P=i(235),N=i.n(P),O=i(7),L=i.n(O);function customStorageToVisualization(e,t){var i=Object(d.a)();return w()(e).call(e,function(e,s){var n,o,a,r=!1;for(var l in t)if(s[l]!==t[l]){r=!0;break}r||e.push({id:s.id,name:s.name,display_name:null,map_id:s.id,active_layer_id:null,type:"keplergl",tags:[],description:s.description,privacy:s.isprivate?"PRIVATE":"LINK",created_at:s.lastmodified,updated_at:s.lastmodified,locked:!1,source:null,title:null,license:null,attributions:null,kind:null,external_source:{},url:L()(n=L()(o=L()(a="".concat("https://kepler.gl","/demo/map/carto?mapId=")).call(a,s.id,"&owner=")).call(o,i.user_data.username,"&privateMap=")).call(n,s.isprivate),version:1,prev_id:null,next_id:null,parent_id:null,transition_options:{},active_child:null,children:[],synchronization:null,uses_builder_features:!1,liked:!1,permission:{owner:i.user_data,acl:[]},stats:{},auth_tokens:[],table:{},thumbnailDataUrl:s.thumbnail});return e},[])}function external_visualizations_fetchVisualizations(e){if(e.state.customStorageInitialized){var t=Object(h.a)({},C.a[e.state.filterType],{page:e.state.page,order:e.state.order,order_direction:e.state.orderDirection,per_page:e.state.resultsPerPage});e.commit("setFetchingState"),e.rootState.customStorage.getVisualizations().then(function(i){var s={};t.privacy&&(s.isprivate="private"===t.privacy);var n=customStorageToVisualization(i,s),o=t.order,a=t.order_direction;o&&a&&(n=N()(n).call(n,function(e,t){return t[o]-e[o]}),"desc"===a&&(n=F()(n).call(n))),e.commit("setExternalMaps",n),e.commit("setPagination",e.state.page)}).catch(function(t){e.commit("setRequestError",t)})}}var R={filter:"mine",order:"updated_at",orderDirection:"desc"},q={namespaced:!0,state:{customStorageInitialized:!1,isFetching:!1,isFiltered:!1,isErrored:!1,error:{},filterType:v()(R),order:R.order,orderDirection:R.orderDirection,list:{},metadata:{},page:1,numPages:1,resultsPerPage:12},getters:{},mutations:{setRequestError:function setRequestError(e,t){e.isFetching=!1,e.isErrored=!0,e.error=t},setExternalMaps:function setExternalMaps(e,t){e.list=b(t,"id"),e.metadata={total_entries:t.length,total_likes:0,total_shared:0,total_user_entries:0},e.isFetching=!1},setFetchingState:function setFetchingState(e){e.isFetching=!0,e.isErrored=!1,e.error={}},setCustomStorageStatus:function setCustomStorageStatus(e,t){e.customStorageInitialized=t},setFilterType:setFilterType,setOrder:setOrder(R),setPagination:setPagination,setResultsPerPage:visualizations_setResultsPerPage},actions:{init:function init(e){return new E.a(function(t,i){e.rootState.customStorage.isInitialized().then(function(i){e.commit("setCustomStorageStatus",i),t()}).catch(function(e){i("Error initializing CustomStorage client: ".concat(e.message))})})},setURLOptions:function external_visualizations_setURLOptions(e,t){e.commit("setPagination",T()(t.page||1)),e.commit("setFilterType",v()(t)),e.commit("setOrder",{order:t.order,direction:t.order_direction}),e.dispatch("fetch")},resetFilters:function external_visualizations_resetFilters(e){return function(t){t.commit("setPagination",1),t.commit("setFilterType","mine"),t.commit("setResultsPerPage",12),t.commit("setOrder",{order:e.order,direction:e.orderDirection})}}(R),fetch:function fetch(e){Object(h.a)({},C.a[e.state.filterType],{page:e.state.page,order:e.state.order,order_direction:e.state.orderDirection,per_page:e.state.resultsPerPage});external_visualizations_fetchVisualizations(e)},delete:function deleteVisualizations(e,t){if(e.state.customStorageInitialized){var i=B()(t).call(t,function(t){return e.rootState.customStorage.deleteVisualization(t.id)});E.a.all(i).then(function(){external_visualizations_fetchVisualizations(e)}).catch(function(t){e.commit("setRequestError",t)})}}}},$={filter:"mine",order:"favorited,updated_at",orderDirection:"desc,desc"},j={namespaced:!0,state:{isFetching:!1,isFiltered:!1,isErrored:!1,error:{},filterType:v()($),order:$.order,orderDirection:$.orderDirection,list:{},metadata:{},page:1,numPages:1,resultsPerPage:1,queryFilter:null},mutations:{setFetchingState:setFetchingState,setFilterType:setFilterType,setOrder:setOrder($),setPagination:setPagination,setResultsPerPage:visualizations_setResultsPerPage,setQueryFilter:function setQueryFilter(e,t){e.queryFilter=t},setRequestError:setRequestError,setVisualizations:setVisualizations,updateNumberLikes:updateNumberLikes,updateVisualization:mutations_visualizations_updateVisualization},actions:{deleteLike:deleteLike,filter:visualizations_filter,like:like,order:visualizations_order,resetFilters:resetFilters($),setResultsPerPage:setResultsPerPage,setURLOptions:setURLOptions,updateVisualization:visualizations_updateVisualization,fetch:function fetch(e){fetchVisualizations(e,Object(h.a)({},C.a[e.state.filterType],{types:"table",page:e.state.page,order:e.state.order,order_direction:e.state.orderDirection,per_page:e.state.resultsPerPage,with_dependent_visualizations:10,load_do_totals:!0},e.state.queryFilter?{q:e.state.queryFilter}:{}))}}},U=i(15),H=i.n(U),W=(i(77),i(417)),Q=i(29);i(569);function getBaseURL(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"v4";return e.config?L()(t="".concat(e.config.base_url,"/api/")).call(t,i):"https://public.carto.com/api/".concat(i)}function __createNewConnection(e,t){return _createNewConnection.apply(this,arguments)}function _createNewConnection(){return(_createNewConnection=Object(Q.a)(H.a.mark(function _callee(e,t){var i,s,n,o,a,r,l;return H.a.wrap(function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return s=getBaseURL(e.rootState),n=e.rootState.user.api_key,o=L()(i="".concat(s,"/connections?api_key=")).call(i,n),c.next=5,fetch(o,{method:"POST",headers:{"content-type":"application/json"},body:S()(t)});case 5:if((a=c.sent).ok){c.next=11;break}return c.next=9,a.json();case 9:throw r=c.sent,new Error(r.errors);case 11:return c.next=13,a.json();case 13:return l=c.sent,c.abrupt("return",l);case 15:case"end":return c.stop()}},_callee)}))).apply(this,arguments)}function _fetchConnectionsList(){return(_fetchConnectionsList=Object(Q.a)(H.a.mark(function _callee2(e){var t,i,s,n,o,a;return H.a.wrap(function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:if(e.rootState.user){r.next=2;break}return r.abrupt("return");case 2:return e.commit("setLoadingConnections"),i=getBaseURL(e.rootState),s=e.rootState.user.api_key,n=L()(t="".concat(i,"/connections?api_key=")).call(t,s),r.prev=6,r.next=9,fetch(n);case 9:return o=r.sent,r.next=12,o.json();case 12:a=r.sent,e.commit("setConnections",a||[]),r.next=19;break;case 16:r.prev=16,r.t0=r.catch(6),console.error("ERROR: ".concat(r.t0));case 19:case"end":return r.stop()}},_callee2,null,[[6,16]])}))).apply(this,arguments)}function _fetchConnectionById(){return(_fetchConnectionById=Object(Q.a)(H.a.mark(function _callee3(e,t){var i,s,n,o,a,r;return H.a.wrap(function _callee3$(l){for(;;)switch(l.prev=l.next){case 0:if(e.rootState.user){l.next=2;break}return l.abrupt("return");case 2:return n=getBaseURL(e.rootState),o=e.rootState.user.api_key,a=L()(i=L()(s="".concat(n,"/connections/")).call(s,t,"?api_key=")).call(i,o),l.prev=5,l.next=8,fetch(a);case 8:return r=l.sent,l.next=11,r.json();case 11:return l.abrupt("return",l.sent);case 14:l.prev=14,l.t0=l.catch(5),console.error("ERROR: ".concat(l.t0));case 17:case"end":return l.stop()}},_callee3,null,[[5,14]])}))).apply(this,arguments)}function _deleteConnection(){return(_deleteConnection=Object(Q.a)(H.a.mark(function _callee4(e,t){var i,s,n,o,a;return H.a.wrap(function _callee4$(r){for(;;)switch(r.prev=r.next){case 0:if(e.rootState.user){r.next=2;break}return r.abrupt("return");case 2:return n=getBaseURL(e.rootState),o=e.rootState.user.api_key,a=L()(i=L()(s="".concat(n,"/connections/")).call(s,t,"?api_key=")).call(i,o),r.prev=5,r.next=8,fetch(a,{method:"DELETE"});case 8:e.dispatch("fetchConnectionsList"),r.next=14;break;case 11:r.prev=11,r.t0=r.catch(5),console.error("ERROR: ".concat(r.t0));case 14:case"end":return r.stop()}},_callee4,null,[[5,11]])}))).apply(this,arguments)}function _checkOauthConnection(){return(_checkOauthConnection=Object(Q.a)(H.a.mark(function _callee5(e,t){var i,s,n,o,a,r,l;return H.a.wrap(function _callee5$(c){for(;;)switch(c.prev=c.next){case 0:if(e.rootState.user){c.next=2;break}return c.abrupt("return");case 2:return n=getBaseURL(e.rootState),o=e.rootState.user.api_key,a=L()(i=L()(s="".concat(n,"/connections/check_oauth/")).call(s,t,"?api_key=")).call(i,o),c.next=7,fetch(a);case 7:return r=c.sent,c.next=10,r.json();case 10:if(l=c.sent,r.ok){c.next=13;break}throw new Error(l.errors);case 13:return e.commit("setLoadingConnections"),e.dispatch("fetchConnectionsList"),c.abrupt("return",l);case 16:case"end":return c.stop()}},_callee5)}))).apply(this,arguments)}function _fetchOAuthFileList(){return(_fetchOAuthFileList=Object(Q.a)(H.a.mark(function _callee6(e,t){var i,s,n,o,a,r,l;return H.a.wrap(function _callee6$(c){for(;;)switch(c.prev=c.next){case 0:if(e.rootState.user){c.next=2;break}return c.abrupt("return");case 2:return n=getBaseURL(e.rootState,"v1"),o=e.rootState.user.api_key,a=L()(i=L()(s="".concat(n,"/imports/service/")).call(s,t,"/list_files?api_key=")).call(i,o),c.next=7,fetch(a);case 7:return r=c.sent,c.next=10,r.json();case 10:if(l=c.sent,r.ok){c.next=13;break}throw new Error(l.errors);case 13:return c.abrupt("return",l);case 14:case"end":return c.stop()}},_callee6)}))).apply(this,arguments)}function _createNewOauthConnection(){return(_createNewOauthConnection=Object(Q.a)(H.a.mark(function _callee7(e,t){var i;return H.a.wrap(function _callee7$(s){for(;;)switch(s.prev=s.next){case 0:if(e.rootState.user){s.next=2;break}return s.abrupt("return");case 2:return s.next=4,__createNewConnection(e,{connector:t,type:"oauth-service"});case 4:return i=s.sent,e.dispatch("fetchConnectionsList"),s.abrupt("return",i&&i.auth_url);case 7:case"end":return s.stop()}},_callee7)}))).apply(this,arguments)}function _createNewConnection2(){return(_createNewConnection2=Object(Q.a)(H.a.mark(function _callee8(e,t){var i,s,n,o;return H.a.wrap(function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:if(i=t.name,s=t.connector,n=Object(W.a)(t,["name","connector"]),e.rootState.user){a.next=3;break}return a.abrupt("return");case 3:return a.next=5,__createNewConnection(e,{name:i,connector:s,parameters:n});case 5:return o=a.sent,e.dispatch("fetchConnectionsList"),a.abrupt("return",o&&o.id);case 8:case"end":return a.stop()}},_callee8)}))).apply(this,arguments)}function _editExistingConnection(){return(_editExistingConnection=Object(Q.a)(H.a.mark(function _callee9(e,t){var i,s,n,o,a,r,l,c,h,d;return H.a.wrap(function _callee9$(u){for(;;)switch(u.prev=u.next){case 0:if(n=t.id,o=t.name,t.connector,a=Object(W.a)(t,["id","name","connector"]),e.rootState.user){u.next=3;break}return u.abrupt("return");case 3:return r=getBaseURL(e.rootState),l=e.rootState.user.api_key,c=L()(i=L()(s="".concat(r,"/connections/")).call(s,n,"?api_key=")).call(i,l),u.next=8,fetch(c,{method:"PUT",headers:{"content-type":"application/json"},body:S()({name:o,parameters:a})});case 8:if((h=u.sent).ok){u.next=14;break}return u.next=12,h.json();case 12:throw d=u.sent,new Error(d.errors);case 14:return e.dispatch("fetchConnectionsList"),u.abrupt("return",n);case 16:case"end":return u.stop()}},_callee9)}))).apply(this,arguments)}function _connectionDryrun(){return(_connectionDryrun=Object(Q.a)(H.a.mark(function _callee10(e,t){var i,s,n,o,a,r,l,c,h,d,u,p;return H.a.wrap(function _callee10$(g){for(;;)switch(g.prev=g.next){case 0:if(n=t.connector,o=t.id,a=t.sql_query,r=t.import_as,e.rootState.user){g.next=3;break}return g.abrupt("return");case 3:return l=getBaseURL(e.rootState,"v1"),c=e.rootState.user.api_key,h=L()(i=L()(s="".concat(l,"/connectors/")).call(s,n,"/dryrun?api_key=")).call(i,c),g.next=8,fetch(h,{method:"POST",headers:{"content-type":"application/json"},body:S()({connection_id:o,sql_query:a,import_as:r})});case 8:if((d=g.sent).ok){g.next=14;break}return g.next=12,d.json();case 12:throw u=g.sent,new Error(u.errors);case 14:return g.next=16,d.json();case 16:return p=g.sent,e.dispatch("fetchConnectionsList"),g.abrupt("return",p&&p.id);case 19:case"end":return g.stop()}},_callee10)}))).apply(this,arguments)}function _createNewBQConnection(){return(_createNewBQConnection=Object(Q.a)(H.a.mark(function _callee11(e,t){var i,s,n,o,a,r,l,c,h,d,u;return H.a.wrap(function _callee11$(p){for(;;)switch(p.prev=p.next){case 0:if(s=t.name,n=t.billing_project,o=t.default_project,a=Object(W.a)(t,["name","billing_project","default_project"]),e.rootState.user){p.next=3;break}return p.abrupt("return");case 3:return r=getBaseURL(e.rootState),l=e.rootState.user.api_key,c=L()(i="".concat(r,"/connections?api_key=")).call(i,l),p.next=8,fetch(c,{method:"POST",headers:{"content-type":"application/json"},body:S()({name:s,connector:"bigquery",parameters:{billing_project:n,default_project:o,service_account:S()(a)}})});case 8:if((h=p.sent).ok){p.next=19;break}return p.prev=10,p.next=13,h.json();case 13:d=p.sent,p.next=18;break;case 16:p.prev=16,p.t0=p.catch(10);case 18:throw new Error(S()({status:h.status,message:d?d.errors:null}));case 19:return p.next=21,h.json();case 21:return u=p.sent,p.abrupt("return",u);case 23:case"end":return p.stop()}},_callee11,null,[[10,16]])}))).apply(this,arguments)}function _createNewBQConnectionThroughOAuth(){return(_createNewBQConnectionThroughOAuth=Object(Q.a)(H.a.mark(function _callee12(e){var t,i,s,n,o,a,r;return H.a.wrap(function _callee12$(l){for(;;)switch(l.prev=l.next){case 0:if(e.rootState.user){l.next=2;break}return l.abrupt("return");case 2:return i=getBaseURL(e.rootState),s=e.rootState.user.api_key,n=L()(t="".concat(i,"/connections?api_key=")).call(t,s),l.next=7,fetch(n,{method:"POST",headers:{"content-type":"application/json"},body:S()({connector:"bigquery"})});case 7:if((o=l.sent).ok){l.next=18;break}return l.prev=9,l.next=12,o.json();case 12:a=l.sent,l.next=17;break;case 15:l.prev=15,l.t0=l.catch(9);case 17:throw new Error(S()({status:o.status,message:a?a.errors:null}));case 18:return l.next=20,o.json();case 20:return r=l.sent,l.abrupt("return",r);case 22:case"end":return l.stop()}},_callee12,null,[[9,15]])}))).apply(this,arguments)}function _checkBQConnectionThroughOAuth(){return(_checkBQConnectionThroughOAuth=Object(Q.a)(H.a.mark(function _callee13(e){var t,i,s,n,o,a,r;return H.a.wrap(function _callee13$(l){for(;;)switch(l.prev=l.next){case 0:if(e.rootState.user){l.next=2;break}return l.abrupt("return");case 2:return i=getBaseURL(e.rootState),s=e.rootState.user.api_key,n=L()(t="".concat(i,"/connections/check_oauth/bigquery?api_key=")).call(t,s),l.next=7,fetch(n);case 7:if((o=l.sent).ok){l.next=18;break}return l.prev=9,l.next=12,o.json();case 12:a=l.sent,l.next=17;break;case 15:l.prev=15,l.t0=l.catch(9);case 17:throw new Error(S()({status:o.status,message:a?a.errors:null}));case 18:return l.next=20,o.json();case 20:return r=l.sent,l.abrupt("return",r);case 22:case"end":return l.stop()}},_callee13,null,[[9,15]])}))).apply(this,arguments)}function _editBQConnection(){return(_editBQConnection=Object(Q.a)(H.a.mark(function _callee14(e,t){var i,s,n,o,a,r,l,c,h,d,u,p;return H.a.wrap(function _callee14$(g){for(;;)switch(g.prev=g.next){case 0:if(n=t.bqConnectionId,o=t.name,a=t.billing_project,r=t.default_project,l=Object(W.a)(t,["bqConnectionId","name","billing_project","default_project"]),e.rootState.user){g.next=3;break}return g.abrupt("return");case 3:return c=getBaseURL(e.rootState),h=e.rootState.user.api_key,d=L()(i=L()(s="".concat(c,"/connections/")).call(s,n,"?api_key=")).call(i,h),g.next=8,fetch(d,{method:"PUT",headers:{"content-type":"application/json"},body:S()({name:o,connector:"bigquery",parameters:{billing_project:a,default_project:r,service_account:S()(l)}})});case 8:if((u=g.sent).ok){g.next=19;break}return g.prev=10,g.next=13,u.json();case 13:p=g.sent,g.next=18;break;case 16:g.prev=16,g.t0=g.catch(10);case 18:throw new Error(S()({status:u.status,message:p?p.errors:null}));case 19:return g.abrupt("return",{id:n});case 20:case"end":return g.stop()}},_callee14,null,[[10,16]])}))).apply(this,arguments)}function _updateBQConnectionBillingProject(){return(_updateBQConnectionBillingProject=Object(Q.a)(H.a.mark(function _callee15(e,t){var i,s,n,o,a,r,l,c,h;return H.a.wrap(function _callee15$(d){for(;;)switch(d.prev=d.next){case 0:if(n=t.id,o=t.billing_project,e.rootState.user){d.next=3;break}return d.abrupt("return");case 3:return a=getBaseURL(e.rootState),r=e.rootState.user.api_key,l=L()(i=L()(s="".concat(a,"/connections/")).call(s,n,"?api_key=")).call(i,r),d.next=8,fetch(l,{method:"PUT",headers:{"content-type":"application/json"},body:S()({parameters:{billing_project:o}})});case 8:if((c=d.sent).ok){d.next=19;break}return d.prev=10,d.next=13,c.json();case 13:h=d.sent,d.next=18;break;case 16:d.prev=16,d.t0=d.catch(10);case 18:throw new Error(S()({status:c.status,message:h?h.errors:null}));case 19:return d.abrupt("return",{id:n});case 20:case"end":return d.stop()}},_callee15,null,[[10,16]])}))).apply(this,arguments)}function _checkServiceAccount(){return(_checkServiceAccount=Object(Q.a)(H.a.mark(function _callee16(e,t){var i,s,n,o,a,r,l;return H.a.wrap(function _callee16$(c){for(;;)switch(c.prev=c.next){case 0:return s=getBaseURL(e.rootState,"v1"),n=e.rootState.user.api_key,o=L()(i="".concat(s,"/connectors/bigquery/projects?api_key=")).call(i,n),c.next=5,fetch(o,{method:"POST",headers:{"content-type":"application/json"},body:S()({service_account:t})});case 5:if((a=c.sent).ok){c.next=11;break}return c.next=9,a.json();case 9:throw r=c.sent,new Error(r.errors);case 11:return c.next=13,a.json();case 13:return l=c.sent,c.abrupt("return",l);case 15:case"end":return c.stop()}},_callee16)}))).apply(this,arguments)}function _fetchBQProjectsList(){return(_fetchBQProjectsList=Object(Q.a)(H.a.mark(function _callee17(e,t){var i,s,n,o,a,r,l;return H.a.wrap(function _callee17$(c){for(;;)switch(c.prev=c.next){case 0:if(e.rootState.user){c.next=2;break}return c.abrupt("return");case 2:return e.commit("setLoadingProjects"),n=getBaseURL(e.rootState),o=e.rootState.user.api_key,a=L()(i=L()(s="".concat(n,"/connections/")).call(s,t,"/projects?api_key=")).call(i,o),c.next=8,fetch(a);case 8:if((r=c.sent).ok){c.next=20;break}return e.commit("setProjects",[]),c.t0=Error,c.t1=S.a,c.t2=r.status,c.next=16,r.json();case 16:throw c.t3=c.sent.errors,c.t4={status:c.t2,message:c.t3},c.t5=(0,c.t1)(c.t4),new c.t0(c.t5);case 20:return c.next=22,r.json();case 22:return l=c.sent,e.commit("setProjects",l||[]),c.abrupt("return",l);case 25:case"end":return c.stop()}},_callee17)}))).apply(this,arguments)}function _fetchBQDatasetsList(){return(_fetchBQDatasetsList=Object(Q.a)(H.a.mark(function _callee18(e,t){var i,s,n,o,a,r,l,c,h,d;return H.a.wrap(function _callee18$(u){for(;;)switch(u.prev=u.next){case 0:if(o=t.connectionId,a=t.projectId,e.rootState.user){u.next=3;break}return u.abrupt("return");case 3:return e.commit("setLoadingDatasets"),r=getBaseURL(e.rootState),l=e.rootState.user.api_key,c=L()(i=L()(s=L()(n="".concat(r,"/bigquery/datasets?api_key=")).call(n,l,"&connection_id=")).call(s,o,"&project_id=")).call(i,a),u.next=9,fetch(c);case 9:if((h=u.sent).ok){u.next=21;break}return e.commit("setBQDatasets",[]),u.t0=Error,u.t1=S.a,u.t2=h.status,u.next=17,h.json();case 17:throw u.t3=u.sent.errors,u.t4={status:u.t2,message:u.t3},u.t5=(0,u.t1)(u.t4),new u.t0(u.t5);case 21:return u.next=23,h.json();case 23:d=u.sent,e.commit("setBQDatasets",d||[]);case 25:case"end":return u.stop()}},_callee18)}))).apply(this,arguments)}var G=i(28),Y=i.n(G);var K={namespaced:!0,state:{connections:null,projects:null,bqDatasets:null,loadingConnections:!1,loadingProjects:!0},getters:{getBigqueryConnection:function getBigqueryConnection(e){var t;return e.connections?Y()(t=e.connections).call(t,function(e){return"bigquery"===e.connector}):null},hasBigqueryConnection:function hasBigqueryConnection(e,t){return!!t.getBigqueryConnection}},mutations:{setConnections:function setConnections(e,t){e.connections=v()(t).call(t,function(e){return!("bigquery"===e.connector&&!e.complete)}),e.loadingConnections=!1},setLoadingConnections:function setLoadingConnections(e){e.loadingConnections=!0},setLoadingProjects:function setLoadingProjects(e){e.loadingProjects=!0},setLoadingDatasets:function setLoadingDatasets(e){e.loadingDatasets=!0},setProjects:function setProjects(e,t){e.projects=t,e.loadingProjects=!1},setBQDatasets:function setBQDatasets(e,t){e.bqDatasets=t,e.loadingDatasets=!1}},actions:{requestConnector:function requestConnector(e,t){var i,s=t.user,n=t.connector,o=[L()(i="submissions/v3/integration/submit/".concat("474999","/")).call(i,"1644a76c-4876-45ae-aa85-2420cd3fb3ff")],a={data:function getFormData(e,t){return S()({fields:[{name:"email",value:e.email},{name:"lastname",value:e.last_name||"no_last_name"},{name:"firstname",value:e.name||"no_firstname"},{name:"jobtitle",value:e.job_role||"no_jobtitle"},{name:"company",value:e.company||(e.organization?e.organization.display_name||e.organization.name:"no_company")},{name:"phone",value:e.phone||"no_phone"},{name:"connector_request_type",value:"request"},{name:"connector_request_name",value:t}],context:{pageUri:window.location.href,pageName:document.title}})}(s,n),baseUrl:"https://api.hsforms.com"};return new E.a(function(t,i){e.rootState.client.post([o],a,function(e){t(!e)})})},deleteConnection:function deleteConnection(e,t){return _deleteConnection.apply(this,arguments)},editExistingConnection:function editExistingConnection(e,t){return _editExistingConnection.apply(this,arguments)},createNewConnection:function createNewConnection(e,t){return _createNewConnection2.apply(this,arguments)},createNewOauthConnection:function createNewOauthConnection(e,t){return _createNewOauthConnection.apply(this,arguments)},checkOauthConnection:function checkOauthConnection(e,t){return _checkOauthConnection.apply(this,arguments)},fetchOAuthFileList:function fetchOAuthFileList(e,t){return _fetchOAuthFileList.apply(this,arguments)},connectionDryrun:function connectionDryrun(e,t){return _connectionDryrun.apply(this,arguments)},fetchConnectionById:function fetchConnectionById(e,t){return _fetchConnectionById.apply(this,arguments)},fetchConnectionsList:function fetchConnectionsList(e){return _fetchConnectionsList.apply(this,arguments)},checkServiceAccount:function checkServiceAccount(e,t){return _checkServiceAccount.apply(this,arguments)},createNewBQConnection:function createNewBQConnection(e,t){return _createNewBQConnection.apply(this,arguments)},createNewBQConnectionThroughOAuth:function createNewBQConnectionThroughOAuth(e){return _createNewBQConnectionThroughOAuth.apply(this,arguments)},checkBQConnectionThroughOAuth:function checkBQConnectionThroughOAuth(e){return _checkBQConnectionThroughOAuth.apply(this,arguments)},updateBQConnectionBillingProject:function updateBQConnectionBillingProject(e,t){return _updateBQConnectionBillingProject.apply(this,arguments)},editBQConnection:function editBQConnection(e,t){return _editBQConnection.apply(this,arguments)},fetchBQProjectsList:function fetchBQProjectsList(e,t){return _fetchBQProjectsList.apply(this,arguments)},fetchBQDatasetsList:function fetchBQDatasetsList(e,t){return _fetchBQDatasetsList.apply(this,arguments)}}},J=i(905),X={namespaced:!0,state:{searchTerm:"",tag:"",resultsPerPage:6,maps:{isFetching:!1,isErrored:!1,results:{},error:{},page:1,numPages:1,numResults:0},datasets:{isFetching:!1,isErrored:!1,results:{},error:{},page:1,numPages:1,numResults:0},tags:{isFetching:!1,isErrored:!1,results:[],error:{},page:1,numPages:1,numResults:0}},getters:{requestParameters:function requestParameters(e){var t={per_page:e.resultsPerPage,shared:"yes",exclude_shared:!1};return e.searchTerm&&(t.q=e.searchTerm),e.tag&&(t.tags=e.tag),t}},mutations:{updatePage:function updatePage(e,t){var i=t.section,s=t.page;e[i].page=s},updateSearchTerm:function updateSearchTerm(e,t){var i=t.query,s=t.tag;e.searchTerm=i,e.tag=s},setFetchingState:function setFetchingState(e,t){e[t].isFetching=!0},setRequestError:function setRequestError(e,t){var i=t.requestType,s=t.error;e[i].error=s},setMaps:function setMaps(e,t){e.maps.results=b(t.visualizations,"id"),e.maps.numResults=t.total_entries,e.maps.numPages=Math.ceil(t.total_entries/e.resultsPerPage),e.maps.isFetching=!1},setDatasets:function setDatasets(e,t){e.datasets.results=b(t.visualizations,"id"),e.datasets.numResults=t.total_entries,e.datasets.numPages=Math.ceil(t.total_entries/e.resultsPerPage),e.datasets.isFetching=!1},setTags:function setTags(e,t){e.tags.results=t.result,e.tags.numResults=t.total,e.tags.numPages=Math.ceil(t.total/e.resultsPerPage),e.tags.isFetching=!1},updateNumberLikes:function updateNumberLikes(){},updateVisualization:function updateVisualization(e,t){var i=t.visualizationId,s=t.visualizationAttributes,n=e.maps.results[i]||e.datasets.results[i];n&&Object(c.a)(n,s)},resetState:function resetState(e){e.searchTerm="",e.tag="",e.maps={isFetching:!1,isErrored:!1,results:{},error:{},page:1,numPages:1,numResults:0},e.datasets={isFetching:!1,isErrored:!1,results:{},error:{},page:1,numPages:1,numResults:0},e.tags={isFetching:!1,isErrored:!1,results:[],error:{},page:1,numPages:1,numResults:0}}},actions:{deleteLike:deleteLike,like:like,doSearch:function doSearch(e,t){e.commit("updateSearchTerm",t),e.commit("setFetchingState","maps"),e.commit("setFetchingState","datasets"),e.dispatch("fetchMaps",e.getters.requestParameters),e.dispatch("fetchDatasets",e.getters.requestParameters),t.query&&(e.dispatch("fetchTags",e.getters.requestParameters),e.commit("setFetchingState","tags"))},changeSectionPage:function changeSectionPage(e,t){e.commit("setFetchingState",t.section);var i=t.section[0].toUpperCase()+t.section.substr(1);e.commit("updatePage",t),e.dispatch("fetch".concat(i),e.getters.requestParameters)},fetchMaps:function fetchMaps(e,t){e.rootState.client.getVisualization("",Object(h.a)({},t,{types:"derived,kuviz",page:e.state.maps.page}),function(t,i,s){if(t)return e.commit("setRequestError",{requestType:"maps",error:t});e.commit("setMaps",s)})},fetchDatasets:function fetchDatasets(e,t){e.rootState.client.getVisualization("",Object(h.a)({},t,{type:"table",page:e.state.datasets.page,with_dependent_visualizations:10}),function(t,i,s){if(t)return e.commit("setRequestError",{requestType:"datasets",error:t});e.commit("setDatasets",s)})},fetchTags:function fetchTags(e,t){e.rootState.client.getTags(Object(h.a)({},t,{types:"table,derived,kuviz",page:e.state.tags.page,include_shared:!0}),function(t,i,s){if(t)return e.commit("setRequestError",{requestType:"tags",error:t});e.commit("setTags",s)})},resetState:function resetState(e){e.commit("resetState")}}},Z=i(56),ee=i.n(Z),te={namespaced:!0,state:{isFetching:!1,isErrored:!1,error:{},notifications:[]},computed:{},getters:{},mutations:{setNotifications:function setNotifications(e,t){e.notifications=t,e.isFetching=!1,e.isErrored=!1,e.error=[]},setRequestError:function setRequestError(e,t){e.isFetching=!1,e.isErrored=!0,e.error=t,e.notifications=[]},setFetchingState:function setFetchingState(e){e.isFetching=!0,e.isErrored=!1,e.error=[],e.notifications=[]}},actions:{fetchNotifications:function fetchNotifications(e,t){e.commit("setFetchingState"),e.rootState.client.getConfig(function(i,s,n){i?e.commit("setRequestError",i):(e.commit("setNotifications",n.unfiltered_organization_notifications),e.dispatch("markNotificationsAsRead",t))})},markNotificationsAsRead:function markNotificationsAsRead(e,t){var i,s=(new Date).toISOString();ee()(i=e.state.notifications).call(i,function(i){var n=t.userId,o=t.apiKey;if(!i.read_at){var a=Object(h.a)({},i,{read_at:s});e.rootState.client.updateNotification(n,o,a,function(){})}})}}},ie=i(38),se=i.n(ie),ne=i(53),oe=i(54),ae={namespaced:!0,state:{isFetching:!1,isErrored:!1,error:{},list:{},metadata:{total_entries:0}},getters:{hasRecentContent:function hasRecentContent(e){return e.metadata.total_entries>0}},mutations:{setFetchingState:setFetchingState,setRequestError:setRequestError,updateNumberLikes:updateNumberLikes,updateVisualization:mutations_visualizations_updateVisualization,setRecentContent:function setRecentContent(e,t){e.list=b(t,"id"),e.metadata={total_entries:t.length},e.isFetching=!1}},actions:{like:like,deleteLike:deleteLike,updateVisualization:visualizations_updateVisualization,fetch:function fetch(e){e.commit("setFetchingState");var t=Object(h.a)({},C.b,{order:"updated_at",order_direction:"desc",types:"table,derived,kuviz",per_page:3,page:1}),i=function whenFetchVisualizations(e,t){return new E.a(function(i,s){e.rootState.client.getVisualization("",t,function(t,n,o){if(t)return e.commit("setRequestError",t),s(t);i(o)})})}(e,t),s=function external_visualizations_whenFetchVisualizations(e){return new E.a(function(t,i){var s=[];if(e.rootState.externalMaps.customStorageInitialized)return e.rootState.customStorage.getVisualizations().then(function(e){s=customStorageToVisualization(e,{}),t(s)}).catch(function(t){e.commit("setRequestError",t),i(t)});t(s)})}(e);E.a.all([i,s]).then(function(i){var s,n=Object(oe.a)(i,2),o=n[0],a=n[1],r=L()(s=[]).call(s,Object(ne.a)(o.visualizations),Object(ne.a)(a)),l=t.order,c=t.order_direction,h=[];l&&c&&(h=N()(r).call(r,function(e,t){return new Date(t[l])-new Date(e[l])}));var d=h.length>3?3:h.length;e.commit("setRecentContent",se()(h).call(h,0,d))}).catch(function(t){e.commit("setRequestError",t)})}}},re=i(91);function setApps(e,t){e.list=b(t,"id"),e.isFetching=!1,e.isErrored=!1,e.error=[]}function apps_setRequestError(e,t){e.isFetching=!1,e.isErrored=!0,e.error=t,e.list={}}function apps_setFetchingState(e){e.isFetching=!0,e.isErrored=!1,e.error=[],e.list={}}function apps_fetch(e){return function(t){var i=t.rootState.user.api_key;t.commit("setFetchingState"),t.rootState.client[e](i,function(e,i,s){if(e){var n=s.responseJSON&&s.responseJSON.errors||{message:s.responseText||s.statusText};t.commit("setRequestError",n)}else t.commit("setApps",s.result)})}}var le={namespaced:!0,state:{isFetching:!1,isErrored:!1,error:[],list:{}},computed:{},getters:{},mutations:{setApps:setApps,addApp:function addApp(e,t){e.list=Object(h.a)({},e.list,Object(re.a)({},t.id,t))},setFetchingState:apps_setFetchingState,setRequestError:apps_setRequestError,updateOAuthApp:function updateOAuthApp(e,t){e.list.hasOwnProperty(t.id)&&Object(c.a)(e.list[t.id],t)}},actions:{fetch:apps_fetch("getOAuthApps"),create:function createOAuth(e,t){var i=e.rootState.user.api_key;return new E.a(function(s,n){e.rootState.client.createApp(i,t,function(t,i,o){if(t){var a=o.responseJSON&&o.responseJSON.errors||{message:o.responseText||o.statusText};return n(a)}e.commit("addApp",o),s(o)})})},update:function updateOAuth(e,t){var i=e.rootState.user.api_key;return new E.a(function(s,n){e.rootState.client.updateApp(i,t,function(t,i,o){if(t){var a=o.responseJSON&&o.responseJSON.errors||{message:o.responseText||o.statusText};return n(a)}e.commit("updateOAuthApp",o),s(o)})})},setApps:setApps,regenerateCredentials:function regenerateCredentials(e,t){var i=e.rootState.user.api_key;e.rootState.client.regenerateClientSecret(i,t,function(t,i,s){t?e.commit("setRequestError",[s.responseText]):e.commit("updateOAuthApp",s)})},delete:function _delete(e,t){var i=e.rootState.user.api_key;return new E.a(function(s,n){e.rootState.client.deleteApp(i,t,function(e,t,i){if(e)return n(i.responseJSON.errors);s()})})}}},ce={namespaced:!0,state:{isFetching:!1,isErrored:!1,error:[],list:{}},computed:{},getters:{},mutations:{setApps:setApps,setRequestError:apps_setRequestError,setFetchingState:apps_setFetchingState},actions:{fetch:apps_fetch("getConnectedApps"),revoke:function revoke(e,t){var i=e.rootState.user.api_key;return new E.a(function(s,n){e.rootState.client.revokeOAuthApp(i,t,function(e,t,i){if(e)return n(i.responseJSON.errors);s()})})}}};function direct_db_connection_setFetchingState(e){e.isFetching=!0}function direct_db_connection_setRequestError(e,t){e.error=t}i(37);var he={namespaced:!0,modules:{ip:{namespaced:!0,state:{isFetching:!1,isErrored:!1,error:{},list:[]},mutations:{setFetchingState:direct_db_connection_setFetchingState,setIPs:function setIPs(e,t){e.list=t,e.isFetching=!1,e.isErrored=!1,e.error={}},setIPsRequestError:direct_db_connection_setRequestError},actions:{fetch:function fetchIPs(e){return e.commit("setFetchingState"),new E.a(function(t,i){e.rootState.client.directDBConnection().getIPs(function(s,n,o){if(s){var a=o.responseJSON&&o.responseJSON.errors||o.responseText||o.statusText;return e.commit("setIPsRequestError",a),i(a)}var r=o.ips||[];e.commit("setIPs",r),t(r)})})},set:function direct_db_connection_setIPs(e,t){return new E.a(function(i,s){e.rootState.client.directDBConnection().setIPs(t,function(t,n,o){if(t){var a=o.responseJSON&&o.responseJSON.errors&&o.responseJSON.errors.ips&&o.responseJSON.errors.ips.join(". ")||o.responseJSON&&o.responseJSON.errors||o.responseText||o.statusText;return e.commit("setIPsRequestError",a),s(a)}var r=o.ips||[];e.commit("setIPs",r),i(r)})})}}},certificates:{namespaced:!0,state:{isFetching:!1,isErrored:!1,error:{},list:{}},mutations:{setFetchingState:direct_db_connection_setFetchingState,setCertificates:function setCertificates(e,t){e.list=b(t,"id"),e.isFetching=!1,e.isErrored=!1,e.error={}},setCertificatesRequestError:direct_db_connection_setRequestError},actions:{fetch:function fetchCertificates(e){e.commit("setFetchingState"),e.rootState.client.directDBConnection().getCertificates(function(t,i,s){if(t){var n=s.responseJSON&&s.responseJSON.errors||{message:s.responseText||s.statusText};e.commit("setCertificatesRequestError",n)}else e.commit("setCertificates",s)})},revoke:function revokeCertificate(e,t){return new E.a(function(i,s){e.rootState.client.directDBConnection().revokeCertificate(t,function(e,t,n){if(e){var o=n.responseJSON&&n.responseJSON.errors||{message:n.responseText||n.statusText};return s(o)}i()})})}}}}};function _fetchTilesetsList(){return(_fetchTilesetsList=Object(Q.a)(H.a.mark(function _callee(e,t){var i,s,n,o,a,r,l,c,h,d,u,p,g,m,f,_,v,y;return H.a.wrap(function _callee$(w){for(;;)switch(w.prev=w.next){case 0:if(l=t.connectionId,c=t.projectId,h=t.datasetId,d=t.perPage,u=void 0===d?10:d,p=t.page,g=void 0===p?1:p,e.rootState.user){w.next=3;break}return w.abrupt("return");case 3:if(h){w.next=6;break}return e.commit("setTilesets",[]),w.abrupt("return");case 6:return e.commit("setLoadingTilesets"),m=getBaseURL(e.rootState),f=e.rootState.user.api_key,_=L()(i=L()(s=L()(n=L()(o=L()(a=L()(r="".concat(m,"/bigquery/tilesets?api_key=")).call(r,f,"&connection_id=")).call(a,l,"&project_id=")).call(o,c,"&dataset_id=")).call(n,h,"&per_page=")).call(s,u,"&page=")).call(i,g),w.next=12,fetch(_);case 12:return v=w.sent,w.next=15,v.json();case 15:if(y=w.sent,v.ok){w.next=19;break}throw e.commit("setTilesets",[]),new Error(S()({status:v.status,message:y.errors}));case 19:e.commit("setTilesets",y||[]);case 20:case"end":return w.stop()}},_callee)}))).apply(this,arguments)}function _getTileset(){return(_getTileset=Object(Q.a)(H.a.mark(function _callee2(e,t){var i,s,n,o,a,r,l,c,h,d,u,p,g;return H.a.wrap(function _callee2$(m){for(;;)switch(m.prev=m.next){case 0:if(r=t.source,l=t.tileset_id,c=t.connection_id,h=t.project_id,e.rootState.user){m.next=3;break}return m.abrupt("return");case 3:return d=getBaseURL(e.rootState),u=e.rootState.user.api_key,p=L()(i=L()(s=L()(n=L()(o=L()(a="".concat(d,"/")).call(a,r,"/tilesets/")).call(o,l,"?api_key=")).call(n,u,"&connection_id=")).call(s,c,"&project_id=")).call(i,h),m.prev=6,m.next=9,fetch(p);case 9:return g=m.sent,m.next=12,g.json();case 12:return m.abrupt("return",m.sent);case 15:m.prev=15,m.t0=m.catch(6),console.error("ERROR: ".concat(m.t0));case 18:case"end":return m.stop()}},_callee2,null,[[6,15]])}))).apply(this,arguments)}function _setPrivacy(){return(_setPrivacy=Object(Q.a)(H.a.mark(function _callee3(e,t){var i,s,n,o,a,r,l,c,h,d,u,p,g,m,f,_,v,y;return H.a.wrap(function _callee3$(w){for(;;)switch(w.prev=w.next){case 0:if(c=t.source,h=t.table,d=t.connection_id,u=t.project_id,p=t.dataset_id,g=t.privacy,e.rootState.user){w.next=3;break}return w.abrupt("return");case 3:return m=getBaseURL(e.rootState),f=e.rootState.user.api_key,_="public"===g?"publish":"unpublish",v=L()(i=L()(s=L()(n=L()(o=L()(a=L()(r=L()(l="".concat(m,"/")).call(l,c,"/tilesets/")).call(r,_,"?api_key=")).call(a,f,"&connection_id=")).call(o,d,"&project_id=")).call(n,u,"&dataset_id=")).call(s,p,"&tileset_id=")).call(i,h),w.next=9,fetch(v);case 9:if((y=w.sent).ok){w.next=20;break}return w.t0=Error,w.t1=S.a,w.t2=y.status,w.next=16,y.json();case 16:throw w.t3=w.sent.errors,w.t4={status:w.t2,errors:w.t3},w.t5=(0,w.t1)(w.t4),new w.t0(w.t5);case 20:case"end":return w.stop()}},_callee3)}))).apply(this,arguments)}var de={namespaced:!0,state:{tilesets:null,loadingTilesets:!1},mutations:{setTilesets:function setTilesets(e,t){e.tilesets=t,e.loadingTilesets=!1},setLoadingTilesets:function setLoadingTilesets(e){e.loadingTilesets=!0}},actions:{fetchTilesetsList:function fetchTilesetsList(e,t){return _fetchTilesetsList.apply(this,arguments)},getTileset:function getTileset(e,t){return _getTileset.apply(this,arguments)},setPrivacy:function setPrivacy(e,t){return _setPrivacy.apply(this,arguments)}}},ue=f.state.sql_api_template?f.state.sql_api_template.replace(/\/?(\?|#|$)/,"/$1"):r.Credentials.DEFAULT_SERVER_URL_TEMPLATE;s.default.use(n.a);var pe={state:{client:new a.a.AuthenticatedClient,customStorage:new l.CustomStorage("keplergl",new r.Credentials(p.state.username,p.state.api_key,ue),{client:"carto-dashboard"})},getters:{},modules:{config:f,user:p,maps:A,externalMaps:q,datasets:j,connectors:K,catalog:J.a,search:X,notifications:te,recentContent:ae,oAuthApps:le,connectedApps:ce,directDBConnection:he,tilesets:de}};t.default=new n.a.Store(pe)},71:function(e,t){e.exports={Mode:{NESTED:"nested",FLOAT:"float",DEFAULT:"nested"}}},732:function(e,t,i){var s=i(76),n=i(3),o=i(4),a=i(18);e.exports=o.extend({tagName:"input",className:"CDB-InputText CDB-Text",events:{keyup:"_onValueChange",change:"_onValueChange"},initialize:function initialize(e){var t,i;if(!e.editorModel)throw new Error("editorModel is required");this._editorModel=e.editorModel,this._onKeyPressed=n(t=this._onKeyPressed).call(t,this),this._onValueChange=n(i=this._onValueChange).call(i,this)},render:function render(){return this.$el.val(this.model.get("value")),this._setFocus(),this._initDocumentBind(),this},_setFocus:function _setFocus(){var e;s(n(e=function _context3(){this.$el.focus()}).call(e,this),100)},_initDocumentBind:function _initDocumentBind(){var e;n(e=a(document)).call(e,"keydown",this._onKeyPressed)},_destroyDocumentBind:function _destroyDocumentBind(){a(document).unbind("keydown",this._onKeyPressed)},_onKeyPressed:function _onKeyPressed(e){if(13===e.which){if(!this.model.isValid())return!1;this._editorModel.confirm()}},_onValueChange:function _onValueChange(){this._setValue(),this._checkValidity()},_setValue:function _setValue(){this.model.set("value",this.$el.val())},_checkValidity:function _checkValidity(){this.$el.toggleClass("has-error",!this.model.isValid())},clean:function clean(){this._destroyDocumentBind(),o.prototype.clean.apply(this)}})},733:function(e,t,i){i(31);var s=i(41),n=i(3);i(31);var o=i(1),a=i(2501);e.exports={init:function init(e,t){if(!e)throw new Error("model is required to initialize undoManager");t=t||{},this.model=e,this.model._undoManager=this.undoManager=new a({maximumStackLength:t.maximumStackLength||30,register:this.model,track:t.track}),this._trackEvents(),this._addMethods(),o.isEmpty(t.history)||(t.track&&this.undoManager.stopTracking(),this._addHistory(t.history),t.track&&this.undoManager.startTracking())},_trackEvents:function _trackEvents(){var e;o.each(["undo","redo"],function(e){var t;n(t=this.undoManager).call(t,e,function(){this.trigger(e,this.changed,this)},this.model)},this),n(e=this.undoManager.stack).call(e,"add remove reset",function(){this.trigger("unredoChanged",this.changed,this)},this.model)},_addHistory:function _addHistory(e){var t=this.undoManager.stack;o.each(e,function(i,s){e[s+1]&&t.add({after:e[s+1],before:i,type:"change",undoTypes:this.undoManager.undoTypes,object:this.model,magicFusionIndex:0})},this),t.pointer=t.length-1},_addMethods:function _addMethods(){o.extend(this.model,{undo:function undo(){this._undoManager.undo()},redo:function redo(){this._undoManager.redo()},canUndo:function canUndo(){return this._undoManager.isAvailable("undo")},canRedo:function canRedo(){return this._undoManager.isAvailable("redo")},getUndoHistory:function getUndoHistory(){var e=this._undoManager.stack.toJSON(),t=s(o).call(o,e,function(e,t,i){return e.push(t.before),e},[],this);return t.push(this.attributes),t}})}}},734:function(e,t,i){var s=i(41),n=i(1),o=i(1419),a=i(548),r=i(2505),l=i(2504),c=i(2503),h=i(1418),d=i(2502),u={none:{tooltipTranslationKey:"editor.style.tooltip.none",labelTranslationKey:"editor.style.types.none",checkIfValid:function checkIfValid(e){return!e},defaultStyles:o},simple:{tooltipTranslationKey:"editor.style.style-form.aggregation.tooltips.simple",labelTranslationKey:"editor.style.types.simple",iconTemplate:i(1417),checkIfValid:function checkIfValid(e){return!!e},defaultStyles:a},squares:{tooltipTranslationKey:"editor.style.style-form.aggregation.tooltips.squares",labelTranslationKey:"editor.style.types.squares",iconTemplate:i(1416),checkIfValid:function checkIfValid(e){return"point"===e},defaultStyles:c},hexabins:{tooltipTranslationKey:"editor.style.style-form.aggregation.tooltips.hexabins",labelTranslationKey:"editor.style.types.hexabins",iconTemplate:i(1415),checkIfValid:function checkIfValid(e){return"point"===e},defaultStyles:h},regions:{tooltipTranslationKey:"editor.style.style-form.aggregation.tooltips.regions",labelTranslationKey:"editor.style.types.regions",iconTemplate:i(1414),checkIfValid:function checkIfValid(e){return"point"===e},defaultStyles:d},animation:{tooltipTranslationKey:"editor.style.style-form.aggregation.tooltips.animation",labelTranslationKey:"editor.style.types.animation",iconTemplate:i(1413),checkIfValid:function checkIfValid(e){return"point"===e},defaultStyles:l},heatmap:{tooltipTranslationKey:"editor.style.style-form.aggregation.tooltips.heatmap",labelTranslationKey:"editor.style.types.heatmap",iconTemplate:i(1412),checkIfValid:function checkIfValid(e){return"point"===e},defaultStyles:r}};e.exports={getDefaultStyleAttrsByType:function getDefaultStyleAttrsByType(e,t){return u[e].defaultStyles.generateAttributes(t)},getStyleTypes:function getStyleTypes(e,t){return s(n).call(n,u,function(i,s,n){return e!==n&&s.checkIfValid&&!s.checkIfValid(t)||i.push({value:n,label:_t(s.labelTranslationKey),tooltip:_t(s.tooltipTranslationKey),iconTemplate:s.iconTemplate}),i},[])},getFormTemplateByType:function getFormTemplateByType(e){return u[e].formTemplate},getAggregationTypes:function getAggregationTypes(){return["squares","hexabins","regions"]}}},736:function(e,t,i){var s=i(1),n=i(84),o=i(2550);e.exports=n.core.Model.extend({defaults:{attrsNames:[],show_stats:!1,show_source:!1},defaultState:{collapsed:!1},initialize:function(e,t,i){if(i=i||{},!t.dataviewModel)throw new Error("dataviewModel is required.");if(!t.layerModel)throw new Error("layerModel is required.");this.dataviewModel=t.dataviewModel,this.layerModel=t.layerModel,this._autoStyleEnabledWhenCreated=void 0===i.autoStyleEnabled||i.autoStyleEnabled,this.activeAutoStyler(),this.listenTo(this,"change:style",this.activeAutoStyler)},activeAutoStyler:function(){this.isAutoStyleEnabled()&&!this.autoStyler&&(this.autoStyler=o.get(this.dataviewModel,this.layerModel,this.get("style")))},update:function(e){var t=s.pick(e,this.get("attrsNames"));return this.set(t),this.dataviewModel.update(e),this._triggerChangesInAutoStyle(),!(!this.changedAttributes()&&!this.dataviewModel.changedAttributes())},_triggerChangesInAutoStyle:function(){var e=this.changed&&this.changed.style&&this.changed.style.auto_style&&this.changed.style.auto_style.definition,t=this.previousAttributes(),i=t.style&&t.style.auto_style&&t.style.auto_style.definition;s.isEqual(e,i)||this.trigger("customAutoStyle",this)},remove:function(){this.dataviewModel.remove(),this.trigger("destroy",this),this.stopListening()},isAutoStyleEnabled:function(){var e=this.get("style");return("category"===this.get("type")||"histogram"===this.get("type"))&&(e&&e.auto_style?e&&e.auto_style&&e.auto_style.allowed:this._autoStyleEnabledWhenCreated)},getWidgetColor:function(){var e=this.get("style"),t=e&&e.widget_style,i=t&&t.definition&&t.definition.color&&t.definition.color.fixed;return(t&&t.widget_color_changed||t&&!t.widget_color_changed&&"#9DE0AD"!==i)&&i},hasColorsAutoStyle:function(){var e=this.getAutoStyle(),t=!1;return!(!e||s.isEmpty(e)||s.isEmpty(e.definition))&&(s.each(e.definition,function(e){e.color&&e.color.range&&e.color.range.length>0&&(t=!0)},this),t)},getColor:function(e){return this.isAutoStyleEnabled()&&this.isAutoStyle()&&"category"===this.get("type")?this.autoStyler.colors.getColorByCategory(e):this.getWidgetColor()},isAutoStyle:function(){return this.get("autoStyle")},autoStyle:function(){if(this.isAutoStyleEnabled()&&this.dataForAutoStyle()){var e=this.layerModel,t=e.get("cartocss");!t&&e.get("meta")&&(t=e.get("meta").cartocss),e.set("initialStyle",t);var i=this.autoStyler.getStyle();e.set("cartocss",i),this.set("autoStyle",!0)}},dataForAutoStyle:function(){return this.dataviewModel.get("data").length>0},reapplyAutoStyle:function(){var e=this.autoStyler.getStyle();this.layerModel.set("cartocss",e),this.set("autoStyle",!0)},cancelAutoStyle:function(e){e||this.layerModel.restoreCartoCSS(),this.set("autoStyle",!1)},getAutoStyle:function(){var e=this.get("style"),t=this.layerModel,i=t.get("cartocss")||t.get("meta")&&t.get("meta").cartocss;if(this.isAutoStyleEnabled()&&this.autoStyler){if(e&&e.auto_style&&e.auto_style.definition){var n=s.extend(e.auto_style,{cartocss:i});return s.extend({},n,{definition:this.autoStyler.getDef(i)})}return{definition:this.autoStyler.getDef(i),cartocss:i}}return{}},_updateAutoStyle:function(e,t){this.autoStyler&&this.autoStyler.updateStyle(t),this.isAutoStyle()&&this.reapplyAutoStyle()},setInitialState:function(e){this.initialState=e||{}},applyInitialState:function(){var e=s.extend(this.initialState,{hasInitialState:!0});this.setState(e)},setState:function(e){this.set(e)},getState:function(){var e={};for(var t in this.defaultState){var i=this.get(t),n=this.defaultState[t];void 0===n||void 0===i||s.isEqual(i,n)||(e[t]=i)}return e},forceResize:function(){var e=this.get("type");"time-series"!==e&&"histogram"!==e||this.trigger("forceResize")}})},737:function(e,t,i){var s=i(1),n=i(454),o=i(4);e.exports=o.extend({animateFromValues:function(e,t,i,o,a){var r=this.$(i),l=a||{},c=l.formatter||n.format("0,000"),h=l.templateData||{},d=l.debounceWait||500,u=t%1==0,p=function(e){e=u?Math.round(e):e;var t=s.isNaN(e)||void 0===e?l.defaultValue||0:c(e),i=s.extend({value:t},h);r.text(o(i))};0!==l.animationSpeed?(p(e),s.debounce(function(){r.prop("counter",e).stop().animate({counter:t},{duration:l.animationSpeed||500,easing:l.easingMethod||"swing",step:p})},d)()):p(t)},animateFromCurrentValue:function(e,t,i,o){var a=this.$(t),r=o||{},l=r.debounceWait||500,c=e,h=+this.$(t).text(),d=r.formatter||n.format("0,000"),u=r.templateData||{},p=c%1==0,g=function(t){t=p?Math.round(t):t,e=s.isNaN(t)||void 0===t?r.defaultValue||0:d(t);var n=s.extend({value:e},u);a.text(i(n))};0!==r.animationSpeed?(g(h),s.debounce(function(){a.prop("counter",h).stop().animate({counter:c},{duration:r.animationSpeed||500,easing:r.easingMethod||"swing",step:g})},l)()):g(c)},animateValue:function(e,t,i,o,a){var r=this.$(i),l=a||{},c=l.debounceWait||500,h=e.get(t),d=e.previous(t)||0,u=l.formatter||n.format("0,000"),p=l.templateData||{},g=h%1==0,m=function(e){e=g?Math.round(e):e;var t=s.isNaN(e)||void 0===e?l.defaultValue||0:u(e),i=s.extend({value:t},p);r.text(o(i))};0!==l.animationSpeed?(m(d),s.debounce(function(){r.prop("counter",d).stop().animate({counter:h},{duration:l.animationSpeed||500,easing:l.easingMethod||"swing",step:m})},c)()):m(h)}})},739:function(e,t){e.exports=function(e,t,i){return t.split(".").reduce(function(e,t){return(e||{})[t]},e)||i}},740:function(e,t,i){var s=i(6);e.exports=s.Model.extend({defaults:{username:"",avatar_url:""},url:function url(){return"//".concat(this.getHost(),"/api/v1/get_authenticated_users")},getHost:function getHost(){var e=window.location.host;return this.get("host")?this.get("host"):e}})},742:function(e,t,i){var s=i(32),n=i(6),o=i(1),a=i(1526),r=i(2911),l=i(2910),c=n.Model.extend({urlRoot:function urlRoot(){return this._configModel.get("base_url")+"/api/v1/users"},defaults:{avatar_url:"http://cartodb.s3.amazonaws.com/static/public_dashboard_default_avatar.png",username:"",email:""},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");this._configModel=t.configModel,e=e||{},o.isEmpty(this.get("organization"))||(this._organizationModel=new a(this.get("organization"),{configModel:this._configModel,currentUserId:this.id})),this.get("layers")&&(this.layers=new l(this.get("layers"),{configModel:this._configModel,currentUserId:this.id})),this.groups=new r(e.groups,{organization:this._organizationModel})},isViewer:function isViewer(){return!0===this.get("viewer")},isBuilder:function isBuilder(){return!this.isViewer()},isInsideOrg:function isInsideOrg(){return!!this._organizationModel&&(!!this._organizationModel.id||this.isOrgOwner())},isOrgOwner:function isOrgOwner(){return!!this._organizationModel&&this._organizationModel.getOwnerId()===this.get("id")},isOrgAdmin:function isOrgAdmin(){return!!this._organizationModel&&this._organizationModel.isOrgAdmin(this)},getOrganization:function getOrganization(){return this._organizationModel},isDOEnabled:function isDOEnabled(){return this.get("do_enabled")},isEnterprise:function isEnterprise(){return this.get("is_enterprise")},isIndividualUser:function isIndividualUser(){var e=["Individual","Annual Individual"];return s(e).call(e,this.get("account_type"))>-1},isFree2020User:function isFree2020User(){var e=["Free 2020"];return s(e).call(e,this.get("account_type"))>-1},hasRemainingByteQuota:function hasRemainingByteQuota(){return!(!this.get("remaining_byte_quota")||this.get("remaining_byte_quota")<=0)},hasTableLimits:function hasTableLimits(){return this.isIndividualUser()||this.isFree2020User()},hasRemainingTableCount:function hasRemainingTableCount(){return!this.hasTableLimits()||!(!this.get("table_count")||this.get("table_count")>=this.get("table_quota"))},canCreateDatasets:function canCreateDatasets(){return!(!this.hasRemainingByteQuota()||!this.hasRemainingTableCount())},updateTableCount:function updateTableCount(){var e=this.get("table_count");e&&this.set("table_count",e+1)},hasPublicMapsLimits:function hasPublicMapsLimits(){return(this.isIndividualUser()||this.isFree2020User())&&!this.hasUnlimitedPublicMaps()},hasRemainingPublicMaps:function hasRemainingPublicMaps(){return!this.hasPublicMapsLimits()||this.get("public_map_quota")>this.getTotalPublicMapsCount()},hasUnlimitedPublicMaps:function hasUnlimitedPublicMaps(){return null===this.get("public_map_quota")},getTotalPublicMapsCount:function getTotalPublicMapsCount(){return(this.get("public_privacy_map_count")||0)+(this.get("password_privacy_map_count")||0)+(this.get("link_privacy_map_count")||0)},hasPrivateMapsLimits:function hasPrivateMapsLimits(){return this.isFree2020User()&&!this.hasUnlimitedPrivateMaps()},hasRemainingPrivateMaps:function hasRemainingPrivateMaps(){return!this.hasPrivateMapsLimits()||this.get("private_map_quota")>this.getTotalPrivateMapsCount()},hasUnlimitedPrivateMaps:function hasUnlimitedPrivateMaps(){return null===this.get("private_map_quota")},getTotalPrivateMapsCount:function getTotalPrivateMapsCount(){return this.get("private_privacy_map_count")},canCreatePrivateDatasets:function canCreatePrivateDatasets(){var e=this.get("actions");return e&&e.private_tables},hasCreateMapsFeature:function hasCreateMapsFeature(){return this.isBuilder()},canCreateTwitterDataset:function canCreateTwitterDataset(){return this.hasOwnTwitterCredentials()},hasOwnTwitterCredentials:function hasOwnTwitterCredentials(){var e=this.get("twitter");return e&&e.customized_config||!1},canSelectPremiumOptions:function canSelectPremiumOptions(e){return this.get("actions")[e.isVisualization()?"private_maps":"private_tables"]},canStartTrial:function canStartTrial(){return!this.isInsideOrg()&&"FREE"===this.get("account_type")&&this.get("table_count")>0},hasPublicMapSharingDisabled:function hasPublicMapSharingDisabled(){return 0===this.get("public_map_quota")},hasPublicDatasetSharingDisabled:function hasPublicDatasetSharingDisabled(){return 0===this.get("public_dataset_quota")},isActionEnabled:function isActionEnabled(e){return this.get("actions")&&this.get("actions")[e]},hasAccountType:function hasAccountType(e){return this.get("account_type")===e},featureEnabled:function featureEnabled(e){var t=this.get("feature_flags");return!(!t||0===t.length||!e)&&o.contains(t,e)},upgradeContactEmail:function upgradeContactEmail(){return this.isInsideOrg()?this.isOrgOwner()?"enterprise-support@carto.com":this._organizationModel.getOwnerEmail():"support@carto.com"},nameOrUsername:function nameOrUsername(){return this.fullName()||this.get("username")},fullName:function fullName(){var e=this.get("name")||"",t=this.get("last_name")||"";return e||t?e+(e&&t?" ":"")+t:""},getMaxConcurrentImports:function getMaxConcurrentImports(){return this.get("limits")&&this.get("limits").concurrent_imports||1},getSchemaName:function getSchemaName(){return this.isInsideOrg()?this.get("username"):"public"},renderData:function renderData(e){var t=this.get("username");return e&&e.id===this.id&&(t=_t("user.you")),{username:t,avatar_url:this.get("avatar_url")}},clone:function clone(){var e=o.clone(this.attributes);return delete e.id,new c(e,{configModel:this._configModel})}});e.exports=c},743:function(e,t,i){i(34),i(67);var s=i(360),n=i(3),o=i(6),a=i(1),r=i(18),l=1.2;e.exports=o.Model.extend({defaults:{name:"",url:"",state:"",run_at:0,ran_at:0,modified_at:0,retried_times:0,interval:0,error_code:0,error_message:"",service_name:"",service_item_id:"",content_guessing:!0,type_guessing:!0},urlRoot:function urlRoot(){var e=this._configModel.urlVersion("synchronizations");return this._configModel.get("base_url")+"/api/"+e+"/synchronizations/"},initialize:function initialize(e,t){var i,s;if(!t.configModel)throw new Error("configModel is required");this._configModel=t.configModel,n(i=this).call(i,"destroy",function(){this.unset("id")}),this._checkState(),n(s=this).call(s,"change:error_code change:error_message change:state",this._checkState,this)},toJSON:function toJSON(){var e=a.clone(this.attributes),t={url:e.url,interval:e.interval,content_guessing:e.content_guessing,type_guessing:e.type_guessing,create_vis:e.create_vis};return"remote"===e.type&&a.extend(t,{remote_visualization_id:e.remote_visualization_id,create_vis:!1,value:e.value}),void 0!==e.id&&(t.id=e.id),e.service_name&&(t.service_name=e.service_name,t.service_item_id=e.service_item_id),e.connector&&(t.connector=e.connector),t},_checkState:function _checkState(){(this.get("error_code")||this.get("error_message"))&&this.set("state","failure")},syncNow:function syncNow(e){if(!e)throw new Error("callback is required");r.ajax({url:this.url()+"/sync_now",type:"PUT"}).always(e)},pollCheck:function pollCheck(e){var t=this,i=1500;this.pollTimer=s(function request(){t.destroyCheck();t.fetch({error:function error(e,i){t.set({error_message:i.statusText||"",state:"failure"})}});i*=l;t.pollTimer=s(request,i)},i)},destroyCheck:function destroyCheck(){clearInterval(this.pollTimer)},isSync:function isSync(){return!this.isNew()&&this.get("interval")>0},isSyncing:function isSyncing(){return"syncing"===this.get("state")||"queued"===this.get("state")},canSyncNow:function canSyncNow(){var e=new Date(this.get("ran_at")),t=new Date;return!this.isSyncing()&&t.getTime()-e.getTime()>9e5},linkToTable:function linkToTable(e){var t=this;e.has("synchronization")&&this.set(e.get("synchronization")),n(e).call(e,"change:synchronization",function(){t.set(e.get("synchronization"))},e),n(e).call(e,"destroy",function destroy(){t.unbind(null,null,e),t.destroy()},e)}},{SYNC_GAP:9e5,POLLING_GAP:15e3})},753:function(e,t,i){i(23),i(64);var s=i(13),n=i(1),o=i(395),a={},r=["querySchemaModel","layerDefinitionModel","tokens"],l={tableName:!0,columnsName:!0,keywords:!0};e.exports={init:function init(e){if(!e)throw new Error("options are required for hints");this.options=n.defaults(n.pick(e,["tableName","columnsName","keywords"]),l),n.each(r,function(t){this["_"+t]=e[t]},this)},hints:function hints(){return this.hints},reset:function reset(){return this.hints=n.union(this._getTableName(),this._getColumns(),this._getKeywords()),this},_getKeywords:function _getKeywords(){return this.options.keywords?this._tokens&&this._memo(this._tokens):[]},_getColumns:function _getColumns(){if(!this.options.columnsName)return[];var e=this._querySchemaModel.columnsCollection;return s(e).call(e,function(e){return{text:e.get("name"),type:"Column_name"}})},_getTableName:function _getTableName(){if(!this.options.tableName)return[];var e=this._layerDefinitionModel.getTableName();return[{text:e=o.getUnqualifiedName(e),type:"Table_name"}]},_memo:function _memo(e,t){return e in a?a[e]:a[e]=this._make(e,t)},_make:function _make(e,t){var i;return s(i=n.chain(e)).call(i,function(e){var t;return s(t=e.keywords.split(" ")).call(t,function(t){return{text:t,type:e.type}})}).flatten().value()}}},789:function(e,t,i){var s=i(3),n=i(1),o=i(18),a=i(6),r=i(4),l=i(788),c=i(787),h=i(59);i(3005);e.exports=r.extend({events:{"blur .js-hex":"_onChangeHex","blur .js-inputColor":"_onChangeColorValue","blur .js-a":"_onChangeOpacity"},initialize:function initialize(e){var t,i=null!=e.opacity?e.opacity:1;this.model=new a.Model({hex:e.value,opacity:i}),this._onEscape=s(t=this._onEscapePressed).call(t,this),this._initBinds()},render:function render(){var e,t=this.model.get("hex"),i=h.hexToRGB(this._sanitizeHex()),o=n.extend(i,{hex:t,opacity:this.model.get("opacity"),opacityDisabled:this.options.disableOpacity});this.$el.append(l(o));var a=n.template("rgba(<%- r %>, <%- g %>, <%- b %>, <%- opacity %>)");this.$(".js-colorPicker").colorpicker({color:a(o),format:"rgba",container:!0,horizontal:!0,inline:!0,customClass:"ColorPicker",template:c(),slidersHorz:{saturation:{maxLeft:206,maxTop:95,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:180,maxTop:0,callLeft:"setHue",callTop:!1},alpha:{maxLeft:180,maxTop:0,callLeft:"setAlpha",callTop:!1}}}),this.options.disableOpacity&&this.$(".js-colorPicker .js-alpha").addClass("is-hidden");var r=s(e=function _context2(e){var t=e.color.toRGB(),i=e.color.toHex();this.model.set({hex:i,r:t.r,g:t.g,b:t.b,opacity:t.a}),this.$(".js-color").css("opacity",t.a)}).call(e,this);return this.$(".js-colorPicker").colorpicker().on("changeColor",r),this._initDocumentBinds(),this},_initBinds:function _initBinds(){var e,t,i,n,o;s(e=this.model).call(e,"change:hex",this._onChangeColor,this),s(t=this.model).call(t,"change:r",this._onChangeColor,this),s(i=this.model).call(i,"change:g",this._onChangeColor,this),s(n=this.model).call(n,"change:b",this._onChangeColor,this),s(o=this.model).call(o,"change:opacity",this._onChangeColor,this)},_onEscapePressed:function _onEscapePressed(e){27===e.which&&this.remove()},_initDocumentBinds:function _initDocumentBinds(){o(document).on("keydown",this._onEscape)},_destroyDocumentBinds:function _destroyDocumentBinds(){o(document).off("keydown",this._onEscape)},_sanitizeHex:function _sanitizeHex(){return h.sanitizeHex(this.model.get("hex"))},_onChangeColor:function _onChangeColor(){this.trigger("change",{opacity:this.model.get("opacity"),hex:this.model.get("hex")},this),this.$(".js-hex").val(this.model.get("hex")),this.$(".js-r").val(this.model.get("r")),this.$(".js-g").val(this.model.get("g")),this.$(".js-b").val(this.model.get("b")),this.$(".js-a").val(this.model.get("opacity"))},_onChangeOpacity:function _onChangeOpacity(){var e=+this.$(".js-a").val();n.isNumber(e)&&e>=0&&e<=1&&this.setColor(this.model.get("hex"),e)},_onChangeColorValue:function _onChangeColorValue(e){this.$(e.target).removeClass("has-error");var t=+this.$(".js-r").val(),i=+this.$(".js-g").val(),s=+this.$(".js-b").val(),n=h.rgbToHex(t,i,s);h.isValidHex(n)?this.setColor(n):this.$(e.target).addClass("has-error")},_onChangeHex:function _onChangeHex(e){this.$(e.target).removeClass("has-error");var t=this.$(".js-hex").val();h.isValidHex(t)?this.setColor(t):this.$(e.target).addClass("has-error")},setColor:function setColor(e,t){n.isUndefined(t)&&(t=this.model.get("opacity")||1),this.$(".js-colorPicker").colorpicker("setValue",h.hexToRGBA(e,t))},clean:function clean(){this._destroyDocumentBinds(),this.trigger("onClean",this),r.prototype.clean.apply(this)}})},795:function(e,t,i){var s=i(4),n=i(396),o=i(198),a=i(794);e.exports=s.extend({defaults:{headerTitle:""},events:{"click .js-back":"_onClickBack"},initialize:function initialize(e){if(!e.stackLayoutModel)throw new Error("stackLayoutModel is required");if(!e.columns)throw new Error("columns param is required");this._stackLayoutModel=e.stackLayoutModel,this._columns=e.columns,this._showSearch=e.showSearch||!1,this._typeLabel=e.typeLabel,this._itemTemplate=e.itemTemplate,this.collection=new o(this._columns),this.listenTo(this.collection,"change:selected",this._onSelectItem)},render:function render(){return this.clearSubViews(),this.$el.empty(),this.$el.append(a({headerTitle:this.options.headerTitle})),this._initViews(),this},_onClickBack:function _onClickBack(e){this.killEvent(e),this.trigger("back",this)},_initViews:function _initViews(){this._listView=new n({collection:this.collection,showSearch:this._showSearch,typeLabel:this._typeLabel,itemTemplate:this._itemTemplate}),this.$(".js-content").append(this._listView.render().$el),this.addView(this._listView)},_onSelectItem:function _onSelectItem(e){this.trigger("selectItem",e,this)}})},816:function(e,t,i){i(23),i(326);var s=i(25),n=i(76),o=i(3),a=i(4),r=i(1),l=i(457),c=i(815),h=i(814),d=i(813),u=i(59);e.exports=a.extend({module:"components:custom-list:custom-list-view",options:{size:3},className:"CDB-Text CDB-Size-medium CustomList-listWrapper",tagName:"div",events:{"click .js-add-custom-value":"_onClickAddCustomValue",mouseover:"_onMouseOver",mouseout:"_onMouseOut"},initialize:function initialize(e){var t;this.options=r.extend({},this.options,e),this._onKeyDownBinded=o(t=this._onKeyDown).call(t,this),this._needsMaxSize=!0,this.options.mouseOverAction&&(this._mouseOverAction=this.options.mouseOverAction),this.options.mouseOutAction&&(this._mouseOutAction=this.options.mouseOutAction),this._initBinds()},render:function render(){this.clearSubViews(),this._removeArrowBinds(),this._destroyCustomScroll(),this.$el.empty();var e=this.model.get("query"),t=this.collection.search(e);this.$el.append(d());var i,s=this.options.allowFreeTextInput;(s&&e&&!u.isBlank(e)&&(this.collection.containsValue(e)||this.$el.prepend(h({query:e,typeLabel:this.options.typeLabel}))),t.size()>0)?(t.each(this._renderItem,this),this._applyArrowBinds(),n(o(i=this._applyCustomScroll).call(i,this),0)):s&&!u.isBlank(e)||this.$el.append(c({query:e,typeLabel:this.options.typeLabel}));return this},_renderItem:function _renderItem(e){if(!e.get("hidden")){var t=new(0,this.options.itemView)({model:e,typeLabel:this.options.typeLabel,template:this.options.itemTemplate});this.$(".js-list").append(t.render().el),this.addView(t),o(t).call(t,"customEvent",function(e,t){this.trigger("customEvent",e,t,this)},this)}},_initBinds:function _initBinds(){var e;o(e=this.model).call(e,"change:query",this._onQueryChanged,this)},_applyArrowBinds:function _applyArrowBinds(){document.addEventListener("keydown",this._onKeyDownBinded)},_removeArrowBinds:function _removeArrowBinds(){document.removeEventListener("keydown",this._onKeyDownBinded)},_getSelected:function _getSelected(){var e,t=this.collection.getSelectedItem();return t?(e=t.getValue(),this.$("[data-val='"+e+"']")):null},_highlightSelected:function _highlightSelected(e){var t=e.outerHeight();e.addClass("is-highlighted"),this.$(".js-list").scrollTop(e.index()*t)},_onClickAddCustomValue:function _onClickAddCustomValue(e){this.killEvent(e);var t=this.model.get("query"),i=this.collection.add({val:t,label:"\u201c"+t+"\u201d",dirty:!0});this.collection.sortByKey("val"),i.set("selected",!0)},_onKeyDown:function _onKeyDown(e){if(!1!==this.model.get("visible")){var t,i,n=e.which,o=this.$(".js-listItem"),a=s(o).call(o,".is-highlighted");if(a.removeClass("is-highlighted"),40===n)t=a.length&&a[0]!==o.last()[0]?a.next():o.eq(0);else if(38===n)t=a.length&&a[0]!==o.first()[0]?a.prev():o.last();else if(13===n&&(e.preventDefault(),a&&a.length))return(i=r.first(this.collection.where({val:a.data("val")})))&&i.set("selected",!0),!1;t&&this._highlightSelected(t)}},_onQueryChanged:function _onQueryChanged(){var e=this.collection.findWhere({val:this.model.previous("query"),dirty:!0});this.collection.remove(e),this.render()},_applyCustomScroll:function _applyCustomScroll(){l.initialize(this._wrapperContainer().get(0),{wheelSpeed:2,wheelPropagation:!0,stopPropagationOnClick:!1,minScrollbarLength:20})},_destroyCustomScroll:function _destroyCustomScroll(){this._wrapperContainer().length>0&&l.destroy(this._wrapperContainer().get(0))},_wrapperContainer:function _wrapperContainer(){return this.$(".js-list")},clean:function clean(){this._removeArrowBinds(),this._destroyCustomScroll(),a.prototype.clean.apply(this)},highlight:function highlight(){var e=this._getSelected();e&&this._highlightSelected(e)},_onMouseOver:function _onMouseOver(){this._mouseOverAction&&this._mouseOverAction()},_onMouseOut:function _onMouseOut(){this._mouseOutAction&&this._mouseOutAction()}})},820:function(e,t,i){var s=i(3),n=i(4),o=i(1575);e.exports=n.extend({events:{"click .js-back":"_goToStart"},options:{fileEnabled:!1,acceptSync:!1},initialize:function initialize(e){if(!e.userModel)throw new Error("userModel is required");this._userModel=e.userModel,this.template=e.template||o,this._initBinds(),this._checkVisibility()},render:function render(){var e=this.options.acceptSync&&this._userModel.get("actions")&&this._userModel.isActionEnabled("sync_tables")&&"file"!==this.model.get("type");return this.$el.html(this.template({type:this.model.get("type"),fileEnabled:this.options.fileEnabled,acceptSync:e,state:this.model.get("state")})),this._checkVisibility(),this},_initBinds:function _initBinds(){var e;s(e=this.model).call(e,"change:state",this.render,this)},_checkVisibility:function _checkVisibility(){this.show()},_goToStart:function _goToStart(){this.model.set("state","idle")}})},821:function(e,t,i){i(37),i(429),i(23),i(88);var s=i(3);i(1228);var n=i(921),o=i(18),a=i(4),r=i(1576),l=i(14),c=["userModel"];e.exports=a.extend({options:{template:"",fileEnabled:!1},events:{"keyup .js-textInput":"_onTextChanged","submit .js-form":"_onSubmitForm"},initialize:function initialize(e){l(e,c,this),this.template=e.template||r,this._initBinds(),this._checkVisibility()},render:function render(){return this.$el.html(this.template(this.options)),this._initViews(),this},_initBinds:function _initBinds(){var e;s(e=this.model).call(e,"change:state",this._checkVisibility,this)},_initViews:function _initViews(){if(this.options.fileEnabled){var e,t=this;s(e=this.$(".js-fileInput")).call(e,"change",function(e){this.files&&this.files.length>0&&t._onFileChanged(this.files),this.value=""}),this._initDropzone()}},_initDropzone:function _initDropzone(){var e,t,i=o("html")[0],a=this;this.dragster=new Dragster(i),s(e=o(i)).call(e,"dragster:enter",function(e){a._showDropzone()}),s(t=o(i)).call(t,"dragster:leave",function(e){a._hideDropzone()}),i.dropzone&&i.dropzone.destroy(),this.dropzone=new n(i,{url:":)",autoProcessQueue:!1,previewsContainer:!1}),this.dropzone.on("dragover",function(){a._showDropzone()}),this.dropzone.on("drop",function(e){var t=e.dataTransfer.files;a._onFileChanged(t),a._hideDropzone()})},_destroyDropzone:function _destroyDropzone(){var e=o("html")[0];this.dragster&&(this.dragster.removeListeners(),this.dragster.reset(),o(e).unbind("dragster:enter dragster:leave")),this.dropzone&&this.dropzone.destroy()},_setValidFileExtensions:function _setValidFileExtensions(e){return RegExp("(.|/)("+e.join("|")+")$","i")},_onTextChanged:function _onTextChanged(){this.$(".js-textInput").val()||this._hideTextError()},_onFileChanged:function _onFileChanged(e){this.trigger("fileSelected",this),e&&1===e.length&&(e=e[0]),this.model.setUpload({type:"file",value:e}),"error"!==this.model.get("state")?(this._hideFileError(),this.model.set("state","selected")):this._showFileError()},_showTextError:function _showTextError(){this.$(".Form-inputError").addClass("is-visible")},_hideTextError:function _hideTextError(){this.$(".Form-inputError").removeClass("is-visible")},_showDropzone:function _showDropzone(){this.$(".Form-upload").addClass("is-dropping"),this._hideFileError()},_hideDropzone:function _hideDropzone(){this.$(".Form-upload").removeClass("is-dropping")},_showFileError:function _showFileError(){"error"===this.model.get("state")&&(this.$(".js-fileError").text(this.model.get("get_error_text").what_about).show(),this.$(".js-fileLabel").hide(),this.$(".js-fileButton").addClass("Button--negative"))},_hideFileError:function _hideFileError(){this.$(".js-fileError").hide(),this.$(".js-fileLabel").show(),this.$(".js-fileButton").removeClass("Button--negative")},_onSubmitForm:function _onSubmitForm(e){e&&this.killEvent(e);var t=this.$(".js-textInput").val();if(t){this.trigger("urlSelected",this);var i=this.model.get("service_name")?"service":"url";this.model.setUpload({type:i,value:t,service_item_id:t,state:"idle"}),"error"!==this.model.get("state")?(this._hideFileError(),this._hideTextError(),this.model.set("state","selected"),this.trigger("urlSubmitted",this)):this._showTextError()}else this._hideTextError()},_checkVisibility:function _checkVisibility(){this["selected"!==this.model.get("state")?"show":"hide"]()},clean:function clean(){this._destroyDropzone(),this.$(".js-fileInput").unbind("change"),a.prototype.clean.apply(this)}})},822:function(e,t){e.exports={uploadStates:["pending","enqueued","uploading","unpacking","importing","guessing","complete"],fileExtensions:["bz2","csv","gpkg","geojson","gz","json","kml","kmz","gpx","ods","osm","rar","tar","tgz","tif","tiff","tsv","txt","xls","xlsx","zip"],fileTimesBigger:3}},85:function(e,t,i){var s=i(2885),n=i(2882),o=function(){var e,t,i=!1,o=new n;function _init(n){if(!t&&!n)throw new Error("editorModel is required");!t&&n&&n.editorModel&&(t=n.editorModel),i=!0,e=new s({collection:o,editorModel:t})}return{DEFAULT_DELAY:5e3,init:function init(e){e.visDefinitionModel&&(this._visDefinitionModel=e.visDefinitionModel),_init(e)},off:function off(){0},getView:function getView(){return i||_init(),e.rebindEvents()},getCollection:function getCollection(){return o},getCount:function getCount(){return o.size()},getNotification:function getNotification(e){return"string"==typeof e?o.findById(e):o.findById(e.id)},addNotification:function addNotification(e){return o.addNotification(e,{visDefinitionModel:this._visDefinitionModel,delay:this.DEFAULT_DELAY})},removeNotification:function removeNotification(e){var t="string"==typeof e?o.findById(e):o.findById(e.id);return o.remove(t)}}}();e.exports=o},86:function(e,t,i){var s=i(84),n=i(295),o=i(370);e.exports=function(e){var t=e.desc&&s.core.sanitize(e.desc);return n({title:e.title||"",descHTML:t||o()})}},866:function(e,t,i){var s=i(4),n=i(987),o=i(14),a=["modalModel","userModel","client"];e.exports=s.extend({events:{"click .js-ok":"_onClickDelete","click .js-cancel":"_closeDialog","submit .js-form":"_closeDialog"},initialize:function initialize(e){o(e,a,this),s.prototype.initialize.apply(this),this._onError=e.onError,this._error="",this._isLoading=!1},render:function render(){return this.$el.html(n({passwordNeeded:!!this._userModel.get("needs_password_confirmation"),isLoading:this._isLoading,error:this._error})),this},_onClickDelete:function _onClickDelete(e){var t=this;this.killEvent(e);var i={deletion_password_confirmation:this.$("#deletion_password_confirmation").val()};this._isLoading=!0,this._error="",this.render(),this._client.deleteUser(i,function(e,i,s){t._isLoading=!1,t.render(),e?t._handleError(s,e):t._onSuccess(s)})},_handleError:function _handleError(e,t){if(this._onError)this._closeDialog(),this._onError(e,t);else{var i=e&&e.responseJSON||{};this._error=i.message,this.render()}},_setHref:function _setHref(e){window.location.href=e},_onSuccess:function _onSuccess(e){this._setHref(e.logout_url),this._closeDialog()},_onFormError:function _onFormError(e,t){this._onError(e,t),this._closeDialog()},_closeDialog:function _closeDialog(){this._modalModel.destroy()}})},905:function(e,t,i){"use strict";(function(e){i(23),i(64);var s=i(28),n=i.n(s),o=i(166),a=i(176),r={namespaced:!0,state:{isFetching:!1,hasError:!1,datasetsList:[],datasetsListCount:0,dataset:{},keyVariables:{},requestError:null,variables:[],filtersAvailable:{},filter:{searchText:"",limit:e.env.VUE_APP_PAGE_SIZE||10,page:0,categories:{}},subscriptionsList:[],currentSubscription:null,currentAccessPlatform:null,interestedSubscriptions:localStorage.getItem("interestedSubscriptions")?localStorage.getItem("interestedSubscriptions").split(","):[]},computed:{},mutations:{setCurrentAccessPlatform:a.h,setCurrentSubscription:a.i,setFetchingState:a.m,setDatasetsList:a.k,setDataset:a.j,setKeyVariables:a.o,setVariables:a.u,setAvailableFilters:a.g,setFilter:a.n,removeFilter:a.b,setSearchText:a.r,setPage:a.p,setDatasetsListCount:a.l,resetTagFilters:a.f,resetDatasetsList:a.d,resetDataset:a.c,setSubscriptionsList:a.t,setSubscriptionInfo:a.s,setRequestError:a.q,resetSubscriptionsList:a.e,addInterestedSubscriptions:a.a},actions:{initFilter:o.j,fetchDatasetsList:o.e,fetchDataset:o.d,fetchKeyVariables:o.f,fetchVariables:o.i,setSearchText:o.w,setPage:o.v,clearTagFilters:o.a,fetchSubscriptionsList:o.h,fetchSubscriptionsDetailsList:o.g,performSubscribe:o.k,performUnsubscribe:o.n,performSubscriptionSync:o.l,performSubscriptionUnsync:o.m,connectSubscriptionSample:o.b,downloadNotebook:o.c,requestDataset:o.q,requestExtendedLicense:o.r,requestAccess:o.o,requestAccessHubspot:o.p,sendAccessAttemptMetrics:o.s,sendRequestExtendedMetrics:o.u,sendRequestAccessMetrics:o.t},getters:{getSubscriptionByDataset:function getSubscriptionByDataset(e){return function(t){var i;return e.subscriptionsList?n()(i=e.subscriptionsList).call(i,function(e){return e.id===t}):void 0}}}};t.a=r}).call(this,i(162))},911:function(e,t,i){var s=i(627),n=i(3072),o=i(3065),a=i(3063),r=i(2933),l=i(1543),c=i(2927),h={GDrive:{view:n,visible:function visible(e,t){return!!e.get("oauth_gdrive")},name:"gdrive",title:"Google Drive",type:"cloud",options:{service:"gdrive",fileExtensions:["Google SpreadSheet","CSV"],showAvailableFormats:!1,acceptSync:!0,fileAttrs:{ext:!0,title:"filename",description:{content:[{name:"size",format:"size",key:!0}]}}}},Dropbox:{view:n,visible:function visible(e,t){return!!e.get("oauth_dropbox")},name:"dropbox",title:"Dropbox",type:"cloud",options:{service:"dropbox",fileExtensions:["CSV","XLS"],showAvailableFormats:!1,acceptSync:!0,fileAttrs:{ext:!0,title:"filename",description:{content:[{name:"id",format:""},{name:"size",format:"size",key:!0}],separator:"-"}}}},Box:{view:n,visible:function visible(e,t){return!!e.get("oauth_box")},name:"box",title:"Box",type:"cloud",options:{service:"box",fileExtensions:["CSV","XLS"],showAvailableFormats:!1,acceptSync:!0,fileAttrs:{ext:!0,title:"filename",description:{content:[{name:"size",format:"size",key:!0}],separator:"-"}}}},Twitter:{view:a,visible:function visible(e,t){return t.get("twitter").enabled},name:"twitter",title:"Twitter",type:"other"},Mailchimp:{view:n,visible:function visible(e,t){return t.get("mailchimp").enabled&&!!e.get("oauth_mailchimp")},name:"mailchimp",title:"MailChimp",options:{service:"mailchimp",fileExtensions:[],acceptSync:!0,showAvailableFormats:!1,headerTemplate:i(1533),fileAttrs:{ext:!0,title:"filename",description:{content:[{name:"member_count",format:"number",key:!0}],itemName:"member",separator:""}}}},Arcgis:{view:o,visible:function visible(e,t){return e.get("arcgis_enabled")},name:"arcgis",title:"ArcGIS",type:"other"},Salesforce:{view:s,visible:function visible(e,t){return e.get("salesforce_enabled")},name:"salesforce",title:"Salesforce"},Hive:{view:s,visible:function visible(e,t){return e.get("hive_enabled")},name:"hive",title:"Hive",type:"database"},BigQuery:{view:r,visible:function visible(e,t){return new l({configModel:e}).hasAnyAuthMethod()},name:"bigquery",title:"BigQuery",type:"database",options:{type:"service",service:"bigquery",beta:!1}},PostgreSQL:{view:c,visible:function visible(e,t){return!0},name:"postgresql",title:"PostgreSQL",type:"database",options:{service:"postgres",params:[{key:"server",type:"text"},{key:"port",type:"number"},{key:"database",type:"text"},{key:"username",type:"text"},{key:"password",type:"password"}],placeholder_query:"SELECT ST_GeogPoint(longitude, latitude) AS the_geom, * FROM table"}},MySQL:{view:c,visible:function visible(e,t){return!0},name:"mysql",title:"MySQL",type:"database",options:{service:"mysql",params:[{key:"server",type:"text"},{key:"port",type:"number"},{key:"database",type:"text"},{key:"username",type:"text"},{key:"password",type:"password"}],placeholder_query:"SELECT ST_AsWKT(ST_SRID(Point(lng, lat), 4326)) AS the_geom, field2, field3 from table"}},SQLServer:{view:c,visible:function visible(e,t){return!0},name:"sqlserver",title:"SQL Server",type:"database",options:{service:"sqlserver",params:[{key:"server",type:"text"},{key:"port",type:"number"},{key:"database",type:"text"},{key:"username",type:"text"},{key:"password",type:"password"}],placeholder_query:"SELECT CONVERT(VARCHAR(MAX), geography::Point(lat, lng, 4326).STAsBinary(), 2) AS the_geom, field2, field3 from table"}},Snowflake:{view:c,visible:function visible(e,t){return!0},name:"snowflake",title:"Snowflake",type:"database",options:{service:"snowflake",beta:!0,params:[{key:"server",type:"text"},{key:"database",type:"text"},{key:"username",type:"text"},{key:"password",type:"password"},{key:"warehouse",type:"text",optional:!0}],placeholder_query:"SELECT ST_MAKEPOINT(lng, lat) AS the_geom, * FROM table",sql_hint:"To import GEOGRAPHY type data as the CARTO geometry you need to give it a `the_geom` alias, unless it already has an accepted name (the_geom, geom, geometry, geojson, wkt or wkb_geometry)."}},Redshift:{view:c,visible:function visible(e,t){return!0},name:"redshift",title:"Redshift",type:"database",options:{service:"redshift",beta:!0,params:[{key:"cluster",type:"text"},{key:"port",type:"number"},{key:"database",type:"text"},{key:"username",type:"text"},{key:"password",type:"password"}],placeholder_query:"SELECT ST_MakePoint(lng, lat) AS the_geom, * FROM table"}},DataObservatory:{view:null,visible:function visible(e,t){return t.get("do_enabled")},name:"dataobservatory",title:"CARTO Data Observatory",type:"dataobservatory",options:{new:!0,highlighted:!0,link:"/dashboard/datasets/spatial-data-catalog/"}}};e.exports={IMPORT_OPTIONS:h,IMPORT_OPTIONS_ORDER:["DataObservatory","GDrive","Box","Dropbox","BigQuery","Snowflake","Redshift","MySQL","PostgreSQL","SQLServer","Arcgis","Salesforce","Twitter","Mailchimp"]}},916:function(e,t,i){i(37),i(23),i(64);var s=i(32),n=i(330).default,o=i(1),a=i(6),r=i(84).SQL,l=i(1209),c=i(14),h=["configModel"],d="the_geom the_geom_webmercator cartodb_id created_at updated_at".split(" ");e.exports=a.Model.extend({_GEOMETRY_TYPES:{point:"st_point",multipoint:"st_multipoint",linestring:"st_linestring",multilinestring:"st_multilinestring",polygon:"st_polygon",multipolygon:"st_multipolygon"},initialize:function initialize(e,t){c(t,h,this)},url:function url(e){var t=this._configModel.urlVersion("record",e),i=this.table||this.collection.table;i||console.error("row has no table assigned");var s="/api/"+t+"/tables/"+i.get("name")+"/records/";return this.isNew()?s:s+this.id},fetch:function fetch(e){e=e||{};var t=this.options&&this.options.user_data?this.options.user_data.username:window.user_data?window.user_data.username:window.user_name,i=this.options&&this.options.user_data?this.options.user_data.api_key:window.user_data?window.user_data.api_key:window.api_key,s=this.table||this.collection.table,n=new r({user:t,version:"v2",api_key:i,sql_api_template:this._configModel.getSqlApiBaseUrl(),extra_params:["skipfields"]}),a=null,l=s.columnNames();a="SELECT "+(l=e.no_geom?o.without(l,"the_geom","the_geom_webmercator"):o.without(l,"the_geom")).join(",")+" ",s.containsColumn("the_geom")&&!e.no_geom&&(a+=",ST_AsGeoJSON(the_geom, 8) as the_geom "),a+=" from ("+s.data().getSQL()+") _table_sql WHERE cartodb_id = "+this.get("cartodb_id"),e.no_geom?e.skipfields="the_geom,the_geom_webmercator":e.skipfields="the_geom_webmercator",n.execute(a,{},e).done(function(e){this.parse(e.rows[0])&&(this.set(e.rows[0]),this.trigger("sync"))})},toJSON:function toJSON(){var e=o.clone(this.attributes);return delete e.updated_at,delete e.created_at,delete e.the_geom_webmercator,this.isGeometryGeoJSON()||delete e.the_geom,e},isGeomLoaded:function isGeomLoaded(){var e=this.get("the_geom"),t=l.types;return"GeoJSON"!==e&&-1!==e&&!o.contains(t,e)},hasGeometry:function hasGeometry(){var e=this.get("the_geom");return!(null==e||void 0==e||""==e)},isGeometryGeoJSON:function isGeometryGeoJSON(){var e=this.get("the_geom");if(e&&"object"===n(e))return!!e.coordinates;if("string"!=typeof e)return!1;if("GeoJSON"===e)return!0;try{return!!JSON.parse(e).coordinates}catch(e){return!1}},getFeatureType:function getFeatureType(){if(this.isGeomLoaded())try{return JSON.parse(this.get("the_geom")).type.toLowerCase()}catch(e){console.info("Not possible to parse geometry type")}return null},getGeomType:function getGeomType(){try{return this._GEOMETRY_TYPES[this.getFeatureType()]}catch(e){console.info("Not possible to parse geometry type")}}},{RESERVED_COLUMNS:d,isReservedColumn:function isReservedColumn(e){var t;return-1!==s(t=o(d)).call(t,e)}})},917:function(e,t,i){i(35);var s=i(430),n=i(1),o=i(1703),a=i(345),r=i(59),l=i(74);e.exports=a.extend({validate:function validate(e){if(e){if("file"===e.type){if(e.value&&e.value.length)return{msg:_t("data.upload-model.one-file")};var t=e.value.name;if(!t)return{msg:_t("data.upload-model.file-defined")};var i=t.substr(s(t).call(t,".")+1);if(i&&(i=i.toLowerCase()),!n.contains(o.fileExtensions,i))return{msg:_t("data.upload-model.file-extension")};if(this._userModel.get("remaining_byte_quota")*o.fileTimesBigger<e.value.size)return{msg:_t("data.upload-model.file-size"),error_code:8001}}if("remote"===e.type){if(!e.remote_visualization_id)return{msg:_t("data.upload-model.visualization-id")};if(e.size&&this._userModel.get("remaining_byte_quota")*o.fileTimesBigger<e.size)return{msg:_t("data.upload-model.remote-file-size"),error_code:8001}}if("url"===e.type&&!r.isURL(e.value))return{msg:_t("data.upload-model.url-invalid")};if("sql"===e.type&&!e.value)return{msg:_t("data.upload-model.query-undefined")};if("duplication"===e.type&&!e.value)return{msg:_t("data.upload-model.dataset-copy-undefined")};if("service"===e.type&&"twitter_search"===e.service_name){var a=e.service_item_id;if(!a||n.isEmpty(a))return{msg:_t("data.upload-model.twitter-data")};if(n.isEmpty(a.categories))return{msg:_t("data.upload-model.twitter-categories-invalid")};var c=a.dates;if(!c||n.isEmpty(c))return{msg:_t("data.upload-model.twitter-dates-empty")};var h=l(c.fromDate)<=l(new Date);if(!c.fromDate||!c.toDate||!h)return{msg:_t("data.upload-model.twitter-dates-invalid")}}}}})},919:function(e,t,i){var s=i(6);e.exports=s.Model.extend({defaults:{content_type:"",page:1,q:"",tag:"",category:"",shared:"no",locked:!1,liked:!1,library:!1,order:"updated_at",deepInsights:!1},isSearching:function isSearching(){return this.get("q")||this.get("tag")},isDatasets:function isDatasets(){return"datasets"===this.get("content_type")},isMaps:function isMaps(){return"maps"===this.get("content_type")},isDeepInsights:function isDeepInsights(){return this.isMaps()&&this.get("deepInsights")}})},920:function(e,t,i){i(598),i(37),i(185);var s=i(237),n=i(38),o=i(235),a=i(32),r=i(13),l=i(3),c=i(18),h=i(6),d=i(1),u=i(1867),p=i(916),g=i(14),m=i(1209),f=i(1211),_=i(1210),v=["configModel"];e.exports=u.extend({_ADDED_ROW_TEXT:"Row added correctly",_ADDING_ROW_TEXT:"Adding a new row",_GEOMETRY_UPDATED:"Table geometry updated",model:function model(e,t){var i=t.collection._configModel;return new p(e,{configModel:i,collection:t.collection})},initialize:function initialize(e,t){var i,s,n;(g(t,v,this),this.table=t?t.table:null,this.model.prototype.idAttribute="cartodb_id",this.initOptions(),this.filter=null,this._fetching=!1,this.pages=[],this.lastPage=!1,l(i=this).call(i,"newPage",this.newPage,this),l(s=this).call(s,"reset",function(){var e=Math.floor(this.size()/this.options.get("rows_per_page"));this.pages=[];for(var t=0;t<e;++t)this.pages.push(t)},this),this.table)&&l(n=this).call(n,"add change:the_geom",function(e){var t=this.table.get("geometry_types");t&&t.length>0||e.get("the_geom")&&this.table.addGeomColumnType(e.getGeomType())},this);u.prototype.initialize.call(this)},initOptions:function initOptions(){var e,t=this;this.options=new h.Model({rows_per_page:40,page:0,sort_order:"asc",order_by:"cartodb_id",filter_column:"",filter_value:""}),l(e=this.options).call(e,"change",function(){if(!t._fetching){t._fetching=!0;var e={},i=t.options.previous("page");t.options.hasChanged("page")?(e.add=!0,e.changingPage=!0,i>t.options.get("page")&&(e.at=0)):t.options.hasChanged("mode")&&t.options.set({page:0},{silent:!0}),e.success=function(s,n){t.trigger("loaded"),n.rows&&0!==n.rows.length?e.changingPage&&t.trigger("newPage",t.options.get("page"),0===e.at?"up":"down"):t.options.set({page:i}),t.trigger("endLoadingRows",t.options.get("page"),0===e.at?"up":"down"),t._fetching=!1},e.error=function(){console.error("there was some problem fetching rows"),t.trigger("endLoadingRows"),t._fetching=!1},t.trigger("loadingRows",0===e.at?"up":"down"),t.fetch(e)}},this)},parse:function parse(e){return this.modify_rows=0===e.rows.length&&0===d.size(e.fields),this.affected_rows=e.affected_rows,this.lastPage=!1,e.rows.length<this.options.get("rows_per_page")&&(this.lastPage=!0),e.rows},_schemaFromQueryFields:function _schemaFromQueryFields(e){var t={};for(var i in e)t[i]=e[i].type;return t},_createUrlOptions:function _createUrlOptions(e){var t;if(e){var i={};for(var s in this.options.attributes)e(s)&&(i[s]=this.options.attributes[s]);t=d(i)}else t=d(this.options.attributes);var n=r(t).call(t,function(e,t){return t+"="+encodeURIComponent(e)}).join("&");return n+="&api_key="+this._configModel.get("api_key")},_geometryColumnSQL:function _geometryColumnSQL(e){return["CASE","WHEN GeometryType("+e+") = 'POINT' THEN","ST_AsGeoJSON("+e+",8)","WHEN ("+e+" IS NULL) THEN","NULL","ELSE","GeometryType("+e+")","END "+e].join(" ")},wrappedSQL:function wrappedSQL(e,t,i){var s,n=this;t=t||["the_geom_webmercator"],e=d.clone(e);var o=r(s=d.chain(e).omit(t)).call(s,function(e,t){return"geometry"===e?i?'st_astext("'+t+'") as '+t:n._geometryColumnSQL(t):'"'+t+'"'}).value();o=o.join(",");var a="desc"===this.options.get("sort_order")?"desc":"asc",l="select "+o+" from ("+this.getSQL()+") __wrapped",c=this.options.get("order_by");return c&&c.length>0&&(l+=" order by "+c+" "+a),l},url:function url(){return this.sqlApiUrl()},sync:function sync(e,t,i){if(i||(i={}),i.data=this._createUrlOptions(function(e){return"sql"!==e}),_.alterTableData(this.options.get("sql")||""))i.data+="&q="+encodeURIComponent(this.options.get("sql")),i.type="POST";else{var s="cartodb_id"in this.query_schema;i.data+="&q="+encodeURIComponent(this.wrappedSQL(this.query_schema,[],!s)),i.data.length>2048&&(i.type="POST")}return h.sync.call(this,e,this,i)},sqlApiUrl:function sqlApiUrl(){return this._configModel.getSqlApiUrl()},setOptions:function setOptions(e){this.options.set(e)},refresh:function refresh(){this.fetch()},isFetchingPage:function isFetchingPage(){return this._fetching},loadPageAtTop:function loadPageAtTop(){if(!this._fetching){var e=this.pages[0];e>0&&this.options.set("page",e-1)}},loadPageAtBottom:function loadPageAtBottom(){if(!this._fetching){var e=this.pages[this.pages.length-1];this.lastPage||this.options.set("page",e+1)}},newPage:function newPage(e,t){var i,s;a(i=this.pages).call(i,e)<0&&this.pages.push(e),o(s=this.pages).call(s,function(e,t){return Number(e)>Number(t)});var r,l,c=this.options.get("rows_per_page"),h=4*c;this.size()>h&&("up"==t?(this.pages.pop(),this.remove(n(r=this.models).call(r,h,this.size()))):(this.pages.shift(),this.remove(n(l=this.models).call(l,0,c))))},addRow:function addRow(e){var t=this;return this.table.notice(this._ADDING_ROW_TEXT,"load",0),e=e||{},d.extend(e,{wait:!0,success:function success(){t.table.notice(t._ADDED_ROW_TEXT)},error:function error(e,i){t.table.error(t._ADDING_ROW_TEXT,i)}}),this.create(null,e)},newRow:function newRow(e){var t=new p(e,{configModel:this._configModel});return t.table=this.table,l(t).call(t,"saved",function _saved(){0===t.table.data().length&&(t.table.data().fetch(),t.unbind("saved",_saved,t.table))},t.table),t},getRow:function getRow(e,t){t=t||{};var i=this.get(e);return i||(i=new p({cartodb_id:e},{configModel:this._configModel})),t.no_add||this.table._data.add(i),i.table=this.table,i},getRowAt:function getRowAt(e){var t=this.at(e);return t.table=this.table,t},deleteRow:function deleteRow(e){},isReadOnly:function isReadOnly(){return!1},quartiles:function quartiles(e,t,i,s){var n=d.template("select quartile, max(<%= column %>) as maxamount from (select <%= column %>, ntile(<%= slots %>) over (order by <%= column %>) as quartile from (<%= sql %>) _table_sql where <%= column %> is not null) x group by quartile order by quartile");this._sqlQuery(n({slots:e,sql:this.getSQL(),column:t}),function(e){i(d(e.rows).pluck("maxamount"))},s)},equalInterval:function equalInterval(e,t,i,s){var n=d.template("\n      with params as (select min(a), max(a) from ( select <%= column %> as a from (<%= sql %>) _table_sql where <%= column %> is not null ) as foo )\n      select (max-min)/<%= slots %> as s, min, max from params");this._sqlQuery(n({slots:e,sql:this.getSQL(),column:t}),function(t){for(var s=t.rows[0].min,n=t.rows[0].max,o=t.rows[0].s,a=[],r=1,l=e;r<l;r++)a.push(o*r+s);a.push(n),i(a)},s)},_quantificationMethod:function _quantificationMethod(e,t,i,s,n,o){var a=d.template("select unnest(<%= functionName %>(array_agg(<%= simplify_fn %>((<%= column %>::numeric))), <%= slots %>)) as buckets from (<%= sql %>) _table_sql where <%= column %> is not null");this._sqlQuery(a({slots:t,sql:this.getSQL(),column:i,functionName:e,simplify_fn:"distinct"}),function(e){n(d(e.rows).pluck("buckets"))},o)},discreteHistogram:function discreteHistogram(e,t,i,s){var o=d.template("SELECT DISTINCT(<%= column %>) AS bucket, count(*) AS value FROM (<%= sql %>) _table_sql GROUP BY <%= column %> ORDER BY value DESC LIMIT <%= nbuckets %> + 1",{column:t,nbuckets:e,sql:this.getSQL()});this._sqlQuery(o,function(t){var s,o=!1;t.rows.length>e&&(t.rows=n(s=t.rows).call(s,0,e),o=!0);i({rows:t.rows,reached_limit:o})})},date_histogram:function date_histogram(e,t,i,n){t="EXTRACT(EPOCH FROM "+t+"::TIMESTAMP WITH TIME ZONE )";var o=d.template("with bounds as ( SELECT  current_timestamp as tz, min(<%= column %>) as lower,  max(<%= column %>) as upper,  (max(<%= column %>) - min(<%= column %>)) as span,  CASE WHEN ABS((max(<%= column %>) - min(<%= column %>))/<%= nbuckets %>) <= 0 THEN 1 ELSE GREATEST(1.0, pow(10,ceil(log((max(<%= column %>) - min(<%= column %>))/<%= nbuckets %>)))) END as bucket_size FROM  (<%= sql %>) _table_sql )  select array_agg(v) val, array_agg(bucket) buckets, tz, bounds.upper, bounds.lower, bounds.span, bounds.bucket_size from ( select  count(<%= column %>) as v,   round((<%= column %> - bounds.lower)/bounds.bucket_size) as bucket  from (<%= sql %>) _table_sql, bounds  where <%= column %> is not null group by bucket order by bucket ) a, bounds group by bounds.upper, bounds.lower, bounds.span, bounds.bucket_size, bounds.tz ");function agg_array(e){return r(e).call(e,function(e){return s(e)})}this._sqlQuery(o({nbuckets:e,sql:this.getSQL(),column:t}),function(e){if(e.rows&&0!==e.rows.length){(e=e.rows[0]).val=agg_array(e.val),e.buckets=agg_array(e.buckets);var t,n=[],o={},a=e.upper,r=e.lower,l=e.tz,c=e.bucket_size;t=e.val[0];for(var h=0;h<e.buckets.length;++h){var d=n[e.buckets[h]]=e.val[h];t=Math.max(t,d)}for(var u=0;u<n.length;++u)void 0===n[u]?n[u]=0:n[u]=n[u]/t;o.upper=s(a),o.lower=s(r),o.bucket_size=s(c),o.tz=l,i(n,o)}else i(null,null)},n)},histogram:function histogram(e,t,i,n){var o=d.template("with bounds as ( SELECT  min(<%= column %>) as lower,  max(<%= column %>) as upper,  (max(<%= column %>) - min(<%= column %>)) as span,  CASE WHEN ABS((max(<%= column %>) - min(<%= column %>))/<%= nbuckets %>) <= 0 THEN 1 ELSE GREATEST(1.0, pow(10,ceil(log((max(<%= column %>) - min(<%= column %>))/<%= nbuckets %>)))) END as bucket_size FROM  (<%= sql %>) _table_sql  )  select array_agg(v) val, array_agg(bucket) buckets, bounds.upper, bounds.lower, bounds.span, bounds.bucket_size from ( select  count(<%= column %>) as v,   round((<%= column %> - bounds.lower)/bounds.bucket_size) as bucket  from (<%= sql %>) _table_sql, bounds  where <%= column %> is not null group by bucket order by bucket ) a, bounds group by bounds.upper, bounds.lower, bounds.span, bounds.bucket_size ");function agg_array(e){return r(e).call(e,function(e){return s(e)})}this._sqlQuery(o({nbuckets:e,sql:this.getSQL(),column:t}),function(e){if(e.rows&&0!==e.rows.length){(e=e.rows[0]).val=agg_array(e.val),e.buckets=agg_array(e.buckets);var t,n=[],o={},a=e.upper,r=e.lower,l=e.bucket_size;t=e.val[0];for(var c=0;c<e.buckets.length;++c){var h=n[e.buckets[c]]=e.val[c];t=Math.max(t,h)}for(var d=0;d<n.length;++d)void 0===n[d]?n[d]=0:n[d]=n[d]/t;o.upper=s(a),o.lower=s(r),o.bucket_size=s(l),i(n,o)}else i(null,null)},n)},jenkBins:function jenkBins(e,t,i,s){this._quantificationMethod("CDB_JenksBins",e,t,!0,i,s)},headTails:function headTails(e,t,i,s){this._quantificationMethod("CDB_HeadsTailsBins",e,t,!1,i,s)},quantileBins:function quantileBins(e,t,i,s){this._quantificationMethod("CDB_QuantileBins",e,t,!1,i,s)},categoriesForColumn:function categoriesForColumn(e,t,i,s){var n=d.template("SELECT <%= column %>, count(<%= column %>) FROM (<%= sql %>) _table_sql GROUP BY <%= column %> ORDER BY count DESC LIMIT <%= max_values %> ");this._sqlQuery(n({sql:this.getSQL(),column:t,max_values:e+1}),function(e){i({type:e.fields[t].type||"string",categories:d(e.rows).pluck(t)})},s)},geometryBounds:function geometryBounds(e){var t=d.template("SELECT ST_XMin(ST_Extent(the_geom)) as minx,ST_YMin(ST_Extent(the_geom)) as miny, ST_XMax(ST_Extent(the_geom)) as maxx,ST_YMax(ST_Extent(the_geom)) as maxy from (<%= sql %>) _table_sql");this._sqlQuery(t({sql:this.getSQL()}),function(t){var i=t.rows[0],s=i.maxx,n=i.maxy,o=i.minx,a=i.miny,r=function clampNum(e,t,i){return e<t?t:e>i?i:e};s=r(s,-179,179),o=r(o,-179,179),n=r(n,-85.0511,85.0511),a=r(a,-85.0511,85.0511),e([[n,s],[a,o]])})},_sqlQuery:function _sqlQuery(e,t,i,s){var n=encodeURIComponent(e);return c.ajax({type:s||"POST",data:"q="+n+"&api_key="+this._configModel.get("api_key"),url:this.url(),success:t,error:i})},getSQL:function getSQL(){return"select * from "+f(this.table.get("id"))},fetch:function fetch(e){var t=this,i=arguments;(e=e||{})&&e.add||(this.options.attributes.page=0,this.options._previousAttributes.page=0,this.pages=[]);var s=e.error;e.error=function(e,i){t.fetched=!0,t.trigger("error",e,i),s&&s(e,i)};var n=e.success;e.success=function(e,s){t.fetched=!0,n&&n.apply(t,i)},this._fetch(e)},_fetch:function _fetch(e){var t=this;this.trigger("loading",e);var i=this.getSQL();_.alterTableData(i)?u.prototype.fetch.call(this,e):this._sqlQuery(d.template("select * from (<%= sql %>) __wrapped limit 0")({sql:i}),function(i){t.query_schema=t._schemaFromQueryFields(i.fields),t.table.isInSQLView()||"the_geom"in t.query_schema&&delete t.query_schema.the_geom_webmercator,u.prototype.fetch.call(t,e)},function(e){t.trigger("error",t,e)},i.length>1024?"POST":"GET")},schemaFromData:function schemaFromData(e){var t;return _.sortSchema(r(t=d(this.query_schema)).call(t,function(e,t){return[t,e]}))},geometryTypeFromGeoJSON:function geometryTypeFromGeoJSON(e){try{return JSON.parse(e).type}catch(e){}},geometryTypeFromWKT:function geometryTypeFromWKT(e){if(!e)return null;var t=m.types;e=e.toUpperCase();for(var i=0;i<t.length;++i){var s=t[i];if(-1!==a(e).call(e,s))return s}},geometryTypeFromWKB:function geometryTypeFromWKB(e){if(!e)return null;var t="0"===e[0]&&"0"===e[1],i=e.substring(2,6);return t||(i=i[2]+i[3]+i[0]+i[1]),{"0001":"Point","0002":"LineString","0003":"Polygon","0004":"MultiPoint","0005":"MultiLineString","0006":"MultiPolygon"}[i]},getGeometryTypes:function getGeometryTypes(){for(var e=null,t=this.size();t--&&(!e||!e.get("the_geom"));)e=this.at(t);if(!e)return[];var i=e.get("the_geom")||e.get("the_geom_webmercator"),s=this.geometryTypeFromWKB(i)||this.geometryTypeFromWKT(i);return s?["ST_"+s[0].toUpperCase()+s.substring(1).toLowerCase()]:[]}})},921:function(e,t,i){(function(e,t){(function(){var i,s,n,o,a,r,l,c,h=[].slice,d={}.hasOwnProperty;l=function(){},s=function(){function Emitter(){}return Emitter.prototype.addEventListener=Emitter.prototype.on,Emitter.prototype.on=function(e,t){return this._callbacks=this._callbacks||{},this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t),this},Emitter.prototype.emit=function(){var e,t,i,s,n;if(i=arguments[0],e=2<=arguments.length?h.call(arguments,1):[],this._callbacks=this._callbacks||{},t=this._callbacks[i])for(s=0,n=t.length;s<n;s++)t[s].apply(this,e);return this},Emitter.prototype.removeListener=Emitter.prototype.off,Emitter.prototype.removeAllListeners=Emitter.prototype.off,Emitter.prototype.removeEventListener=Emitter.prototype.off,Emitter.prototype.off=function(e,t){var i,s,n,o;if(!this._callbacks||0===arguments.length)return this._callbacks={},this;if(!(i=this._callbacks[e]))return this;if(1===arguments.length)return delete this._callbacks[e],this;for(s=n=0,o=i.length;n<o;s=++n)if(i[s]===t){i.splice(s,1);break}return this},Emitter}(),(i=function(e){var t,i;function Dropzone(e,i){var s,n,o;if(this.element=e,this.version=Dropzone.version,this.defaultOptions.previewTemplate=this.defaultOptions.previewTemplate.replace(/\n*/g,""),this.clickableElements=[],this.listeners=[],this.files=[],"string"==typeof this.element&&(this.element=document.querySelector(this.element)),!this.element||null==this.element.nodeType)throw new Error("Invalid dropzone element.");if(this.element.dropzone)throw new Error("Dropzone already attached.");if(Dropzone.instances.push(this),this.element.dropzone=this,s=null!=(o=Dropzone.optionsForElement(this.element))?o:{},this.options=t({},this.defaultOptions,s,null!=i?i:{}),this.options.forceFallback||!Dropzone.isBrowserSupported())return this.options.fallback.call(this);if(null==this.options.url&&(this.options.url=this.element.getAttribute("action")),!this.options.url)throw new Error("No URL provided.");if(this.options.acceptedFiles&&this.options.acceptedMimeTypes)throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");this.options.acceptedMimeTypes&&(this.options.acceptedFiles=this.options.acceptedMimeTypes,delete this.options.acceptedMimeTypes),this.options.method=this.options.method.toUpperCase(),(n=this.getExistingFallback())&&n.parentNode&&n.parentNode.removeChild(n),!1!==this.options.previewsContainer&&(this.options.previewsContainer?this.previewsContainer=Dropzone.getElement(this.options.previewsContainer,"previewsContainer"):this.previewsContainer=this.element),this.options.clickable&&(!0===this.options.clickable?this.clickableElements=[this.element]:this.clickableElements=Dropzone.getElements(this.options.clickable,"clickable")),this.init()}return function(e,t){for(var i in t)d.call(t,i)&&(e[i]=t[i]);function ctor(){this.constructor=e}ctor.prototype=t.prototype,e.prototype=new ctor,e.__super__=t.prototype}(Dropzone,s),Dropzone.prototype.Emitter=s,Dropzone.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","addedfile","removedfile","thumbnail","error","errormultiple","processing","processingmultiple","uploadprogress","totaluploadprogress","sending","sendingmultiple","success","successmultiple","canceled","canceledmultiple","complete","completemultiple","reset","maxfilesexceeded","maxfilesreached","queuecomplete"],Dropzone.prototype.defaultOptions={url:null,method:"post",withCredentials:!1,parallelUploads:2,uploadMultiple:!1,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:120,thumbnailHeight:120,filesizeBase:1e3,maxFiles:null,filesizeBase:1e3,params:{},clickable:!0,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!0,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,capture:null,dictDefaultMessage:"Drop files here to upload",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictInvalidFileType:"You can't upload files of this type.",dictResponseError:"Server responded with {{statusCode}} code.",dictCancelUpload:"Cancel upload",dictCancelUploadConfirmation:"Are you sure you want to cancel this upload?",dictRemoveFile:"Remove file",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:"You can not upload any more files.",accept:function(e,t){return t()},init:function(){return l},forceFallback:!1,fallback:function(){var e,t,i,s,n,o;for(this.element.className=this.element.className+" dz-browser-not-supported",s=0,n=(o=this.element.getElementsByTagName("div")).length;s<n;s++)e=o[s],/(^| )dz-message($| )/.test(e.className)&&(t=e,e.className="dz-message");return t||(t=Dropzone.createElement('<div class="dz-message"><span></span></div>'),this.element.appendChild(t)),(i=t.getElementsByTagName("span")[0])&&(i.textContent=this.options.dictFallbackMessage),this.element.appendChild(this.getFallbackForm())},resize:function(e){var t,i,s;return t={srcX:0,srcY:0,srcWidth:e.width,srcHeight:e.height},i=e.width/e.height,t.optWidth=this.options.thumbnailWidth,t.optHeight=this.options.thumbnailHeight,null==t.optWidth&&null==t.optHeight?(t.optWidth=t.srcWidth,t.optHeight=t.srcHeight):null==t.optWidth?t.optWidth=i*t.optHeight:null==t.optHeight&&(t.optHeight=1/i*t.optWidth),s=t.optWidth/t.optHeight,e.height<t.optHeight||e.width<t.optWidth?(t.trgHeight=t.srcHeight,t.trgWidth=t.srcWidth):i>s?(t.srcHeight=e.height,t.srcWidth=t.srcHeight*s):(t.srcWidth=e.width,t.srcHeight=t.srcWidth/s),t.srcX=(e.width-t.srcWidth)/2,t.srcY=(e.height-t.srcHeight)/2,t},drop:function(e){return this.element.classList.remove("dz-drag-hover")},dragstart:l,dragend:function(e){return this.element.classList.remove("dz-drag-hover")},dragenter:function(e){return this.element.classList.add("dz-drag-hover")},dragover:function(e){return this.element.classList.add("dz-drag-hover")},dragleave:function(e){return this.element.classList.remove("dz-drag-hover")},paste:l,reset:function(){return this.element.classList.remove("dz-started")},addedfile:function(e){var t,i,s,n,o,a,r,l,c,h,d,u,p;if(this.element===this.previewsContainer&&this.element.classList.add("dz-started"),this.previewsContainer){for(e.previewElement=Dropzone.createElement(this.options.previewTemplate.trim()),e.previewTemplate=e.previewElement,this.previewsContainer.appendChild(e.previewElement),s=0,a=(c=e.previewElement.querySelectorAll("[data-dz-name]")).length;s<a;s++)c[s].textContent=e.name;for(n=0,r=(h=e.previewElement.querySelectorAll("[data-dz-size]")).length;n<r;n++)h[n].innerHTML=this.filesize(e.size);for(this.options.addRemoveLinks&&(e._removeLink=Dropzone.createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+this.options.dictRemoveFile+"</a>"),e.previewElement.appendChild(e._removeLink)),p=this,t=function(t){return t.preventDefault(),t.stopPropagation(),e.status===Dropzone.UPLOADING?Dropzone.confirm(p.options.dictCancelUploadConfirmation,function(){return p.removeFile(e)}):p.options.dictRemoveFileConfirmation?Dropzone.confirm(p.options.dictRemoveFileConfirmation,function(){return p.removeFile(e)}):p.removeFile(e)},u=[],o=0,l=(d=e.previewElement.querySelectorAll("[data-dz-remove]")).length;o<l;o++)i=d[o],u.push(i.addEventListener("click",t));return u}},removedfile:function(e){var t;return e.previewElement&&null!=(t=e.previewElement)&&t.parentNode.removeChild(e.previewElement),this._updateMaxFilesReachedClass()},thumbnail:function(e,t){var i,s,n,o;if(e.previewElement){for(e.previewElement.classList.remove("dz-file-preview"),s=0,n=(o=e.previewElement.querySelectorAll("[data-dz-thumbnail]")).length;s<n;s++)(i=o[s]).alt=e.name,i.src=t;return setTimeout(function(){return e.previewElement.classList.add("dz-image-preview")},1)}},error:function(e,t){var i,s,n,o,a;if(e.previewElement){for(e.previewElement.classList.add("dz-error"),"String"!=typeof t&&t.error&&(t=t.error),a=[],s=0,n=(o=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;s<n;s++)i=o[s],a.push(i.textContent=t);return a}},errormultiple:l,processing:function(e){if(e.previewElement&&(e.previewElement.classList.add("dz-processing"),e._removeLink))return e._removeLink.textContent=this.options.dictCancelUpload},processingmultiple:l,uploadprogress:function(e,t,i){var s,n,o,a,r;if(e.previewElement){for(r=[],n=0,o=(a=e.previewElement.querySelectorAll("[data-dz-uploadprogress]")).length;n<o;n++)"PROGRESS"===(s=a[n]).nodeName?r.push(s.value=t):r.push(s.style.width=t+"%");return r}},totaluploadprogress:l,sending:l,sendingmultiple:l,success:function(e){if(e.previewElement)return e.previewElement.classList.add("dz-success")},successmultiple:l,canceled:function(e){return this.emit("error",e,"Upload canceled.")},canceledmultiple:l,complete:function(e){if(e._removeLink&&(e._removeLink.textContent=this.options.dictRemoveFile),e.previewElement)return e.previewElement.classList.add("dz-complete")},completemultiple:l,maxfilesexceeded:l,maxfilesreached:l,queuecomplete:l,previewTemplate:'<div class="dz-preview dz-file-preview">\n  <div class="dz-image"><img data-dz-thumbnail /></div>\n  <div class="dz-details">\n    <div class="dz-size"><span data-dz-size></span></div>\n    <div class="dz-filename"><span data-dz-name></span></div>\n  </div>\n  <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\n  <div class="dz-error-message"><span data-dz-errormessage></span></div>\n  <div class="dz-success-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Check</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <path d="M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" stroke-opacity="0.198794158" stroke="#747474" fill-opacity="0.816519475" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>\n      </g>\n    </svg>\n  </div>\n  <div class="dz-error-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Error</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <g id="Check-+-Oval-2" sketch:type="MSLayerGroup" stroke="#747474" stroke-opacity="0.198794158" fill="#FFFFFF" fill-opacity="0.816519475">\n          <path d="M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" sketch:type="MSShapeGroup"></path>\n        </g>\n      </g>\n    </svg>\n  </div>\n</div>'},t=function(){var e,t,i,s,n,o,a;for(s=arguments[0],o=0,a=(i=2<=arguments.length?h.call(arguments,1):[]).length;o<a;o++)for(e in t=i[o])n=t[e],s[e]=n;return s},Dropzone.prototype.getAcceptedFiles=function(){var e,t,i,s,n;for(n=[],t=0,i=(s=this.files).length;t<i;t++)(e=s[t]).accepted&&n.push(e);return n},Dropzone.prototype.getRejectedFiles=function(){var e,t,i,s,n;for(n=[],t=0,i=(s=this.files).length;t<i;t++)(e=s[t]).accepted||n.push(e);return n},Dropzone.prototype.getFilesWithStatus=function(e){var t,i,s,n,o;for(o=[],i=0,s=(n=this.files).length;i<s;i++)(t=n[i]).status===e&&o.push(t);return o},Dropzone.prototype.getQueuedFiles=function(){return this.getFilesWithStatus(Dropzone.QUEUED)},Dropzone.prototype.getUploadingFiles=function(){return this.getFilesWithStatus(Dropzone.UPLOADING)},Dropzone.prototype.getActiveFiles=function(){var e,t,i,s,n;for(n=[],t=0,i=(s=this.files).length;t<i;t++)(e=s[t]).status!==Dropzone.UPLOADING&&e.status!==Dropzone.QUEUED||n.push(e);return n},Dropzone.prototype.init=function(){var e,t,i,s,n,o,a,r;for("form"===this.element.tagName&&this.element.setAttribute("enctype","multipart/form-data"),this.element.classList.contains("dropzone")&&!this.element.querySelector(".dz-message")&&this.element.appendChild(Dropzone.createElement('<div class="dz-default dz-message"><span>'+this.options.dictDefaultMessage+"</span></div>")),this.clickableElements.length&&(r=this,(i=function(){return r.hiddenFileInput&&document.body.removeChild(r.hiddenFileInput),r.hiddenFileInput=document.createElement("input"),r.hiddenFileInput.setAttribute("type","file"),(null==r.options.maxFiles||r.options.maxFiles>1)&&r.hiddenFileInput.setAttribute("multiple","multiple"),r.hiddenFileInput.className="dz-hidden-input",null!=r.options.acceptedFiles&&r.hiddenFileInput.setAttribute("accept",r.options.acceptedFiles),null!=r.options.capture&&r.hiddenFileInput.setAttribute("capture",r.options.capture),r.hiddenFileInput.style.visibility="hidden",r.hiddenFileInput.style.position="absolute",r.hiddenFileInput.style.top="0",r.hiddenFileInput.style.left="0",r.hiddenFileInput.style.height="0",r.hiddenFileInput.style.width="0",document.body.appendChild(r.hiddenFileInput),r.hiddenFileInput.addEventListener("change",function(){var e,t,s,n;if((t=r.hiddenFileInput.files).length)for(s=0,n=t.length;s<n;s++)e=t[s],r.addFile(e);return i()})})()),this.URL=null!=(o=window.URL)?o:window.webkitURL,s=0,n=(a=this.events).length;s<n;s++)e=a[s],this.on(e,this.options[e]);return this.on("uploadprogress",function(e){return function(){return e.updateTotalUploadProgress()}}(this)),this.on("removedfile",function(e){return function(){return e.updateTotalUploadProgress()}}(this)),this.on("canceled",function(e){return function(t){return e.emit("complete",t)}}(this)),this.on("complete",function(e){return function(t){if(0===e.getUploadingFiles().length&&0===e.getQueuedFiles().length)return setTimeout(function(){return e.emit("queuecomplete")},0)}}(this)),t=function(e){return e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1},this.listeners=[{element:this.element,events:{dragstart:function(e){return function(t){return e.emit("dragstart",t)}}(this),dragenter:function(e){return function(i){return t(i),e.emit("dragenter",i)}}(this),dragover:function(e){return function(i){var s;try{s=i.dataTransfer.effectAllowed}catch(e){}return i.dataTransfer.dropEffect="move"===s||"linkMove"===s?"move":"copy",t(i),e.emit("dragover",i)}}(this),dragleave:function(e){return function(t){return e.emit("dragleave",t)}}(this),drop:function(e){return function(i){return t(i),e.drop(i)}}(this),dragend:function(e){return function(t){return e.emit("dragend",t)}}(this)}}],this.clickableElements.forEach(function(e){return function(t){return e.listeners.push({element:t,events:{click:function(i){if(t!==e.element||i.target===e.element||Dropzone.elementInside(i.target,e.element.querySelector(".dz-message")))return e.hiddenFileInput.click()}}})}}(this)),this.enable(),this.options.init.call(this)},Dropzone.prototype.destroy=function(){var e;return this.disable(),this.removeAllFiles(!0),(null!=(e=this.hiddenFileInput)?e.parentNode:void 0)&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null),delete this.element.dropzone,Dropzone.instances.splice(Dropzone.instances.indexOf(this),1)},Dropzone.prototype.updateTotalUploadProgress=function(){var e,t,i,s,n,o,a;if(i=0,t=0,this.getActiveFiles().length){for(n=0,o=(a=this.getActiveFiles()).length;n<o;n++)i+=(e=a[n]).upload.bytesSent,t+=e.upload.total;s=100*i/t}else s=100;return this.emit("totaluploadprogress",s,t,i)},Dropzone.prototype._getParamName=function(e){return"function"==typeof this.options.paramName?this.options.paramName(e):this.options.paramName+(this.options.uploadMultiple?"["+e+"]":"")},Dropzone.prototype.getFallbackForm=function(){var e,t,i,s;return(e=this.getExistingFallback())?e:(i='<div class="dz-fallback">',this.options.dictFallbackText&&(i+="<p>"+this.options.dictFallbackText+"</p>"),i+='<input type="file" name="'+this._getParamName(0)+'" '+(this.options.uploadMultiple?'multiple="multiple"':void 0)+' /><input type="submit" value="Upload!"></div>',t=Dropzone.createElement(i),"FORM"!==this.element.tagName?(s=Dropzone.createElement('<form action="'+this.options.url+'" enctype="multipart/form-data" method="'+this.options.method+'"></form>')).appendChild(t):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method",this.options.method)),null!=s?s:t)},Dropzone.prototype.getExistingFallback=function(){var e,t,i,s,n,o;for(t=function(e){var t,i,s;for(i=0,s=e.length;i<s;i++)if(t=e[i],/(^| )fallback($| )/.test(t.className))return t},s=0,n=(o=["div","form"]).length;s<n;s++)if(i=o[s],e=t(this.element.getElementsByTagName(i)))return e},Dropzone.prototype.setupEventListeners=function(){var e,t,i,s,n,o,a;for(a=[],s=0,n=(o=this.listeners).length;s<n;s++)e=o[s],a.push(function(){var s,n;for(t in n=[],s=e.events)i=s[t],n.push(e.element.addEventListener(t,i,!1));return n}());return a},Dropzone.prototype.removeEventListeners=function(){var e,t,i,s,n,o,a;for(a=[],s=0,n=(o=this.listeners).length;s<n;s++)e=o[s],a.push(function(){var s,n;for(t in n=[],s=e.events)i=s[t],n.push(e.element.removeEventListener(t,i,!1));return n}());return a},Dropzone.prototype.disable=function(){var e,t,i,s,n;for(this.clickableElements.forEach(function(e){return e.classList.remove("dz-clickable")}),this.removeEventListeners(),n=[],t=0,i=(s=this.files).length;t<i;t++)e=s[t],n.push(this.cancelUpload(e));return n},Dropzone.prototype.enable=function(){return this.clickableElements.forEach(function(e){return e.classList.add("dz-clickable")}),this.setupEventListeners()},Dropzone.prototype.filesize=function(e){var t,i,s,n,o,a,r;for(i=s=null,t=a=0,r=(o=["TB","GB","MB","KB","b"]).length;a<r;t=++a)if(n=o[t],e>=Math.pow(this.options.filesizeBase,4-t)/10){i=e/Math.pow(this.options.filesizeBase,4-t),s=n;break}return"<strong>"+(i=Math.round(10*i)/10)+"</strong> "+s},Dropzone.prototype._updateMaxFilesReachedClass=function(){return null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit("maxfilesreached",this.files),this.element.classList.add("dz-max-files-reached")):this.element.classList.remove("dz-max-files-reached")},Dropzone.prototype.drop=function(e){var t,i;e.dataTransfer&&(this.emit("drop",e),(t=e.dataTransfer.files).length&&((i=e.dataTransfer.items)&&i.length&&null!=i[0].webkitGetAsEntry?this._addFilesFromItems(i):this.handleFiles(t)))},Dropzone.prototype.paste=function(e){var t,i;if(null!=(null!=e&&null!=(i=e.clipboardData)?i.items:void 0))return this.emit("paste",e),(t=e.clipboardData.items).length?this._addFilesFromItems(t):void 0},Dropzone.prototype.handleFiles=function(e){var t,i,s,n;for(n=[],i=0,s=e.length;i<s;i++)t=e[i],n.push(this.addFile(t));return n},Dropzone.prototype._addFilesFromItems=function(e){var t,i,s,n,o;for(o=[],s=0,n=e.length;s<n;s++)null!=(i=e[s]).webkitGetAsEntry&&(t=i.webkitGetAsEntry())?t.isFile?o.push(this.addFile(i.getAsFile())):t.isDirectory?o.push(this._addFilesFromDirectory(t,t.name)):o.push(void 0):null!=i.getAsFile&&(null==i.kind||"file"===i.kind)?o.push(this.addFile(i.getAsFile())):o.push(void 0);return o},Dropzone.prototype._addFilesFromDirectory=function(e,t){var i,s,n;return i=e.createReader(),n=this,s=function(e){var i,s,o;for(s=0,o=e.length;s<o;s++)(i=e[s]).isFile?i.file(function(e){if(!n.options.ignoreHiddenFiles||"."!==e.name.substring(0,1))return e.fullPath=t+"/"+e.name,n.addFile(e)}):i.isDirectory&&n._addFilesFromDirectory(i,t+"/"+i.name)},i.readEntries(s,function(e){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log(e):void 0})},Dropzone.prototype.accept=function(e,t){return e.size>1024*this.options.maxFilesize*1024?t(this.options.dictFileTooBig.replace("{{filesize}}",Math.round(e.size/1024/10.24)/100).replace("{{maxFilesize}}",this.options.maxFilesize)):Dropzone.isValidFile(e,this.options.acceptedFiles)?null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(t(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}",this.options.maxFiles)),this.emit("maxfilesexceeded",e)):this.options.accept.call(this,e,t):t(this.options.dictInvalidFileType)},Dropzone.prototype.addFile=function(e){return e.upload={progress:0,total:e.size,bytesSent:0},this.files.push(e),e.status=Dropzone.ADDED,this.emit("addedfile",e),this._enqueueThumbnail(e),this.accept(e,(t=this,function(i){return i?(e.accepted=!1,t._errorProcessing([e],i)):(e.accepted=!0,t.options.autoQueue&&t.enqueueFile(e)),t._updateMaxFilesReachedClass()}));var t},Dropzone.prototype.enqueueFiles=function(e){var t,i,s;for(i=0,s=e.length;i<s;i++)t=e[i],this.enqueueFile(t);return null},Dropzone.prototype.enqueueFile=function(e){if(e.status!==Dropzone.ADDED||!0!==e.accepted)throw new Error("This file can't be queued because it has already been processed or was rejected.");if(e.status=Dropzone.QUEUED,this.options.autoProcessQueue)return setTimeout((t=this,function(){return t.processQueue()}),0);var t},Dropzone.prototype._thumbnailQueue=[],Dropzone.prototype._processingThumbnail=!1,Dropzone.prototype._enqueueThumbnail=function(e){if(this.options.createImageThumbnails&&e.type.match(/image.*/)&&e.size<=1024*this.options.maxThumbnailFilesize*1024)return this._thumbnailQueue.push(e),setTimeout((t=this,function(){return t._processThumbnailQueue()}),0);var t},Dropzone.prototype._processThumbnailQueue=function(){var e;if(!this._processingThumbnail&&0!==this._thumbnailQueue.length)return this._processingThumbnail=!0,this.createThumbnail(this._thumbnailQueue.shift(),(e=this,function(){return e._processingThumbnail=!1,e._processThumbnailQueue()}))},Dropzone.prototype.removeFile=function(e){if(e.status===Dropzone.UPLOADING&&this.cancelUpload(e),this.files=c(this.files,e),this.emit("removedfile",e),0===this.files.length)return this.emit("reset")},Dropzone.prototype.removeAllFiles=function(e){var t,i,s,n;for(null==e&&(e=!1),i=0,s=(n=this.files.slice()).length;i<s;i++)((t=n[i]).status!==Dropzone.UPLOADING||e)&&this.removeFile(t);return null},Dropzone.prototype.createThumbnail=function(e,t){var i,s;return(i=new FileReader).onload=(s=this,function(){return"image/svg+xml"===e.type?(s.emit("thumbnail",e,i.result),void(null!=t&&t())):s.createThumbnailFromUrl(e,i.result,t)}),i.readAsDataURL(e)},Dropzone.prototype.createThumbnailFromUrl=function(e,t,i){var s,n;return(s=document.createElement("img")).onload=(n=this,function(){var t,o,a,l,c,h,d,u;if(e.width=s.width,e.height=s.height,null==(a=n.options.resize.call(n,e)).trgWidth&&(a.trgWidth=a.optWidth),null==a.trgHeight&&(a.trgHeight=a.optHeight),o=(t=document.createElement("canvas")).getContext("2d"),t.width=a.trgWidth,t.height=a.trgHeight,r(o,s,null!=(c=a.srcX)?c:0,null!=(h=a.srcY)?h:0,a.srcWidth,a.srcHeight,null!=(d=a.trgX)?d:0,null!=(u=a.trgY)?u:0,a.trgWidth,a.trgHeight),l=t.toDataURL("image/png"),n.emit("thumbnail",e,l),null!=i)return i()}),null!=i&&(s.onerror=i),s.src=t},Dropzone.prototype.processQueue=function(){var e,t,i,s;if(t=this.options.parallelUploads,e=i=this.getUploadingFiles().length,!(i>=t)&&(s=this.getQueuedFiles()).length>0){if(this.options.uploadMultiple)return this.processFiles(s.slice(0,t-i));for(;e<t;){if(!s.length)return;this.processFile(s.shift()),e++}}},Dropzone.prototype.processFile=function(e){return this.processFiles([e])},Dropzone.prototype.processFiles=function(e){var t,i,s;for(i=0,s=e.length;i<s;i++)(t=e[i]).processing=!0,t.status=Dropzone.UPLOADING,this.emit("processing",t);return this.options.uploadMultiple&&this.emit("processingmultiple",e),this.uploadFiles(e)},Dropzone.prototype._getFilesWithXhr=function(e){var t;return function(){var i,s,n,o;for(o=[],i=0,s=(n=this.files).length;i<s;i++)(t=n[i]).xhr===e&&o.push(t);return o}.call(this)},Dropzone.prototype.cancelUpload=function(e){var t,i,s,n,o,a,r;if(e.status===Dropzone.UPLOADING){for(s=0,o=(i=this._getFilesWithXhr(e.xhr)).length;s<o;s++)(t=i[s]).status=Dropzone.CANCELED;for(e.xhr.abort(),n=0,a=i.length;n<a;n++)t=i[n],this.emit("canceled",t);this.options.uploadMultiple&&this.emit("canceledmultiple",i)}else(r=e.status)!==Dropzone.ADDED&&r!==Dropzone.QUEUED||(e.status=Dropzone.CANCELED,this.emit("canceled",e),this.options.uploadMultiple&&this.emit("canceledmultiple",[e]));if(this.options.autoProcessQueue)return this.processQueue()},i=function(){var e,t;return t=arguments[0],e=2<=arguments.length?h.call(arguments,1):[],"function"==typeof t?t.apply(this,e):t},Dropzone.prototype.uploadFile=function(e){return this.uploadFiles([e])},Dropzone.prototype.uploadFiles=function(e){var s,n,o,a,r,l,c,h,d,u,p,g,m,f,_,v,y,w,b,C,M,k,S,x,T,D,E,V,A,I,B,z,F,P;for(w=new XMLHttpRequest,b=0,S=e.length;b<S;b++)(s=e[b]).xhr=w;for(a in g=i(this.options.method,e),v=i(this.options.url,e),w.open(g,v,!0),w.withCredentials=!!this.options.withCredentials,f=null,P=this,o=function(){var t,i,n;for(n=[],t=0,i=e.length;t<i;t++)s=e[t],n.push(P._errorProcessing(e,f||P.options.dictResponseError.replace("{{statusCode}}",w.status),w));return n},_=function(t){return function(i){var n,o,a,r,l,c,h,d,u;if(null!=i)for(o=100*i.loaded/i.total,a=0,c=e.length;a<c;a++)(s=e[a]).upload={progress:o,total:i.total,bytesSent:i.loaded};else{for(n=!0,o=100,r=0,h=e.length;r<h;r++)100===(s=e[r]).upload.progress&&s.upload.bytesSent===s.upload.total||(n=!1),s.upload.progress=o,s.upload.bytesSent=s.upload.total;if(n)return}for(u=[],l=0,d=e.length;l<d;l++)s=e[l],u.push(t.emit("uploadprogress",s,o,s.upload.bytesSent));return u}}(this),w.onload=function(t){return function(i){var s;if(e[0].status!==Dropzone.CANCELED&&4===w.readyState){if(f=w.responseText,w.getResponseHeader("content-type")&&~w.getResponseHeader("content-type").indexOf("application/json"))try{f=JSON.parse(f)}catch(e){i=e,f="Invalid JSON response from server."}return _(),200<=(s=w.status)&&s<300?t._finished(e,f,i):o()}}}(this),w.onerror=function(){if(e[0].status!==Dropzone.CANCELED)return o()},(null!=(V=w.upload)?V:w).onprogress=_,l={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"},this.options.headers&&t(l,this.options.headers),l)r=l[a],w.setRequestHeader(a,r);if(n=new FormData,this.options.params)for(p in A=this.options.params)y=A[p],n.append(p,y);for(C=0,x=e.length;C<x;C++)s=e[C],this.emit("sending",s,w,n);if(this.options.uploadMultiple&&this.emit("sendingmultiple",e,w,n),"FORM"===this.element.tagName)for(M=0,T=(I=this.element.querySelectorAll("input, textarea, select, button")).length;M<T;M++)if(d=(h=I[M]).getAttribute("name"),u=h.getAttribute("type"),"SELECT"===h.tagName&&h.hasAttribute("multiple"))for(k=0,D=(B=h.options).length;k<D;k++)(m=B[k]).selected&&n.append(d,m.value);else(!u||"checkbox"!==(z=u.toLowerCase())&&"radio"!==z||h.checked)&&n.append(d,h.value);for(c=E=0,F=e.length-1;0<=F?E<=F:E>=F;c=0<=F?++E:--E)n.append(this._getParamName(c),e[c],e[c].name);return w.send(n)},Dropzone.prototype._finished=function(e,t,i){var s,n,o;for(n=0,o=e.length;n<o;n++)(s=e[n]).status=Dropzone.SUCCESS,this.emit("success",s,t,i),this.emit("complete",s);if(this.options.uploadMultiple&&(this.emit("successmultiple",e,t,i),this.emit("completemultiple",e)),this.options.autoProcessQueue)return this.processQueue()},Dropzone.prototype._errorProcessing=function(e,t,i){var s,n,o;for(n=0,o=e.length;n<o;n++)(s=e[n]).status=Dropzone.ERROR,this.emit("error",s,t,i),this.emit("complete",s);if(this.options.uploadMultiple&&(this.emit("errormultiple",e,t,i),this.emit("completemultiple",e)),this.options.autoProcessQueue)return this.processQueue()},Dropzone}()).version="4.0.1",i.options={},i.optionsForElement=function(e){return e.getAttribute("id")?i.options[n(e.getAttribute("id"))]:void 0},i.instances=[],i.forElement=function(e){if("string"==typeof e&&(e=document.querySelector(e)),null==(null!=e?e.dropzone:void 0))throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.");return e.dropzone},i.autoDiscover=!0,i.discover=function(){var e,t,s,n,o,a;for(document.querySelectorAll?s=document.querySelectorAll(".dropzone"):(s=[],(e=function(e){var t,i,n,o;for(o=[],i=0,n=e.length;i<n;i++)t=e[i],/(^| )dropzone($| )/.test(t.className)?o.push(s.push(t)):o.push(void 0);return o})(document.getElementsByTagName("div")),e(document.getElementsByTagName("form"))),a=[],n=0,o=s.length;n<o;n++)t=s[n],!1!==i.optionsForElement(t)?a.push(new i(t)):a.push(void 0);return a},i.blacklistedBrowsers=[/opera.*Macintosh.*version\/12/i],i.isBrowserSupported=function(){var e,t,s,n;if(e=!0,window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if("classList"in document.createElement("a"))for(t=0,s=(n=i.blacklistedBrowsers).length;t<s;t++)n[t].test(navigator.userAgent)&&(e=!1);else e=!1;else e=!1;return e},c=function(e,t){var i,s,n,o;for(o=[],s=0,n=e.length;s<n;s++)(i=e[s])!==t&&o.push(i);return o},n=function(e){return e.replace(/[\-_](\w)/g,function(e){return e.charAt(1).toUpperCase()})},i.createElement=function(e){var t;return(t=document.createElement("div")).innerHTML=e,t.childNodes[0]},i.elementInside=function(e,t){if(e===t)return!0;for(;e=e.parentNode;)if(e===t)return!0;return!1},i.getElement=function(e,t){var i;if("string"==typeof e?i=document.querySelector(e):null!=e.nodeType&&(i=e),null==i)throw new Error("Invalid `"+t+"` option provided. Please provide a CSS selector or a plain HTML element.");return i},i.getElements=function(e,t){var i,s,n,o,a,r,l;if(e instanceof Array){s=[];try{for(n=0,a=e.length;n<a;n++)i=e[n],s.push(this.getElement(i,t))}catch(e){e,s=null}}else if("string"==typeof e)for(s=[],o=0,r=(l=document.querySelectorAll(e)).length;o<r;o++)i=l[o],s.push(i);else null!=e.nodeType&&(s=[e]);if(null==s||!s.length)throw new Error("Invalid `"+t+"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.");return s},i.confirm=function(e,t,i){return window.confirm(e)?t():null!=i?i():void 0},i.isValidFile=function(e,t){var i,s,n,o,a;if(!t)return!0;for(t=t.split(","),i=(s=e.type).replace(/\/.*$/,""),o=0,a=t.length;o<a;o++)if("."===(n=(n=t[o]).trim()).charAt(0)){if(-1!==e.name.toLowerCase().indexOf(n.toLowerCase(),e.name.length-n.length))return!0}else if(/\/\*$/.test(n)){if(i===n.replace(/\/.*$/,""))return!0}else if(s===n)return!0;return!1},void 0!==e&&null!==e&&(e.fn.dropzone=function(e){return this.each(function(){return new i(this,e)})}),void 0!==t&&null!==t?t.exports=i:window.Dropzone=i,i.ADDED="added",i.QUEUED="queued",i.ACCEPTED=i.QUEUED,i.UPLOADING="uploading",i.PROCESSING=i.UPLOADING,i.CANCELED="canceled",i.ERROR="error",i.SUCCESS="success",a=function(e){var t,i,s,n,o,a,r,l;for(e.naturalWidth,o=e.naturalHeight,(t=document.createElement("canvas")).width=1,t.height=o,(i=t.getContext("2d")).drawImage(e,0,0),s=i.getImageData(0,0,1,o).data,l=0,n=o,a=o;a>l;)0===s[4*(a-1)+3]?n=a:l=a,a=n+l>>1;return 0===(r=a/o)?1:r},r=function(e,t,i,s,n,o,r,l,c,h){var d;return d=a(t),e.drawImage(t,i,s,n,o,r,l,c,h/d)},o=function(e,t){var i,s,n,o,a,r,l,c,h;if(n=!1,h=!0,s=e.document,c=s.documentElement,i=s.addEventListener?"addEventListener":"attachEvent",l=s.addEventListener?"removeEventListener":"detachEvent",r=s.addEventListener?"":"on",o=function(i){if("readystatechange"!==i.type||"complete"===s.readyState)return("load"===i.type?e:s)[l](r+i.type,o,!1),!n&&(n=!0)?t.call(e,i.type||i):void 0},a=function(){try{c.doScroll("left")}catch(e){return e,void setTimeout(a,50)}return o("poll")},"complete"!==s.readyState){if(s.createEventObject&&c.doScroll){try{h=!e.frameElement}catch(e){}h&&a()}return s[i](r+"DOMContentLoaded",o,!1),s[i](r+"readystatechange",o,!1),e[i](r+"load",o,!1)}},i._autoDiscoverFunction=function(){if(i.autoDiscover)return i.discover()},o(window,i._autoDiscoverFunction)}).call(this)}).call(this,i(18),i(382)(e))},923:function(e,t,i){var s=i(13),n=i(3),o=i(6),a=i(4),r=i(1),l=i(1266),c=i(1225),h=i(1846),d=i(1223),u=i(86),p=i(1845),g=i(1844),m=i(104),f=i(85),_=i(59);e.exports=a.extend({events:{"click .js-back":"_onBackFromError"},className:"Dialog-content Dialog-content--expanded",initialize:function initialize(e){if(!e.modalModel)throw new TypeError("modalModel is required");if(!e.visDefinitionModel)throw new TypeError("visDefinitionModel is required");if(!e.configModel)throw new TypeError("configModel is required");if(void 0===e.isLocked)throw new TypeError("isLocked is required");this._modalModel=e.modalModel,this._visDefinitionModel=e.visDefinitionModel,this._configModel=e.configModel,this._isLocked=e.isLocked,this._visMetadataModel=new l({name:this._visDefinitionModel.get("name"),description:this._visDefinitionModel.get("description"),license:this._visDefinitionModel.get("license"),source:this._visDefinitionModel.get("source"),attributions:this._visDefinitionModel.get("attributions"),tags:this._visDefinitionModel.get("tags")}),this._stateModel=new o.Model({status:"show"}),this._initBinds()},render:function render(){return this.clearSubViews(),this._hasError()?this._renderError():this._isLoading()?this._renderLoading():(this.$el.html(c()),this._initViews()),this},_initViews:function _initViews(){var e,t,i=new p({visDefinitionModel:this._visDefinitionModel,visMetadataModel:this._visMetadataModel,configModel:this._configModel,isLocked:this._isLocked});this.$(".js-content").append(i.render().el),this.addView(i);var s=new h({visMetadataModel:this._visMetadataModel,onSaveAction:n(e=this._onSave).call(e,this),onCloseAction:n(t=this._onClose).call(t,this)});this.$(".js-footer").append(s.render().el),this.addView(s)},_renderError:function _renderError(){var e=this._stateModel.get("error");this.$el.html(d({error:_t("components.modals.dataset-metadata.error.subtitle",{error:e})}))},_renderLoading:function _renderLoading(){this.$el.html(u({title:_t("components.modals.dataset-metadata.loading")}))},_initBinds:function _initBinds(){this._stateModel.on("change:status",this.render,this),this.add_related_model(this._stateModel)},_hasError:function _hasError(){return"error"===this._stateModel.get("status")},_isLoading:function _isLoading(){return"loading"===this._stateModel.get("status")},_onSave:function _onSave(){var e,t;this._stateModel.set({status:"loading"}),g({onSuccess:n(e=this._onSuccessSave).call(e,this),onError:n(t=this._onErrorSave).call(t,this),visDefinitionModel:this._visDefinitionModel,name:this._getMetadataName(),description:this._getMetadataDescription(),tags:this._getMetadataTags(),source:this._visMetadataModel.get("source"),attributions:this._visMetadataModel.get("attributions"),license:this._visMetadataModel.get("license")})},_onSuccessSave:function _onSuccessSave(){f.addNotification({status:"success",info:_t("components.modals.dataset-metadata.success",{name:this._getMetadataName()}),closable:!0,delay:f.DEFAULT_DELAY}),this._modalModel.destroy()},_onClose:function _onClose(){this._modalModel.destroy()},_onErrorSave:function _onErrorSave(e){this._stateModel.set({status:"error",error:m(e)})},_onBackFromError:function _onBackFromError(){this._stateModel.set({status:"show"})},_getMetadataName:function _getMetadataName(){return _.sanitizeHtml(this._visMetadataModel.get("name"))},_getMetadataDescription:function _getMetadataDescription(){return _.sanitizeHtml(this._visMetadataModel.get("description"))},_getMetadataTags:function _getMetadataTags(){return s(r).call(r,this._visMetadataModel.get("tags"),function(e){return _.sanitizeHtml(e)})}})},924:function(e,t){e.exports=" | CARTO"},925:function(e,t,i){var s=i(28),n=i(367),o=i(502),a=i(1045),r=i(14),l=["modalModel","privacyType"];e.exports=n.extend({className:"Dialog-content",events:{"click .js-confirm":"_onConfirm","click .js-cancel":"_onDismiss"},initialize:function initialize(e){r(e,l,this),this.options.onConfirm&&(this._onConfirmCallback=this.options.onConfirm),this.options.onDismiss&&(this._onDismissCallback=this.options.onDismiss)},render:function render(){var e;this.clearSubViews(),this.$el.html(a({type:this.options.type||"visualization",selectedPrivacyType:this._privacyType}));var t=new o({placeholder:s(e=this.$el).call(e,".js-icon-warning"),icon:"warning"});return t.render(),this.addView(t),this},_onConfirm:function _onConfirm(){this._modalModel.destroy(),this._onConfirmCallback&&this._onConfirmCallback()},_onDismiss:function _onDismiss(){this._modalModel.destroy(),this._onDismissCallback&&this._onDismissCallback()}})},926:function(e,t,i){var s=i(1),n=i(6),o=i(503),a=i(332);e.exports=n.Collection.extend({DEFAULT_FETCH_OPTIONS:{type:"table",order:"updated_at",page:1,per_page:20,exclude_shared:!1,exclude_raster:!0,tags:"",q:""},model:function model(e,t){var i=t.collection._configModel;return new("derived"!==e.type?o:a)(e,{configModel:i})},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");this._configModel=t.configModel,this._stats={}},url:function url(){var e=this._configModel.urlVersion("visualization");return this._configModel.get("base_url")+"/api/"+e+"/viz"},fetch:function fetch(e){return this.trigger("loading",this),(e=e||{data:{per_page:1e3}}).data=s.extend({},this.DEFAULT_FETCH_OPTIONS,e.data),n.Collection.prototype.fetch.call(this,e)},getDefaultParam:function getDefaultParam(e){return this.DEFAULT_FETCH_OPTIONS[e]},getTotalStat:function getTotalStat(e){return this._stats[e]||0},parse:function parse(e){return this._stats=s.omit(e,"visualizations"),e.visualizations}})},927:function(e,t,i){i(23),i(101),i(31);var s=i(3);i(31);var n=i(1),o=i(6),a=i(1047),r=i(345),l=i(332),c=i(619);e.exports=o.Model.extend({defaults:{step:"upload",state:""},initialize:function initialize(e,t){if(!t.userModel)throw new Error("userModel is required");if(!t.configModel)throw new Error("configModel is required");this._userModel=t.userModel,this._configModel=t.configModel,this._uploadModel=new r(t.upload,{userModel:this._userModel,configModel:this._configModel}),n.isEmpty(t)&&(t={}),this._importModel=new a(t.import,{configModel:this._configModel}),this._initBinds(),this._checkStatus()},_initBinds:function _initBinds(){var e,t,i,n,o;s(e=this).call(e,"change:import",this._onImportChange,this),s(t=this).call(t,"change:upload",this._onUploadChange,this),s(i=this).call(i,"change:id",this._onIdChange,this),s(n=this._importModel).call(n,"change",function(){this.trigger("change:import",this),this.trigger("change",this)},this),s(o=this._uploadModel).call(o,"change",function(){this.trigger("change:upload",this),this.trigger("change",this)},this)},_destroyBinds:function _destroyBinds(){this._uploadModel.unbind(null,null,this),this._importModel.unbind(null,null,this)},_onIdChange:function _onIdChange(){var e=this.get("id");e&&this._importModel.set("item_queue_id",e),this.set("step","import")},_onUploadChange:function _onUploadChange(e,t){if("upload"===this.get("step")){var i=this._uploadModel.get("item_queue_id"),s=this._uploadModel.get("state");i&&this.set("id",i),s&&this.set("state",s)}},_onImportChange:function _onImportChange(){if("import"===this.get("step")){var e=this._importModel.get("state");e&&this.set("state",e)}},_checkStatus:function _checkStatus(){this.get("id")||this._uploadModel.isValid()?"file"===this._uploadModel.get("type")?this._uploadModel.upload():this.get("id")?(this.set("step","import"),this._importModel.set("item_queue_id",this.get("id"))):this._importModel.get("item_queue_id")||""===this._uploadModel.get("type")||(this.set("step","import"),this._importModel.createImport(this._uploadModel.toJSON())):this.trigger("change:upload")},getImportModel:function getImportModel(){return this._importModel},pause:function pause(){this.stopUpload(),this.stopImport()},hasFailed:function hasFailed(){var e=this.get("state"),t=this.get("step");return"import"===t&&"failure"===e||"upload"===t&&"error"===e},hasCompleted:function hasCompleted(){return"import"===this.get("step")&&this._importModel&&"complete"===this._importModel.get("state")},getWarnings:function getWarnings(){return"import"===this.get("step")?this._importModel.get("warnings"):""},getError:function getError(){if(this.hasFailed()){var e=this.get("step");return n.extend({errorCode:this["upload"===e?"_uploadModel":"_importModel"].get("error_code"),itemQueueId:"import"===e?this._importModel.get("id"):"",originalUrl:"import"===e?this._importModel.get("original_url"):"",dataType:"import"===e?this._importModel.get("data_type"):"",httpResponseCode:"import"===e?this._importModel.get("http_response_code"):"",httpResponseCodeMessage:"import"===e?this._importModel.get("http_response_code_message"):""},this["upload"===e?"_uploadModel":"_importModel"].get("get_error_text"))}return{title:"",what_about:"",error_code:""}},importedVis:function importedVis(){return this.get("import").derived_visualization_id?this._getMapVis():this._getDatasetVis()},getNumberOfTablesCreated:function getNumberOfTablesCreated(){return this._importModel.get("tables_created_count")},_getServiceName:function _getServiceName(){return this._importModel.get("service_name")},isTwitterImport:function isTwitterImport(){return"twitter_search"===this._getServiceName()},isCartoImport:function isCartoImport(){return this._getDisplayName()&&this._getDisplayName().match(/\.carto$/i)},_getDisplayName:function _getDisplayName(){return this._importModel.get("display_name")},_getMapVis:function _getMapVis(){var e=this._importModel.get("derived_visualization_id");return!!e&&this._createVis({type:"derived",id:e})},_getDatasetVis:function _getDatasetVis(){var e=this._importModel.get("table_name");return!!e&&this._createVis({type:"table",table:{name:e}})},_createVis:function _createVis(e){var t=new l(e,{configModel:this._configModel});return t.permission=new c({owner:this._userModel.attributes},{configModel:this._configModel,userModel:this._userModel}),t},setError:function setError(e){var t=this["upload"===this.get("step")?"_uploadModel":"_importModel"];this.stopUpload(),this.stopImport(),t.set(e),this.set("state","error")},stopUpload:function stopUpload(){this._uploadModel.stopUpload()},stopImport:function stopImport(){this._importModel.destroyCheck()},get:function get(e){return"upload"===e?this._uploadModel.toJSON():"import"===e?this._importModel.toJSON():o.Model.prototype.get.call(this,e)},getRedirectUrl:function getRedirectUrl(e){var t=this.importedVis();if(t)return encodeURI(t.viewUrl(e).edit())},toJSON:function toJSON(){return{step:this.get("step"),id:this.get("id"),state:this.get("state"),upload:this._uploadModel.toJSON(),import:this._importModel.toJSON()}}})},953:function(e,t,i){var s=i(4),n=i(1357),o=i(58);e.exports=s.extend({events:{"click .js-redo":"_onRedoClick","click .js-undo":"_onUndoClick","click .js-apply":"_onApplyClick","click .js-clear":"_onClearClick"},options:{applyButton:!1,cancelButton:!1},initialize:function initialize(e){if(!e.editorModel)throw new Error("editorModel is required");if(!e.trackModel)throw new Error("trackModel is required");this._trackModel=e.trackModel,this._editorModel=e.editorModel,this._clearModel=e.clearModel,this._applyStatusModel=e.applyStatusModel,this._overlayModel=e.overlayModel,this._initBinds()},render:function render(){this.clearSubViews();var e=!1;return this._clearModel&&(e=!0===this._clearModel.get("visible")),this.$el.html(n({canUndo:this._canUndo(),canRedo:this._canRedo(),canApply:this.options.applyButton&&this._editorModel.isEditing(),canClear:e,isDisabled:this._isDisabled(),isLoading:this._applyStatusModel&&this._applyStatusModel.get("loading")})),this._initViews(),this._checkButtonsStyle(),this},_initViews:function _initViews(){if(this._canUndo()){var e=new o({el:this.$(".js-undo"),gravity:"s",title:function title(){return _t("components.undo-redo.undo")}});this.addView(e)}if(this._canRedo()){var t=new o({el:this.$(".js-redo"),gravity:"s",title:function title(){return _t("components.undo-redo.redo")}});this.addView(t)}},_initBinds:function _initBinds(){this.listenTo(this._trackModel,"undo redo",this.render),this.listenTo(this._trackModel,"unredoChanged",this.render),this.listenTo(this._editorModel,"change:edition",this._checkButtonsStyle),this._overlayModel&&this.listenTo(this._overlayModel,"change:visible",this.render),this._clearModel&&this.listenTo(this._clearModel,"change",this.render),this._applyStatusModel&&this.listenTo(this._applyStatusModel,"change:loading",this._applyStatusChanged)},_isDisabled:function _isDisabled(){return this._overlayModel&&this._overlayModel.get("visible")},_canRedo:function _canRedo(){return this._trackModel.canRedo()&&!this._isDisabled()},_canUndo:function _canUndo(){return this._trackModel.canUndo()&&!this._isDisabled()},_onUndoClick:function _onUndoClick(){this._trackModel.canUndo()&&this._trackModel.undo()},_onRedoClick:function _onRedoClick(){this._trackModel.canRedo()&&this._trackModel.redo()},_onApplyClick:function _onApplyClick(){this.options.applyButton&&this.options.onApplyClick&&!this._isDisabled()&&this.options.onApplyClick()},_onClearClick:function _onClearClick(){this.options.clearButton&&this.options.onClearClick&&this.options.onClearClick()},_checkButtonsStyle:function _checkButtonsStyle(e){var t=this._editorModel.isEditing();this._getIcons().toggleClass("u-actionTextColor",!t),this._getIcons().toggleClass("u-whiteTextColor",t)},_getIcons:function _getIcons(){return this.$(".js-theme")},_applyStatusChanged:function _applyStatusChanged(){this.render()}})},954:function(e,t,i){var s=i(4),n=i(14),o=["infoboxModel","infoboxCollection"];e.exports=s.extend({initialize:function initialize(e){n(e,o,this),this._initBinds(),this._setSelectedModel()},render:function render(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initBinds:function _initBinds(){this.listenTo(this._infoboxModel,"change:state",this._onChangeState),this.listenTo(this._infoboxModel,"change:visible",this.render)},_initViews:function _initViews(){var e;this._selectedModel&&(e=this._selectedModel.get("createContentView"),this.infoboxView=e(),this.$el.append(this.infoboxView.render().el),this.addView(this.infoboxView),this._initSubviewBinds())},_setSelectedModel:function _setSelectedModel(){var e=this._infoboxModel.get("state");this._selectedModel=this._infoboxCollection.setSelected(e)},_onChangeState:function _onChangeState(){this._setSelectedModel(),this.render()},_initSubviewBinds:function _initSubviewBinds(){this.listenTo(this.infoboxView,"action:main",this._onAction),this.listenTo(this.infoboxView,"action:close",this._onClose)},_onAction:function _onAction(){var e=this._selectedModel.get("onAction");e&&e()},_onClose:function _onClose(){var e=this._selectedModel.get("onClose");e?e():this._infoboxModel.set("state",null)}})},955:function(e,t,i){i(37);var s=i(13),n=i(1),o=i(85),a=n.template("<span class='CDB-Text u-errorTextColor'><%- title %></span>"),r={track:function track(e){this._notificationId="sql-notifications"},removeNotification:function removeNotification(){o.removeNotification(this._notificationId)},showNotification:function showNotification(e){this._addOrUpdateNotification(this._notificationId,e)},showErrorNotification:function showErrorNotification(e){var t={status:"error",info:_t("notifications.sql.error.body",{body:a({title:_t("notifications.sql.error.title")}),error:this._transformErrors(e)}),closable:!1};this._addOrUpdateNotification(this._notificationId,t)},_transformErrors:function _transformErrors(e){return s(n).call(n,e,function(e){return e.message},this).join(". ")},_addOrUpdateNotification:function _addOrUpdateNotification(e,t){var i=this._getNotification(e);i?i.set(t):this._addNotification(e,t)},_addNotification:function _addNotification(e,t){t=n.extend({id:e},t),o.addNotification(t)},_getNotification:function _getNotification(e){return o.getNotification(e)}};e.exports=r},956:function(e,t,i){i(37),i(23),i(40);var s=i(360),n=i(32),o=i(3),a=i(18),r=i(1),l=i(4),c=i(86),h=i(264),d=i(1366),u=i(14),p=i(263),g=i(262),m=i(2451),f=[{format:"csv",fetcher:"fetchCSV",geomRequired:!1},{format:"shp",fetcher:"fetch",geomRequired:!0},{format:"kml",fetcher:"fetch",geomRequired:!0},{format:"geojson",label:"geo json",fetcher:"fetch",geomRequired:!0},{format:"svg",fetcher:"fetchSVG",geomRequired:!0},{format:"gpkg",fetcher:"fetch",geomRequired:!0}],_=["configModel","queryGeometryModel","querySchemaModel","canHideColumns","modalModel","fromView"];e.exports=l.extend({className:"Dialog-content",events:{"click .js-confirm":"_onConfirm","click .js-cancel":"_close"},options:{autoClose:!0},initialize:function initialize(e){u(e,_,this),this._layerModel=e.layerModel,this._filename=e.filename,this._initBinds(),"unfetched"===this._queryGeometryModel.get("status")&&this._queryGeometryModel.fetch()},render:function render(){return this.clearSubViews(),this.$el.empty(),"fetched"===this._queryGeometryModel.get("status")||"unavailable"===this._queryGeometryModel.get("status")?this._renderFormats():this._renderLoadingContent(_t("components.modals.export-data.loading.geometry")),this},_renderFormats:function _renderFormats(){var e=this._queryGeometryModel.get("simple_geom"),t=!!e;this.$el.html(d({isGeoreferenced:t,url:this._configModel.getSqlApiUrl()}));var i=!0;r.each(f,function(s){var n=!1===t&&!0===s.geomRequired;!0!==t||null==s.geomRestricted||n||(n=!r.contains(s.geomRestricted,e)),this._renderFormat(s,n,!n&&i),n||(i=!1)},this)},_renderFormat:function _renderFormat(e,t,i){var s=new m({format:e,isDisabled:t,isChecked:i});this.$(".js-formats").append(s.render().el),this.addView(s)},_initBinds:function _initBinds(){var e;o(e=this._queryGeometryModel).call(e,"change:status",function(){"unavailable"!==this._queryGeometryModel.get("status")?this.render():this.showError(_t("components.modals.export-data.error.geometry-error"))},this),this.add_related_model(this._queryGeometryModel)},_getFormat:function _getFormat(e){for(var t in f)if(f[t].format===e)return f[t]},_onConfirm:function _onConfirm(){this._form=this.$(".js-form");var e=a(".js-format[name=format]:checked",this._form).data("format"),t=this._getFormat(e);this._layerModel&&p.track(g.DOWNLOADED_LAYER,{format:e,layer_id:this._layerModel.get("id"),source:this._layerModel.get("source"),visible:this._layerModel.get("visible"),table_name:this._layerModel.get("table_name"),from_view:this._fromView}),this[t.fetcher](e)},getBaseOptions:function getBaseOptions(){return{filename:this._filename,apiKey:this._configModel.get("api_key")}},getGeomFilteredSql:function getGeomFilteredSql(){var e=this._queryGeometryModel.get("query");return this._queryGeometryModel.get("simple_geom")?"SELECT * FROM (%%sql%%) as subq ".replace(/%%sql%%/g,e):e},_fetch:function _fetch(e,t){this.$(".js-format").val(e.format),this.$(".js-q").val(t),this.$(".js-filename").val(e.filename),this.$(".js-apiKey").val(e.apiKey);var i=["the_geom_webmercator"];if("csv"!==e.format&&i.push("the_geom"),this._canHideColumns){var s=this._querySchemaModel.getColumnNames();-1!==n(s).call(s,"center")&&"geometry"===this._querySchemaModel.getColumnType("center")&&i.push("center")}if(this.$(".js-skipfields").val(i.join(",")),t.length<1e3){var o=this.$(".js-form").attr("action")+"?"+this.$(".js-form").serialize();this._fetchGET(o)}else this.submit();this.$(".js-skipfields").attr("disabled","disabled"),this.options.autoClose?this._close():this._renderLoadingContent(_t("components.modals.export-data.loading.preparing"))},showError:function showError(e){var t=new h({title:_t("hello"),desc:e});this.$el.html(t.render().el),this.addView(t)},_fetchGET:function _fetchGET(e){var t,i=this,o=window.open(e);o.onload=function(){clearInterval(t);var e=function getError(e){var t=null;try{t=JSON.parse(e).error[0]}catch(i){e&&-1!==n(e).call(e,"error")&&(t=_t("components.modals.export-data.error.unknown"))}return t}(o.document.body.textContent);e?i.showError(e):i._close(),o.close()},window.focus(),t=s(function check(){(o.closed||o.document&&0===o.document.body.textContent.length)&&(i._close(),clearInterval(t))},100)},fetch:function fetch(e){var t=this.getBaseOptions();t.format=e;var i=this._queryGeometryModel.get("query");this._fetch(t,i)},fetchCSV:function fetchCSV(){var e=this.getBaseOptions();e.format="csv";var t=this.getGeomFilteredSql();this.$(".js-skipfields").removeAttr("disabled"),this._fetch(e,t)},fetchSVG:function fetchSVG(){this.fetch("svg")},submit:function submit(){this.$(".js-form").submit()},_renderLoadingContent:function _renderLoadingContent(e){this.$el.html(c({title:e}))},_close:function _close(){this._modalModel.destroy()}})},957:function(e,t){function someNode(e,t){if(t(e))return e;if("source"!==e.get("type")){var i=e.getPrimarySource&&e.getPrimarySource();if(i)return someNode(i,t)}return!1}function hasAnalysisType(e){return function(t){return t.get("type")===e}}var i=hasAnalysisType("trade-area"),s=hasAnalysisType("deprecated-sql-function");e.exports={nodeHasTradeArea:function nodeHasTradeArea(e){return someNode(e,i)},nodeHasSQLFunction:function nodeHasSQLFunction(e){return someNode(e,s)},getSourceNode:function getSourceNode(e){var t;if("source"===e.get("type"))t=e;else{var i=e.getPrimarySource&&e.getPrimarySource();t=i&&"source"===i.get("type")?i:getSourceNode(i)}return t},someNode:someNode}},958:function(e,t,i){i(35);var s=i(7),n=i(1),o=i(6),a={number:["date"],boolean:["date"],date:["boolean"]},r={string:{string:!1,number:!0,date:!0,boolean:!0},number:{string:!1,number:!1,date:!0,boolean:!0},date:{string:!1,number:!0,date:!1,boolean:!0},boolean:{string:!1,number:!1,date:!0,boolean:!1}},l=["the_geom_webmercator","cartodb_id","the_geom"];e.exports=o.Model.extend({url:function url(){if(this._tableName){var url=this._configModel.get("base_url")+"/api/"+this._configModel.urlVersion("column")+"/tables/"+this._tableName+"/columns/";return this.isNew()||(url+=this.previous("name")||this.get("name")),url}return!1},parse:function parse(e){return{name:e.name,type:e.cartodb_type||e.type,isNew:!1}},initialize:function initialize(e,t){if(!t.configModel)throw new Error("configModel is required");this._tableName=t.tableName,this._configModel=t.configModel},isNew:function isNew(){return this.get("isNew")},isEditable:function isEditable(){return!n.contains(l,this.get("name"))},isCartoDBIDColumn:function isCartoDBIDColumn(){return"cartodb_id"===this.get("name")&&"number"===this.get("type")},isGeometryColumn:function isGeometryColumn(){return"geometry"===this.get("type")}},{isTypeChangeDestructive:function isTypeChangeDestructive(e,t){return r[e][t]},isTypeChangeAllowed:function isTypeChangeAllowed(e,t){var i=a[e]||[];return i=s(i).call(i,[e]),!n.contains(i,t)}})},959:function(e,t,i){var s=i(32),n=i(1),o=i(4),a=i(1389),r=i(14),l=["visDefinitionModel","userModel"];e.exports=o.extend({className:"Share-with u-flex u-alignCenter",events:{click:"_onClick"},initialize:function initialize(e){r(e,l,this),this.separationClass=e.separationClass||"",this.avatarClass=e.avatarClass||"",this.options.clickPrivacyAction&&(this._clickPrivacyAction=this.options.clickPrivacyAction),this._acl=this._visDefinitionModel.getPermissionModel().acl,this._initBinds()},render:function render(){var e=this._getPeople();return this.clearSubViews(),this.$el.html(a({avatar:this._userModel.get("avatar_url"),people:e,avatarClass:this.avatarClass,separationClass:this.separationClass,hasAction:!!this._clickPrivacyAction})),this.$el.toggleClass("is-pointer",!!this._clickPrivacyAction),this},_getPeople:function _getPeople(){var e=this._acl.pluck("type");if(s(e).call(e,"org")>-1)return this._userModel.getOrganization().get("user_count")-1;var t=[];return n.each(this._acl.where({type:"group"}),function(e){var i=e.get("entity");Array.prototype.push.apply(t,i.users.pluck("id"))},this),n.each(this._acl.where({type:"user"}),function(e){var i=e.get("entity");t.push(i.get("id"))},this),t=n.without(t,this._userModel.id),n.unique(t).length},_initBinds:function _initBinds(){this._acl.on("fetch",this.render,this),this.add_related_model(this._acl)},_onClick:function _onClick(){this._clickPrivacyAction&&this._clickPrivacyAction()}})},960:function(e,t,i){var s=i(13),n=i(25),o=i(32),a=i(3),r=i(18),l=i(6),c=i(4),h=i(2484),d=i(925),u=i(2483),p=i(259),g=i(241),m=i(198),f=i(179),_=i(1392),v=i(1391),y=i(58),w=i(332),b=i(14),C=i(476),M=["visDefinitionModel","userModel","privacyCollection","configModel","isOwner"],k={public:"green",link:"orange",password:"orange-dark",private:"red"};e.exports=c.extend({events:{"click .js-toggle":"_onToggleDialogClicked"},initialize:function initialize(e){var t,i;if(b(e,M,this),this._visDefinitionModel.isVisualization()&&!this.options.mapcapsCollection)throw new Error("mapcapsCollection is required for visualizations");this._triggerElementID="toggle"+this.cid,this._modals=new f,this.model=new l.Model({privacy:e.visDefinitionModel.get("privacy"),state:"show"}),this._onEscapePressed=a(t=this._onEscapePressed).call(t,this),this._onDocumentElementClicked=a(i=this._onDocumentElementClicked).call(i,this),this.options.ownerName&&(this._ownerName=this.options.ownerName),this.options.mapcapsCollection&&(this._mapcapsCollection=this.options.mapcapsCollection),this._configPrivacyCollection(),this._configPanes(),this._initBinds()},render:function render(){var e=this.model.get("privacy");"error"===this.model.get("state")&&(e=this.options.visDefinitionModel.get("privacy"));var t=k[e.toLowerCase()],i=this._canChangePrivacy(e);return this.clearSubViews(),this._hideDialog(),this.$el.html(_({privacy:e,cssClass:t,isLoading:"loading"===this.model.get("state"),isOwner:this._isOwner,canChangePrivacy:i})),this._initViews(),this},_initBinds:function _initBinds(){this._customCollection.on("change:selected",function(e){e.get("disabled")||("password"===e.get("val")?this._showPasswordDialog():(this._onToggleDialogClicked(),this._setPrivacy(e.get("val"))))},this),this.add_related_model(this._customCollection),this.model.on("change:state",this.render,this),this.add_related_model(this.model)},_canChangePrivacy:function _canChangePrivacy(e){return"PRIVATE"===e?this._canChangePrivacyFromPrivate(e):this._canChangePrivacyFromPublic(e)},_canChangePrivacyFromPrivate:function _canChangePrivacyFromPrivate(e){var t=this.options.visDefinitionModel.isVisualization(),i=this.options.userModel.hasPublicMapsLimits(),s=this.options.userModel.hasRemainingPublicMaps();return!(i&&t&&!s&&"PRIVATE"===e)},_canChangePrivacyFromPublic:function _canChangePrivacyFromPublic(e){return!0},_makePrivacyDialog:function _makePrivacyDialog(){return new h({model:this.model,collection:this._customCollection,userModel:this._userModel,configModel:this._configModel,visModel:this._visDefinitionModel})},_makePasswordDialog:function _makePasswordDialog(){var e,t;return new u({onBack:a(e=this._showPrivacyDialog).call(e,this),onEdit:a(t=this._setPassword).call(t,this)})},_setPassword:function _setPassword(e){""!==e&&(this._privacyCollection.passwordOption().set({password:e}),this.model.set({password:e}),this._setPrivacy("password"))},_setPrivacy:function _setPrivacy(e){var t,i,s=e.toUpperCase();(this.model.set({privacy:s},{silent:!0}),this._shouldShowPrivacyWarning(s))?this._checkPrivacyChange(s,a(t=this._savePrivacy).call(t,this),a(i=this._discardPrivacyChange).call(i,this)):this._savePrivacy()},_savePrivacy:function _savePrivacy(){var e=this,t=this._visDefinitionModel;this.model.set({state:"loading"}),this._privacyCollection.searchByPrivacy(this.model.get("privacy")).saveToVis(t,{success:function success(){e.model.set({state:"show"})},error:function error(t,i){var s;-1!==o(s=i.responseText).call(s,"over account public map quota")&&e._modals.create(function(){return new C({error:{errorCode:8007},userModel:e._userModel,configModel:e._configModel})}),e.model.set({state:"error"})}})},_checkPrivacyChange:function _checkPrivacyChange(e,t,i){var s=this;this._modals.create(function(n){return new d({modalModel:n,privacyType:e,type:s._visDefinitionModel.isVisualization()?"visualization":"dataset",onConfirm:t,onDismiss:i})})},_discardPrivacyChange:function _discardPrivacyChange(){var e=this.model.previous("privacy");this.model.set("privacy",e,{silent:!0}),this.model.set("state","show")},_shouldShowPrivacyWarning:function _shouldShowPrivacyWarning(e){if(!this._userModel.canSelectPremiumOptions(this._visDefinitionModel))return!1;var t=w.isPubliclyAvailable(e);return this._visDefinitionModel.isVisualization()?!!this._mapcapsCollection.length&&t:t},_transformPrivacyOptions:function _transformPrivacyOptions(){var e,t;return n(e=s(t=this._privacyCollection).call(t,function(e){return{label:e.get("title"),val:e.get("privacy").toLowerCase(),disabled:e.get("disabled"),selected:e.get("selected"),renderOptions:{cssClass:e.get("cssClass")}}})).call(e,Boolean)},_configPrivacyCollection:function _configPrivacyCollection(){var e=this._transformPrivacyOptions();this._customCollection=new m(e)},_configPanes:function _configPanes(){var e,t,i=[{createContentView:this._showNoneDialog},{createContentView:a(e=this._makePrivacyDialog).call(e,this)},{createContentView:a(t=this._makePasswordDialog).call(t,this)}];this._collectionPane=new g(i)},_showNoneDialog:function _showNoneDialog(){return!1},_showPasswordDialog:function _showPasswordDialog(){this._collectionPane.at(2).set({selected:!0})},_showPrivacyDialog:function _showPrivacyDialog(){this._customCollection.each(function(e){e.set({selected:!1},{silent:!0})}),this._collectionPane.at(1).set({selected:!0})},_onToggleDialogClicked:function _onToggleDialogClicked(){this._isDialogVisible()?this._hideDialog():(this._onMouseClick(),this._initDocumentBinds(),this._showPrivacyDialog())},_isDialogVisible:function _isDialogVisible(){return!1===this._collectionPane.at(0).get("selected")},_hideDialog:function _hideDialog(){this._destroyDocumentBinds(),this._collectionPane.at(0).set({selected:!0})},_showDialog:function _showDialog(){this._showPrivacyDialog()},_initViews:function _initViews(){var e,t,i=new p({collection:this._collectionPane,template:v,mouseOverAction:a(e=this._onMouseClick).call(e,this)});this.$(".js-dialog").append(i.render().$el),this.addView(i),this._privacyTooltip=new y({el:this.$(".js-tooltip"),gravity:"w",html:!0,title:a(t=function _context13(){return this._getPrivacyInfo()}).call(t,this)}),this.addView(this._privacyTooltip)},_getPrivacyInfo:function _getPrivacyInfo(){var e=_t("change-privacy");return this._ownerName&&(e=_t("dataset.privacy.info",{name:this._ownerName})),e},_initDocumentBinds:function _initDocumentBinds(){r(document).on("keydown",this._onEscapePressed),r(document).on("mousedown",this._onDocumentElementClicked)},_destroyDocumentBinds:function _destroyDocumentBinds(){r(document).off("keydown",this._onEscapePressed),r(document).off("mousedown",this._onDocumentElementClicked)},_onEscapePressed:function _onEscapePressed(e){27===e.which&&this._hideDialog()},_onDocumentElementClicked:function _onDocumentElementClicked(e){var t=r(e.target);0===t.closest(this.$el).length&&0===t.closest(r("#"+this._triggerElementID)).length&&this._hideDialog()},_onMouseClick:function _onMouseClick(){this._privacyTooltip.hideTipsy()},clean:function clean(){this._destroyDocumentBinds(),c.prototype.clean.apply(this)}})},961:function(e,t,i){var s=i(3),n=i(74),o=i(4),a=i(1396),r=i(1395),l=i(557),c=i(1033),h=i(1273),d=i(960),u=i(2482),p=i(959),g=i(2481),m=i(14),f=["modalModel","visDefinitionModel","privacyCollection","userModel","configModel","isOwner"];e.exports=o.extend({className:"Publish-modal",events:{"click .js-done":"_onDone"},initialize:function initialize(e){m(e,f,this),this._mapcapsCollection=e.mapcapsCollection,this.mode=e.mode||"full"},render:function render(){return this.clearSubViews(),this.$el.html(a({name:this._visDefinitionModel.get("name"),isSimple:!this._hasTabs(),hasShareStats:this._hasShareStats()})),this._initViews(),"full"===this.mode?this._hasOrganization()?this._initTabsViews():this._makePublishView():"share"===this.mode?this._makeShareView():"publish"===this.mode&&this._makePublishView(),this},_hasShareStats:function _hasShareStats(){return"publish"!==this.mode&&this._hasOrganization()},_hasOrganization:function _hasOrganization(){return this._userModel.isInsideOrg()},_hasTabs:function _hasTabs(){return this._hasOrganization()&&"full"===this.mode},_makePublishView:function _makePublishView(){var e=this._createPublishView();this.$(".js-panes").append(e.render().el),this.addView(e)},_makeShareView:function _makeShareView(){var e=this._createShareView();this.$(".js-panes").append(e.render().el),this.addView(e)},_initViews:function _initViews(){var e,t,i,s,o;e=new d({privacyCollection:this._privacyCollection,visDefinitionModel:this._visDefinitionModel,mapcapsCollection:this._mapcapsCollection,userModel:this._userModel,configModel:this._configModel,isOwner:this._isOwner}),this.$(".js-dropdown").append(e.render().el),this.addView(e),void 0!==this._mapcapsCollection?(t=new u({visDefinitionModel:this._visDefinitionModel,mapcapsCollection:this._mapcapsCollection,configModel:this._configModel,userModel:this._userModel}),this.$(".js-update").append(t.render().el),this.addView(t)):(o=_t("components.modals.publish.share.last-published",{date:n(this._visDefinitionModel.get("updated_at")).format("Do MMMM YYYY, HH:mm")}),this.$(".js-update").html(o)),this._hasShareStats()&&(i=new p({visDefinitionModel:this._visDefinitionModel,userModel:this._userModel,avatarClass:"Share-user--big",separationClass:"u-rSpace--xl"}),this.$(".js-share-users").append(i.render().el),this.addView(i)),this._hasOrganization()||(s=new g,this.$(".js-upgrade").append(s.render().el),this.addView(s))},_initTabsViews:function _initTabsViews(){var e,t,i=[{name:"share",label:_t("components.modals.publish.menu.share"),createContentView:s(e=this._createShareView).call(e,this)},{name:"publish",label:_t("components.modals.publish.menu.publish"),createContentView:s(t=this._createPublishView).call(t,this)}],n={tabPaneOptions:{template:r,tabPaneItemOptions:{tagName:"li",klassName:"CDB-NavSubmenu-item"}},tabPaneItemLabelOptions:{tagName:"button",className:"CDB-NavSubmenu-link u-upperCase Publish-modalLink"}};this._layerTabPaneView=l(i,n),this.$(".js-panes").append(this._layerTabPaneView.render().$el),this.addView(this._layerTabPaneView)},_createShareView:function _createShareView(){return new h({className:"Share-wrapper",currentUserId:this._userModel.id,visDefinitionModel:this._visDefinitionModel,organization:this._userModel._organizationModel,configModel:this._configModel})},_createPublishView:function _createPublishView(){return new c({visDefinitionModel:this._visDefinitionModel,mapcapsCollection:this._mapcapsCollection,userModel:this._userModel})},_onDone:function _onDone(){this._modalModel.destroy()}})},963:function(e,t,i){i(92),i(34),i(67),i(236),i(257);var s=i(49);e.exports=function(e){if(!e)throw new Error("all query objects are required");if(!e.querySchemaModel)throw new Error("querySchemaModel is required");if(!e.queryGeometryModel)throw new Error("queryGeometryModel is required");if(!e.queryRowsCollection)throw new Error("queryRowsCollection is required");function fetchModel(e){return new s(function(t,i){var s=!1;e.shouldFetch()?(e.fetch(),s=!0):e.isInFinalStatus()?t():s=!0,s&&e.once("inFinalStatus",function(){t()})})}var t=fetchModel(e.querySchemaModel),i=fetchModel(e.queryGeometryModel);return s.all([t,i]).then(function(){return fetchModel(e.queryRowsCollection)})}},971:function(e,t,i){var s=i(18),n={_isViewport:function(e){return s(window).width()<e},isMobileViewport:function(){return this._isViewport(480)},isTabletViewport:function(){return this._isViewport(760)}};e.exports=n},975:function(e,t,i){var s=i(2582),n=i(1);e.exports={getURLFromState:function(e){var t=new s(this.getLocalURL());if(t.removeQuery("state"),!n.isEmpty(e)){var i=JSON.stringify(e);t.setQuery("state",i)}return t.toString()},getStateFromCurrentURL:function(){var e=this.getLocalURL();return this.getStateFromURL(e)},getStateFromURL:function(e){var t,i=new s(e),o={};return i.hasQuery("state")&&(t=i.query(!0).state,n.isEmpty(t)||(o=JSON.parse(decodeURIComponent(t)))),o},getLocalURL:n.constant(window.location.href)}},976:function(e,t,i){i(23),i(40);var s=i(6),n=i(1);e.exports=s.Model.extend({defaults:{base_url:"/CHANGEME"},urlVersion:function urlVersion(e,t,i){return t=t||"",this.get(e+"_"+t+"_url_version")||i||"v1"},getSqlApiUrl:function getSqlApiUrl(e){return e=e||"v2",this._getSqlApiBaseUrl()+"/api/"+e+"/sql"},_getSqlApiBaseUrl:function _getSqlApiBaseUrl(){return this.get("sql_api_template")?this.get("sql_api_template").replace("{user}",this.get("user_name")):this.get("sql_api_protocol")+"://"+this.get("user_name")+"."+this.get("sql_api_domain")+":"+this.get("sql_api_port")},dataServiceEnabled:function dataServiceEnabled(e){var t=this.get("dataservices_enabled");return!!(t&&n.size(t)&&e)&&!!t[e]},dataLibraryEnabled:function dataLibraryEnabled(){return this.get("data_library_enabled")},isHosted:function isHosted(){return this.get("cartodb_com_hosted")}})},984:function(e,t,i){var s=i(4),n=i(983),o=i(14),a=["model"];e.exports=s.extend({initialize:function initialize(e){o(e,a,this),this.listenTo(this.model,"change",this.render)},render:function render(){return this.$el.toggle(this.model.shouldDisplay()),this.$el.html(n({str:this.model.get("msg"),type:this.model.get("type")})),this}})},985:function(e,t,i){var s=i(6);e.exports=s.Model.extend({defaults:{msg:"",type:"error",display:!1},shouldDisplay:function shouldDisplay(){return this.get("display")&&!!this.get("msg")&&!!this.get("type")},show:function show(e,t){return this.set({display:!0,msg:e,type:t})},hide:function hide(){this.set("display",!1)}})},990:function(e,t,i){var s=i(4),n=i(989),o=i(14),a=["configModel","userModel"];e.exports=s.extend({initialize:function initialize(e){o(e,a,this),this._initBinds()},render:function render(){var e=this._configModel.get("upgrade_url"),t=e&&!this._configModel.get("cartodb_com_hosted")&&(!this._userModel.isInsideOrg()||this._userModel.isOrgOwner());return this.$el.html(n({canUpgrade:t,closeToLimits:this._userModel.isCloseToLimits(),upgradeableWithoutContactingSales:!this._userModel.isEnterprise(),quotaPer:100*this._userModel.get("remaining_byte_quota")/this._userModel.get("quota_in_bytes"),upgradeUrl:e,showTrial:this._userModel.canStartTrial()})),this},_initBinds:function _initBinds(){this.listenTo(this._userModel,"change",this.render)}})},997:function(e,t,i){i(35),i(23),i(326);var s=i(44),n=i(1),o=function LocalStorageWrapper(e){this.name=e||"cartodb",!localStorage.getItem(this.name)&&this.isEnabled()&&localStorage.setItem(this.name,"{}")};o.prototype.isEnabled=function(){try{return localStorage.setItem("checking","test"),localStorage.removeItem("checking"),!0}catch(e){return!1}},o.prototype.get=function(e){return!!this.isEnabled()&&(void 0===e?JSON.parse(localStorage.getItem(this.name)):JSON.parse(localStorage.getItem(this.name))[e])},o.prototype.search=function(e){if(!this.isEnabled())return null;var t=JSON.parse(localStorage.getItem(this.name));for(var i in t)if(t[i][e])return t[i][e];return null},o.prototype.set=function(e){if(!this.isEnabled())return null;var t=n.extend(this.get(),e);return localStorage.setItem(this.name,s(t))},o.prototype.add=function(e){return this.set(e)},o.prototype.remove=function(e){if(!this.isEnabled())return null;var t=n.omit(this.get(),e);return localStorage.setItem(this.name,s(t))},o.prototype.destroy=function(){localStorage.removeItem(this.name)},e.exports=o}}]);
//# sourceMappingURL=common.js.map